<form nz-form [formGroup]="taskForm" nzLayout="vertical" (ngSubmit)="onSubmit()">
  <nz-spin [nzSpinning]="loading()">
    <nz-form-item>
      <nz-form-label nzRequired>任務名稱</nz-form-label>
      <nz-form-control nzErrorTip="請輸入任務名稱（最多 200 字）">
        <input nz-input formControlName="name" placeholder="任務名稱" maxlength="200" />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label>任務描述</nz-form-label>
      <nz-form-control>
        <textarea nz-input formControlName="description" placeholder="說明" [nzAutosize]="{ minRows: 3, maxRows: 6 }"></textarea>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label>備註</nz-form-label>
      <nz-form-control>
        <textarea nz-input formControlName="notes" placeholder="內部備註" [nzAutosize]="{ minRows: 2, maxRows: 4 }"></textarea>
      </nz-form-control>
    </nz-form-item>

    @if (quantityLoading()) {
    <nz-alert nzType="info" nzMessage="正在載入數量資料..." nzShowIcon [style.margin-bottom.px]="12"></nz-alert>
    }

    <nz-form-item>
      <nz-form-label nzRequired>進度單位</nz-form-label>
      <nz-form-control nzErrorTip="請輸入進度單位">
        <input nz-input formControlName="quantityUnit" placeholder="例如：孔、次、項" maxlength="32" />
      </nz-form-control>
    </nz-form-item>

    <div nz-row [nzGutter]="16">
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired>計畫數量</nz-form-label>
          <nz-form-control nzErrorTip="計畫數量需大於 0">
            <nz-input-number formControlName="plannedQuantity" [nzMin]="1" [nzStep]="1" [nzPrecision]="0"
              style="width: 100%"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label>已完成數量</nz-form-label>
          <nz-form-control nzErrorTip="不可小於 0">
            <nz-input-number formControlName="installedQuantity" [nzMin]="0" [nzStep]="1" [nzPrecision]="0"
              style="width: 100%"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label>已使用數量</nz-form-label>
          <nz-form-control nzErrorTip="不可小於 0">
            <nz-input-number formControlName="usedQuantity" [nzMin]="0" [nzStep]="1" [nzPrecision]="0"
              style="width: 100%"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <div nz-row [nzGutter]="16">
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>狀態</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="status">
              <nz-option nzLabel="待辦" nzValue="todo"></nz-option>
              <nz-option nzLabel="進行中" nzValue="in-progress"></nz-option>
              <nz-option nzLabel="已完成" nzValue="completed"></nz-option>
              <nz-option nzLabel="已取消" nzValue="cancelled"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>優先級</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="priority">
              <nz-option nzLabel="低" nzValue="low"></nz-option>
              <nz-option nzLabel="中" nzValue="medium"></nz-option>
              <nz-option nzLabel="高" nzValue="high"></nz-option>
              <nz-option nzLabel="緊急" nzValue="urgent"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <nz-form-item>
      <nz-form-label>標籤</nz-form-label>
      <nz-form-control>
        <nz-select nzMode="tags" formControlName="tags" nzPlaceHolder="輸入標籤後按 Enter"></nz-select>
      </nz-form-control>
    </nz-form-item>

    <div nz-row [nzGutter]="16">
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label>分類</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="category" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label>子分類</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="subcategory" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label>工作類型</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="workType" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <div nz-row [nzGutter]="16">
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>專業</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="discipline" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>負責人</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="assignedTo" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <div nz-space nzDirection="horizontal" class="form-actions">
      <button nz-button nzType="primary" [disabled]="taskForm.invalid || loading()" type="submit">
        {{ isEditMode() ? '更新任務' : '建立任務' }}
      </button>
      <button nz-button nzType="default" type="button" (click)="onCancel()">取消</button>
    </div>
  </nz-spin>
</form>

