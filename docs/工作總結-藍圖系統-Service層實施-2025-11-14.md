# å·¥ä½œç¸½çµ - è—åœ–ç³»çµ± Service å±¤å¯¦æ–½

> **æ—¥æœŸ**ï¼š2025-11-14  
> **ç‹€æ…‹**ï¼šâœ… å®Œæˆ  
> **å¯¦æ–½æ–¹æ³•**ï¼šSequential Thinking + Software Planning Tool

---

## ğŸ“‹ ä»»å‹™æ¦‚è¿°

ç‚ºè—åœ–ç³»çµ±å¯¦æ–½ Service å±¤ï¼ŒåŒ…æ‹¬ 3 å€‹ Service çš„å¯¦ç¾ã€‚æ‰€æœ‰ Service ä½¿ç”¨ Signals ç®¡ç†ç‹€æ…‹ï¼Œå¯¦ç¾ Git-like åˆ†æ”¯é‚è¼¯ã€‚

---

## âœ… å·²å®Œæˆå…§å®¹

### 1. BlueprintService

- **æ–‡ä»¶**ï¼š`src/app/shared/services/blueprint/blueprint.service.ts`
- **ç‹€æ…‹**ï¼šâœ… å®Œæˆ
- **åŠŸèƒ½**ï¼š
  - è—åœ– CRUD æ“ä½œï¼ˆcreateã€updateã€deleteã€loadï¼‰
  - æ ¹æ“šæ“æœ‰è€… IDã€ç‹€æ…‹ã€é …ç›®ä»£ç¢¼æŸ¥è©¢
  - è—åœ–é…ç½®ç®¡ç†ï¼ˆloadConfigsã€getConfigã€setConfigï¼‰
  - ç‹€æ…‹ç®¡ç†ï¼ˆä½¿ç”¨ Signalsï¼‰
  - Computed signalsï¼ˆactiveBlueprintsã€planningBlueprintsã€completedBlueprintsï¼‰

### 2. BranchService

- **æ–‡ä»¶**ï¼š`src/app/shared/services/blueprint/branch.service.ts`
- **ç‹€æ…‹**ï¼šâœ… å®Œæˆ
- **åŠŸèƒ½**ï¼š
  - åˆ†æ”¯ CRUD æ“ä½œ
  - **Fork æ©Ÿåˆ¶**ï¼š`forkBranch()` - å‰µå»ºçµ„ç¹”åˆ†æ”¯ï¼Œè¨˜éŒ„ Fork æ­·å²
  - æ ¹æ“šè—åœ– IDã€çµ„ç¹” ID æŸ¥è©¢åˆ†æ”¯
  - åˆ†æ”¯ç‹€æ…‹ç®¡ç†ï¼ˆactiveã€mergedã€closedï¼‰
  - **åŒæ­¥ä¸»åˆ†æ”¯æ•¸æ“š**ï¼š`syncFromMainBranch()` - æ›´æ–° last_sync_at
  - Fork è¨˜éŒ„ç®¡ç†ï¼ˆloadForksByBranchIdï¼‰
  - Computed signalsï¼ˆactiveBranchesã€mergedBranchesï¼‰

### 3. PullRequestService

- **æ–‡ä»¶**ï¼š`src/app/shared/services/blueprint/pull-request.service.ts`
- **ç‹€æ…‹**ï¼šâœ… å®Œæˆ
- **åŠŸèƒ½**ï¼š
  - PR CRUD æ“ä½œ
  - **PR æµç¨‹ç®¡ç†**ï¼š
    - `createPullRequest()` - å‰µå»º PRï¼ˆç‹€æ…‹ï¼šopenï¼‰
    - `startReview()` - é–‹å§‹å¯©æ ¸ï¼ˆç‹€æ…‹ï¼šreviewingï¼‰
    - `approvePullRequest()` - æ‰¹å‡† PRï¼ˆç‹€æ…‹ï¼šapprovedï¼‰
    - `rejectPullRequest()` - æ‹’çµ• PRï¼ˆç‹€æ…‹ï¼šrejectedï¼‰
    - `mergePullRequest()` - åˆä½µ PRï¼ˆç‹€æ…‹ï¼šmergedï¼Œæ›´æ–°æ‰¿æ”¬æ¬„ä½ï¼‰
    - `closePullRequest()` - é—œé–‰ PRï¼ˆç‹€æ…‹ï¼šclosedï¼‰
  - æ ¹æ“šè—åœ– IDã€åˆ†æ”¯ ID æŸ¥è©¢ PR
  - PR ç‹€æ…‹ç®¡ç†
  - Computed signalsï¼ˆopenPullRequestsã€reviewingPullRequestsã€approvedPullRequestsã€mergedPullRequestsï¼‰

### 4. æ¨¡çµ„å°å‡º

- **æ–‡ä»¶**ï¼š`src/app/shared/services/blueprint/index.ts` - æ–°å»º
- **æ–‡ä»¶**ï¼š`src/app/shared/services/index.ts` - å·²æ›´æ–°
- **ç‹€æ…‹**ï¼šâœ… å®Œæˆ

---

## ğŸ“Š æ–‡ä»¶çµæ§‹

```
src/app/shared/services/blueprint/
â”œâ”€â”€ blueprint.service.ts        # è—åœ– Serviceï¼ˆæ–°å»ºï¼‰
â”œâ”€â”€ branch.service.ts           # åˆ†æ”¯ Serviceï¼ˆæ–°å»ºï¼‰
â”œâ”€â”€ pull-request.service.ts     # Pull Request Serviceï¼ˆæ–°å»ºï¼‰
â””â”€â”€ index.ts                    # æ¨¡çµ„å°å‡ºï¼ˆæ–°å»ºï¼‰
```

---

## ğŸ” Git-like åˆ†æ”¯é‚è¼¯å¯¦ç¾

### Fork æ©Ÿåˆ¶

```typescript
// BranchService.forkBranch()
// 1. æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨åˆ†æ”¯
// 2. å‰µå»ºåˆ†æ”¯ï¼ˆBlueprintBranchï¼‰
// 3. å‰µå»º Fork è¨˜éŒ„ï¼ˆBranchForkï¼‰
// 4. æ›´æ–°æœ¬åœ°ç‹€æ…‹
```

### PR åˆä½µæµç¨‹

```typescript
// PullRequestService.mergePullRequest()
// 1. æ›´æ–° PR ç‹€æ…‹ç‚º merged
// 2. è¨˜éŒ„åˆä½µæ™‚é–“å’Œåˆä½µè€…
// 3. ä¿å­˜è®Šæ›´æ‘˜è¦ï¼ˆchangesSummaryï¼‰
// æ³¨æ„ï¼šå¯¦éš›çš„åˆä½µé‚è¼¯ï¼ˆæ›´æ–°ä»»å‹™æ‰¿æ”¬æ¬„ä½ï¼‰éœ€è¦åœ¨æ›´é«˜å±¤å¯¦ç¾
```

### åˆ†æ”¯åŒæ­¥

```typescript
// BranchService.syncFromMainBranch()
// æ›´æ–°åˆ†æ”¯çš„ last_sync_at æ™‚é–“æˆ³
// ç”¨æ–¼è¿½è¹¤åˆ†æ”¯èˆ‡ä¸»åˆ†æ”¯çš„åŒæ­¥ç‹€æ…‹
```

---

## âœ… é©—è­‰æ¸…å–®

- [x] BlueprintService å‰µå»ºå®Œæˆ
- [x] BranchService å‰µå»ºå®Œæˆï¼ˆåŒ…å« Fork æ©Ÿåˆ¶ï¼‰
- [x] PullRequestService å‰µå»ºå®Œæˆï¼ˆåŒ…å« PR æµç¨‹ï¼‰
- [x] æ¨¡çµ„å°å‡ºæ›´æ–°å®Œæˆ
- [x] é¡å‹æª¢æŸ¥é€šéï¼ˆ`yarn tsc --noEmit`ï¼‰
- [x] Lint æª¢æŸ¥é€šéï¼ˆç„¡éŒ¯èª¤ï¼‰

---

## ğŸ” è¨­è¨ˆåŸå‰‡

1. **Signals ç‹€æ…‹ç®¡ç†**ï¼š
   - ä½¿ç”¨ `signal()` å‰µå»ºéŸ¿æ‡‰å¼ç‹€æ…‹
   - ä½¿ç”¨ `computed()` å‰µå»ºæ´¾ç”Ÿç‹€æ…‹
   - æš´éœ² `ReadonlySignal` çµ¦çµ„ä»¶

2. **Git-like åˆ†æ”¯æ¨¡å‹**ï¼š
   - Fork æ©Ÿåˆ¶ï¼šå‰µå»ºåˆ†æ”¯æ™‚åŒæ™‚å‰µå»º Fork è¨˜éŒ„
   - PR æµç¨‹ï¼šopen â†’ reviewing â†’ approved/rejected â†’ merged
   - åˆ†æ”¯åŒæ­¥ï¼šè¿½è¹¤ last_sync_at

3. **éŒ¯èª¤è™•ç†**ï¼š
   - çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
   - è¨­ç½® errorState ä¿¡è™Ÿ
   - æ‹‹å‡ºéŒ¯èª¤ä¾›ä¸Šå±¤è™•ç†

4. **é¡å‹å®‰å…¨**ï¼š
   - ä½¿ç”¨ TypeScript åš´æ ¼æ¨¡å¼
   - ä½¿ç”¨æšèˆ‰é¡å‹ï¼ˆBlueprintStatusã€BranchStatusã€PRStatusï¼‰
   - é¡å‹å®šç¾©èˆ‡æ•¸æ“šåº«çµæ§‹ä¸€è‡´

---

## ğŸ“ å¾ŒçºŒå»ºè­°

### 1. å®Œå–„åˆä½µé‚è¼¯

ç•¶å‰ `mergePullRequest()` åªæ›´æ–° PR ç‹€æ…‹ï¼Œå¯¦éš›çš„åˆä½µé‚è¼¯ï¼ˆæ›´æ–°ä»»å‹™æ‰¿æ”¬æ¬„ä½ï¼‰éœ€è¦åœ¨æ›´é«˜å±¤å¯¦ç¾ï¼š

```typescript
// éœ€è¦åœ¨ TaskService æˆ–æ›´é«˜å±¤å¯¦ç¾
async mergePullRequestWithTasks(prId: string, mergedBy: string) {
  // 1. ç²å– PR å’Œè®Šæ›´æ‘˜è¦
  // 2. æ›´æ–°ä¸»åˆ†æ”¯ä»»å‹™çš„æ‰¿æ”¬æ¬„ä½
  // 3. æ›´æ–° PR ç‹€æ…‹ç‚º merged
}
```

### 2. å‰µå»ºå–®å…ƒæ¸¬è©¦

- ç‚ºæ¯å€‹ Service å‰µå»ºå–®å…ƒæ¸¬è©¦
- æ¸¬è©¦æ‰€æœ‰ CRUD æ“ä½œ
- æ¸¬è©¦ Git-like åˆ†æ”¯é‚è¼¯
- æ¸¬è©¦ç‹€æ…‹ç®¡ç†

### 3. UI å±¤å¯¦æ–½

- å‰µå»º 5 å€‹é é¢çµ„ä»¶ï¼š
  - è—åœ–åˆ—è¡¨é 
  - è—åœ–è©³æƒ…é ï¼ˆä¸»åˆ†æ”¯è¦–åœ–ï¼‰
  - è—åœ–ç·¨è¼¯é 
  - åˆ†æ”¯ç®¡ç†é ï¼ˆForkã€æŸ¥çœ‹åˆ†æ”¯ï¼‰
  - Pull Request é ï¼ˆå‰µå»ºã€å¯©æ ¸ã€åˆä½µï¼‰

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [å®Œæ•´æ¶æ§‹æµç¨‹åœ–](./27-å®Œæ•´æ¶æ§‹æµç¨‹åœ–.mermaid.md)
- [å·¥ä½œç¸½çµ-è—åœ–ç³»çµ±æ•¸æ“šæ¨¡å‹å±¤è¨­è¨ˆ-2025-11-14.md](./å·¥ä½œç¸½çµ-è—åœ–ç³»çµ±æ•¸æ“šæ¨¡å‹å±¤è¨­è¨ˆ-2025-11-14.md)
- [å·¥ä½œç¸½çµ-è—åœ–ç³»çµ±-Repositoryå±¤å¯¦æ–½-2025-11-14.md](./å·¥ä½œç¸½çµ-è—åœ–ç³»çµ±-Repositoryå±¤å¯¦æ–½-2025-11-14.md)

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-14  
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ

