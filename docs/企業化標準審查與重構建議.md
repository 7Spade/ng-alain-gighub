# ä¼æ¥­åŒ–æ¨™æº–å¯©æŸ¥èˆ‡é‡æ§‹å»ºè­°

> ğŸ“‹ **ç›®çš„**ï¼šåˆ†æç¾æœ‰å°ˆæ¡ˆä»£ç¢¼ï¼Œæä¾›ä¼æ¥­åŒ–æ¨™æº–æ”¹é€²å»ºè­°å’Œé‡æ§‹æ–¹æ¡ˆï¼Œç¢ºä¿ä»£ç¢¼ç¬¦åˆ docs è¦ç¯„å’Œä¼æ¥­ç´šé–‹ç™¼æ¨™æº–

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-20  
**å¯©æŸ¥ç¯„åœ**ï¼šå·¥ä½œå€ä¸Šä¸‹æ–‡ç³»çµ±åŠç›¸é—œæ¨¡çµ„  
**å¯©æŸ¥æ¨™æº–**ï¼š
- [é–‹ç™¼ä½œæ¥­æŒ‡å¼•](./00-é–‹ç™¼ä½œæ¥­æŒ‡å¼•.md) - é–‹ç™¼è¦ç¯„
- [ä»£ç¢¼è³ªé‡è¦ç¯„](./.cursor/rules/06-code-quality.md) - ä»£ç¢¼è³ªé‡æ¨™æº–
- [æ ¸å¿ƒé–‹ç™¼åŸå‰‡](./.cursor/rules/core-principles.md) - å››å¤§æ ¸å¿ƒåŸå‰‡

---

## ğŸ¯ ä¼æ¥­åŒ–æ¨™æº–å®šç¾©

### å››å¤§æ ¸å¿ƒåŸå‰‡

æ ¹æ“šå°ˆæ¡ˆçš„æ ¸å¿ƒé–‹ç™¼åŸå‰‡ï¼Œä¼æ¥­åŒ–æ¨™æº–åŒ…å«ï¼š

1. **å¸¸è¦‹åšæ³• (Common Practices)**
   - éµå¾ª Angular å®˜æ–¹æœ€ä½³å¯¦è¸
   - ä½¿ç”¨æ¥­ç•Œæ¨™æº–è¨­è¨ˆæ¨¡å¼
   - åƒè€ƒ NG-ZORRO å’Œ ng-alain å®˜æ–¹ç¯„ä¾‹

2. **ä¼æ¥­æ¨™æº– (Enterprise Standards)**
   - ä»£ç¢¼çµæ§‹æ¸…æ™°ã€è·è²¬åˆ†é›¢æ˜ç¢º
   - å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
   - è¦ç¯„çš„ç‹€æ…‹ç®¡ç†ï¼ˆSignalsï¼‰
   - å®Œæ•´çš„ TypeScript é¡å‹å®šç¾©

3. **ç¬¦åˆé‚è¼¯ (Logical)**
   - æ•¸æ“šæµæ¸…æ™°ã€å‘½åèªç¾©åŒ–
   - æ¢ä»¶åˆ¤æ–·åˆç†ã€é‚è¼¯ç°¡æ½”
   - çµ„ä»¶åˆå§‹åŒ–é †åºæ­£ç¢º

4. **ç¬¦åˆå¸¸ç† (Common Sense)**
   - åŠŸèƒ½çœŸæ­£å¯ç”¨ã€ç”¨æˆ¶é«”é©—å„ªå…ˆ
   - é¿å…éåº¦è¨­è¨ˆã€åŠæ™‚é©—è­‰
   - æ€§èƒ½è€ƒé‡ã€å®‰å…¨æ„è­˜

### ä¼æ¥­åŒ–æ¨™æº–æª¢æŸ¥æ¸…å–®

#### 1. ä»£ç¢¼æ¶æ§‹æ¨™æº– âœ…

- [ ] **åˆ†å±¤æ¶æ§‹æ¸…æ™°**
  - Core å±¤ï¼šå–®ä¾‹æœå‹™ã€å…¨å±€é…ç½®
  - Shared å±¤ï¼šå…±äº«çµ„ä»¶ã€æœå‹™ã€å·¥å…·
  - Routes å±¤ï¼šæ¥­å‹™é‚è¼¯ã€é é¢çµ„ä»¶
  - ä¾è³´æ–¹å‘æ­£ç¢ºï¼šRoutes â†’ Shared â†’ Core

- [ ] **è·è²¬åˆ†é›¢æ˜ç¢º**
  - Service åªè² è²¬æ•¸æ“šå’Œæ¥­å‹™é‚è¼¯
  - Component åªè² è²¬ UI å’Œç”¨æˆ¶äº¤äº’
  - Facade å”èª¿å¤šå€‹ Service
  - Repository è² è²¬æ•¸æ“šè¨ªå•

- [ ] **æ¨¡çµ„åŒ–è¨­è¨ˆ**
  - åŠŸèƒ½æ¨¡çµ„ç¨ç«‹
  - å¯é‡ç”¨æ€§é«˜
  - è€¦åˆåº¦ä½

#### 2. TypeScript é¡å‹å®‰å…¨ âœ…

- [ ] **å®Œæ•´çš„é¡å‹å®šç¾©**
  - æ‰€æœ‰å‡½æ•¸åƒæ•¸å’Œè¿”å›å€¼æœ‰æ˜ç¢ºé¡å‹
  - é¿å…ä½¿ç”¨ `any`ï¼ˆé™¤éå¿…è¦ï¼‰
  - ä½¿ç”¨ Interface æˆ– Type å®šç¾©æ•¸æ“šçµæ§‹

- [ ] **åš´æ ¼çš„é¡å‹æª¢æŸ¥**
  - `strict: true` åœ¨ tsconfig.json
  - `noImplicitAny: true`
  - `strictNullChecks: true`

- [ ] **é¡å‹æ–‡æª”åŒ–**
  - ä½¿ç”¨ JSDoc è¨»é‡‹æè¿°é¡å‹ç”¨é€”
  - è¤‡é›œé¡å‹æä¾›ä½¿ç”¨ç¯„ä¾‹

#### 3. Angular 20 ç¾ä»£åŒ– âœ…

- [ ] **Signals API ä½¿ç”¨**
  - ä½¿ç”¨ `signal()` ç®¡ç†ç‹€æ…‹
  - ä½¿ç”¨ `computed()` è¡ç”Ÿæ•¸æ“š
  - ä½¿ç”¨ `effect()` è™•ç†å‰¯ä½œç”¨

- [ ] **Standalone Components**
  - æ‰€æœ‰çµ„ä»¶ç‚º Standalone
  - ä½¿ç”¨ SHARED_IMPORTS
  - é¿å… NgModulesï¼ˆé™¤æ ¹æ¨¡çµ„ï¼‰

- [ ] **ç¾ä»£åŒ– API**
  - Signal Inputs: `input()`
  - Signal Outputs: `output()`
  - Signal Queries: `viewChild()`, `contentChild()`

#### 4. éŒ¯èª¤è™•ç†æ¨™æº– âœ…

- [ ] **å®Œå–„çš„éŒ¯èª¤è™•ç†**
  - æ‰€æœ‰ HTTP è«‹æ±‚æœ‰éŒ¯èª¤è™•ç†
  - ä½¿ç”¨ try-catch åŒ…è£¹å¯èƒ½å‡ºéŒ¯çš„ä»£ç¢¼
  - éŒ¯èª¤è¨Šæ¯ç”¨æˆ¶å‹å¥½

- [ ] **éŒ¯èª¤æ—¥èªŒè¨˜éŒ„**
  - ä½¿ç”¨ console.error è¨˜éŒ„éŒ¯èª¤
  - åŒ…å«ä¸Šä¸‹æ–‡è³‡è¨Š
  - ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨éŒ¯èª¤è¿½è¹¤æœå‹™

- [ ] **å„ªé›…é™ç´š**
  - éŒ¯èª¤ç™¼ç”Ÿæ™‚ä¸å´©æ½°
  - æä¾› fallback æ©Ÿåˆ¶
  - ç”¨æˆ¶å¯æ¢å¾©æ“ä½œ

#### 5. å®‰å…¨æ¨™æº– âœ…

- [ ] **RLS ç­–ç•¥æ‡‰ç”¨**
  - æ‰€æœ‰ Supabase æŸ¥è©¢éµå¾ª RLS
  - å‰ç«¯ä¸ä¾è³´æ¬Šé™åˆ¤æ–·
  - å¾Œç«¯ Edge Functions é©—è­‰æ¬Šé™

- [ ] **è¼¸å…¥é©—è­‰**
  - æ‰€æœ‰ç”¨æˆ¶è¼¸å…¥é©—è­‰
  - ä½¿ç”¨ Angular Forms é©—è­‰
  - é˜²æ­¢ XSSã€SQL Injection

- [ ] **æ•æ„Ÿæ•¸æ“šä¿è­·**
  - ä¸åœ¨å‰ç«¯æš´éœ²å¯†é‘°
  - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
  - HTTPS å‚³è¼¸

#### 6. æ€§èƒ½æ¨™æº– âœ…

- [ ] **OnPush è®Šæ›´æª¢æ¸¬**
  - æ‰€æœ‰çµ„ä»¶ä½¿ç”¨ `ChangeDetectionStrategy.OnPush`
  - æ¸›å°‘ä¸å¿…è¦çš„è®Šæ›´æª¢æ¸¬

- [ ] **å»¶é²åŠ è¼‰**
  - è·¯ç”±ç´šåˆ¥å»¶é²åŠ è¼‰
  - å¤§å‹æ¨¡çµ„æŒ‰éœ€åŠ è¼‰

- [ ] **æ•¸æ“šç·©å­˜**
  - åˆç†ä½¿ç”¨ç·©å­˜æ¸›å°‘ API èª¿ç”¨
  - ç·©å­˜éæœŸç­–ç•¥æ¸…æ™°

#### 7. æ¸¬è©¦æ¨™æº– âœ…

- [ ] **å–®å…ƒæ¸¬è©¦**
  - Service æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%
  - Component æ¸¬è©¦è¦†è“‹æ ¸å¿ƒé‚è¼¯
  - ä½¿ç”¨ Jasmine + Karma

- [ ] **æ¸¬è©¦è³ªé‡**
  - æ¸¬è©¦ç¨ç«‹ã€å¯é‡è¤‡
  - Mock å¤–éƒ¨ä¾è³´
  - æ¸¬è©¦é‚Šç•Œæƒ…æ³

#### 8. æ–‡æª”æ¨™æº– âœ…

- [ ] **ä»£ç¢¼è¨»é‡‹**
  - Service å’Œ Component æœ‰ JSDoc
  - è¤‡é›œé‚è¼¯æœ‰è¡Œå…§è¨»é‡‹
  - å…¬å…± API å®Œæ•´æ–‡æª”

- [ ] **README å’ŒæŒ‡å—**
  - æ¨¡çµ„æœ‰ README èªªæ˜
  - ä½¿ç”¨ç¯„ä¾‹æ¸…æ™°
  - æ¶æ§‹æ±ºç­–æ–‡æª”åŒ–

---

## ğŸ” ç¾æœ‰ä»£ç¢¼å¯©æŸ¥

### å¯©æŸ¥ç¯„åœ

åŸºæ–¼ç¾æœ‰çš„å·¥ä½œå€ä¸Šä¸‹æ–‡ç³»çµ±ï¼Œå¯©æŸ¥ä»¥ä¸‹æ¨¡çµ„ï¼š

1. **Workspace Context Services** (`src/app/shared/services/workspace-context/`)
   - WorkspaceContextService
   - WorkspaceDataService
   - WorkspacePersistenceService

2. **Workspace Menu Service** (`src/app/core/services/workspace-menu.service.ts`)

3. **Account/Organization/Team Components** (`src/app/routes/accounts/`)

### å¯©æŸ¥çµæœ

#### âœ… å„ªé»ï¼ˆå·²ç¬¦åˆä¼æ¥­æ¨™æº–ï¼‰

1. **ç¾ä»£åŒ– Angular 20 æ¶æ§‹**
   - âœ… ä½¿ç”¨ Signals API (`signal()`, `computed()`, `effect()`)
   - âœ… Standalone Components
   - âœ… Inject function ä¾è³´æ³¨å…¥

2. **æ¸…æ™°çš„åˆ†å±¤æ¶æ§‹**
   - âœ… Core/Shared/Routes åˆ†å±¤æ˜ç¢º
   - âœ… Service è·è²¬å–®ä¸€
   - âœ… Facade æ¨¡å¼æ‡‰ç”¨æ­£ç¢º

3. **è‰¯å¥½çš„ä»£ç¢¼è¨»é‡‹**
   - âœ… Service æœ‰è©³ç´°çš„ JSDoc
   - âœ… ä½¿ç”¨ç¯„ä¾‹æ¸…æ¥š
   - âœ… è·è²¬æè¿°æ¸…æ™°

4. **TypeScript é¡å‹ä½¿ç”¨**
   - âœ… å¤§éƒ¨åˆ†å‡½æ•¸æœ‰é¡å‹å®šç¾©
   - âœ… ä½¿ç”¨ Interface å®šç¾©æ•¸æ“šçµæ§‹

#### âš ï¸ éœ€è¦æ”¹é€²çš„åœ°æ–¹

### 1. TypeScript é¡å‹å®‰å…¨æ”¹é€² ğŸ”´ é«˜å„ªå…ˆç´š

**å•é¡Œ**ï¼šéƒ¨åˆ†ä»£ç¢¼ä½¿ç”¨ `NzSafeAny`ï¼Œé™ä½é¡å‹å®‰å…¨æ€§

```typescript
// âŒ ç•¶å‰ä»£ç¢¼ï¼ˆworkspace-menu.service.tsï¼‰
private userMenuData: NzSafeAny[] = [];
private organizationMenuData: NzSafeAny[] = [];
```

**æ”¹é€²æ–¹æ¡ˆ**ï¼šå®šç¾©æ˜ç¢ºçš„ Menu é¡å‹

```typescript
// âœ… æ”¹é€²å¾Œ
// src/app/shared/models/menu.model.ts
export interface MenuItem {
  text: string;
  i18n?: string;
  icon?: string;
  link?: string;
  children?: MenuItem[];
  group?: boolean;
  hideInBreadcrumb?: boolean;
  [key: string]: any; // å…è¨±é¡å¤–å±¬æ€§ï¼Œä½†ä¸»è¦çµæ§‹æ˜ç¢º
}

// workspace-menu.service.ts
private userMenuData: MenuItem[] = [];
private organizationMenuData: MenuItem[] = [];
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º `src/app/shared/models/menu.model.ts`
2. å®šç¾© `MenuItem` interface
3. æ›´æ–°æ‰€æœ‰ Menu Service ä½¿ç”¨æ–°é¡å‹
4. æ›´æ–°ç›¸é—œçµ„ä»¶å’Œæ¸¬è©¦

---

### 2. éŒ¯èª¤è™•ç†æ¨™æº–åŒ– ğŸ”´ é«˜å„ªå…ˆç´š

**å•é¡Œ**ï¼šéŒ¯èª¤è™•ç†ä¸çµ±ä¸€ï¼Œç¼ºå°‘å…¨å±€éŒ¯èª¤è™•ç†ç­–ç•¥

```typescript
// âŒ ç•¶å‰ä»£ç¢¼ï¼ˆéƒ¨åˆ† Serviceï¼‰
loadData() {
  this.http.get(url).subscribe(data => {
    // è™•ç†æ•¸æ“š
  });
  // æ²’æœ‰éŒ¯èª¤è™•ç†
}
```

**æ”¹é€²æ–¹æ¡ˆ**ï¼šçµ±ä¸€çš„éŒ¯èª¤è™•ç†æ¨¡å¼

```typescript
// âœ… æ”¹é€²å¾Œ
// src/app/core/services/error-handler.service.ts
@Injectable({ providedIn: 'root' })
export class ErrorHandlerService {
  private readonly message = inject(NzMessageService);

  handleError(error: Error, context?: string): void {
    console.error(`[${context}] Error:`, error);
    
    // ç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤è¨Šæ¯
    if (error instanceof HttpErrorResponse) {
      if (error.status === 401) {
        this.message.error('ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥');
      } else if (error.status === 403) {
        this.message.error('æ¬Šé™ä¸è¶³');
      } else {
        this.message.error('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    } else {
      this.message.error('ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤');
    }
  }
}

// ä½¿ç”¨ç¯„ä¾‹
loadData() {
  this.http.get(url).subscribe({
    next: data => { /* è™•ç†æ•¸æ“š */ },
    error: err => this.errorHandler.handleError(err, 'loadData')
  });
}
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º `ErrorHandlerService`
2. å®šç¾©çµ±ä¸€çš„éŒ¯èª¤è™•ç†ç­–ç•¥
3. æ›´æ–°æ‰€æœ‰ Service ä½¿ç”¨çµ±ä¸€éŒ¯èª¤è™•ç†
4. æ·»åŠ éŒ¯èª¤è™•ç†æ¸¬è©¦

---

### 3. ç‹€æ…‹ç®¡ç†æ¨™æº–åŒ– ğŸŸ¡ ä¸­å„ªå…ˆç´š

**å•é¡Œ**ï¼šç‹€æ…‹ç®¡ç†æ¨¡å¼ä¸ä¸€è‡´ï¼Œéƒ¨åˆ†ä½¿ç”¨ BehaviorSubjectï¼Œéƒ¨åˆ†ä½¿ç”¨ Signals

**æ”¹é€²æ–¹æ¡ˆ**ï¼šçµ±ä¸€ä½¿ç”¨ Signals API

```typescript
// âŒ èˆŠä»£ç¢¼ï¼ˆæ··ç”¨ï¼‰
private dataSubject = new BehaviorSubject<Data[]>([]);
readonly data$ = this.dataSubject.asObservable();

// âœ… æ–°ä»£ç¢¼ï¼ˆçµ±ä¸€ Signalsï¼‰
private dataState = signal<Data[]>([]);
readonly data = this.dataState.asReadonly();

// Computed è¡ç”Ÿæ•¸æ“š
readonly activeData = computed(() => 
  this.data().filter(d => d.status === 'active')
);
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. è­˜åˆ¥æ‰€æœ‰ä½¿ç”¨ BehaviorSubject çš„åœ°æ–¹
2. é€æ­¥é·ç§»åˆ° Signals API
3. æ›´æ–°ç›¸é—œçµ„ä»¶è¨‚é–±æ–¹å¼
4. æ›´æ–°æ¸¬è©¦

---

### 4. çµ„ä»¶è·è²¬åˆ†é›¢ ğŸŸ¡ ä¸­å„ªå…ˆç´š

**å•é¡Œ**ï¼šéƒ¨åˆ†çµ„ä»¶ç›´æ¥èª¿ç”¨ Repositoryï¼Œæ‡‰é€šé Facade æˆ– Service

```typescript
// âŒ ç•¶å‰ä»£ç¢¼
export class AccountFormComponent {
  private readonly accountRepo = inject(AccountRepository);
  
  save() {
    this.accountRepo.create(data).subscribe(/* ... */);
  }
}
```

**æ”¹é€²æ–¹æ¡ˆ**ï¼šé€šé Facade çµ±ä¸€ç®¡ç†

```typescript
// âœ… æ”¹é€²å¾Œ
// src/app/core/facades/account.facade.ts
@Injectable({ providedIn: 'root' })
export class AccountFacade {
  private readonly accountRepo = inject(AccountRepository);
  private readonly errorHandler = inject(ErrorHandlerService);
  
  createAccount(data: AccountInput): Observable<Account> {
    return this.accountRepo.create(data).pipe(
      catchError(err => {
        this.errorHandler.handleError(err, 'createAccount');
        return throwError(() => err);
      })
    );
  }
}

// çµ„ä»¶
export class AccountFormComponent {
  private readonly accountFacade = inject(AccountFacade);
  
  save() {
    this.accountFacade.createAccount(data).subscribe(/* ... */);
  }
}
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º Facade å±¤ï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
2. å°‡æ¥­å‹™é‚è¼¯å¾çµ„ä»¶ç§»åˆ° Facade
3. çµ„ä»¶åªèª¿ç”¨ Facade
4. æ›´æ–°æ¸¬è©¦

---

### 5. è·¯ç”±åƒæ•¸è™•ç†æ¨™æº–åŒ– ğŸŸ¡ ä¸­å„ªå…ˆç´š

**å•é¡Œ**ï¼šè·¯ç”±åƒæ•¸è™•ç†åˆ†æ•£ï¼Œç¼ºå°‘çµ±ä¸€çš„åƒæ•¸æ›¿æ›é‚è¼¯

**æ”¹é€²æ–¹æ¡ˆ**ï¼šå‰µå»ºçµ±ä¸€çš„è·¯ç”±å·¥å…·æœå‹™

```typescript
// âœ… æ”¹é€²æ–¹æ¡ˆ
// src/app/core/services/route-utils.service.ts
@Injectable({ providedIn: 'root' })
export class RouteUtilsService {
  /**
   * æ›¿æ›è·¯ç”±ä¸­çš„å‹•æ…‹åƒæ•¸
   * @example
   * replaceParams('/accounts/:userId', { userId: '123' })
   * // è¿”å›: '/accounts/123'
   */
  replaceParams(route: string, params: Record<string, string>): string {
    let result = route;
    Object.entries(params).forEach(([key, value]) => {
      result = result.replace(`:${key}`, value);
      result = result.replace(`?${key}=:${key}`, `?${key}=${value}`);
    });
    return result;
  }
  
  /**
   * æ‰¹é‡æ›¿æ›èœå–®é …ä¸­çš„è·¯ç”±åƒæ•¸
   */
  replaceMenuParams(menu: MenuItem[], params: Record<string, string>): MenuItem[] {
    return menu.map(item => ({
      ...item,
      link: item.link ? this.replaceParams(item.link, params) : undefined,
      children: item.children ? this.replaceMenuParams(item.children, params) : undefined
    }));
  }
}
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º `RouteUtilsService`
2. å°‡åˆ†æ•£çš„è·¯ç”±è™•ç†é‚è¼¯é›†ä¸­
3. æ›´æ–° WorkspaceMenuService ä½¿ç”¨å·¥å…·æœå‹™
4. æ·»åŠ å–®å…ƒæ¸¬è©¦

---

### 6. æ•¸æ“šé©—è­‰æ¨™æº–åŒ– ğŸŸ¢ ä½å„ªå…ˆç´š

**å•é¡Œ**ï¼šè¡¨å–®é©—è­‰é‚è¼¯åˆ†æ•£ï¼Œç¼ºå°‘å…±äº«é©—è­‰è¦å‰‡

**æ”¹é€²æ–¹æ¡ˆ**ï¼šå‰µå»ºå…±äº«é©—è­‰å™¨

```typescript
// âœ… æ”¹é€²æ–¹æ¡ˆ
// src/app/shared/validators/custom-validators.ts
export class CustomValidators {
  /**
   * çµ„ç¹”åç¨±é©—è­‰å™¨
   */
  static organizationName(control: AbstractControl): ValidationErrors | null {
    const value = control.value;
    if (!value) return null;
    
    if (value.length < 2) {
      return { minLength: { requiredLength: 2, actualLength: value.length } };
    }
    if (value.length > 50) {
      return { maxLength: { requiredLength: 50, actualLength: value.length } };
    }
    if (!/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/.test(value)) {
      return { invalidFormat: true };
    }
    
    return null;
  }
  
  /**
   * åœ˜éšŠåç¨±é©—è­‰å™¨
   */
  static teamName = CustomValidators.organizationName; // è¤‡ç”¨è¦å‰‡
}

// ä½¿ç”¨ç¯„ä¾‹
this.form = this.fb.group({
  name: ['', [Validators.required, CustomValidators.organizationName]]
});
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º `CustomValidators` é¡
2. å®šç¾©å…±äº«é©—è­‰è¦å‰‡
3. æ›´æ–°è¡¨å–®ä½¿ç”¨å…±äº«é©—è­‰å™¨
4. æ·»åŠ é©—è­‰å™¨æ¸¬è©¦

---

### 7. æ—¥èªŒå’Œç›£æ§æ¨™æº–åŒ– ğŸŸ¢ ä½å„ªå…ˆç´š

**å•é¡Œ**ï¼šç¼ºå°‘çµ±ä¸€çš„æ—¥èªŒè¨˜éŒ„ç­–ç•¥

**æ”¹é€²æ–¹æ¡ˆ**ï¼šå‰µå»º Logger Service

```typescript
// âœ… æ”¹é€²æ–¹æ¡ˆ
// src/app/core/services/logger.service.ts
export enum LogLevel {
  DEBUG = 0,
  INFO = 1,
  WARN = 2,
  ERROR = 3
}

@Injectable({ providedIn: 'root' })
export class LoggerService {
  private readonly env = inject(EnvironmentService);
  private minLevel = LogLevel.INFO;
  
  constructor() {
    // é–‹ç™¼ç’°å¢ƒé¡¯ç¤ºæ‰€æœ‰æ—¥èªŒ
    if (!this.env.isProduction()) {
      this.minLevel = LogLevel.DEBUG;
    }
  }
  
  debug(message: string, context?: string, data?: any): void {
    this.log(LogLevel.DEBUG, message, context, data);
  }
  
  info(message: string, context?: string, data?: any): void {
    this.log(LogLevel.INFO, message, context, data);
  }
  
  warn(message: string, context?: string, data?: any): void {
    this.log(LogLevel.WARN, message, context, data);
  }
  
  error(message: string, context?: string, data?: any): void {
    this.log(LogLevel.ERROR, message, context, data);
  }
  
  private log(level: LogLevel, message: string, context?: string, data?: any): void {
    if (level < this.minLevel) return;
    
    const prefix = context ? `[${context}]` : '';
    const logMessage = `${prefix} ${message}`;
    
    switch (level) {
      case LogLevel.DEBUG:
        console.debug(logMessage, data);
        break;
      case LogLevel.INFO:
        console.info(logMessage, data);
        break;
      case LogLevel.WARN:
        console.warn(logMessage, data);
        break;
      case LogLevel.ERROR:
        console.error(logMessage, data);
        // ç”Ÿç”¢ç’°å¢ƒç™¼é€åˆ°éŒ¯èª¤è¿½è¹¤æœå‹™
        if (this.env.isProduction()) {
          // Sentry.captureException(data);
        }
        break;
    }
  }
}

// ä½¿ç”¨ç¯„ä¾‹
export class WorkspaceContextService {
  private readonly logger = inject(LoggerService);
  
  switchToOrganization(orgId: string): void {
    this.logger.info('Switching to organization', 'WorkspaceContextService', { orgId });
    // ...
  }
}
```

**é‡æ§‹æ­¥é©Ÿ**ï¼š
1. å‰µå»º `LoggerService`
2. æ›¿æ›æ‰€æœ‰ `console.log/warn/error` ç‚º Logger
3. é…ç½®ç”Ÿç”¢ç’°å¢ƒæ—¥èªŒç´šåˆ¥
4. æ•´åˆéŒ¯èª¤è¿½è¹¤æœå‹™ï¼ˆå¦‚ Sentryï¼‰

---

## ğŸ“‹ é‡æ§‹å„ªå…ˆç´šè¦åŠƒ

### Phase 1: é«˜å„ªå…ˆç´šé‡æ§‹ï¼ˆç«‹å³åŸ·è¡Œï¼‰ğŸ”´

**æ™‚é–“ä¼°è¨ˆ**ï¼š1-2 é€±

1. **TypeScript é¡å‹å®‰å…¨æ”¹é€²**
   - å‰µå»º Menu é¡å‹å®šç¾©
   - ç§»é™¤ `NzSafeAny` ä½¿ç”¨
   - æ·»åŠ åš´æ ¼é¡å‹æª¢æŸ¥

2. **éŒ¯èª¤è™•ç†æ¨™æº–åŒ–**
   - å‰µå»º `ErrorHandlerService`
   - çµ±ä¸€éŒ¯èª¤è™•ç†æ¨¡å¼
   - æ·»åŠ ç”¨æˆ¶å‹å¥½éŒ¯èª¤è¨Šæ¯

**é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‰€æœ‰ Menu ç›¸é—œä»£ç¢¼ä½¿ç”¨æ˜ç¢ºé¡å‹
- [ ] æ‰€æœ‰ HTTP è«‹æ±‚æœ‰éŒ¯èª¤è™•ç†
- [ ] éŒ¯èª¤è¨Šæ¯ç”¨æˆ¶å‹å¥½
- [ ] é€šé TypeScript åš´æ ¼æª¢æŸ¥

---

### Phase 2: ä¸­å„ªå…ˆç´šé‡æ§‹ï¼ˆçŸ­æœŸè¦åŠƒï¼‰ğŸŸ¡

**æ™‚é–“ä¼°è¨ˆ**ï¼š2-3 é€±

1. **ç‹€æ…‹ç®¡ç†æ¨™æº–åŒ–**
   - é·ç§» BehaviorSubject åˆ° Signals
   - çµ±ä¸€ç‹€æ…‹ç®¡ç†æ¨¡å¼

2. **çµ„ä»¶è·è²¬åˆ†é›¢**
   - å‰µå»º/å®Œå–„ Facade å±¤
   - ç§»å‹•æ¥­å‹™é‚è¼¯åˆ° Facade

3. **è·¯ç”±åƒæ•¸è™•ç†æ¨™æº–åŒ–**
   - å‰µå»º `RouteUtilsService`
   - çµ±ä¸€è·¯ç”±åƒæ•¸æ›¿æ›é‚è¼¯

**é©—æ”¶æ¨™æº–**ï¼š
- [ ] 80% ä»¥ä¸Šç‹€æ…‹ä½¿ç”¨ Signals
- [ ] çµ„ä»¶ä¸ç›´æ¥èª¿ç”¨ Repository
- [ ] è·¯ç”±åƒæ•¸è™•ç†çµ±ä¸€

---

### Phase 3: ä½å„ªå…ˆç´šæ”¹é€²ï¼ˆé•·æœŸå„ªåŒ–ï¼‰ğŸŸ¢

**æ™‚é–“ä¼°è¨ˆ**ï¼š1-2 å€‹æœˆ

1. **æ•¸æ“šé©—è­‰æ¨™æº–åŒ–**
   - å‰µå»ºå…±äº«é©—è­‰å™¨
   - çµ±ä¸€é©—è­‰è¦å‰‡

2. **æ—¥èªŒå’Œç›£æ§æ¨™æº–åŒ–**
   - å‰µå»º `LoggerService`
   - æ•´åˆéŒ¯èª¤è¿½è¹¤

**é©—æ”¶æ¨™æº–**ï¼š
- [ ] å…±äº«é©—è­‰å™¨è¦†è“‹å¸¸è¦‹å ´æ™¯
- [ ] çµ±ä¸€çš„æ—¥èªŒè¨˜éŒ„
- [ ] ç”Ÿç”¢ç’°å¢ƒéŒ¯èª¤è¿½è¹¤

---

## ğŸ› ï¸ é‡æ§‹å¯¦æ–½æŒ‡å—

### é‡æ§‹åŸå‰‡

1. **å°æ­¥å¿«è·‘**ï¼šæ¯æ¬¡é‡æ§‹ä¸€å€‹æ¨¡çµ„ï¼Œä¸è¦å¤§è¦æ¨¡é‡å¯«
2. **æ¸¬è©¦å…ˆè¡Œ**ï¼šé‡æ§‹å‰ç·¨å¯«æ¸¬è©¦ï¼Œç¢ºä¿é‡æ§‹ä¸ç ´å£åŠŸèƒ½
3. **æ¼¸é€²å¼**ï¼šä¿æŒç³»çµ±å¯é‹è¡Œï¼Œé€æ­¥æ›¿æ›èˆŠä»£ç¢¼
4. **æ–‡æª”åŒæ­¥**ï¼šé‡æ§‹å¾Œç«‹å³æ›´æ–°æ–‡æª”

### é‡æ§‹æµç¨‹

```mermaid
graph TD
    A[è­˜åˆ¥é‡æ§‹é»] --> B[ç·¨å¯«æ¸¬è©¦]
    B --> C[é‡æ§‹ä»£ç¢¼]
    C --> D[é‹è¡Œæ¸¬è©¦]
    D --> E{æ¸¬è©¦é€šé?}
    E -->|å¦| C
    E -->|æ˜¯| F[ä»£ç¢¼å¯©æŸ¥]
    F --> G[æ›´æ–°æ–‡æª”]
    G --> H[æäº¤ä»£ç¢¼]
```

### é‡æ§‹æª¢æŸ¥æ¸…å–®

æ¯æ¬¡é‡æ§‹å®Œæˆå¾Œï¼Œæª¢æŸ¥ï¼š

- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- [ ] ESLint æª¢æŸ¥é€šé
- [ ] åŠŸèƒ½æ­£å¸¸é‹ä½œ
- [ ] æ€§èƒ½æ²’æœ‰æ˜é¡¯ä¸‹é™
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] ä»£ç¢¼å·²å¯©æŸ¥

---

## ğŸ“š ä¼æ¥­åŒ–æ¨™æº–è³‡æº

### å…§éƒ¨è³‡æº

- [é–‹ç™¼ä½œæ¥­æŒ‡å¼•](./00-é–‹ç™¼ä½œæ¥­æŒ‡å¼•.md) - é–‹ç™¼è¦ç¯„ç¸½è¦½
- [ä»£ç¢¼è³ªé‡è¦ç¯„](./.cursor/rules/06-code-quality.md) - è©³ç´°ä»£ç¢¼æ¨™æº–
- [TypeScript è¦ç¯„](./.cursor/rules/01-typescript-safety.md) - TypeScript æœ€ä½³å¯¦è¸
- [Angular 20 è¦ç¯„](./.cursor/rules/02-angular-best-practices.md) - Angular ç¾ä»£åŒ–é–‹ç™¼
- [éŒ¯èª¤è™•ç†æŒ‡å—](./37-éŒ¯èª¤è™•ç†æŒ‡å—.md) - éŒ¯èª¤è™•ç†æ¨™æº–
- [æ¸¬è©¦æŒ‡å—](./38-æ¸¬è©¦æŒ‡å—.md) - æ¸¬è©¦æ¨™æº–

### å¤–éƒ¨è³‡æº

- [Angular Style Guide](https://angular.dev/style-guide) - Angular å®˜æ–¹é¢¨æ ¼æŒ‡å—
- [TypeScript Deep Dive](https://basarat.gitbook.io/typescript/) - TypeScript æ·±å…¥å­¸ç¿’
- [NG-ZORRO Documentation](https://ng.ant.design/docs/introduce/en) - NG-ZORRO å®˜æ–¹æ–‡æª”
- [ng-alain Documentation](https://ng-alain.com/) - ng-alain å®˜æ–¹æ–‡æª”

---

## ğŸ“Š é‡æ§‹é€²åº¦è¿½è¹¤

### é‡æ§‹é …ç›®æ¸…å–®

| é‡æ§‹é …ç›® | å„ªå…ˆç´š | ç‹€æ…‹ | è² è²¬äºº | é è¨ˆå®Œæˆ |
|---------|--------|------|--------|---------|
| TypeScript é¡å‹å®‰å…¨ | ğŸ”´ é«˜ | å¾…é–‹å§‹ | - | - |
| éŒ¯èª¤è™•ç†æ¨™æº–åŒ– | ğŸ”´ é«˜ | å¾…é–‹å§‹ | - | - |
| ç‹€æ…‹ç®¡ç†æ¨™æº–åŒ– | ğŸŸ¡ ä¸­ | å¾…é–‹å§‹ | - | - |
| çµ„ä»¶è·è²¬åˆ†é›¢ | ğŸŸ¡ ä¸­ | å¾…é–‹å§‹ | - | - |
| è·¯ç”±åƒæ•¸è™•ç† | ğŸŸ¡ ä¸­ | å¾…é–‹å§‹ | - | - |
| æ•¸æ“šé©—è­‰æ¨™æº–åŒ– | ğŸŸ¢ ä½ | å¾…é–‹å§‹ | - | - |
| æ—¥èªŒç›£æ§æ¨™æº–åŒ– | ğŸŸ¢ ä½ | å¾…é–‹å§‹ | - | - |

### é‡æ§‹åº¦é‡æŒ‡æ¨™

è¿½è¹¤ä»¥ä¸‹æŒ‡æ¨™è©•ä¼°é‡æ§‹æˆæ•ˆï¼š

| æŒ‡æ¨™ | ç•¶å‰å€¼ | ç›®æ¨™å€¼ | æ¸¬é‡æ–¹å¼ |
|------|--------|--------|---------|
| TypeScript åš´æ ¼æ¨¡å¼ | âŒ | âœ… | tsconfig.json |
| æ¸¬è©¦è¦†è“‹ç‡ | ? | â‰¥ 80% | Karma Coverage |
| ESLint éŒ¯èª¤æ•¸ | ? | 0 | `npm run lint` |
| ç·¨è­¯è­¦å‘Šæ•¸ | ? | 0 | `npm run build` |
| éŒ¯èª¤è™•ç†è¦†è“‹ç‡ | ? | 100% | æ‰‹å‹•å¯©æŸ¥ |

---

## ğŸ”— ç›¸é—œè³‡æº

### æ–‡æª”ç´¢å¼•
- [docs/README.md](./README.md) - å®Œæ•´æ–‡æª”å°èˆª
- [å·¥ä½œå€ä¸Šä¸‹æ–‡ç³»çµ±æ–‡æª”](./å·¥ä½œå€ä¸Šä¸‹æ–‡ä½¿ç”¨èˆ‡è¦åŠƒæŒ‡å—.md) - ç³»çµ±èªªæ˜

### é–‹ç™¼è¦ç¯„
- [.cursor/rules/](../.cursor/rules/) - å®Œæ•´é–‹ç™¼è¦ç¯„
- [AGENTS.md](../AGENTS.md) - Agent é–‹ç™¼æŒ‡å¼•

---

**æ–‡æª”ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ  
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-20  
**ç‰ˆæœ¬**ï¼šv1.0
