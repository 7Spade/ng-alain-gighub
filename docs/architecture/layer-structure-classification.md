# äº”å±¤æ¶æ§‹çµæ§‹åˆ†é¡èªªæ˜

> ğŸ“‹ **ç›®çš„**ï¼šè¨˜éŒ„å°ˆæ¡ˆäº”å±¤æ¶æ§‹çš„å¯¦éš›çµ„ç¹”çµæ§‹ï¼Œæä¾›å®Œæ•´çš„å±¤ç´šæ˜ å°„å’Œæœ€ä½³å¯¦è¸æŒ‡å—

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-01-21  
**ç‹€æ…‹**ï¼šActive  
**è² è²¬äºº**ï¼šæ¶æ§‹åœ˜éšŠ

---

## ğŸ“‘ ç›®éŒ„

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. å±¤ç´šçµæ§‹ç¸½è¦½](#2-å±¤ç´šçµæ§‹ç¸½è¦½)
- [3. æ¥­å‹™åŸŸå®Œæ•´æ˜ å°„](#3-æ¥­å‹™åŸŸå®Œæ•´æ˜ å°„)
- [4. å„å±¤çµ„ç¹”åŸå‰‡](#4-å„å±¤çµ„ç¹”åŸå‰‡)
- [5. å‘½åè¦ç¯„](#5-å‘½åè¦ç¯„)
- [6. æœ€ä½³å¯¦è¸](#6-æœ€ä½³å¯¦è¸)
- [7. å¸¸è¦‹å•é¡Œ](#7-å¸¸è¦‹å•é¡Œ)

---

## 1. æ¦‚è¿°

### 1.1 äº”å±¤æ¶æ§‹æ¨¡å‹

æœ¬å°ˆæ¡ˆæ¡ç”¨åš´æ ¼çš„äº”å±¤æ¶æ§‹è¨­è¨ˆï¼Œå¾åº•å±¤åˆ°ä¸Šå±¤ä¾æ¬¡ç‚ºï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Components Layer                      â”‚
â”‚                 (Presentation/Routes)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ inject
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Facades Layer                         â”‚
â”‚     çµ±ä¸€å°å¤–æ¥å£ã€å”èª¿å¤šå€‹ Service (ä½åŸå­åŒ–)              â”‚
â”‚     ä½ç½®ï¼šsrc/app/core/facades/                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ inject
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Services Layer                         â”‚
â”‚     æ¥­å‹™é‚è¼¯ã€ç‹€æ…‹ç®¡ç† (ä¸­åº¦åŸå­åŒ–)                        â”‚
â”‚     ä½ç½®ï¼šsrc/app/shared/services/                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ inject
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Repositories Layer                       â”‚
â”‚     è³‡æ–™å­˜å–ã€CRUD (é«˜åŸå­åŒ–)                            â”‚
â”‚     ä½ç½®ï¼šsrc/app/core/infra/repositories/              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ use
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Types + Models                         â”‚
â”‚     Types: å‹åˆ¥å®šç¾© (é«˜åŸå­åŒ–)                           â”‚
â”‚     ä½ç½®ï¼šsrc/app/core/infra/types/                     â”‚
â”‚     Models: è³‡æ–™æ¨¡å‹ (ä¸­åº¦åŸå­åŒ–)                        â”‚
â”‚     ä½ç½®ï¼šsrc/app/shared/models/                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 åŸå­åŒ–ç¨‹åº¦èªªæ˜

| å±¤ç´š | åŸå­åŒ–ç¨‹åº¦ | æª”æ¡ˆçµ„ç¹” | è·è²¬ç¯„åœ |
|------|-----------|---------|---------|
| **Types** | é«˜ | æŒ‰æ¥­å‹™åŸŸç›®éŒ„çµ„ç¹” | å‹åˆ¥å®šç¾©ã€æšèˆ‰ã€ä»‹é¢ |
| **Repositories** | é«˜ | å–®ä¸€æª”æ¡ˆå–®ä¸€è·è²¬ | è³‡æ–™è¡¨çš„ CRUD æ“ä½œ |
| **Models** | ä¸­ | æŒ‰æ¥­å‹™åŸŸå–®ä¸€æª”æ¡ˆ | æ¥­å‹™å¯¦é«”ã€å‹åˆ¥å†å°å‡º |
| **Services** | ä¸­ | æŒ‰æ¥­å‹™åŸŸç›®éŒ„çµ„ç¹” | æ¥­å‹™é‚è¼¯ã€ç‹€æ…‹ç®¡ç† |
| **Facades** | ä½ | å–®ä¸€æª”æ¡ˆèšåˆ | çµ±ä¸€æ¥å£ã€å”èª¿å¤šå€‹ Service |

---

## 2. å±¤ç´šçµæ§‹ç¸½è¦½

### 2.1 Types å±¤ï¼ˆé«˜åŸå­åŒ–ï¼‰

**ä½ç½®**ï¼š`src/app/core/infra/types/`

**çµ„ç¹”æ–¹å¼**ï¼šæŒ‰æ¥­å‹™åŸŸå‰µå»ºå­ç›®éŒ„ï¼Œæ¯å€‹ç›®éŒ„åŒ…å«è©²åŸŸçš„é¡å‹å®šç¾©

```text
types/
â”œâ”€â”€ account/
â”‚   â”œâ”€â”€ account.types.ts         # å¸³æˆ¶ç›¸é—œå‹åˆ¥
â”‚   â””â”€â”€ index.ts                 # å°å‡ºæª”æ¡ˆ
â”œâ”€â”€ analytics/
â”‚   â”œâ”€â”€ analytics.types.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ blueprint/
â”‚   â”œâ”€â”€ blueprint.types.ts       # è—åœ–ç‹€æ…‹ã€åˆ†æ”¯é¡å‹ç­‰æšèˆ‰
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ bot/
â”œâ”€â”€ collab/
â”œâ”€â”€ common/                      # å…±ç”¨å‹åˆ¥ï¼ˆDatabase, QueryOptions ç­‰ï¼‰
â”œâ”€â”€ explore/
â”œâ”€â”€ issue/
â”œâ”€â”€ org/
â”œâ”€â”€ permission/
â”œâ”€â”€ quality/
â”œâ”€â”€ system/
â”œâ”€â”€ task/
â””â”€â”€ index.ts                     # ç¸½å°å‡ºæª”æ¡ˆ
```

**çµ±è¨ˆ**ï¼š13 å€‹æ¥­å‹™åŸŸç›®éŒ„

### 2.2 Repositories å±¤ï¼ˆé«˜åŸå­åŒ–ï¼‰

**ä½ç½®**ï¼š`src/app/core/infra/repositories/`

**çµ„ç¹”æ–¹å¼**ï¼šæ‰å¹³åŒ–çµæ§‹ï¼Œæ¯å€‹è³‡æ–™è¡¨ä¸€å€‹ Repository æª”æ¡ˆ

```text
repositories/
â”œâ”€â”€ base.repository.ts                         # åŸºç¤ Repository
â”œâ”€â”€ account.repository.ts                      # å¸³æˆ¶
â”œâ”€â”€ activity-log.repository.ts                 # æ´»å‹•è¨˜éŒ„
â”œâ”€â”€ analytics-cache.repository.ts              # åˆ†æå¿«å–
â”œâ”€â”€ blueprint.repository.ts                    # è—åœ–ä¸»æª”æ¡ˆ
â”œâ”€â”€ blueprint-branch.repository.ts             # è—åœ–åˆ†æ”¯
â”œâ”€â”€ blueprint-config.repository.ts             # è—åœ–é…ç½®
â”œâ”€â”€ bot.repository.ts                          # æ©Ÿå™¨äºº
â”œâ”€â”€ bot-task.repository.ts                     # æ©Ÿå™¨äººä»»å‹™
â”œâ”€â”€ bot-execution-log.repository.ts            # åŸ·è¡Œè¨˜éŒ„
â”œâ”€â”€ collaboration-invitation.repository.ts     # å”ä½œé‚€è«‹
â”œâ”€â”€ collaboration-member.repository.ts         # å”ä½œæˆå“¡
â”œâ”€â”€ comment.repository.ts                      # è©•è«–
â”œâ”€â”€ document.repository.ts                     # æ–‡æª”
â”œâ”€â”€ document-version.repository.ts             # æ–‡æª”ç‰ˆæœ¬
â”œâ”€â”€ document-thumbnail.repository.ts           # æ–‡æª”ç¸®åœ–
â”œâ”€â”€ issue.repository.ts                        # å•é¡Œ
â”œâ”€â”€ issue-assignment.repository.ts             # å•é¡ŒæŒ‡æ´¾
â”œâ”€â”€ issue-photo.repository.ts                  # å•é¡Œç…§ç‰‡
â”œâ”€â”€ pull-request.repository.ts                 # Pull Request
â”œâ”€â”€ quality-check.repository.ts                # å“è³ªæª¢æŸ¥
â”œâ”€â”€ task.repository.ts                         # ä»»å‹™
â”œâ”€â”€ task-list.repository.ts                    # ä»»å‹™æ¸…å–®
â”œâ”€â”€ task-staging.repository.ts                 # ä»»å‹™æš«å­˜å€
â”œâ”€â”€ task-assignment.repository.ts              # ä»»å‹™æŒ‡æ´¾
â””â”€â”€ index.ts                                   # ç¸½å°å‡ºæª”æ¡ˆ
```

**çµ±è¨ˆ**ï¼š56 å€‹ Repository æª”æ¡ˆï¼ˆå« base.repository.ts å’Œ index.tsï¼‰

### 2.3 Models å±¤ï¼ˆä¸­åº¦åŸå­åŒ–ï¼‰

**ä½ç½®**ï¼š`src/app/shared/models/`

**çµ„ç¹”æ–¹å¼**ï¼šæŒ‰æ¥­å‹™åŸŸå–®ä¸€æª”æ¡ˆï¼ŒåŒ…å«è©²åŸŸæ‰€æœ‰å¯¦é«”æ¨¡å‹

```text
models/
â”œâ”€â”€ account.models.ts              # å¸³æˆ¶ã€åœ˜éšŠã€çµ„ç¹”
â”œâ”€â”€ blueprint.models.ts            # è—åœ–ã€åˆ†æ”¯ã€PRã€é…ç½®
â”œâ”€â”€ bot.models.ts                  # æ©Ÿå™¨äººã€ä»»å‹™ã€åŸ·è¡Œè¨˜éŒ„
â”œâ”€â”€ collaboration.models.ts        # å”ä½œé‚€è«‹ã€æˆå“¡
â”œâ”€â”€ communication.models.ts        # é€šçŸ¥ã€è©•è«–
â”œâ”€â”€ data.models.ts                 # è³‡æ–™åˆ†æã€å¿«å–
â”œâ”€â”€ explore.models.ts              # æ¢ç´¢ç›¸é—œ
â”œâ”€â”€ issue.models.ts                # å•é¡Œè¿½è¹¤
â”œâ”€â”€ permission.models.ts           # æ¬Šé™ã€è§’è‰²
â”œâ”€â”€ quality.models.ts              # å“è³ªæª¢æŸ¥
â”œâ”€â”€ system.models.ts               # ç³»çµ±è¨­å®šã€åŠŸèƒ½æ¨™èªŒ
â”œâ”€â”€ task.models.ts                 # ä»»å‹™ã€æ¸…å–®ã€æš«å­˜å€
â””â”€â”€ index.ts                       # ç¸½å°å‡ºæª”æ¡ˆ
```

**çµ±è¨ˆ**ï¼š13 å€‹ Models æª”æ¡ˆï¼ˆå« index.tsï¼‰

**ç‰¹é»**ï¼š
- å¾ Types å±¤é‡æ–°å°å‡ºæšèˆ‰ï¼ˆä¿æŒå‘å¾Œå…¼å®¹ï¼‰
- å¾ Database å‹åˆ¥æå–å¯¦é«”å‹åˆ¥
- å®šç¾© Insert/Update å‹åˆ¥

### 2.4 Services å±¤ï¼ˆä¸­åº¦åŸå­åŒ–ï¼‰

**ä½ç½®**ï¼š`src/app/shared/services/`

**çµ„ç¹”æ–¹å¼**ï¼šæŒ‰æ¥­å‹™åŸŸå‰µå»ºå­ç›®éŒ„ï¼Œæ¯å€‹ç›®éŒ„åŒ…å«å¤šå€‹ç›¸é—œ Service

```text
services/
â”œâ”€â”€ account/
â”‚   â”œâ”€â”€ account.service.ts
â”‚   â”œâ”€â”€ team.service.ts
â”‚   â”œâ”€â”€ organization.service.ts
â”‚   â”œâ”€â”€ organization-schedule.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ analytics/
â”‚   â”œâ”€â”€ analytics.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ session.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ blueprint/
â”‚   â”œâ”€â”€ blueprint.service.ts                # è—åœ– CRUD
â”‚   â”œâ”€â”€ blueprint-activity.service.ts       # æ´»å‹•è¨˜éŒ„
â”‚   â”œâ”€â”€ branch.service.ts                   # åˆ†æ”¯ç®¡ç†
â”‚   â”œâ”€â”€ pull-request.service.ts             # PR æµç¨‹
â”‚   â”œâ”€â”€ branch-data-isolation.service.ts    # æ•¸æ“šéš”é›¢
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ bot.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ collab/
â”‚   â”œâ”€â”€ notification.service.ts
â”‚   â”œâ”€â”€ comment.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ error-state.service.ts              # éŒ¯èª¤ç‹€æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ loading-state.service.ts            # è¼‰å…¥ç‹€æ…‹ç®¡ç†
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ document/
â”‚   â”œâ”€â”€ document.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ explore/
â”œâ”€â”€ issue/
â”‚   â”œâ”€â”€ issue.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ org/
â”‚   â”œâ”€â”€ organization-collaboration.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ permission/
â”‚   â”œâ”€â”€ branch-permission.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ quality/
â”‚   â”œâ”€â”€ quality.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ setting.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ task/
â”‚   â”œâ”€â”€ task.service.ts
â”‚   â”œâ”€â”€ task-state-machine.ts              # ä»»å‹™ç‹€æ…‹æ©Ÿ
â”‚   â”œâ”€â”€ task-staging.service.ts            # æš«å­˜å€
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ todo/
â”‚   â”œâ”€â”€ personal-todo.service.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ workspace-context/
â”‚   â”œâ”€â”€ workspace-context.service.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ index.ts
```

**çµ±è¨ˆ**ï¼š17 å€‹æ¥­å‹™åŸŸç›®éŒ„ï¼Œ64 å€‹ Service æª”æ¡ˆ

### 2.5 Facades å±¤ï¼ˆä½åŸå­åŒ–ï¼‰

**ä½ç½®**ï¼š`src/app/core/facades/`

**çµ„ç¹”æ–¹å¼**ï¼šæ‰å¹³åŒ–çµæ§‹ï¼Œæ¯å€‹æ¥­å‹™åŸŸä¸€å€‹ Facade æª”æ¡ˆ

```text
facades/
â”œâ”€â”€ account.facade.ts                # å¸³æˆ¶ç®¡ç†é–€é¢
â”œâ”€â”€ analytics.facade.ts              # è³‡æ–™åˆ†æé–€é¢
â”œâ”€â”€ auth.facade.ts                   # èªè­‰é–€é¢
â”œâ”€â”€ blueprint.facade.ts              # è—åœ–ç®¡ç†é–€é¢ï¼ˆå”èª¿å¤šå€‹ Serviceï¼‰
â”œâ”€â”€ bot.facade.ts                    # æ©Ÿå™¨äººé–€é¢
â”œâ”€â”€ collaboration.facade.ts          # å”ä½œé–€é¢
â”œâ”€â”€ communication.facade.ts          # é€šè¨Šé–€é¢
â”œâ”€â”€ document.facade.ts               # æ–‡æª”ç®¡ç†é–€é¢
â”œâ”€â”€ issue.facade.ts                  # å•é¡Œè¿½è¹¤é–€é¢
â”œâ”€â”€ quality.facade.ts                # å“è³ªç®¡ç†é–€é¢
â”œâ”€â”€ realtime.facade.ts               # å³æ™‚é€šè¨Šé–€é¢
â”œâ”€â”€ storage.facade.ts                # å„²å­˜é–€é¢
â”œâ”€â”€ system.facade.ts                 # ç³»çµ±ç®¡ç†é–€é¢
â”œâ”€â”€ task.facade.ts                   # ä»»å‹™ç®¡ç†é–€é¢
â”œâ”€â”€ workspace-context.facade.ts      # å·¥ä½œå€ä¸Šä¸‹æ–‡é–€é¢
â””â”€â”€ index.ts
```

**çµ±è¨ˆ**ï¼š16 å€‹ Facade æª”æ¡ˆï¼ˆå« index.ts å’Œæ¸¬è©¦æª”æ¡ˆå…± 18 å€‹ï¼‰

**ç‰¹é»**ï¼š
- å”èª¿å¤šå€‹ Services
- æš´éœ²çµ±ä¸€çš„ Signal æ¥å£
- æ•´åˆéŒ¯èª¤è™•ç†å’Œæ´»å‹•è¨˜éŒ„

---

## 3. æ¥­å‹™åŸŸå®Œæ•´æ˜ å°„

### 3.1 å®Œæ•´æ¥­å‹™åŸŸåˆ—è¡¨

| æ¥­å‹™åŸŸ | Types | Repositories | Models | Services | Facades | èªªæ˜ |
|-------|-------|-------------|--------|----------|---------|------|
| **account** | âœ… | âœ… (1) | âœ… | âœ… (8) | âœ… | å¸³æˆ¶ã€åœ˜éšŠã€çµ„ç¹”ç®¡ç† |
| **analytics** | âœ… | âœ… (1) | âŒ | âœ… (2) | âœ… | è³‡æ–™åˆ†æï¼ˆç°¡å–®æ•¸æ“šå‚³éï¼‰ |
| **auth** | âŒ | âœ… (1) | âŒ | âœ… (4) | âœ… | èªè­‰æˆæ¬Šï¼ˆä½¿ç”¨ Supabase Authï¼‰ |
| **blueprint** | âœ… | âœ… (3) | âœ… | âœ… (7) | âœ… | è—åœ–/å°ˆæ¡ˆç®¡ç†ï¼ˆæ ¸å¿ƒæ¥­å‹™ï¼‰ |
| **bot** | âœ… | âœ… (3) | âœ… | âœ… (2) | âœ… | æ©Ÿå™¨äººç³»çµ± |
| **collab** | âœ… | âœ… (4) | âœ…* | âœ… (3) | âœ…* | å”ä½œç³»çµ±ï¼ˆä½¿ç”¨ collaborationï¼‰ |
| **common** | âœ… | âŒ | âŒ | âœ… (6) | âŒ | å…±ç”¨å·¥å…·ï¼ˆä¸éœ€è¦ Facadeï¼‰ |
| **document** | âŒ | âœ… (3) | âŒ | âœ… (2) | âœ… | æ–‡æª”ç®¡ç† |
| **explore** | âœ… | âŒ | âœ… | âœ… (2) | âŒ | æ¢ç´¢åŠŸèƒ½ï¼ˆå‰ç«¯ç‚ºä¸»ï¼‰ |
| **issue** | âœ… | âœ… (4) | âœ… | âœ… (2) | âœ… | å•é¡Œè¿½è¹¤ç³»çµ± |
| **org** | âœ… | âœ… (4) | âŒ | âœ… (5) | âŒ | çµ„ç¹”å”ä½œï¼ˆç°¡å–®æ•¸æ“šå‚³éï¼‰ |
| **permission** | âœ… | âœ… (3) | âœ… | âœ… (2) | âŒ | æ¬Šé™ç³»çµ±ï¼ˆåµŒå…¥å¼ä½¿ç”¨ï¼‰ |
| **quality** | âœ… | âœ… (1) | âœ… | âœ… (3) | âœ… | å“è³ªæª¢æŸ¥ç³»çµ± |
| **system** | âœ… | âŒ | âœ… | âœ… (3) | âœ… | ç³»çµ±è¨­å®š |
| **task** | âœ… | âœ… (7) | âœ… | âœ… (9) | âœ… | ä»»å‹™ç®¡ç†ç³»çµ±ï¼ˆæ ¸å¿ƒæ¥­å‹™ï¼‰ |
| **todo** | âŒ | âœ… (1) | âŒ | âœ… (2) | âŒ | å€‹äººå¾…è¾¦ï¼ˆç°¡å–®åŠŸèƒ½ï¼‰ |
| **workspace** | âŒ | âŒ | âŒ | âœ… (4) | âœ… | å·¥ä½œå€ä¸Šä¸‹æ–‡ |

**è¨»è§£**ï¼š
- âœ… è¡¨ç¤ºè©²å±¤å­˜åœ¨
- âŒ è¡¨ç¤ºè©²å±¤ä¸å­˜åœ¨ï¼ˆé€šå¸¸æœ‰åˆç†åŸå› ï¼‰
- âœ…* è¡¨ç¤ºä½¿ç”¨å®Œæ•´åç¨±ï¼ˆå¦‚ collaboration è€Œé collabï¼‰
- æ‹¬è™Ÿå…§æ•¸å­—è¡¨ç¤ºæª”æ¡ˆæ•¸é‡

### 3.2 ä¸å­˜åœ¨æŸå±¤çš„åˆç†åŸå› 

#### æ²’æœ‰ Types å±¤çš„åŸŸ
- **auth**ï¼šä½¿ç”¨ Supabase Auth æä¾›çš„å‹åˆ¥
- **document**ï¼šç°¡å–® CRUDï¼Œå‹åˆ¥ä¾†è‡ª Database
- **workspace**ï¼šå‰ç«¯ç‹€æ…‹ç®¡ç†ç‚ºä¸»

#### æ²’æœ‰ Repositories å±¤çš„åŸŸ
- **common**ï¼šå·¥å…·æ€§è³ªï¼Œä¸ç›´æ¥æ“ä½œè³‡æ–™åº«
- **explore**ï¼šå‰ç«¯èšåˆå±•ç¤ºï¼Œå¾å…¶ä»– Repository å–æ•¸æ“š
- **system**ï¼šéƒ¨åˆ†ä½¿ç”¨ setting.repository.ts
- **workspace**ï¼šå‰ç«¯ç‹€æ…‹ç®¡ç†

#### æ²’æœ‰ Models å±¤çš„åŸŸ
- **analytics**ï¼šç°¡å–®æ•¸æ“šå‚³éï¼Œä¸éœ€è¦è¤‡é›œæ¨¡å‹
- **auth**ï¼šä½¿ç”¨ Supabase æä¾›çš„ç”¨æˆ¶æ¨¡å‹
- **common**ï¼šå·¥å…·æ€§è³ª
- **document**ï¼šç°¡å–®å¯¦é«”ï¼Œç›´æ¥ä½¿ç”¨ Repository å‹åˆ¥
- **org**ï¼šç°¡å–®æ•¸æ“šå‚³é
- **todo**ï¼šç°¡å–®å¯¦é«”

#### æ²’æœ‰ Facades å±¤çš„åŸŸ
- **common**ï¼šå·¥å…·é¡ï¼Œä¸éœ€è¦é–€é¢
- **explore**ï¼šå‰ç«¯èšåˆï¼Œä¸éœ€è¦è¤‡é›œå”èª¿
- **org**ï¼šç°¡å–®æ¥­å‹™é‚è¼¯ï¼ŒService å·²è¶³å¤ 
- **permission**ï¼šåµŒå…¥åœ¨å…¶ä»– Facade ä¸­ä½¿ç”¨
- **todo**ï¼šç°¡å–®åŠŸèƒ½ï¼Œä¸éœ€è¦é–€é¢

---

## 4. å„å±¤çµ„ç¹”åŸå‰‡

### 4.1 Types å±¤çµ„ç¹”åŸå‰‡

**é«˜åŸå­åŒ–ç­–ç•¥**ï¼š

âœ… **æ¨è–¦åšæ³•**ï¼š
```typescript
// âœ… å¥½ï¼šæŒ‰æ¥­å‹™åŸŸçµ„ç¹”ï¼Œæšèˆ‰å’Œä»‹é¢æ¸…æ™°åˆ†é›¢
// src/app/core/infra/types/blueprint/blueprint.types.ts
export enum BlueprintStatus {
  PLANNING = 'planning',
  ACTIVE = 'active',
  COMPLETED = 'completed'
}

export enum BranchType {
  CONTRACTOR = 'contractor',
  SUBCONTRACTOR = 'subcontractor'
}
```

âŒ **ä¸æ¨è–¦åšæ³•**ï¼š
```typescript
// âŒ å£ï¼šæ··åˆå¤šå€‹æ¥­å‹™åŸŸçš„å‹åˆ¥
// src/app/core/infra/types/mixed.types.ts
export enum BlueprintStatus { ... }
export enum TaskStatus { ... }  // æ‡‰è©²åœ¨ task.types.ts
export enum IssueStatus { ... }  // æ‡‰è©²åœ¨ issue.types.ts
```

**å‘½åè¦ç¯„**ï¼š
- æª”æ¡ˆåï¼š`{domain}.types.ts`
- æšèˆ‰åï¼š`PascalCase`ï¼ˆå¦‚ `BlueprintStatus`ï¼‰
- ä»‹é¢åï¼š`PascalCase`ï¼ˆå¦‚ `QueryOptions`ï¼‰

### 4.2 Repositories å±¤çµ„ç¹”åŸå‰‡

**é«˜åŸå­åŒ–ç­–ç•¥**ï¼š

âœ… **æ¨è–¦åšæ³•**ï¼š
```typescript
// âœ… å¥½ï¼šå–®ä¸€è·è²¬ï¼Œåªè™•ç† blueprints è³‡æ–™è¡¨
// src/app/core/infra/repositories/blueprint.repository.ts
@Injectable({ providedIn: 'root' })
export class BlueprintRepository extends BaseRepository<
  Blueprint,
  BlueprintInsert,
  BlueprintUpdate
> {
  protected tableName = 'blueprints';
  
  findByOwnerId(ownerId: string): Observable<Blueprint[]> { ... }
  findByStatus(status: BlueprintStatus): Observable<Blueprint[]> { ... }
}
```

âŒ **ä¸æ¨è–¦åšæ³•**ï¼š
```typescript
// âŒ å£ï¼šä¸€å€‹ Repository è™•ç†å¤šå€‹è³‡æ–™è¡¨
@Injectable({ providedIn: 'root' })
export class BlueprintRepository {
  // ä¸è¦åœ¨åŒä¸€å€‹ Repository ä¸­è™•ç†å¤šå€‹è³‡æ–™è¡¨
  getBlueprints() { ... }
  getBranches() { ... }  // æ‡‰è©²åœ¨ BlueprintBranchRepository
  getPRs() { ... }       // æ‡‰è©²åœ¨ PullRequestRepository
}
```

**å‘½åè¦ç¯„**ï¼š
- æª”æ¡ˆåï¼š`{table-name}.repository.ts`ï¼ˆä½¿ç”¨ kebab-caseï¼‰
- é¡åˆ¥åï¼š`{TableName}Repository`ï¼ˆä½¿ç”¨ PascalCaseï¼‰
- ç¹¼æ‰¿ `BaseRepository<T, TInsert, TUpdate>`

### 4.3 Models å±¤çµ„ç¹”åŸå‰‡

**ä¸­åº¦åŸå­åŒ–ç­–ç•¥**ï¼š

âœ… **æ¨è–¦åšæ³•**ï¼š
```typescript
// âœ… å¥½ï¼šæŒ‰æ¥­å‹™åŸŸçµ„ç¹”ï¼ŒåŒ…å«è©²åŸŸæ‰€æœ‰å¯¦é«”
// src/app/shared/models/blueprint.models.ts

// é‡æ–°å°å‡ºæšèˆ‰ï¼ˆä¿æŒå‘å¾Œå…¼å®¹ï¼‰
export { BlueprintStatus, BranchType, BranchStatus, PRStatus } from '@core';

// å®šç¾©å¯¦é«”å‹åˆ¥
export type Blueprint = Database['public']['Tables']['blueprints']['Row'];
export type BlueprintInsert = Database['public']['Tables']['blueprints']['Insert'];
export type BlueprintUpdate = Database['public']['Tables']['blueprints']['Update'];

export type BlueprintBranch = Database['public']['Tables']['blueprint_branches']['Row'];
export type PullRequest = Database['public']['Tables']['pull_requests']['Row'];
```

âŒ **ä¸æ¨è–¦åšæ³•**ï¼š
```typescript
// âŒ å£ï¼šéåº¦æ‹†åˆ†ï¼Œæ¯å€‹å¯¦é«”ä¸€å€‹æª”æ¡ˆ
// blueprint.models.ts, blueprint-branch.models.ts, pull-request.models.ts
// ç›¸é—œå¯¦é«”æ‡‰è©²çµ„ç¹”åœ¨åŒä¸€å€‹æª”æ¡ˆä¸­
```

**å‘½åè¦ç¯„**ï¼š
- æª”æ¡ˆåï¼š`{domain}.models.ts`
- å‹åˆ¥åï¼š`PascalCase`ï¼ˆå¦‚ `Blueprint`ï¼‰
- å¾ Types å±¤é‡æ–°å°å‡ºæšèˆ‰

### 4.4 Services å±¤çµ„ç¹”åŸå‰‡

**ä¸­åº¦åŸå­åŒ–ç­–ç•¥**ï¼š

âœ… **æ¨è–¦åšæ³•**ï¼š
```typescript
// âœ… å¥½ï¼šæ¥­å‹™é‚è¼¯å…§èšï¼Œå–®ä¸€æ¥­å‹™è·è²¬
// src/app/shared/services/blueprint/blueprint.service.ts
@Injectable({ providedIn: 'root' })
export class BlueprintService {
  private blueprintRepository = inject(BlueprintRepository);
  private blueprintConfigRepository = inject(BlueprintConfigRepository);
  
  private blueprintsState = signal<Blueprint[]>([]);
  readonly blueprints = this.blueprintsState.asReadonly();
  
  async loadBlueprints(): Promise<void> { ... }
  async createBlueprint(data: BlueprintInsert): Promise<Blueprint> { ... }
  async updateBlueprint(id: string, data: BlueprintUpdate): Promise<void> { ... }
}

// src/app/shared/services/blueprint/branch.service.ts
@Injectable({ providedIn: 'root' })
export class BranchService {
  private blueprintBranchRepository = inject(BlueprintBranchRepository);
  
  async createBranch(data: BlueprintBranchInsert): Promise<BlueprintBranch> { ... }
  async forkBranch(branchId: string, orgId: string): Promise<BlueprintBranch> { ... }
}
```

âŒ **ä¸æ¨è–¦åšæ³•**ï¼š
```typescript
// âŒ å£ï¼šGod Objectï¼Œä¸€å€‹ Service è™•ç†æ‰€æœ‰æ¥­å‹™
@Injectable({ providedIn: 'root' })
export class BlueprintService {
  // ä¸è¦æŠŠæ‰€æœ‰åŠŸèƒ½éƒ½å¡åœ¨ä¸€å€‹ Service
  loadBlueprints() { ... }
  loadBranches() { ... }      // æ‡‰è©²åœ¨ BranchService
  createPR() { ... }          // æ‡‰è©²åœ¨ PullRequestService
  logActivity() { ... }       // æ‡‰è©²åœ¨ BlueprintActivityService
  checkPermission() { ... }   // æ‡‰è©²åœ¨ BranchPermissionService
}
```

**å‘½åè¦ç¯„**ï¼š
- ç›®éŒ„åï¼š`{domain}/`
- æª”æ¡ˆåï¼š`{feature}.service.ts`
- é¡åˆ¥åï¼š`{Feature}Service`
- index.tsï¼šå°å‡ºè©²åŸŸæ‰€æœ‰ Services

### 4.5 Facades å±¤çµ„ç¹”åŸå‰‡

**ä½åŸå­åŒ–ç­–ç•¥ï¼ˆèšåˆå±¤ï¼‰**ï¼š

âœ… **æ¨è–¦åšæ³•**ï¼š
```typescript
// âœ… å¥½ï¼šå”èª¿å¤šå€‹ Servicesï¼Œæä¾›çµ±ä¸€æ¥å£
// src/app/core/facades/blueprint.facade.ts
@Injectable({ providedIn: 'root' })
export class BlueprintFacade implements OnDestroy {
  // æ³¨å…¥å¤šå€‹ Services
  private blueprintService = inject(BlueprintService);
  private branchService = inject(BranchService);
  private pullRequestService = inject(PullRequestService);
  private blueprintActivityService = inject(BlueprintActivityService);
  
  // èšåˆç‹€æ…‹
  private selectedBlueprintState = signal<Blueprint | null>(null);
  readonly selectedBlueprint = this.selectedBlueprintState.asReadonly();
  
  // è¨ˆç®—ç‹€æ…‹
  readonly canCreateBranch = computed(() => {
    const blueprint = this.selectedBlueprint();
    return blueprint?.status === BlueprintStatus.ACTIVE;
  });
  
  // å”èª¿å¤šå€‹ Services çš„æ“ä½œ
  async createBlueprintWithBranch(
    blueprintData: BlueprintInsert,
    branchData: BlueprintBranchInsert
  ): Promise<void> {
    const blueprint = await this.blueprintService.createBlueprint(blueprintData);
    const branch = await this.branchService.createBranch({
      ...branchData,
      blueprintId: blueprint.id
    });
    await this.blueprintActivityService.logActivity({
      blueprintId: blueprint.id,
      actionType: 'blueprint_created',
      details: { branchId: branch.id }
    });
  }
}
```

âŒ **ä¸æ¨è–¦åšæ³•**ï¼š
```typescript
// âŒ å£ï¼šFacade åªæ˜¯ç°¡å–®è½‰ç™¼ï¼Œæ²’æœ‰å”èª¿å¤šå€‹ Services
@Injectable({ providedIn: 'root' })
export class BlueprintFacade {
  private blueprintService = inject(BlueprintService);
  
  // åªæ˜¯ç°¡å–®è½‰ç™¼ï¼Œä¸éœ€è¦ Facade
  loadBlueprints() {
    return this.blueprintService.loadBlueprints();
  }
  
  createBlueprint(data: BlueprintInsert) {
    return this.blueprintService.createBlueprint(data);
  }
}
```

**å‘½åè¦ç¯„**ï¼š
- æª”æ¡ˆåï¼š`{domain}.facade.ts`
- é¡åˆ¥åï¼š`{Domain}Facade`
- å¿…é ˆå”èª¿è‡³å°‘ 2 å€‹ä»¥ä¸Šçš„ Services

---

## 5. å‘½åè¦ç¯„

### 5.1 æª”æ¡ˆå‘½å

| å±¤ç´š | æª”æ¡ˆå‘½åæ ¼å¼ | ç¯„ä¾‹ |
|------|------------|------|
| Types | `{domain}.types.ts` | `blueprint.types.ts` |
| Repositories | `{table-name}.repository.ts` | `blueprint-branch.repository.ts` |
| Models | `{domain}.models.ts` | `blueprint.models.ts` |
| Services | `{feature}.service.ts` | `blueprint-activity.service.ts` |
| Facades | `{domain}.facade.ts` | `blueprint.facade.ts` |

### 5.2 é¡åˆ¥å‘½å

| å±¤ç´š | é¡åˆ¥å‘½åæ ¼å¼ | ç¯„ä¾‹ |
|------|------------|------|
| Repositories | `{TableName}Repository` | `BlueprintBranchRepository` |
| Services | `{Feature}Service` | `BlueprintActivityService` |
| Facades | `{Domain}Facade` | `BlueprintFacade` |

### 5.3 å°å‡ºæª”æ¡ˆ

æ¯å€‹ç›®éŒ„å¿…é ˆåŒ…å« `index.ts` å°å‡ºæª”æ¡ˆï¼š

```typescript
// âœ… å¥½ï¼šæ¸…æ™°çš„å°å‡ºçµæ§‹
// src/app/shared/services/blueprint/index.ts
export * from './blueprint.service';
export * from './blueprint-activity.service';
export * from './branch.service';
export * from './pull-request.service';
export * from './branch-data-isolation.service';
```

---

## 6. æœ€ä½³å¯¦è¸

### 6.1 ä¾è³´æ–¹å‘è¦å‰‡

**åš´æ ¼éµå®ˆå±¤ç´šä¾è³´æ–¹å‘**ï¼š

```text
Components
    â†“
Facades (åªèƒ½ä¾è³´ Servicesã€Repositoriesã€Typesã€Models)
    â†“
Services (åªèƒ½ä¾è³´ Repositoriesã€Typesã€Models)
    â†“
Repositories (åªèƒ½ä¾è³´ Types)
    â†“
Types + Models (ä¸ä¾è³´å…¶ä»–å±¤)
```

âœ… **å…è¨±çš„ä¾è³´**ï¼š
- Facades â†’ Servicesã€Repositoriesã€Typesã€Models
- Services â†’ Repositoriesã€Typesã€Models
- Repositories â†’ Types
- Models â†’ Typesï¼ˆé‡æ–°å°å‡ºæšèˆ‰ï¼‰

âŒ **ç¦æ­¢çš„ä¾è³´**ï¼š
- Services âŒâ†’ Facades
- Repositories âŒâ†’ Services
- Types âŒâ†’ Models
- ä»»ä½•å±¤ âŒâ†’ Components

### 6.2 è·è²¬åˆ†é›¢

**Types å±¤**ï¼š
- âœ… åªå®šç¾©å‹åˆ¥ã€ä»‹é¢ã€æšèˆ‰
- âŒ ä¸åŒ…å«æ¥­å‹™é‚è¼¯
- âŒ ä¸ä¾è³´å…¶ä»–å±¤

**Repositories å±¤**ï¼š
- âœ… åªè™•ç†è³‡æ–™å­˜å–ï¼ˆCRUDï¼‰
- âœ… ç¹¼æ‰¿ BaseRepository
- âŒ ä¸åŒ…å«æ¥­å‹™é‚è¼¯
- âŒ ä¸èª¿ç”¨å…¶ä»– Repositories

**Models å±¤**ï¼š
- âœ… å®šç¾©æ¥­å‹™å¯¦é«”å‹åˆ¥
- âœ… å¾ Types å±¤é‡æ–°å°å‡ºæšèˆ‰
- âŒ ä¸åŒ…å«æ¥­å‹™é‚è¼¯

**Services å±¤**ï¼š
- âœ… å¯¦ä½œæ¥­å‹™é‚è¼¯
- âœ… ä½¿ç”¨ Signals ç®¡ç†ç‹€æ…‹
- âœ… èª¿ç”¨ Repositories å­˜å–æ•¸æ“š
- âŒ ä¸ç›´æ¥èª¿ç”¨ Supabase Client

**Facades å±¤**ï¼š
- âœ… å”èª¿å¤šå€‹ Services
- âœ… æä¾›çµ±ä¸€çš„å°å¤–æ¥å£
- âœ… æ•´åˆéŒ¯èª¤è™•ç†å’Œæ´»å‹•è¨˜éŒ„
- âŒ ä¸ç›´æ¥èª¿ç”¨ Repositories

### 6.3 å¼•ç”¨è·¯å¾‘è¦ç¯„

ä½¿ç”¨ TypeScript Path Aliasesï¼š

```typescript
// âœ… å¥½ï¼šä½¿ç”¨ Path Aliases
import { Blueprint, BlueprintStatus } from '@core';
import { BlueprintService } from '@shared';

// âŒ å£ï¼šä½¿ç”¨ç›¸å°è·¯å¾‘
import { Blueprint } from '../../../core/infra/types/blueprint';
import { BlueprintService } from '../../services/blueprint';
```

**Path Aliases é…ç½®**ï¼ˆtsconfig.jsonï¼‰ï¼š
```json
{
  "compilerOptions": {
    "paths": {
      "@core": ["src/app/core"],
      "@core/*": ["src/app/core/*"],
      "@shared": ["src/app/shared"],
      "@shared/*": ["src/app/shared/*"],
      "@routes": ["src/app/routes"],
      "@routes/*": ["src/app/routes/*"]
    }
  }
}
```

### 6.4 æ¸¬è©¦æª”æ¡ˆçµ„ç¹”

æ¸¬è©¦æª”æ¡ˆèˆ‡åŸå§‹æª”æ¡ˆæ”¾åœ¨åŒä¸€ç›®éŒ„ï¼š

```text
services/blueprint/
â”œâ”€â”€ blueprint.service.ts
â”œâ”€â”€ blueprint.service.spec.ts         # å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ blueprint-activity.service.ts
â””â”€â”€ blueprint-activity.service.spec.ts
```

---

## 7. å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æœ‰äº›åŸŸæ²’æœ‰ Models å±¤ï¼Ÿ

**A**: Models å±¤ä¸»è¦ç”¨æ–¼è¤‡é›œæ¥­å‹™å¯¦é«”ã€‚å°æ–¼ç°¡å–®æ•¸æ“šå‚³éçš„åŸŸï¼ˆå¦‚ analyticsã€orgï¼‰ï¼Œç›´æ¥ä½¿ç”¨ Repository çš„å‹åˆ¥å·²è¶³å¤ ï¼Œä¸éœ€è¦é¡å¤–çš„ Models å±¤ã€‚

### Q2: ç‚ºä»€éº¼æœ‰äº›åŸŸæ²’æœ‰ Facades å±¤ï¼Ÿ

**A**: Facades å±¤ç”¨æ–¼å”èª¿å¤šå€‹ Servicesã€‚å°æ–¼ç°¡å–®æ¥­å‹™é‚è¼¯ï¼ˆå¦‚ commonã€todoã€permissionï¼‰ï¼ŒService å±¤å·²ç¶“è¶³å¤ ï¼Œä¸éœ€è¦é¡å¤–çš„ Facades å±¤ã€‚Facades é€šå¸¸ç”¨æ–¼æ ¸å¿ƒæ¥­å‹™åŸŸï¼ˆå¦‚ blueprintã€taskã€issueï¼‰ã€‚

### Q3: collab åŸŸç‚ºä»€éº¼ä½¿ç”¨ collaboration å‘½åï¼Ÿ

**A**: ç‚ºäº†ä¿æŒç¨‹å¼ç¢¼çš„å¯è®€æ€§å’Œèªç¾©åŒ–ï¼š
- Types å±¤ï¼š`collab/`ï¼ˆç°¡çŸ­ï¼‰
- Models å±¤ï¼š`collaboration.models.ts`ï¼ˆå®Œæ•´ï¼‰
- Services å±¤ï¼š`collab/`ï¼ˆç°¡çŸ­ï¼‰
- Facades å±¤ï¼š`collaboration.facade.ts`ï¼ˆå®Œæ•´ï¼‰

æª”æ¡ˆå‘½åä½¿ç”¨å®Œæ•´å–®è©ä»¥æé«˜å¯è®€æ€§ï¼Œç›®éŒ„å‘½åå¯ä»¥ç°¡åŒ–ä»¥æé«˜æ•ˆç‡ã€‚

### Q4: å¦‚ä½•æ±ºå®šæ˜¯å¦éœ€è¦å‰µå»ºæ–°çš„ Serviceï¼Ÿ

**A**: éµå¾ªä»¥ä¸‹åŸå‰‡ï¼š
1. **å–®ä¸€è·è²¬**ï¼šä¸€å€‹ Service åªè™•ç†ä¸€å€‹æ¥­å‹™æ¦‚å¿µ
2. **æª”æ¡ˆå¤§å°**ï¼šè¶…é 300 è¡Œè€ƒæ…®æ‹†åˆ†
3. **ä¾è³´é—œä¿‚**ï¼šå¦‚æœæŸåŠŸèƒ½å¯ä»¥ç¨ç«‹ä½¿ç”¨ï¼Œæ‡‰è©²æ‹†åˆ†
4. **è¤‡ç”¨æ€§**ï¼šå¦‚æœæŸåŠŸèƒ½æœƒåœ¨å¤šè™•ä½¿ç”¨ï¼Œæ‡‰è©²ç¨ç«‹

åƒè€ƒ blueprint åŸŸçš„çµ„ç¹”ï¼š
- `blueprint.service.ts` - è—åœ– CRUD
- `blueprint-activity.service.ts` - æ´»å‹•è¨˜éŒ„
- `branch.service.ts` - åˆ†æ”¯ç®¡ç†
- `pull-request.service.ts` - PR æµç¨‹
- `branch-data-isolation.service.ts` - æ•¸æ“šéš”é›¢

### Q5: Repository æ˜¯å¦å¯ä»¥èª¿ç”¨å…¶ä»– Repositoryï¼Ÿ

**A**: **ä¸å»ºè­°**ã€‚Repositories æ‡‰è©²ä¿æŒé«˜åº¦ç¨ç«‹ï¼Œåªè² è²¬å–®ä¸€è³‡æ–™è¡¨çš„ CRUDã€‚å¦‚æœéœ€è¦å”èª¿å¤šå€‹è³‡æ–™è¡¨çš„æ“ä½œï¼Œæ‡‰è©²åœ¨ Service å±¤å¯¦ä½œã€‚

```typescript
// âŒ ä¸æ¨è–¦ï¼šåœ¨ Repository ä¸­èª¿ç”¨å…¶ä»– Repository
export class BlueprintRepository {
  private branchRepository = inject(BlueprintBranchRepository);
  
  async getBlueprintWithBranches(id: string) {
    const blueprint = await this.findById(id);
    const branches = await this.branchRepository.findByBlueprintId(id);
    return { ...blueprint, branches };
  }
}

// âœ… æ¨è–¦ï¼šåœ¨ Service å±¤å”èª¿å¤šå€‹ Repositories
export class BlueprintService {
  private blueprintRepository = inject(BlueprintRepository);
  private branchRepository = inject(BlueprintBranchRepository);
  
  async loadBlueprintWithBranches(id: string) {
    const blueprint = await firstValueFrom(
      this.blueprintRepository.findById(id)
    );
    const branches = await firstValueFrom(
      this.branchRepository.findByBlueprintId(id)
    );
    return { ...blueprint, branches };
  }
}
```

### Q6: ä½•æ™‚ä½¿ç”¨ Facade è€Œéç›´æ¥ä½¿ç”¨ Serviceï¼Ÿ

**A**: åœ¨ä»¥ä¸‹æƒ…æ³ä¸‹ä½¿ç”¨ Facadeï¼š
1. **å¤šå€‹ Services å”èª¿**ï¼šéœ€è¦å”èª¿ 2 å€‹ä»¥ä¸Šçš„ Services
2. **è¤‡é›œæ¥­å‹™æµç¨‹**ï¼šæ¶‰åŠå¤šæ­¥é©Ÿæ“ä½œã€éŒ¯èª¤è™•ç†ã€æ´»å‹•è¨˜éŒ„
3. **çµ±ä¸€æ¥å£**ï¼šç‚ºç›¸é—œåŠŸèƒ½æä¾›çµ±ä¸€çš„å°å¤–æ¥å£
4. **ç‹€æ…‹èšåˆ**ï¼šéœ€è¦èšåˆå¤šå€‹ Services çš„ç‹€æ…‹

çµ„ä»¶æ‡‰è©²å„ªå…ˆä½¿ç”¨ Facadeï¼Œåªæœ‰åœ¨ç°¡å–®å ´æ™¯ä¸‹æ‰ç›´æ¥ä½¿ç”¨ Serviceã€‚

---

## 8. é™„éŒ„

### 8.1 å®Œæ•´æª”æ¡ˆæ¸…å–®

è©³è¦‹å„å±¤ç´šçš„çµæ§‹ç¸½è¦½ç« ç¯€ã€‚

### 8.2 ç›¸é—œæ–‡æª”

- [æ¶æ§‹å±¤ç´šåŸå­åŒ–è¨­è¨ˆè¦ç¯„](./architecture-layers-atomization-design.md)
- [é–‹ç™¼æœ€ä½³å¯¦è¸æŒ‡å—](../guides/development-best-practices.md)
- [å°ˆæ¡ˆçµæ§‹æµç¨‹åœ–](./02-project-structure-flowchart.mermaid.md)
- [äº”å±¤é–‹ç™¼é †åº](../archive/é–‹ç™¼é †åº.md)

### 8.3 è®Šæ›´æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´å…§å®¹ | è² è²¬äºº |
|------|------|---------|--------|
| v1.0 | 2025-01-21 | åˆå§‹ç‰ˆæœ¬ï¼Œè¨˜éŒ„ç¾æœ‰çµæ§‹åˆ†é¡ | æ¶æ§‹åœ˜éšŠ |

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-01-21  
**ç¶­è­·è€…**ï¼šæ¶æ§‹åœ˜éšŠ  
**ç‹€æ…‹**ï¼šActive
