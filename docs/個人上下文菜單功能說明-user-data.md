# 個人上下文菜單功能說明 (user-data.json)

## 📑 目錄

- [🎯 個人上下文定位](#-個人上下文定位)
  - [核心理念](#核心理念)
  - [設計原則](#設計原則)
- [📋 功能模組清單](#-功能模組清單)
  - [1. 帳戶系統 (Account System)](#1-帳戶系統-account-system)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
  - [2. 我的任務 (My Tasks)](#2-我的任務-my-tasks)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
  - [3. 我的藍圖 (My Blueprints)](#3-我的藍圖-my-blueprints)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
  - [4. 我的文檔 (My Documents)](#4-我的文檔-my-documents)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
  - [5. 我的溝通 (My Communication)](#5-我的溝通-my-communication)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
  - [6. 個人設置 (Personal Settings)](#6-個人設置-personal-settings)
    - [模組說明](#模組說明)
    - [包含功能](#包含功能)
    - [功能詳解](#功能詳解)
- [🗂️ 數據文件結構](#-數據文件結構)
  - [JSON 結構說明](#json-結構說明)
  - [字段說明](#字段說明)
- [🔗 路由參數說明](#-路由參數說明)
  - [動態參數](#動態參數)
  - [參數替換邏輯](#參數替換邏輯)
- [🎨 使用場景範例](#-使用場景範例)
  - [場景 1：新用戶首次登入](#場景-1新用戶首次登入)
  - [場景 2：自由工作者管理個人專案](#場景-2自由工作者管理個人專案)
  - [場景 3：跨組織成員查看所有任務](#場景-3跨組織成員查看所有任務)
- [🔍 與其他上下文的差異](#-與其他上下文的差異)
  - [個人 vs 組織](#個人-vs-組織)
  - [個人 vs 團隊](#個人-vs-團隊)
- [📐 開發指南](#-開發指南)
  - [添加新功能到個人上下文](#添加新功能到個人上下文)
  - [路由權限控制](#路由權限控制)
  - [數據加載模式](#數據加載模式)
- [💡 最佳實踐](#-最佳實踐)
  - [DO's ✅](#dos-)
  - [DON'Ts ❌](#donts-)
- [🔗 相關資源](#-相關資源)
  - [主要文檔](#主要文檔)
  - [數據文件](#數據文件)
  - [技術文檔](#技術文檔)

---


> 📋 **目的**：說明個人上下文 (User Context) 的所有功能與路由連結，幫助開發者理解 `user-data.json` 的設計理念與實現細節

**最後更新**：2025-11-20
**數據文件**：`src/assets/tmp/user-data.json`
**相關文檔**：
- [工作區上下文使用與規劃指南](./工作區上下文使用與規劃指南.md) - 完整的上下文系統說明
- [工作區上下文切換流程圖](./工作區上下文切換流程圖.mermaid.md) - 視覺化流程圖

- --

## 🎯 個人上下文定位

### 核心理念
**輕量級個人生產力中心**

- **適用對象**：所有系統用戶
- **使用場景**：個人日常工作、獨立任務管理
- **權限範圍**：僅限個人數據
- **設計特點**：輕量、快速、專注於個人效率

### 設計原則

1. **聚合視圖**：匯總來自所有組織和團隊的個人相關數據
2. **快速訪問**：提供最常用功能的快捷入口
3. **跨上下文**：不受限於單一組織或團隊
4. **個人化**：根據個人偏好定制

- --

## 📋 功能模組清單

個人上下文包含 **6 大功能模組**，共 **15 個功能頁面**：

### 1. 帳戶系統 (Account System)

#### 模組說明
管理個人帳戶資訊和組織關係

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 我的個人資料 | `/accounts/:userId` | `menu.personal.account.profile` | 查看和編輯個人基本資訊 |
| 我的組織 | `/accounts/org` | `menu.personal.account.organizations` | 查看所有加入的組織列表 |

#### 功能詳解

**我的個人資料**
- **路由模式**：`/accounts/:userId`
- **參數說明**：`:userId` 為當前登入用戶的帳戶 ID
- **主要功能**：
  - 查看個人基本資訊（姓名、郵箱、電話等）
  - 編輯個人資料
  - 上傳頭像
  - 查看帳戶狀態
- **權限要求**：僅限本人訪問

**我的組織**
- **路由模式**：`/accounts/org`
- **主要功能**：
  - 查看我創建的組織
  - 查看我加入的組織
  - 快速切換到組織上下文
  - 查看組織基本資訊
- **數據來源**：聚合來自 `WorkspaceDataService` 的組織數據

- --

### 2. 我的任務 (My Tasks)

#### 模組說明
個人任務聚合視圖，匯總所有指派給我的任務

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 我的待辦清單 | `/tasks/todo` | `menu.personal.tasks.todo` | 個人待辦事項列表 |
| 我的指派任務 | `/tasks/assignments` | `menu.personal.tasks.assignments` | 所有指派給我的任務 |

#### 功能詳解

**我的待辦清單**
- **路由模式**：`/tasks/todo`
- **主要功能**：
  - 查看個人待辦事項
  - 標記完成狀態
  - 設置優先級
  - 添加備註
- **數據範圍**：僅限個人創建的待辦事項
- **特點**：不限於特定組織或團隊

**我的指派任務**
- **路由模式**：`/tasks/assignments`
- **主要功能**：
  - 查看所有指派給我的任務（跨組織、跨團隊）
  - 按狀態篩選（待處理、進行中、已完成）
  - 按組織或團隊分組
  - 快速更新任務狀態
- **數據來源**：聚合來自所有組織和團隊的任務
- **特點**：提供統一的任務管理視圖

- --

### 3. 我的藍圖 (My Blueprints)

#### 模組說明
管理個人創建的藍圖專案

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 我的藍圖列表 | `/blueprints` | `menu.personal.blueprints.list` | 個人創建的藍圖列表 |
| 創建藍圖 | `/blueprints/create` | `menu.personal.blueprints.create` | 創建新的個人藍圖 |

#### 功能詳解

**我的藍圖列表**
- **路由模式**：`/blueprints`
- **主要功能**：
  - 查看我創建的所有個人藍圖
  - 查看藍圖基本資訊
  - 快速訪問藍圖詳情
  - 刪除個人藍圖
- **數據範圍**：僅限個人創建的藍圖（owner_id 為當前用戶 ID）
- **特點**：個人藍圖不包含 Git-like 分支功能

**創建藍圖**
- **路由模式**：`/blueprints/create`
- **主要功能**：
  - 填寫藍圖基本資訊（名稱、描述）
  - 設置藍圖類型
  - 創建個人藍圖
- **權限要求**：所有用戶均可創建個人藍圖
- **注意事項**：個人藍圖與組織藍圖的功能差異

- --

### 4. 我的文檔 (My Documents)

#### 模組說明
個人文檔存儲和管理

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 我的文檔列表 | `/documents` | `menu.personal.documents.list` | 個人文檔列表 |
| 上傳文檔 | `/documents/upload` | `menu.personal.documents.upload` | 上傳新文檔 |

#### 功能詳解

**我的文檔列表**
- **路由模式**：`/documents`
- **主要功能**：
  - 查看個人上傳的文檔
  - 下載文檔
  - 預覽文檔
  - 刪除文檔
- **數據範圍**：僅限個人上傳的文檔
- **支援格式**：所有常見文檔格式（PDF、Office、圖片等）

**上傳文檔**
- **路由模式**：`/documents/upload`
- **主要功能**：
  - 選擇文件上傳
  - 填寫文檔描述
  - 設置文檔類型
  - 批量上傳
- **存儲位置**：Supabase Storage（個人 bucket）
- **限制**：文件大小限制（依系統配置）

- --

### 5. 我的溝通 (My Communication)

#### 模組說明
個人通知和待辦事項中心

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 我的通知 | `/communication/notifications` | `menu.personal.communication.notifications` | 系統通知列表 |
| 我的待辦 | `/communication/todos` | `menu.personal.communication.todos` | 待處理事項提醒 |

#### 功能詳解

**我的通知**
- **路由模式**：`/communication/notifications`
- **主要功能**：
  - 查看所有系統通知（跨組織、跨團隊）
  - 標記已讀/未讀
  - 按類型篩選
  - 快速跳轉到相關內容
- **通知類型**：
  - 任務指派通知
  - PR 審查請求
  - 問題提及通知
  - 系統公告
- **數據來源**：聚合來自所有上下文的通知

**我的待辦**
- **路由模式**：`/communication/todos`
- **主要功能**：
  - 查看所有待處理事項
  - 按優先級排序
  - 標記完成
  - 設置提醒
- **待辦來源**：
  - 任務截止提醒
  - PR 審查待辦
  - 問題處理待辦
  - 自定義待辦

- --

### 6. 個人設置 (Personal Settings)

#### 模組說明
個人化設置和偏好管理

#### 包含功能

| 功能名稱 | 路由 | i18n Key | 說明 |
|---------|------|----------|------|
| 個人偏好設置 | `/system/settings/personal` | `menu.personal.settings.preferences` | 個人化設置選項 |

#### 功能詳解

**個人偏好設置**
- **路由模式**：`/system/settings/personal`
- **主要功能**：
  - 語言設置（繁中、簡中、英文）
  - 主題設置（亮色、暗色）
  - 通知偏好設置
  - 時區設置
  - 日期格式設置
- **存儲方式**：LocalStorage + 後端用戶設置表
- **即時生效**：設置變更後立即應用

- --

## 🗂️ 數據文件結構

### JSON 結構說明

```json
{
  "app": {
    "name": "NG-ALAIN",
    "description": "Ng-zorro admin panel front-end framework"
  },
  "menu": [
    {
      "text": "Personal",           // 菜單組名稱
      "i18n": "menu.personal",     // 國際化 key
      "group": true,               // 標記為菜單組
      "hideInBreadcrumb": true,    // 不顯示在麵包屑中
      "children": [                // 子菜單項
        {
          "text": "Account System",
          "i18n": "menu.personal.account",
          "icon": "anticon-user",  // NG-ZORRO 圖標
          "children": [
            {
              "text": "My Profile",
              "link": "/accounts/:userId",  // 路由路徑（支持參數）
              "i18n": "menu.personal.account.profile"
            }
          ]
        }
      ]
    }
  ]
}
```

### 字段說明

| 字段 | 類型 | 必填 | 說明 |
|------|------|------|------|
| `text` | string | ✅ | 菜單項顯示文字（英文） |
| `i18n` | string | ✅ | 國際化 key，用於多語言支援 |
| `icon` | string | ❌ | NG-ZORRO 圖標名稱（如 `anticon-user`） |
| `link` | string | ❌ | 路由路徑（如有 children 則不需要） |
| `group` | boolean | ❌ | 是否為菜單組 |
| `hideInBreadcrumb` | boolean | ❌ | 是否隱藏在麵包屑中 |
| `children` | array | ❌ | 子菜單項數組 |

- --

## 🔗 路由參數說明

### 動態參數

個人上下文中使用的動態參數：

| 參數名 | 示例值 | 說明 | 獲取方式 |
|--------|--------|------|----------|
| `:userId` | `uuid-xxx-xxx` | 當前用戶的帳戶 ID | `WorkspaceContextService.currentUserAccountId()` |

### 參數替換邏輯

在 `WorkspaceMenuService` 中，路由會自動替換參數：

```typescript
// 原始路由
'/accounts/:userId'

// 替換後（假設當前用戶 ID 為 'abc-123'）
'/accounts/abc-123'
```

- --

## 🎨 使用場景範例

### 場景 1：新用戶首次登入

```
步驟：
1. 用戶登入 → 自動進入個人上下文
2. 點擊「我的個人資料」→ 完善個人資訊
3. 點擊「我的組織」→ 查看加入的組織
4. 點擊「我的指派任務」→ 查看待處理任務
```

### 場景 2：自由工作者管理個人專案

```
步驟：
1. 進入個人上下文
2. 點擊「我的藍圖列表」→ 查看個人專案
3. 點擊「創建藍圖」→ 創建新的個人專案
4. 點擊「我的待辦清單」→ 管理專案待辦事項
```

### 場景 3：跨組織成員查看所有任務

```
步驟：
1. 用戶屬於多個組織和團隊
2. 進入個人上下文 → 點擊「我的指派任務」
3. 系統聚合顯示來自所有組織和團隊的任務
4. 用戶可一次性查看所有任務，不需切換上下文
```

- --

## 🔍 與其他上下文的差異

### 個人 vs 組織

| 特性 | 個人上下文 | 組織上下文 |
|------|-----------|-----------|
| **藍圖功能** | ✅ 個人藍圖（簡化） | ✅ 組織藍圖（完整，含 Git-like 分支） |
| **任務管理** | ✅ 聚合視圖（只讀） | ✅ 完整管理（創建、編輯、刪除） |
| **成員管理** | ❌ | ✅ 組織成員、團隊管理 |
| **數據分析** | ❌ | ✅ 完整的數據分析和報表 |
| **品質管理** | ❌ | ✅ 品質檢查、驗收管理 |

### 個人 vs 團隊

| 特性 | 個人上下文 | 團隊上下文 |
|------|-----------|-----------|
| **數據範圍** | 跨組織、跨團隊 | 限定於特定團隊 |
| **任務視圖** | 聚合視圖 | 團隊任務視圖 |
| **文檔管理** | 個人文檔 | 團隊文檔 |
| **通知** | 所有通知 | 團隊通知 |

- --

## 📐 開發指南

### 添加新功能到個人上下文

**判斷標準**：
- 是否為個人數據或偏好？ → 是 → 加入個人上下文
- 是否需要跨組織/團隊聚合視圖？ → 是 → 加入個人上下文
- 是否為個人快捷入口？ → 是 → 加入個人上下文

**添加步驟**：

1. **更新 user-data.json**
```json
{
  "text": "新功能",
  "link": "/new-feature",
  "i18n": "menu.personal.newfeature"
}
```

2. **添加國際化**
```typescript
// src/assets/tmp/i18n/zh-TW.json
{
  "menu": {
    "personal": {
      "newfeature": "新功能"
    }
  }
}
```

3. **實現路由組件**
```typescript
// src/app/routes/new-feature/new-feature.component.ts
@Component({
  selector: 'app-new-feature',
  standalone: true,
  imports: [SHARED_IMPORTS],
  templateUrl: './new-feature.component.html'
})
export class NewFeatureComponent {
  // 實現邏輯
}
```

4. **更新路由配置**
```typescript
// src/app/routes/routes.ts
{
  path: 'new-feature',
  loadComponent: () => import('./new-feature/new-feature.component')
    .then(m => m.NewFeatureComponent)
}
```

### 路由權限控制

個人上下文的路由通常不需要特殊權限，因為：
- 所有用戶都有個人上下文
- 數據已在後端通過 RLS 策略過濾
- 前端主要負責顯示和用戶交互

### 數據加載模式

**推薦模式**：
```typescript
export class PersonalFeatureComponent {
  private workspaceContext = inject(WorkspaceContextService);
  private dataService = inject(YourDataService);

  // 使用 computed 或 effect 響應上下文變化
  readonly data = computed(() => {
    const userId = this.workspaceContext.currentUserAccountId();
    if (!userId) return [];
    return this.dataService.loadUserData(userId);
  });
}
```

- --

## 💡 最佳實踐

### DO's ✅

1. **保持輕量**：個人上下文應該快速響應，避免複雜的數據處理
2. **聚合視圖**：充分利用個人上下文的跨組織聚合特性
3. **快速訪問**：提供最常用功能的快捷入口
4. **個人化**：根據用戶偏好定制顯示內容

### DON'Ts ❌

1. **不要添加管理功能**：管理功能（創建組織、管理成員等）應放在組織上下文
2. **不要添加團隊特定功能**：團隊相關功能應放在團隊上下文
3. **不要添加重複功能**：避免與組織/團隊上下文功能重複
4. **不要過度複雜化**：保持個人上下文的簡潔性

- --

## 🔗 相關資源

### 主要文檔
- [工作區上下文使用與規劃指南](./工作區上下文使用與規劃指南.md) - 完整系統說明
- [組織上下文菜單功能說明](./組織上下文菜單功能說明-organization-data.md) - 組織上下文功能
- [團隊上下文菜單功能說明](./團隊上下文菜單功能說明-team-data.md) - 團隊上下文功能

### 數據文件
- [user-data.json](../src/assets/tmp/user-data.json) - 個人上下文菜單數據

### 技術文檔
- [工作區上下文系統架構審查](./工作區上下文系統架構審查.md) - 技術架構
- [工作區系統快速參考指南](./工作區系統-快速參考指南.md) - 開發者參考

- --

**文檔維護者**：開發團隊
**最後更新**：2025-11-20
**版本**：v1.0
