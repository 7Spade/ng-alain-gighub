按企业标准整理完整清单：


[3 tools called]


# 企业化标准开发清单

> 基于：缺失功能明确化报告 + 架构层级完整性检查报告 + 代码质量规范

---

## 一、P0（必须完成）- Facades 层

### 1.1 BotFacade

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/core/facades/bot.facade.ts` |
| **测试文件** | `src/app/core/facades/bot.facade.spec.ts` |
| **优先级** | P0 |
| **依赖 Services** | `BotService`（已存在） |
| **依赖 Repositories** | 无（通过 Service 访问） |
| **核心功能** | Bot 管理、Bot 任务管理、Bot 执行控制、执行日志管理、统计功能 |
| **Signal 状态** | `bots`, `tasks`, `executionLogs`, `activeBots`, `pendingTasks`, `runningTasks`, `failedTasks` |
| **错误处理** | 整合 `ErrorStateService` |
| **活动记录** | 整合 `BlueprintActivityService` |
| **测试覆盖率** | ≥80% |

**必须方法**：
- `loadBots()`, `loadBotById()`, `createBot()`, `updateBot()`, `deleteBot()`
- `loadTasksByBot()`, `createBotTask()`, `updateBotTask()`, `executeBotTask()`
- `startBot()`, `stopBot()`, `restartBot()`
- `loadExecutionLogs()`, `getExecutionLogById()`
- Computed signals: `activeBots`, `pendingTasks`, `runningTasks`, `failedTasks`, `botStats`

---

### 1.2 SystemFacade

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/core/facades/system.facade.ts` |
| **测试文件** | `src/app/core/facades/system.facade.spec.ts` |
| **优先级** | P0 |
| **依赖 Services** | `SettingService`, `FeatureFlagService`（已存在） |
| **依赖 Repositories** | 无（通过 Service 访问） |
| **核心功能** | 系统设定管理、功能开关管理、灰度发布管理、A/B 测试管理 |
| **Signal 状态** | `settings`, `featureFlags`, `enabledFeatures`, `activeABTests` |
| **错误处理** | 整合 `ErrorStateService` |
| **活动记录** | 整合 `BlueprintActivityService` |
| **测试覆盖率** | ≥80% |

**必须方法**：
- `getSetting()`, `setSetting()`, `updateSetting()`, `loadSettings()`, `loadSettingsByCategory()`
- `getFeatureFlag()`, `setFeatureFlag()`, `enableFeature()`, `disableFeature()`
- `enableFeatureForUsers()`, `enableFeatureForOrganizations()`
- `createABTest()`, `updateABTest()`, `getABTestResults()`
- Computed signals: `enabledFeatures`, `activeABTests`, `systemSettings`, `featureUsageStats`

---

## 二、P0（必须完成）- Services 层

### 2.1 TaskTemplateService

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/shared/services/task/task-template.service.ts` |
| **测试文件** | `src/app/shared/services/task/task-template.service.spec.ts` |
| **优先级** | P0 |
| **依赖 Repository** | `TaskTemplateRepository`（已存在） |
| **核心功能** | 任务模板 CRUD、模板套用、使用统计 |
| **Signal 状态** | `templates`, `selectedTemplate`, `loading`, `error` |
| **测试覆盖率** | ≥80% |

**必须方法**：
- `loadTemplates()`, `loadTemplateById()`, `createTemplate()`, `updateTemplate()`, `deleteTemplate()`
- `findByOrganizationId()`, `findPublicTemplates()`
- `applyTemplate()`, `createTaskFromTemplate()`
- `getTemplateUsageStats()`
- Computed signals: `publicTemplates`, `organizationTemplates`, `popularTemplates`

---

### 2.2 TaskDependencyService

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/shared/services/task/task-dependency.service.ts` |
| **测试文件** | `src/app/shared/services/task/task-dependency.service.spec.ts` |
| **优先级** | P0 |
| **依赖 Repository** | `TaskDependencyRepository`（已存在） |
| **核心功能** | 任务依赖 CRUD、循环依赖检测、依赖关系可视化、依赖解析 |
| **Signal 状态** | `dependencies`, `dependencyGraph`, `loading`, `error` |
| **测试覆盖率** | ≥80% |

**必须方法**：
- `loadDependencies()`, `loadDependents()`, `loadDependenciesByTask()`
- `createDependency()`, `updateDependency()`, `deleteDependency()`
- `checkCircularDependency()`, `validateDependency()`
- `getDependencyGraph()`, `getDependencyTree()`
- `resolveDependencies()`, `getExecutionOrder()`
- Computed signals: `circularDependencies`, `unresolvedDependencies`

---

## 三、P1（重要功能）- Facades 层

### 3.1 AnalyticsFacade

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/core/facades/analytics.facade.ts` |
| **测试文件** | `src/app/core/facades/analytics.facade.spec.ts` |
| **优先级** | P1 |
| **依赖 Services** | `ProgressTrackingService`, `AnalyticsCacheService`（已存在） |
| **依赖 Repositories** | 无（通过 Service 访问） |
| **核心功能** | 进度追踪管理、活动记录管理、分析快取管理、报表生成、数据可视化 |
| **Signal 状态** | `progressTracking`, `activityLogs`, `analyticsCache`, `progressStats`, `activityStats` |
| **错误处理** | 整合 `ErrorStateService` |
| **测试覆盖率** | ≥80% |
| **备注** | 或扩展现有的 `DocumentFacade` |

**必须方法**：
- `getProgressTracking()`, `updateProgressTracking()`, `loadProgressTracking()`
- `getActivityLogs()`, `createActivityLog()`, `loadActivityLogs()`
- `getAnalyticsCache()`, `invalidateCache()`, `loadAnalyticsCache()`
- `generateReport()`, `exportReport()`
- `getChartData()`, `getStatistics()`
- Computed signals: `progressStats`, `activityStats`, `cacheStats`, `analyticsStats`, `reportStats`

---

## 四、P1（重要功能）- Services 层

### 4.1 NotificationRuleService

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/shared/services/collaboration/notification-rule.service.ts` |
| **测试文件** | `src/app/shared/services/collaboration/notification-rule.service.spec.ts` |
| **优先级** | P1 |
| **依赖 Repository** | `NotificationRuleRepository`（已存在） |
| **核心功能** | 通知规则引擎完善、规则匹配、规则优先级、规则冲突解决 |
| **Signal 状态** | `rules`, `selectedRule`, `loading`, `error` |
| **测试覆盖率** | ≥80% |
| **备注** | 目前 `NotificationService` 已包含基础功能，是否需要独立 Service 需评估 |

**可选方法**：
- `testRule()`, `validateRule()`
- `createRuleTemplate()`, `applyRuleTemplate()`
- 规则匹配、规则优先级、规则冲突解决逻辑

---

### 4.2 NotificationSubscriptionService

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/shared/services/collaboration/notification-subscription.service.ts` |
| **测试文件** | `src/app/shared/services/collaboration/notification-subscription.service.spec.ts` |
| **优先级** | P1 |
| **依赖 Repository** | `NotificationSubscriptionRepository`（已存在） |
| **核心功能** | 订阅层级管理、订阅对象管理、批量订阅操作、订阅统计 |
| **Signal 状态** | `subscriptions`, `loading`, `error` |
| **测试覆盖率** | ≥80% |
| **备注** | 目前 `NotificationService` 已包含基础功能，是否需要独立 Service 需评估 |

**可选方法**：
- `bulkSubscribe()`, `bulkUnsubscribe()`
- `getSubscriptionStats()`
- 订阅层级管理（all/mentions_only/none）
- 订阅对象管理（blueprint/task/issue/branch）

---

## 五、P2（辅助功能）- Services 层

### 5.1 TodoStatusTrackingService

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/shared/services/todo/todo-status-tracking.service.ts` |
| **测试文件** | `src/app/shared/services/todo/todo-status-tracking.service.spec.ts` |
| **优先级** | P2 |
| **依赖 Repository** | `TodoStatusTrackingRepository`（已存在） |
| **核心功能** | 状态追踪历史查询、状态变更统计、状态变更时间轴、状态变更原因分析 |
| **Signal 状态** | `statusHistory`, `loading`, `error` |
| **测试覆盖率** | ≥80% |
| **备注** | 目前 `PersonalTodoService` 已包含基础功能，是否需要独立 Service 需评估 |

**可选方法**：
- `loadStatusHistory()`, `getStatusHistoryByTodo()`
- `getStatusChangeStats()`, `getStatusTransitionStats()`
- `getStatusTimeline()`
- `analyzeStatusChanges()`

---

## 六、必须更新 - 导出文件

### 6.1 Core 模块导出

| 文件路径 | 更新内容 |
|---------|---------|
| `src/app/core/index.ts` | 添加 Facades 导出：<br>`export * from './facades/bot.facade';`<br>`export * from './facades/system.facade';`<br>`export * from './facades/analytics.facade';`（如果建立） |

---

### 6.2 Shared Services 模块导出

| 文件路径 | 更新内容 |
|---------|---------|
| `src/app/shared/services/task/index.ts` | 添加 Services 导出：<br>`export * from './task-template.service';`<br>`export * from './task-dependency.service';` |
| `src/app/shared/services/collaboration/index.ts` | 添加 Services 导出（如果建立）：<br>`export * from './notification-rule.service';`<br>`export * from './notification-subscription.service';` |
| `src/app/shared/services/todo/index.ts` | 添加 Services 导出（如果建立）：<br>`export * from './todo-status-tracking.service';` |

---

## 七、推荐扩展 - 现有 Facades

### 7.1 TaskFacade 扩展

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/core/facades/task.facade.ts`（已存在） |
| **优先级** | P1（推荐） |
| **扩展内容** | 整合 `TaskTemplateService` 和 `TaskDependencyService` 功能 |
| **新增依赖** | `TaskTemplateService`, `TaskDependencyService` |
| **新增方法** | 任务模板相关方法、任务依赖相关方法 |

**新增方法**：
- `createTaskFromTemplate(templateId: string, blueprintId: string): Promise<Task>`
- `loadTemplates(): Promise<void>`
- `createDependency(taskId: string, dependsOnTaskId: string): Promise<TaskDependency>`
- `checkCircularDependency(taskId: string, dependsOnTaskId: string): Promise<boolean>`
- `getDependencyGraph(blueprintId: string): Promise<DependencyGraph>`

---

### 7.2 CommunicationFacade 扩展

| 项目 | 内容 |
|------|------|
| **文件路径** | `src/app/core/facades/communication.facade.ts`（已存在） |
| **优先级** | P1 |
| **扩展内容** | 整合 `NotificationRuleService` 和 `NotificationSubscriptionService` 功能 |
| **新增依赖** | `NotificationRuleService`, `NotificationSubscriptionService`（如果建立） |
| **新增方法** | 通知规则相关方法、通知订阅相关方法 |

**新增方法**（如果建立了独立 Service）：
- `createNotificationRule(rule: NotificationRuleInsert): Promise<NotificationRule>`
- `subscribeToBlueprint(blueprintId: string, userId: string): Promise<void>`
- `bulkSubscribe(...)`, `bulkUnsubscribe(...)`

---

## 八、企业标准验证清单

### 8.1 代码质量验证

每个文件完成后必须执行：

- [ ] 类型检查：`yarn type-check`（无类型错误）
- [ ] 代码检查：`yarn lint`（无 ESLint 错误）
- [ ] 样式检查：`yarn lint:style`（无 Stylelint 错误）
- [ ] 编译检查：`yarn build`（编译成功）
- [ ] 测试检查：`yarn test`（测试通过，覆盖率 ≥80%）
- [ ] 运行时检查：启动开发服务器验证功能正常

---

### 8.2 架构合规性验证

- [ ] 依赖方向正确：Facade → Service → Repository
- [ ] Facade 不直接依赖 Repository（通过 Service 访问）
- [ ] 使用 Signals 管理状态
- [ ] 暴露 ReadonlySignal 给组件
- [ ] 错误处理整合 `ErrorStateService`
- [ ] 活动记录整合 `BlueprintActivityService`（如适用）

---

### 8.3 代码规范验证

- [ ] 遵循项目命名规范（kebab-case 文件名，PascalCase 类名）
- [ ] 使用 `inject()` 进行依赖注入（Angular 20）
- [ ] 使用 `providedIn: 'root'` 提供服务
- [ ] 完整的 JSDoc 注释
- [ ] 类型安全（无 `any` 类型，除非必要）

---

## 九、完整文件清单统计

### 9.1 P0（必须完成）

| 类别 | 文件数量 | 文件列表 |
|------|---------|---------|
| **Facades** | 2 个 | `bot.facade.ts`, `system.facade.ts` |
| **Facade 测试** | 2 个 | `bot.facade.spec.ts`, `system.facade.spec.ts` |
| **Services** | 2 个 | `task-template.service.ts`, `task-dependency.service.ts` |
| **Service 测试** | 2 个 | `task-template.service.spec.ts`, `task-dependency.service.spec.ts` |
| **导出文件更新** | 2 个 | `core/index.ts`, `shared/services/task/index.ts` |
| **小计** | **10 个文件** | |

---

### 9.2 P1（重要功能）

| 类别 | 文件数量 | 文件列表 |
|------|---------|---------|
| **Facades** | 1 个 | `analytics.facade.ts` |
| **Facade 测试** | 1 个 | `analytics.facade.spec.ts` |
| **Services** | 2 个 | `notification-rule.service.ts`, `notification-subscription.service.ts` |
| **Service 测试** | 2 个 | `notification-rule.service.spec.ts`, `notification-subscription.service.spec.ts` |
| **导出文件更新** | 3 个 | `core/index.ts`, `shared/services/collaboration/index.ts`（如果建立） |
| **Facade 扩展** | 2 个 | `task.facade.ts`（扩展）, `communication.facade.ts`（扩展，可选） |
| **小计** | **最多 11 个文件** | |

---

### 9.3 P2（辅助功能）

| 类别 | 文件数量 | 文件列表 |
|------|---------|---------|
| **Services** | 1 个 | `todo-status-tracking.service.ts` |
| **Service 测试** | 1 个 | `todo-status-tracking.service.spec.ts` |
| **导出文件更新** | 1 个 | `shared/services/todo/index.ts`（如果建立） |
| **小计** | **最多 3 个文件** | |

---

### 9.4 总计

| 优先级 | 文件数量 | 说明 |
|--------|---------|------|
| **P0** | 10 个 | 必须完成 |
| **P1** | 最多 11 个 | 重要功能（部分可选） |
| **P2** | 最多 3 个 | 辅助功能 |
| **总计** | **最多 24 个文件** | |

---

## 十、开发顺序建议

### 阶段 1：P0 核心功能（第 1-2 周）

1. 建立 `TaskTemplateService` + 测试
2. 建立 `TaskDependencyService` + 测试
3. 建立 `BotFacade` + 测试
4. 建立 `SystemFacade` + 测试
5. 更新导出文件
6. 验证和测试

### 阶段 2：P1 重要功能（第 3-4 周）

7. 建立 `AnalyticsFacade` + 测试（或扩展 `DocumentFacade`）
8. 扩展 `TaskFacade`（整合任务模板和依赖功能）
9. 可选：建立 `NotificationRuleService` + 测试
10. 可选：建立 `NotificationSubscriptionService` + 测试
11. 可选：扩展 `CommunicationFacade`
12. 更新导出文件
13. 验证和测试

### 阶段 3：P2 辅助功能（第 5 周）

14. 可选：建立 `TodoStatusTrackingService` + 测试
15. 更新导出文件
16. 验证和测试

---

## 十一、注意事项

1. 所有文件必须遵循企业标准：代码质量、架构合规、测试覆盖
2. 每个文件完成后必须执行完整的验证清单
3. 优先参考现有代码（如 `BlueprintFacade`）保持一致性
4. 确保依赖方向正确：Facade → Service → Repository
5. 所有异步操作必须有错误处理
6. 使用 Signals 管理状态，暴露 ReadonlySignal
7. 测试覆盖率目标：≥80%

---

报告生成时间：2025-01-15  
维护者：开发团队  
版本：v1.0（企业标准版）