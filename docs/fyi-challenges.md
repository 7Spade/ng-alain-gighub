# 問題與挑戰記錄 (FYI - Challenges)

> 參考：[@fyi.md](./fyi.md)

記錄專案在開發過程中遇到的問題、挑戰及其解決方案。

---

## 📋 記錄格式

每個問題/挑戰應包含：
- **日期**：問題發現或解決的日期
- **問題描述**：問題的詳細描述
- **影響範圍**：問題影響的模組或功能
- **解決方案**：採用的解決方法
- **經驗教訓**：從中學到的經驗或最佳實踐

---

## 🐛 問題與挑戰

### 2025-01-15: 權限系統設計權衡

#### 問題描述
在設計權限服務時，需要平衡以下幾個方面：
- 性能：權限檢查頻繁，需要快速響應
- 實時性：權限變更需要及時生效
- 一致性：多層緩存需要保持數據一致

#### 影響範圍
- 權限檢查性能
- 權限更新延遲
- 系統響應速度

#### 解決方案
採用三層緩存策略：
1. **ACLService 緩存**（框架級）：最快，但需要手動同步
2. **內存緩存**（應用級）：5 分鐘 TTL，平衡性能和實時性
3. **數據庫**（持久化）：權威數據源，實時更新

#### 權衡決策
- **緩存時間選擇**：5 分鐘 TTL
  - 過短（< 1 分鐘）：增加數據庫查詢，影響性能
  - 過長（> 10 分鐘）：權限更新延遲，影響實時性
  - 5 分鐘：平衡兩者，適合大多數場景

#### 經驗教訓
- 多層緩存需要明確的更新策略
- 緩存時間需要根據業務場景調整
- 需要提供手動刷新機制應對緊急情況

---

### 2025-11-14: Supabase 與 @delon/auth 整合挑戰

#### 問題描述
需要整合兩個不同的認證系統：
- Supabase Auth：使用 Session 格式
- @delon/auth：使用 Token 格式
- 需要零破壞性整合，保留所有現有代碼

#### 影響範圍
- 認證流程
- 現有業務代碼
- 系統兼容性

#### 解決方案
採用適配器模式：
- 創建 `SupabaseAuthAdapterService` 作為橋樑
- 自動轉換 Session 格式為 Token 格式
- 自動同步到 TokenService
- 保留所有現有 @delon/auth 使用方式

#### 權衡決策
- **增加抽象層**：增加一層適配器，但換來兼容性
- **零破壞性**：避免大規模重構，降低風險

#### 經驗教訓
- 適配器模式適合整合不同系統
- 格式轉換需要考慮所有字段映射
- 自動同步機制需要處理邊界情況

---

### 待補充

當遇到新問題時，請按照上述格式記錄。

---

**最後更新**：2025-01-15  
**維護者**：開發團隊

