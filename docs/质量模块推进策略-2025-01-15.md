# è´¨é‡æ¨¡å—æ¨è¿›ç­–ç•¥

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15  
> **åˆ†ææ–¹æ³•**ï¼šSequential Thinking + Software Planning Tool + Context7 + Supabase MCP  
> **ç›®æ ‡**ï¼šæ¨è¿›è´¨é‡æ¨¡å—ï¼ˆQuality Moduleï¼‰ä»éª¨æ¶çŠ¶æ€åˆ°MVPåŠŸèƒ½å®Œæˆ

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²å®Œæˆ
- âœ… è·¯ç”±é…ç½®å·²å®Œæˆï¼ˆ5ä¸ªè·¯ç”±ï¼‰
  - `/quality/checks` - å“è´¨æ£€æŸ¥åˆ—è¡¨
  - `/quality/submit` - æäº¤éªŒæ”¶ç”³è¯·
  - `/quality/inspections` - éªŒæ”¶ç®¡ç†
  - `/quality/photos` - éªŒæ”¶ç…§ç‰‡
  - `/quality/results` - éªŒæ”¶ç»“æœç»Ÿè®¡
- âœ… ç»„ä»¶éª¨æ¶å·²åˆ›å»ºï¼ˆæ˜¾ç¤º"åŠŸèƒ½å¼€å‘ä¸­"å ä½ç¬¦ï¼‰
- âœ… æ•°æ®åº“è¡¨ç»“æ„å·²å®šä¹‰ï¼ˆ4å¼ è¡¨ï¼ŒRLSå·²å¯ç”¨ï¼‰
  - `quality_checks` - å“è´¨ç®¡ç†è¡¨
  - `qc_photos` - å“ç®¡ç…§ç‰‡è¡¨
  - `inspections` - éªŒæ”¶è¡¨ï¼ˆè´£ä»»åˆ‡å‰²ï¼‰
  - `inspection_photos` - éªŒæ”¶ç…§ç‰‡è¡¨

### âŒ å¾…å®ç°
- âŒ æ•°æ®æ¨¡å‹å±‚ï¼šæœªå®ç°
- âŒ Repositoryå±‚ï¼šæœªå®ç°
- âŒ æœåŠ¡å±‚ï¼šæœªå®ç°
- âŒ UIå±‚ï¼šæœªå®ç°ï¼ˆåªæœ‰å ä½ç¬¦ï¼‰
- âŒ RLSç­–ç•¥ï¼šæœªå®ç°ï¼ˆè¡¨å·²å¯ç”¨RLSï¼Œä½†ç­–ç•¥æœªå®šä¹‰ï¼‰

---

## ğŸ¯ æ¨è¿›ç­–ç•¥ï¼ˆåˆ†4ä¸ªé˜¶æ®µï¼‰

### é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹æ•°æ®æ¨¡å‹ã€Repositoryå’ŒServiceå±‚ï¼Œä¸ºUIå±‚æä¾›åŸºç¡€

#### 1.1 æ•°æ®æ¨¡å‹å±‚ï¼ˆå¤æ‚åº¦ï¼š6/10ï¼‰

**ä½ç½®**ï¼š`src/app/shared/models/quality/`

**ä»»åŠ¡**ï¼š
- åˆ›å»º `types.ts` æ–‡ä»¶ï¼Œå®šä¹‰4å¼ è¡¨çš„TypeScriptç±»å‹
- ä» `Database` ç±»å‹ä¸­æå–ç±»å‹å®šä¹‰
- åˆ›å»ºæšä¸¾ç±»å‹ï¼ˆQualityCheckTypeã€QualityCheckStatusã€InspectionTypeã€InspectionStatusç­‰ï¼‰
- å®šä¹‰JSONBå­—æ®µçš„æ¥å£ï¼ˆCheckItemã€InspectionItemã€DefectRecordï¼‰
- åˆ›å»ºè¾…åŠ©ç±»å‹å’Œå·¥å…·å‡½æ•°

**å‚è€ƒ**ï¼š`src/app/shared/models/task/types.ts`

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// shared/models/quality/types.ts
import { Database } from '@core';

export type QualityCheck = Database['public']['Tables']['quality_checks']['Row'];
export type QualityCheckInsert = Database['public']['Tables']['quality_checks']['Insert'];
export type QualityCheckUpdate = Database['public']['Tables']['quality_checks']['Update'];

export enum QualityCheckType {
  ROUTINE = 'routine',
  MILESTONE = 'milestone',
  FINAL = 'final',
  SPOT_CHECK = 'spot_check'
}

export enum QualityCheckStatus {
  PENDING = 'pending',
  IN_PROGRESS = 'in_progress',
  PASSED = 'passed',
  FAILED = 'failed',
  CONDITIONAL_PASS = 'conditional_pass'
}

export interface CheckItem {
  id: string;
  name: string;
  standard: string;
  result: 'pass' | 'fail' | 'na';
  notes?: string;
}

export enum InspectionType {
  PRELIMINARY = 'preliminary',
  FINAL = 'final',
  WARRANTY = 'warranty',
  HANDOVER = 'handover'
}

export enum InspectionStatus {
  PENDING = 'pending',
  IN_PROGRESS = 'in_progress',
  ACCEPTED = 'accepted',
  REJECTED = 'rejected',
  CONDITIONAL_ACCEPT = 'conditional_accept'
}

export interface InspectionItem {
  id: string;
  name: string;
  criteria: string;
  result: 'pass' | 'fail' | 'na';
  notes?: string;
}

export interface DefectRecord {
  id: string;
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  location?: string;
  photoIds?: string[];
}
```

#### 1.2 Repositoryå±‚ï¼ˆå¤æ‚åº¦ï¼š7/10ï¼‰

**ä½ç½®**ï¼š`src/app/core/infra/repositories/`

**ä»»åŠ¡**ï¼š
- åˆ›å»º4ä¸ªRepositoryç±»ï¼Œç»§æ‰¿ `BaseRepository`
- `QualityCheckRepository`: æ·»åŠ  `findByTaskId()`, `findByStatus()`, `findByCheckType()` ç­‰æ–¹æ³•
- `QcPhotoRepository`: æ·»åŠ  `findByQcId()`, `findByPhotoType()` ç­‰æ–¹æ³•
- `InspectionRepository`: æ·»åŠ  `findByTaskId()`, `findByStatus()`, `findWithResponsibilityTransferred()` ç­‰æ–¹æ³•
- `InspectionPhotoRepository`: æ·»åŠ  `findByInspectionId()` ç­‰æ–¹æ³•

**å‚è€ƒ**ï¼š`src/app/core/infra/repositories/task.repository.ts`

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// core/infra/repositories/quality-check.repository.ts
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { BaseRepository, QueryOptions } from '@core';
import { QualityCheck, QualityCheckInsert, QualityCheckUpdate, QualityCheckStatus } from '@shared';

@Injectable({ providedIn: 'root' })
export class QualityCheckRepository extends BaseRepository<QualityCheck, QualityCheckInsert, QualityCheckUpdate> {
  protected tableName = 'quality_checks';

  findByTaskId(taskId: string, options?: QueryOptions): Observable<QualityCheck[]> {
    return this.findAll({
      ...options,
      filters: { taskId }
    });
  }

  findByStatus(status: QualityCheckStatus, options?: QueryOptions): Observable<QualityCheck[]> {
    return this.findAll({
      ...options,
      filters: { status }
    });
  }

  findByCheckType(checkType: string, options?: QueryOptions): Observable<QualityCheck[]> {
    return this.findAll({
      ...options,
      filters: { checkType }
    });
  }
}
```

#### 1.3 æœåŠ¡å±‚ï¼ˆå¤æ‚åº¦ï¼š7/10ï¼‰

**ä½ç½®**ï¼š`src/app/shared/services/quality/`

**ä»»åŠ¡**ï¼š
- åˆ›å»º `QualityCheckService`ï¼Œå®ç°åŸºç¡€CRUDæ“ä½œ
- åˆ›å»º `InspectionService`ï¼Œå®ç°åŸºç¡€CRUDæ“ä½œå’Œè´£ä»»è½¬ç§»é€»è¾‘
- ä½¿ç”¨ Signals ç®¡ç†çŠ¶æ€
- å®ç° `loadChecks()`, `createCheck()`, `updateCheck()`, `getCheckById()` ç­‰æ–¹æ³•
- å®ç° `loadInspections()`, `createInspection()`, `updateInspection()`, `markResponsibilityTransferred()` ç­‰æ–¹æ³•

**å‚è€ƒ**ï¼š`src/app/shared/services/task/task.service.ts`

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// shared/services/quality/quality-check.service.ts
import { Injectable, inject, signal, computed } from '@angular/core';
import { QualityCheckRepository, QualityCheckInsert, QualityCheckUpdate } from '@core';
import { QualityCheck, QualityCheckStatus } from '@shared';
import { firstValueFrom } from 'rxjs';

@Injectable({ providedIn: 'root' })
export class QualityCheckService {
  private readonly qualityCheckRepository = inject(QualityCheckRepository);
  
  private readonly checksState = signal<QualityCheck[]>([]);
  private readonly selectedCheckState = signal<QualityCheck | null>(null);
  private readonly loadingState = signal<boolean>(false);
  private readonly errorState = signal<string | null>(null);
  
  readonly checks = this.checksState.asReadonly();
  readonly selectedCheck = this.selectedCheckState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  readonly error = this.errorState.asReadonly();
  
  readonly pendingChecks = computed(() => 
    this.checks().filter(c => c.status === QualityCheckStatus.PENDING)
  );
  
  readonly passedChecks = computed(() => 
    this.checks().filter(c => c.status === QualityCheckStatus.PASSED)
  );
  
  async loadChecksByTask(taskId: string): Promise<void> {
    this.loadingState.set(true);
    this.errorState.set(null);
    try {
      const checks = await firstValueFrom(
        this.qualityCheckRepository.findByTaskId(taskId)
      );
      this.checksState.set(checks);
    } catch (error) {
      this.errorState.set(
        error instanceof Error ? error.message : 'åŠ è½½æ£€æŸ¥è®°å½•å¤±è´¥'
      );
      throw error;
    } finally {
      this.loadingState.set(false);
    }
  }
  
  async createCheck(data: QualityCheckInsert): Promise<QualityCheck> {
    this.loadingState.set(true);
    this.errorState.set(null);
    try {
      const check = await firstValueFrom(
        this.qualityCheckRepository.create(data)
      );
      this.checksState.update(checks => [...checks, check]);
      return check;
    } catch (error) {
      this.errorState.set(
        error instanceof Error ? error.message : 'åˆ›å»ºæ£€æŸ¥è®°å½•å¤±è´¥'
      );
      throw error;
    } finally {
      this.loadingState.set(false);
    }
  }
}
```

#### 1.4 å¯¼å‡ºæ¨¡å—å’Œæ›´æ–°ç´¢å¼•æ–‡ä»¶ï¼ˆå¤æ‚åº¦ï¼š3/10ï¼‰

**ä»»åŠ¡**ï¼š
- æ›´æ–° `src/app/shared/models/index.ts`: å¯¼å‡º quality ç›¸å…³ç±»å‹
- æ›´æ–° `src/app/shared/services/index.ts`: å¯¼å‡º quality ç›¸å…³æœåŠ¡
- æ›´æ–° `src/app/core/infra/repositories/index.ts`: å¯¼å‡º quality ç›¸å…³Repository
- ç¡®ä¿è·¯å¾„åˆ«åæ­£ç¡®é…ç½®

---

### é˜¶æ®µ2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**ç›®æ ‡**ï¼šå®ç°å“è´¨æ£€æŸ¥å’ŒéªŒæ”¶ç®¡ç†çš„æ ¸å¿ƒUIåŠŸèƒ½

#### 2.1 å“è´¨æ£€æŸ¥åˆ—è¡¨é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š6/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/checks/quality-checks.component.ts`

**ä»»åŠ¡**ï¼š
- ä½¿ç”¨ `nz-table` æ˜¾ç¤ºæ£€æŸ¥è®°å½•åˆ—è¡¨
- æ”¯æŒç­›é€‰ï¼ˆä»»åŠ¡ã€æ£€æŸ¥ç±»å‹ã€çŠ¶æ€ï¼‰
- æ”¯æŒåˆ›å»ºæ–°æ£€æŸ¥ã€æŸ¥çœ‹è¯¦æƒ…ã€ç¼–è¾‘
- ä½¿ç”¨ Signals ç®¡ç†çŠ¶æ€ï¼Œè¿æ¥ `QualityCheckService`
- ä½¿ç”¨ `SHARED_IMPORTS`ï¼Œç°ä»£æ§åˆ¶æµç¨‹ï¼ˆ`@if`ã€`@for`ï¼‰

**å‚è€ƒ**ï¼š`src/app/routes/tasks/list/task-list.component.ts`

#### 2.2 å“è´¨æ£€æŸ¥è¯¦æƒ…é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š6/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/checks/detail/quality-check-detail.component.ts`

**ä»»åŠ¡**ï¼š
- æ˜¾ç¤ºæ£€æŸ¥çš„å®Œæ•´ä¿¡æ¯ï¼ˆæ£€æŸ¥é¡¹ç›®ã€å‘ç°è®°å½•ã€å»ºè®®ç­‰ï¼‰
- æ˜¾ç¤ºå…³è”çš„ç…§ç‰‡ï¼ˆä½¿ç”¨ `nz-image` ç»„ä»¶ï¼‰
- æ”¯æŒç¼–è¾‘æ£€æŸ¥çŠ¶æ€ã€æ·»åŠ ç…§ç‰‡
- æ˜¾ç¤ºæ£€æŸ¥å†å²è®°å½•

#### 2.3 æäº¤éªŒæ”¶é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š7/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/submit/quality-submit.component.ts`

**ä»»åŠ¡**ï¼š
- ä½¿ç”¨ `nz-form` åˆ›å»ºéªŒæ”¶ç”³è¯·è¡¨å•
- å­—æ®µï¼šé€‰æ‹©ä»»åŠ¡ã€éªŒæ”¶ç±»å‹ã€éªŒæ”¶é¡¹ç›®ï¼ˆJSONBï¼‰ã€éªŒæ”¶æ ‡å‡†ã€å¤‡æ³¨
- æ”¯æŒä¸Šä¼ ç…§ç‰‡ï¼ˆé›†æˆ Supabase Storageï¼‰
- è¡¨å•éªŒè¯å’Œæäº¤é€»è¾‘

#### 2.4 éªŒæ”¶ç®¡ç†é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š7/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/inspections/quality-inspections.component.ts`

**ä»»åŠ¡**ï¼š
- ä½¿ç”¨ `nz-table` æ˜¾ç¤ºéªŒæ”¶è®°å½•åˆ—è¡¨
- æ”¯æŒç­›é€‰ï¼ˆä»»åŠ¡ã€éªŒæ”¶ç±»å‹ã€çŠ¶æ€ã€è´£ä»»è½¬ç§»çŠ¶æ€ï¼‰
- æ”¯æŒæŸ¥çœ‹è¯¦æƒ…ã€å¤„ç†éªŒæ”¶ï¼ˆé€šè¿‡/æ‹’ç»/æ¡ä»¶é€šè¿‡ï¼‰
- æ”¯æŒæ ‡è®°è´£ä»»è½¬ç§»ï¼ˆè®¾ç½® `responsibility_transferred` å’Œ `transfer_date`ï¼‰
- æ˜¾ç¤ºè´£ä»»è½¬ç§»ç»Ÿè®¡

#### 2.5 éªŒæ”¶è¯¦æƒ…é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š7/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/inspections/detail/quality-inspection-detail.component.ts`

**ä»»åŠ¡**ï¼š
- æ˜¾ç¤ºéªŒæ”¶çš„å®Œæ•´ä¿¡æ¯ï¼ˆéªŒæ”¶é¡¹ç›®ã€ç¼ºå¤±è®°å½•ã€çŸ«æ­£æªæ–½ç­‰ï¼‰
- æ˜¾ç¤ºè´£ä»»è½¬ç§»ä¿¡æ¯ï¼ˆæ˜¯å¦è½¬ç§»ã€è½¬ç§»æ—¥æœŸï¼‰
- æ˜¾ç¤ºå…³è”çš„ç…§ç‰‡ï¼ˆå‰/ä¸­/åå¯¹æ¯”ç…§ç‰‡ï¼‰
- æ”¯æŒå¤„ç†éªŒæ”¶ã€æ ‡è®°è´£ä»»è½¬ç§»
- æ˜¾ç¤ºéªŒæ”¶å†å²è®°å½•

**è´£ä»»è½¬ç§»é€»è¾‘**ï¼š
```typescript
async markResponsibilityTransferred(inspectionId: string): Promise<void> {
  const inspection = await this.getInspectionById(inspectionId);
  if (inspection.status === InspectionStatus.ACCEPTED) {
    await this.updateInspection(inspectionId, {
      responsibilityTransferred: true,
      transferDate: new Date().toISOString().split('T')[0]
    });
  }
}
```

---

### é˜¶æ®µ3ï¼šå¢å¼ºåŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

**ç›®æ ‡**ï¼šå®ç°ç…§ç‰‡ç®¡ç†å’Œç»“æœç»Ÿè®¡åŠŸèƒ½

#### 3.1 éªŒæ”¶ç…§ç‰‡é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š6/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/photos/quality-photos.component.ts`

**ä»»åŠ¡**ï¼š
- ä½¿ç”¨ `nz-image` æˆ– `nz-upload` ç»„ä»¶æ˜¾ç¤ºç…§ç‰‡åˆ—è¡¨
- æ”¯æŒæŒ‰æ£€æŸ¥/éªŒæ”¶ç­›é€‰ç…§ç‰‡
- æ”¯æŒä¸Šä¼ æ–°ç…§ç‰‡ï¼ˆé›†æˆ Supabase Storageï¼‰
- æ”¯æŒåˆ é™¤ç…§ç‰‡ã€æ·»åŠ ç…§ç‰‡è¯´æ˜
- ç…§ç‰‡é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½

**æŠ€æœ¯è¦ç‚¹**ï¼š
- é›†æˆ Supabase Storage
- å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€é¢„è§ˆã€åˆ é™¤
- EXIFæ•°æ®æå–ï¼ˆå¯é€‰ï¼‰

#### 3.2 éªŒæ”¶ç»“æœç»Ÿè®¡é¡µé¢ï¼ˆå¤æ‚åº¦ï¼š6/10ï¼‰

**ä½ç½®**ï¼š`src/app/routes/quality/results/quality-results.component.ts`

**ä»»åŠ¡**ï¼š
- ä½¿ç”¨ `nz-statistic` æ˜¾ç¤ºç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æ£€æŸ¥æ•°ã€é€šè¿‡ç‡ã€è´£ä»»è½¬ç§»æ•°ç­‰ï¼‰
- ä½¿ç”¨å›¾è¡¨ï¼ˆnz-chart æˆ–ç¬¬ä¸‰æ–¹åº“ï¼‰æ˜¾ç¤ºè¶‹åŠ¿åˆ†æ
- æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ã€ä»»åŠ¡ã€ç»„ç»‡ç­›é€‰ç»Ÿè®¡
- æ˜¾ç¤ºè´£ä»»è½¬ç§»ç»Ÿè®¡å’ŒéªŒæ”¶é€šè¿‡ç‡è¶‹åŠ¿

**ç»Ÿè®¡æŒ‡æ ‡**ï¼š
- æ€»æ£€æŸ¥æ•°ã€é€šè¿‡æ•°ã€å¤±è´¥æ•°
- é€šè¿‡ç‡ã€å¤±è´¥ç‡
- è´£ä»»è½¬ç§»æ•°é‡
- éªŒæ”¶é€šè¿‡ç‡è¶‹åŠ¿

---

### é˜¶æ®µ4ï¼šå®Œå–„ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

**ç›®æ ‡**ï¼šå®æ–½RLSç­–ç•¥ã€æµ‹è¯•ã€æ–‡æ¡£

#### 4.1 RLSç­–ç•¥å®æ–½ï¼ˆå¤æ‚åº¦ï¼š8/10ï¼‰

**ä»»åŠ¡**ï¼š
- ä¸º4å¼ è´¨é‡ç›¸å…³è¡¨å®æ–½RLSç­–ç•¥
- `quality_checks`: æ‹¥æœ‰è€…å¯æŸ¥çœ‹æ‰€æœ‰ï¼Œæ£€æŸ¥è€…å¯ä¿®æ”¹è‡ªå·±çš„æ£€æŸ¥
- `qc_photos`: å…³è”æ£€æŸ¥çš„æƒé™æ§åˆ¶
- `inspections`: æ‹¥æœ‰è€…å¯æŸ¥çœ‹æ‰€æœ‰ï¼ŒéªŒæ”¶è€…å¯ä¿®æ”¹è‡ªå·±çš„éªŒæ”¶
- `inspection_photos`: å…³è”éªŒæ”¶çš„æƒé™æ§åˆ¶

**æŠ€æœ¯è¦ç‚¹**ï¼š
- å‚è€ƒè“å›¾ç³»ç»Ÿçš„RLSå®ç°
- ç¡®ä¿ç¬¦åˆGit-likeåˆ†æ”¯æ¨¡å‹çš„æƒé™è¦æ±‚
- ä½¿ç”¨ Supabase MCP å·¥å…·åˆ›å»ºå’ŒéªŒè¯RLSç­–ç•¥

#### 4.2 æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆå¤æ‚åº¦ï¼š5/10ï¼‰

**ä»»åŠ¡**ï¼š
- ä¸ºæ‰€æœ‰Repositoryç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆç›®æ ‡80%è¦†ç›–ç‡ï¼‰
- ä¸ºServiceå±‚ç¼–å†™é›†æˆæµ‹è¯•
- æ›´æ–°APIæ–‡æ¡£ï¼ˆ`docs/33-API-æ¥å£è©³ç´°æ–‡æª”.md`ï¼‰
- åˆ›å»ºç”¨æˆ·æ“ä½œæŒ‡å—
- æ›´æ–°è·¯çº¿å›¾çŠ¶æ€

**å‚è€ƒ**ï¼š`docs/38-æ¸¬è©¦æŒ‡å—.md`

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. JSONBå­—æ®µå¤„ç†

**æ£€æŸ¥é¡¹ç›®ï¼ˆcheck_itemsï¼‰**ï¼š
```typescript
export interface CheckItem {
  id: string;
  name: string;
  standard: string;
  result: 'pass' | 'fail' | 'na';
  notes?: string;
}

// ä½¿ç”¨
const checkItems: CheckItem[] = [
  {
    id: '1',
    name: 'ææ–™è´¨é‡',
    standard: 'ç¬¦åˆå›½å®¶æ ‡å‡†',
    result: 'pass',
    notes: 'æ£€æŸ¥é€šè¿‡'
  }
];

await qualityCheckRepository.create({
  taskId: 'task-id',
  checkItems: checkItems as any, // JSONBå­—æ®µ
  status: QualityCheckStatus.PENDING
});
```

### 2. è´£ä»»è½¬ç§»é€»è¾‘

**å®ç°æ–¹å¼**ï¼š
```typescript
async acceptInspection(inspectionId: string): Promise<void> {
  const inspection = await this.getInspectionById(inspectionId);
  
  // æ›´æ–°éªŒæ”¶çŠ¶æ€
  await this.updateInspection(inspectionId, {
    status: InspectionStatus.ACCEPTED,
    completedAt: new Date().toISOString()
  });
  
  // è‡ªåŠ¨æ ‡è®°è´£ä»»è½¬ç§»
  await this.markResponsibilityTransferred(inspectionId);
}
```

### 3. ç…§ç‰‡ä¸Šä¼ é›†æˆ

**Supabase Storageé›†æˆ**ï¼š
```typescript
async uploadPhoto(file: File, qcId: string): Promise<string> {
  const fileExt = file.name.split('.').pop();
  const fileName = `${qcId}/${Date.now()}.${fileExt}`;
  
  const { data, error } = await this.supabase.storage
    .from('qc-photos')
    .upload(fileName, file);
  
  if (error) throw error;
  
  // åˆ›å»ºdocumentè®°å½•
  const document = await this.documentRepository.create({
    fileName: file.name,
    filePath: data.path,
    fileType: file.type,
    fileSize: file.size
  });
  
  // åˆ›å»ºqc_photoè®°å½•
  await this.qcPhotoRepository.create({
    qcId,
    documentId: document.id,
    photoType: 'inspection'
  });
  
  return document.id;
}
```

### 4. æ•°æ®å…³è”æŸ¥è¯¢

**æŸ¥è¯¢æ£€æŸ¥åŠå…¶ç…§ç‰‡**ï¼š
```typescript
async getCheckWithPhotos(checkId: string): Promise<QualityCheckWithPhotos> {
  const check = await firstValueFrom(
    this.qualityCheckRepository.findById(checkId)
  );
  
  const photos = await firstValueFrom(
    this.qcPhotoRepository.findByQcId(checkId)
  );
  
  return {
    ...check,
    photos
  };
}
```

---

## ğŸ“‹ UIç»„ä»¶é€‰æ‹©

æ ¹æ® ng-zorro-antd æ–‡æ¡£å’Œé¡¹ç›®è§„èŒƒï¼š

| åŠŸèƒ½ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| æ£€æŸ¥åˆ—è¡¨ | `nz-table` | æ”¯æŒåˆ†é¡µã€æ’åºã€ç­›é€‰ |
| æ£€æŸ¥è¡¨å• | `nz-form` + `nz-form-item` | å“åº”å¼è¡¨å• |
| ç…§ç‰‡å±•ç¤º | `nz-image` | æ”¯æŒé¢„è§ˆã€ç¼©æ”¾ |
| ç…§ç‰‡ä¸Šä¼  | `nz-upload` | æ”¯æŒæ‹–æ‹½ä¸Šä¼  |
| ç»Ÿè®¡å¡ç‰‡ | `nz-statistic` | æ˜¾ç¤ºç»Ÿè®¡æ•°æ® |
| å›¾è¡¨ | `nz-chart` æˆ–ç¬¬ä¸‰æ–¹åº“ | è¶‹åŠ¿åˆ†æ |

**æ‰€æœ‰ç»„ä»¶éƒ½åœ¨ `SHARED_IMPORTS` ä¸­ï¼Œå¯ç›´æ¥ä½¿ç”¨**

---

## ğŸ” RLSç­–ç•¥è®¾è®¡

### quality_checks è¡¨
- **æ‹¥æœ‰è€…ï¼ˆè“å›¾ownerï¼‰**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ£€æŸ¥è®°å½•
- **æ£€æŸ¥è€…ï¼ˆinspector_idï¼‰**ï¼šå¯ä»¥ä¿®æ”¹è‡ªå·±åˆ›å»ºçš„æ£€æŸ¥
- **ä»»åŠ¡ç›¸å…³ç»„ç»‡**ï¼šå¯ä»¥æŸ¥çœ‹å…³è”ä»»åŠ¡çš„æ£€æŸ¥è®°å½•

### inspections è¡¨
- **æ‹¥æœ‰è€…ï¼ˆè“å›¾ownerï¼‰**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰éªŒæ”¶è®°å½•
- **éªŒæ”¶è€…ï¼ˆinspector_idï¼‰**ï¼šå¯ä»¥ä¿®æ”¹è‡ªå·±åˆ›å»ºçš„éªŒæ”¶
- **ä»»åŠ¡ç›¸å…³ç»„ç»‡**ï¼šå¯ä»¥æŸ¥çœ‹å…³è”ä»»åŠ¡çš„éªŒæ”¶è®°å½•

### qc_photos å’Œ inspection_photos è¡¨
- å…³è”æ£€æŸ¥/éªŒæ”¶çš„æƒé™æ§åˆ¶
- ç…§ç‰‡ä¸Šä¼ è€…å¯ä»¥åˆ é™¤è‡ªå·±ä¸Šä¼ çš„ç…§ç‰‡

---

## ğŸ“… æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | æ—¶é—´ | ç´¯è®¡ |
|------|------|------|
| é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„ | 1-2å‘¨ | 1-2å‘¨ |
| é˜¶æ®µ2ï¼šæ ¸å¿ƒåŠŸèƒ½ | 2-3å‘¨ | 3-5å‘¨ |
| é˜¶æ®µ3ï¼šå¢å¼ºåŠŸèƒ½ | 1-2å‘¨ | 4-7å‘¨ |
| é˜¶æ®µ4ï¼šå®Œå–„ | 1å‘¨ | 5-8å‘¨ |

**æ€»è®¡**ï¼š5-8å‘¨

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **ç¡®è®¤æ•°æ®åº“çŠ¶æ€** - å·²å®Œæˆï¼ˆ4å¼ è¡¨å·²å­˜åœ¨ï¼‰
2. âœ… **ç¡®è®¤æŠ€æœ¯æ ˆ** - å·²å®Œæˆï¼ˆng-zorroç»„ä»¶ã€BaseRepositoryæ¨¡å¼ï¼‰
3. âœ… **åˆ¶å®šæ¨è¿›è®¡åˆ’** - å·²å®Œæˆï¼ˆä½¿ç”¨Software Planning Toolï¼‰
4. â³ **å¼€å§‹é˜¶æ®µ1.1** - åˆ›å»ºæ•°æ®æ¨¡å‹å±‚
5. â³ **åˆ›å»ºRepositoryå±‚** - å‚è€ƒTaskRepository
6. â³ **å®ç°æœåŠ¡å±‚** - ä½¿ç”¨Signalsç®¡ç†çŠ¶æ€
7. â³ **å®ç°UIå±‚** - ä½¿ç”¨SHARED_IMPORTS

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [ä»»åŠ¡æ¨¡å—æ¨è¿›ç­–ç•¥](./ä»»åŠ¡æ¨¡å—æ¨è¿›ç­–ç•¥-2025-01-15.md) - å‚è€ƒå®ç°æ¨¡å¼
- [å¼€å‘æœ€ä½³å®è·µæŒ‡å—](./51-é–‹ç™¼æœ€ä½³å¯¦è¸æŒ‡å—.md) - ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ
- [30-0-å®Œæ•´SQLè¡¨çµæ§‹å®šç¾©.md](./30-0-å®Œæ•´SQLè¡¨çµæ§‹å®šç¾©.md) - æ•°æ®åº“è¡¨ç»“æ„
- [PRD.md](./PRD.md) - äº§å“éœ€æ±‚æ–‡æ¡£
- [27-å®Œæ•´æ¶æ§‹æµç¨‹åœ–.mermaid.md](./27-å®Œæ•´æ¶æ§‹æµç¨‹åœ–.mermaid.md) - ç³»ç»Ÿæ¶æ„
- [é–‹ç™¼ä¸­æ¨¡çµ„ç‹€æ…‹æª¢æŸ¥å ±å‘Š-2025-01-15.md](./é–‹ç™¼ä¸­æ¨¡çµ„ç‹€æ…‹æª¢æŸ¥å ±å‘Š-2025-01-15.md) - å½“å‰çŠ¶æ€

---

**æœ€åæ›´æ–°**ï¼š2025-01-15  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

