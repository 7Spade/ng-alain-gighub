# TaskList 功能使用指南

**版本**: 1.0  
**最後更新**: 2025-11-16  
**適用版本**: ng-alain-github v20.1.0+  
**描述**: TaskListComponent 增強功能完整使用指南

---

## 📋 概覽

TaskListComponent 是任務管理的核心介面，提供完整的任務檢視、狀態管理、暫存控制與過濾功能。本指南說明如何使用 Phase 4 新增的所有功能。

---

## 🎯 功能總覽

### 核心功能

1. **狀態轉換管理** - 8 種任務狀態的智能轉換
2. **暫存控制** - 48 小時暫存機制與撤回功能
3. **響應式過濾** - 多維度任務篩選
4. **即時更新** - 自動同步任務狀態

---

## 📍 位置與存取

### 路由位置

```
/tasks/list
```

### 導航方式

1. **從側邊欄**: 任務管理 → 任務列表
2. **從儀表板**: 點擊任務統計卡片
3. **直接輸入**: 在網址列輸入 `/tasks/list`

---

## 🔧 功能詳解

### 1. 藍圖選擇

**位置**: 頁面頂部左側

**功能**: 選擇要檢視的專案藍圖

**使用步驟**:
1. 點擊「選擇藍圖」下拉選單
2. 從列表中選擇藍圖
3. 任務列表自動載入該藍圖的所有任務

**注意事項**:
- 必須先選擇藍圖才能看到任務
- 切換藍圖會清空當前過濾器
- 支援搜尋藍圖名稱

---

### 2. 狀態轉換管理

**位置**: 任務列表 → 操作欄 → 變更狀態

**功能**: 根據狀態機規則轉換任務狀態

#### 8 種任務狀態

| 狀態 | 中文名稱 | 說明 | 顏色標籤 |
|------|----------|------|----------|
| `pending` | 待处理 | 任務已建立，等待指派 | 灰色 |
| `assigned` | 已指派 | 任務已指派給執行者 | 藍色 |
| `in_progress` | 进行中 | 任務執行中 | 藍色動態 |
| `staging` | 暂存中 | 任務提交到暫存區（48h） | 橙色 |
| `in_qa` | 品管中 | 任務進行品質檢查 | 金色 |
| `in_inspection` | 验收中 | 任務進行驗收 | 青綠色 |
| `completed` | 已完成 | 任務完成 | 綠色 |
| `cancelled` | 已取消 | 任務取消 | 紅色 |

#### 狀態流程

```
pending → assigned → in_progress → staging → in_qa → in_inspection → completed
                                      ↓
                                  cancelled
```

#### 使用步驟

1. **找到要變更的任務**
   - 使用過濾器或滾動找到任務

2. **點擊「變更狀態」按鈕**
   - 位於操作欄中
   - 僅顯示允許的下一步狀態

3. **選擇新狀態**
   - 從下拉選單中選擇
   - 系統會自動驗證轉換合法性

4. **確認變更**
   - 成功後顯示「状态更新成功」訊息
   - 任務列表自動更新

#### 狀態轉換規則

**允許的轉換**:
- `pending` → `assigned`, `cancelled`
- `assigned` → `in_progress`, `cancelled`
- `in_progress` → `staging`, `cancelled`
- `staging` → `in_qa`, `cancelled`（撤回也會改變狀態）
- `in_qa` → `in_inspection`, `staging`（退回）
- `in_inspection` → `completed`, `in_qa`（退回）

**禁止的轉換**:
- 不能跳過階段（例如：`pending` → `staging`）
- 不能從終態返回（`completed` 和 `cancelled` 無法變更）
- 不能向後轉換（例如：`in_qa` → `assigned`）

#### 錯誤處理

如果嘗試無效轉換，系統會顯示錯誤訊息：
```
「無效的狀態轉換」
「狀態機驗證失敗」
```

---

### 3. 暫存控制

**位置**: 任務列表 → 狀態欄 & 操作欄

**功能**: 管理 48 小時暫存機制與撤回操作

#### 48 小時倒計時

**顯示位置**: 狀態欄（僅 `staging` 狀態任務）

**顯示格式**:
```
暂存中
剩余 24h
```

**倒計時規則**:
- 從任務提交到暫存區開始計時
- 顯示剩餘整數小時數
- 0h 表示即將到期
- 過期後自動鎖定（無法撤回）

#### 撤回功能

**顯示位置**: 操作欄 → 撤回按鈕（紅色）

**顯示條件**:
1. 任務狀態為 `staging`
2. 在 48 小時內
3. `can_withdraw` 為 `true`（未被確認）
4. 當前用戶是提交者

**使用步驟**:

1. **確認可撤回**
   - 檢查任務是否顯示「撤回」按鈕
   - 檢查剩餘時間

2. **點擊撤回按鈕**
   - 紅色「撤回」按鈕

3. **確認撤回**
   - 系統自動驗證權限
   - 成功後顯示「撤回成功」訊息

4. **任務狀態變更**
   - 任務從暫存區移除
   - 狀態返回 `in_progress`
   - 可重新編輯任務

#### 撤回限制

**無法撤回的情況**:
- ❌ 超過 48 小時
- ❌ 已被 QA 確認（`can_withdraw` = `false`）
- ❌ 當前用戶不是提交者
- ❌ 任務已進入 `in_qa` 或後續狀態

**錯誤訊息**:
```
「找不到暂存信息」 - 任務無暫存記錄
「未登录用户无法执行此操作」 - 用戶未登入
「权限不足」 - 不是提交者
「撤回失败」 - 其他錯誤
```

---

### 4. 響應式過濾器

**位置**: 藍圖選擇器右側

**功能**: 多維度即時篩選任務

#### 三種過濾器

##### 4.1 狀態過濾器

**選項**: 8 種狀態
```
- 待处理 (pending)
- 已指派 (assigned)
- 进行中 (in_progress)
- 暂存中 (staging)
- 品管中 (in_qa)
- 验收中 (in_inspection)
- 已完成 (completed)
- 已取消 (cancelled)
```

**使用**:
1. 點擊「狀態」下拉選單
2. 選擇要篩選的狀態
3. 列表立即更新
4. 點擊「✕」清除過濾

**常見用途**:
- 查看所有暫存中的任務
- 檢視進行中的工作
- 審查已完成的任務

##### 4.2 優先級過濾器

**選項**: 4 個級別
```
- 低 (low)
- 中 (medium)
- 高 (high)
- 緊急 (urgent)
```

**使用**:
1. 點擊「優先級」下拉選單
2. 選擇要篩選的級別
3. 列表立即更新

**常見用途**:
- 聚焦高優先級任務
- 處理緊急事項
- 規劃低優先級工作

##### 4.3 類型過濾器

**選項**: 4 種類型
```
- 里程碑 (milestone)
- 階段 (phase)
- 任務 (task)
- 子任務 (subtask)
```

**使用**:
1. 點擊「類型」下拉選單
2. 選擇要篩選的類型
3. 列表立即更新

**常見用途**:
- 檢視專案里程碑
- 管理階段性工作
- 追蹤子任務進度

#### 組合過濾

**功能**: 同時使用多個過濾器

**範例**:
```
狀態: staging
優先級: urgent
類型: task
```
結果：僅顯示「暫存中」且「緊急」的「任務」類型項目

**清除過濾**:
- 單個過濾器：點擊下拉選單中的「✕」
- 全部清除：手動清除每個過濾器

#### 過濾效能

- ✅ 零延遲：使用 Computed Signal
- ✅ 即時更新：無需重新載入
- ✅ 無閃爍：OnPush 變更檢測
- ✅ 大列表：支援數百個任務

---

### 5. 任務操作

#### 5.1 查看詳情

**按鈕**: 查看

**功能**: 開啟任務詳情頁面

**使用**:
1. 點擊任務列中的「查看」按鈕
2. 跳轉到任務詳情頁面
3. 檢視完整任務資訊

#### 5.2 編輯任務

**按鈕**: 編輯

**功能**: 開啟任務編輯頁面

**使用**:
1. 點擊任務列中的「編輯」按鈕
2. 跳轉到任務編輯頁面
3. 修改任務資訊
4. 儲存變更

#### 5.3 刪除任務

**按鈕**: 刪除（紅色）

**功能**: 永久刪除任務

**使用**:
1. 點擊任務列中的「刪除」按鈕
2. 確認刪除操作
3. 任務從列表中移除

**注意**:
- ⚠️ 刪除操作不可逆
- ⚠️ 會刪除所有關聯資料
- ✅ 有確認對話框

---

## 💡 使用技巧

### 快速篩選

**情境**: 找到所有需要驗收的高優先級任務

**操作**:
```
1. 狀態: in_inspection
2. 優先級: high
```

### 監控暫存區

**情境**: 檢查即將到期的暫存任務

**操作**:
```
1. 狀態: staging
2. 查看「剩余 Xh」欄位
3. 優先處理低於 6h 的任務
```

### 團隊協作

**情境**: 確認團隊成員的工作進度

**操作**:
```
1. 狀態: in_progress
2. 檢視指派欄位
3. 追蹤個別進度
```

---

## ⚠️ 常見問題

### Q1: 為什麼我看不到「變更狀態」按鈕？

**A**: 
- 任務已完成或取消（終態）
- 當前狀態沒有允許的下一步
- 刷新頁面重試

### Q2: 為什麼撤回按鈕沒有顯示？

**A**: 檢查以下條件:
- 任務是否為 `staging` 狀態
- 是否在 48 小時內
- 你是否為提交者
- 任務是否已被確認

### Q3: 過濾器不工作？

**A**:
- 確認已選擇藍圖
- 確認有符合條件的任務
- 嘗試清除過濾器重新設定
- 刷新頁面

### Q4: 狀態變更失敗？

**A**:
- 檢查狀態轉換是否符合規則
- 確認任務未處於終態
- 檢查網路連線
- 查看錯誤訊息詳情

---

## 🔒 權限說明

### 查看權限

- ✅ 所有藍圖成員可查看任務
- ✅ 組織成員可查看相關藍圖

### 編輯權限

- ✅ 任務指派者可編輯
- ✅ 藍圖擁有者可編輯所有任務
- ❌ 其他用戶僅可查看

### 撤回權限

- ✅ 僅任務提交者
- ✅ 48 小時內
- ✅ 未被確認

### 狀態變更權限

- ✅ 有編輯權限的用戶
- ✅ 符合狀態機規則
- ❌ 終態任務無法變更

---

## 📱 響應式設計

### 桌面版（≥1200px）

- 完整功能顯示
- 多欄位表格
- 所有操作按鈕

### 平板版（768px - 1199px）

- 簡化表格欄位
- 操作選單收合
- 過濾器保持可用

### 手機版（<768px）

- 卡片式布局
- 折疊式操作
- 底部導航

---

## 🎯 最佳實踐

### 1. 定期檢查暫存區

**建議頻率**: 每天 2 次

**檢查項目**:
- 即將到期的任務（<6h）
- 需要撤回的任務
- 等待 QA 的任務

### 2. 使用過濾器規劃工作

**早上**:
```
優先級: urgent + high
狀態: assigned, in_progress
```

**下午**:
```
狀態: staging
檢查需要 QA 的任務
```

### 3. 追蹤團隊進度

**每週**:
```
狀態: completed
查看完成的任務數量
```

**每月**:
```
類型: milestone
確認里程碑達成
```

---

## 🔗 相關文檔

- **實施報告**: `docs/54-Phase4-5實施報告.md`
- **部署清單**: `docs/56-生產部署清單.md`
- **開發指南**: `docs/00-開發作業指引.md`
- **狀態圖**: `docs/16-狀態圖.mermaid.md`
- **狀態機實作**: `src/app/shared/services/task/task-state-machine.ts`

---

## 📞 支援

如遇問題，請聯繫:
- **技術支援**: 開發團隊
- **功能建議**: GitHub Issues
- **文檔更新**: Pull Requests

---

**版本**: 1.0  
**維護者**: Development Team  
**最後更新**: 2025-11-16  
**狀態**: ✅ 正式發布
