# 用户操作流程分析 - 组织与团队

> **目的**：从用户视角分析组织与团队的完整操作流程，确定需要实现的功能

## 📋 用户场景

### 场景一：用户 A（组织拥有者）

**操作流程：**
1. **注册账号** → 自动创建 User 账户
2. **创建组织** → `/accounts/create/organization` → 成为组织拥有者（owner）
3. **切换到组织上下文** → 通过菜单切换器切换到组织视角
4. **创建团队** → `/org/:id/teams` → 创建团队，自动成为团队负责人（leader）
5. **邀请朋友加入组织** → `/org/:id/members` → 点击"邀请成员" → 输入朋友邮箱
6. **邀请朋友加入团队** → `/org/:id/teams` → 点击团队 → `/org/teams/:id/members` → 点击"邀请成员"

### 场景二：用户 B（朋友，要加入）

**操作流程：**
1. **注册账号** → 自动创建 User 账户
2. **收到组织邀请通知** → 点击接受 → 自动加入组织（默认角色：member）
3. **切换到组织上下文** → 通过菜单切换器切换到组织视角
4. **查看团队列表** → `/org/:id/teams` → 看到该组织的所有团队
5. **收到团队邀请通知** → 点击接受 → 自动加入团队（默认角色：member）
   
   或者：
   
   **申请加入团队** → `/org/:id/teams` → 点击"申请加入" → 等待团队负责人审核

---

## 🎯 需要的功能清单

### ✅ 已实现的功能

**组织层面：**
- ✅ 创建组织（`/accounts/create/organization`）
- ✅ 组织成员管理（`/org/:id/members`）
  - ✅ 添加成员（直接添加）
  - ✅ 编辑角色
  - ✅ 移除成员

**团队层面：**
- ✅ 创建团队（`/accounts/teams/create`）
- ✅ 团队成员管理（`/org/teams/:id/members`）
  - ✅ 添加成员（直接添加）
  - ✅ 编辑角色
  - ✅ 移除成员

### ❌ 缺失的关键功能

**组织上下文下的团队管理：**
- ❌ `/org/:id/teams` - **组织下的团队列表**（最重要！）
  - 在组织上下文下查看该组织的所有团队
  - 在组织上下文下创建团队
  - 在组织上下文下管理团队（编辑、删除）
  - 点击团队进入团队成员管理

**邀请和申请机制：**
- ❌ 组织邀请功能
  - 发送邀请（通过邮箱或用户名）
  - 接受/拒绝邀请
  - 邀请通知
- ❌ 团队邀请功能
  - 发送邀请（只能邀请组织成员）
  - 接受/拒绝邀请
  - 邀请通知
- ❌ 申请加入功能
  - 申请加入组织
  - 申请加入团队
  - 审核申请

**通知系统：**
- ❌ 邀请通知
- ❌ 申请通知
- ❌ 通知中心

---

## 🔍 当前实现的问题

### 问题一：缺少组织上下文下的团队管理

**当前状态：**
- 团队管理在 `/accounts/teams`（账户管理视角）
- 需要先选择组织，才能看到该组织的团队
- 朋友加入组织后，无法直接看到该组织的团队列表

**应该实现：**
- `/org/:id/teams` - 在组织上下文下直接显示该组织的所有团队
- 朋友加入组织后，切换到组织上下文，就能看到所有团队
- 可以直接申请加入或等待邀请

### 问题二：直接添加 vs 邀请流程

**当前状态：**
- 只能直接添加成员（需要知道账户ID）
- 管理员操作，朋友被动接受

**应该实现：**
- 邀请流程（通过邮箱或用户名邀请）
- 发送邀请通知
- 朋友主动接受邀请

### 问题三：缺少团队列表查看

**当前状态：**
- 朋友加入组织后，不知道有哪些团队
- 需要去 `/accounts/teams` 选择组织才能看到

**应该实现：**
- 在组织上下文下 `/org/:id/teams` 直接显示所有团队
- 朋友可以看到团队列表，申请加入或等待邀请

---

## 🚀 实施优先级

### 阶段一：基础功能（当前状态）✅

1. ✅ 创建组织
2. ✅ 创建团队
3. ✅ 直接添加组织成员
4. ✅ 直接添加团队成员

### 阶段二：组织上下文下的团队管理（**最紧急**）❌

1. ❌ `/org/:id/teams` - 组织下的团队列表
   - 显示该组织的所有团队
   - 创建团队按钮
   - 团队操作（查看、编辑、删除）
   - 点击团队进入团队成员管理

2. ❌ 在组织上下文下创建团队
   - 复用 `TeamCreateComponent`
   - 自动填充组织ID

3. ❌ 更新菜单配置
   - 在组织菜单中添加"团队管理"菜单项

### 阶段三：邀请和申请机制（未来扩展）

1. ❌ 组织邀请功能
2. ❌ 团队邀请功能
3. ❌ 申请加入功能
4. ❌ 通知系统

---

## 📝 用户操作路径总结

### 用户 A（组织拥有者）的完整路径：

```
1. 注册 → 自动完成
2. 创建组织 → /accounts/create/organization
3. 切换到组织上下文 → 菜单切换器
4. 创建团队 → /org/:id/teams → 点击"创建团队"
5. 邀请朋友 → /org/:id/members → 点击"邀请成员"
6. 邀请朋友加入团队 → /org/:id/teams → 点击团队 → /org/teams/:id/members → 点击"邀请成员"
```

### 用户 B（朋友）的完整路径：

```
1. 注册 → 自动完成
2. 收到组织邀请 → 点击接受 → 自动加入组织
3. 切换到组织上下文 → 菜单切换器
4. 查看团队列表 → /org/:id/teams → 看到所有团队
5. 收到团队邀请 → 点击接受 → 自动加入团队
   或者：
   申请加入团队 → /org/:id/teams → 点击"申请加入"
```

---

## 🎯 关键发现

**最紧急需要实现的功能：**

1. **`/org/:id/teams` - 组织下的团队列表**
   - 这是朋友加入组织后，能够看到和管理团队的关键入口
   - 应该在组织上下文下直接显示，不需要选择组织

2. **在组织上下文下创建和管理团队**
   - 组织拥有者应该在组织上下文下直接创建团队
   - 不需要回到账户管理视角

3. **团队列表的操作**
   - 查看团队详情
   - 管理团队成员（跳转到 `/org/teams/:id/members`）
   - 编辑团队
   - 删除团队

---

**最后更新**：2025-01-20  
**维护者**：开发团队

