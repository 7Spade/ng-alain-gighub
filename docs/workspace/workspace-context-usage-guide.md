# 工作區上下文使用與規劃指南

## 📑 目錄

- [🎯 概述](#-概述)
  - [什麼是工作區上下文？](#什麼是工作區上下文)
  - [為什麼需要三個獨立的上下文？](#為什麼需要三個獨立的上下文)
- [📊 上下文層級與關係](#-上下文層級與關係)
  - [層級結構](#層級結構)
  - [關係說明](#關係說明)
  - [數據流](#數據流)
- [👤 個人上下文 (user-data.json)](#-個人上下文-user-datajson)
  - [🎯 用途與定位](#-用途與定位)
  - [📋 菜單結構](#-菜單結構)
  - [✨ 核心功能](#-核心功能)
    - [1. 帳戶系統 (Account System)](#1-帳戶系統-account-system)
    - [2. 我的任務 (My Tasks)](#2-我的任務-my-tasks)
    - [3. 我的藍圖 (My Blueprints)](#3-我的藍圖-my-blueprints)
    - [4. 我的文檔 (My Documents)](#4-我的文檔-my-documents)
    - [5. 我的溝通 (My Communication)](#5-我的溝通-my-communication)
    - [6. 個人設置 (Personal Settings)](#6-個人設置-personal-settings)
  - [🎨 使用場景](#-使用場景)
- [🏢 組織上下文 (organization-data.json)](#-組織上下文-organization-datajson)
  - [🎯 用途與定位](#-用途與定位)
  - [📋 菜單結構](#-菜單結構)
  - [✨ 核心功能](#-核心功能)
    - [1. 組織管理 (Organization Management)](#1-組織管理-organization-management)
    - [2. 組織協作 (Organization Collaboration)](#2-組織協作-organization-collaboration)
    - [3. 組織藍圖 (Organization Blueprints) ⭐ **最重要**](#3-組織藍圖-organization-blueprints--最重要)
    - [4. 組織任務 (Organization Tasks)](#4-組織任務-organization-tasks)
    - [5. 組織品質 (Organization Quality)](#5-組織品質-organization-quality)
    - [6. 組織問題 (Organization Issues)](#6-組織問題-organization-issues)
    - [7. 組織溝通 (Organization Communication)](#7-組織溝通-organization-communication)
    - [8. 組織分析 (Organization Analytics)](#8-組織分析-organization-analytics)
    - [9. 組織文檔 (Organization Documents)](#9-組織文檔-organization-documents)
  - [🎨 使用場景](#-使用場景)
- [👥 團隊上下文 (team-data.json)](#-團隊上下文-team-datajson)
  - [🎯 用途與定位](#-用途與定位)
  - [📋 菜單結構](#-菜單結構)
  - [✨ 核心功能](#-核心功能)
    - [1. 團隊管理 (Team Management)](#1-團隊管理-team-management)
    - [2. 團隊任務 (Team Tasks)](#2-團隊任務-team-tasks)
    - [3. 團隊問題 (Team Issues)](#3-團隊問題-team-issues)
    - [4. 團隊溝通 (Team Communication)](#4-團隊溝通-team-communication)
    - [5. 團隊文檔 (Team Documents)](#5-團隊文檔-team-documents)
  - [🎨 使用場景](#-使用場景)
- [📋 功能可用性矩陣](#-功能可用性矩陣)
  - [圖例說明](#圖例說明)
  - [功能分級原則](#功能分級原則)
- [🔄 上下文切換體驗](#-上下文切換體驗)
  - [UI/UX 最佳實踐](#uiux-最佳實踐)
    - [1. **清晰的上下文指示器**](#1-清晰的上下文指示器)
    - [2. **平滑的切換動畫**](#2-平滑的切換動畫)
    - [3. **上下文切換器 (Context Switcher)**](#3-上下文切換器-context-switcher)
    - [4. **狀態持久化**](#4-狀態持久化)
  - [導航模式](#導航模式)
    - [模式 1：頂部導航 + 上下文切換器](#模式-1頂部導航--上下文切換器)
    - [模式 2：側邊欄 + 上下文區塊](#模式-2側邊欄--上下文區塊)
  - [關鍵體驗指標](#關鍵體驗指標)
- [📐 功能規劃指南](#-功能規劃指南)
  - [決策樹：功能應該放在哪個上下文？](#決策樹功能應該放在哪個上下文)
  - [功能分類原則](#功能分類原則)
    - [原則 1：管理權限 → 組織上下文](#原則-1管理權限--組織上下文)
    - [原則 2：個人數據 → 個人上下文](#原則-2個人數據--個人上下文)
    - [原則 3：團隊協作 → 團隊 + 組織](#原則-3團隊協作--團隊--組織)
    - [原則 4：數據分析 → 組織上下文](#原則-4數據分析--組織上下文)
  - [功能添加檢查清單](#功能添加檢查清單)
  - [反模式 (Anti-patterns)](#反模式-anti-patterns)
- [💡 最佳實踐](#-最佳實踐)
  - [DO's ✅](#dos-)
  - [DON'Ts ❌](#donts-)
  - [常見陷阱](#常見陷阱)
    - [陷阱 1：功能放置不當](#陷阱-1功能放置不當)
    - [陷阱 2：數據過濾錯誤](#陷阱-2數據過濾錯誤)
    - [陷阱 3：上下文指示不清](#陷阱-3上下文指示不清)
    - [陷阱 4：切換後狀態丟失](#陷阱-4切換後狀態丟失)
- [🎨 使用場景範例](#-使用場景範例)
  - [場景 1：新員工入職](#場景-1新員工入職)
  - [場景 2：專案經理日常工作](#場景-2專案經理日常工作)
  - [場景 3：團隊成員執行任務](#場景-3團隊成員執行任務)
  - [場景 4：跨上下文工作流](#場景-4跨上下文工作流)
  - [場景 5：組織管理員管理多個團隊](#場景-5組織管理員管理多個團隊)
- [📊 總結與建議](#-總結與建議)
  - [核心設計理念](#核心設計理念)
  - [用戶體驗原則](#用戶體驗原則)
  - [開發建議](#開發建議)
  - [未來擴展方向](#未來擴展方向)
- [📚 相關資源](#-相關資源)

---


> 📚 **目的**：提供工作區上下文系統的完整使用指南，幫助團隊理解三個數據文件（user-data.json、organization-data.json、team-data.json）的功能規劃與用戶體驗設計

**最後更新**：2025-11-20
**相關文檔**：
- [工作區上下文系統架構審查](./工作區上下文系統架構審查.md) - 技術架構詳細審查
- [工作區系統快速參考指南](./工作區系統-快速參考指南.md) - 開發者快速參考
- [工作區上下文切換流程圖](./工作區上下文切換流程圖.mermaid.md) - 視覺化流程圖

- --

## 🎯 概述

### 什麼是工作區上下文？

工作區上下文是本系統的**多視角管理機制**，允許用戶在不同的工作環境之間無縫切換。系統提供三種主要上下文：

| 上下文類型 | 數據文件 | 圖標 | 主要用途 |
|-----------|---------|------|----------|
| 👤 **個人上下文** | `user-data.json` | user | 個人任務、文檔、設置管理 |
| 🏢 **組織上下文** | `organization-data.json` | team | 組織級別的完整功能管理 |
| 👥 **團隊上下文** | `team-data.json` | usergroup-add | 團隊協作與任務執行 |

### 為什麼需要三個獨立的上下文？

**設計理念**：不同的工作場景需要不同的功能集和操作權限

1. **個人上下文**：聚焦於個人生產力
   - 我的任務、我的文檔、我的藍圖
   - 個人設置和偏好
   - 輕量級、快速訪問

2. **組織上下文**：組織管理的完整功能
   - 組織管理（成員、團隊、權限）
   - 藍圖系統（Git-like 分支模型）
   - 質量控制、問題追蹤
   - 數據分析和報表
   - 最完整的功能集

3. **團隊上下文**：團隊協作與執行
   - 團隊任務和日程
   - 團隊溝通和協作
   - 聚焦於執行層面
   - 功能集是組織的子集

- --

## 📊 上下文層級與關係

### 層級結構

```
應用 (App Context)
  │
  ├─ 👤 個人 (User Context)
  │   └─ 個人帳戶
  │
  ├─ 🏢 組織 (Organization Context)
  │   ├─ 組織帳戶
  │   └─ 組織藍圖
  │
  └─ 👥 團隊 (Team Context)
      ├─ 團隊成員
      └─ 所屬組織的藍圖
```

### 關係說明

1. **用戶可以擁有多個身份**
   - 作為個人使用系統
   - 創建或加入多個組織
   - 加入多個團隊（可跨組織）

2. **組織包含團隊**
   - 一個組織可以有多個團隊
   - 團隊必須屬於某個組織
   - 團隊共享組織的藍圖

3. **藍圖歸屬**
   - 個人可以創建個人藍圖
   - 組織可以創建組織藍圖
   - 團隊使用所屬組織的藍圖

### 數據流

```
用戶登入
  ↓
選擇上下文 (個人/組織/團隊)
  ↓
加載對應的菜單 (user-data.json / organization-data.json / team-data.json)
  ↓
加載對應的數據 (帳戶、藍圖、團隊等)
  ↓
顯示上下文特定的功能
```

- --

## 👤 個人上下文 (user-data.json)

### 🎯 用途與定位

**核心理念**：個人生產力中心

- **適用場景**：個人日常工作、獨立任務管理
- **權限範圍**：僅限個人數據
- **特點**：輕量、快速、專注於個人效率

### 📋 菜單結構

```json
{
  "menu": [
    {
      "text": "Personal",
      "children": [
        "帳戶系統",
        "我的任務",
        "我的藍圖",
        "我的文檔",
        "我的溝通",
        "個人設置"
      ]
    }
  ]
}
```

### ✨ 核心功能

#### 1. 帳戶系統 (Account System)
```typescript
{
  "text": "Account System",
  "children": [
    "我的個人資料",    // 查看和編輯個人資料
    "我的組織"         // 查看加入的組織列表
  ]
}
```

**用途**：
- 管理個人基本資訊
- 快速導航至所屬組織

#### 2. 我的任務 (My Tasks)
```typescript
{
  "text": "My Tasks",
  "children": [
    "我的待辦清單",    // 個人待辦事項
    "我的指派任務"     // 被指派的任務
  ]
}
```

**用途**：
- 查看所有指派給我的任務
- 管理個人待辦事項
- 跨組織、跨團隊的任務聚合視圖

#### 3. 我的藍圖 (My Blueprints)
```typescript
{
  "text": "My Blueprints",
  "children": [
    "我的藍圖列表",    // 我創建的個人藍圖
    "創建藍圖"         // 創建新的個人藍圖
  ]
}
```

**用途**：
- 管理個人創建的藍圖
- 個人專案管理

#### 4. 我的文檔 (My Documents)
```typescript
{
  "text": "My Documents",
  "children": [
    "我的文檔列表",    // 我的個人文檔
    "上傳文檔"         // 上傳新文檔
  ]
}
```

**用途**：
- 個人文檔存儲
- 快速訪問常用文檔

#### 5. 我的溝通 (My Communication)
```typescript
{
  "text": "My Communication",
  "children": [
    "我的通知",        // 系統通知
    "我的待辦"         // 待處理事項
  ]
}
```

**用途**：
- 統一的通知中心
- 待處理事項提醒

#### 6. 個人設置 (Personal Settings)
```typescript
{
  "text": "Personal Settings",
  "children": [
    "個人偏好設置"     // 個人化設置
  ]
}
```

**用途**：
- 語言、主題等偏好設置
- 通知設置

### 🎨 使用場景

**場景 1：個人自由工作者**
```
用戶：張三（自由接案工作者）
需求：管理多個獨立專案、追蹤個人任務
使用：個人上下文 → 我的藍圖 → 創建個人藍圖
```

**場景 2：查看所有任務**
```
用戶：李四（多個組織的成員）
需求：一次查看所有指派給我的任務
使用：個人上下文 → 我的任務 → 我的指派任務
（自動聚合來自所有組織和團隊的任務）
```

**場景 3：管理個人文檔**
```
用戶：王五（需要存儲個人筆記和文檔）
需求：儲存和管理個人文件
使用：個人上下文 → 我的文檔 → 上傳文檔
```

- --

## 🏢 組織上下文 (organization-data.json)

### 🎯 用途與定位

**核心理念**：組織全功能管理中心

- **適用場景**：組織管理、專案管理、團隊協作
- **權限範圍**：組織級別數據
- **特點**：功能最完整、管理能力最強

### 📋 菜單結構

```json
{
  "menu": [
    {
      "text": "Organization",
      "children": [
        "組織管理",       // 成員、團隊管理
        "組織協作",       // 協作與邀請
        "組織藍圖",       // 完整的藍圖管理（Git-like）
        "組織任務",       // 任務管理（多視圖）
        "組織品質",       // 品質檢查與驗收
        "組織問題",       // 問題追蹤
        "組織溝通",       // 討論與通知
        "組織分析",       // 數據分析與報表
        "組織文檔"        // 文檔管理
      ]
    }
  ]
}
```

### ✨ 核心功能

#### 1. 組織管理 (Organization Management)
```typescript
{
  "text": "Organization Management",
  "children": [
    "組織成員",        // 成員列表、權限管理
    "組織團隊"         // 團隊列表、創建團隊
  ]
}
```

**用途**：
- 管理組織成員和權限
- 創建和管理團隊
- 組織架構管理

**適合角色**：組織管理員、HR

#### 2. 組織協作 (Organization Collaboration)
```typescript
{
  "text": "Organization Collaboration",
  "children": [
    "協作列表",        // 協作專案列表
    "創建協作",        // 創建新的協作
    "協作邀請"         // 管理邀請
  ]
}
```

**用途**：
- 跨團隊協作管理
- 外部協作者邀請

#### 3. 組織藍圖 (Organization Blueprints) ⭐ **最重要**
```typescript
{
  "text": "Organization Blueprints",
  "children": [
    "藍圖列表",        // 組織所有藍圖
    "創建藍圖",        // 創建新藍圖
    "藍圖詳情",        // 藍圖詳細資訊
    "藍圖設置",        // 藍圖配置
    "主分支",          // 主分支管理
    "分支管理",        // 所有分支列表
    "分支詳情",        // 分支詳細資訊
    "Fork 任務",       // Fork 到組織分支
    "Pull Request",    // PR 列表
    "PR 詳情",         // PR 詳細資訊
    "PR 審查"          // PR 審查界面
  ]
}
```

**用途**：
- 完整的 Git-like 藍圖管理系統
- 主分支（擁有者控制）
- 組織分支（Fork 機制）
- PR 機制（提交執行數據，擁有者審核）

**適合角色**：專案經理、藍圖擁有者

#### 4. 組織任務 (Organization Tasks)
```typescript
{
  "text": "Organization Tasks",
  "children": [
    "任務看板",        // Kanban 視圖
    "任務日曆",        // 日曆視圖
    "任務列表",        // 列表視圖
    "任務樹狀圖",      // 樹狀結構視圖
    "創建任務",        // 創建新任務
    "任務詳情",        // 任務詳細資訊
    "任務表單",        // 任務編輯表單
    "任務指派",        // 任務分配
    "待辦清單",        // 待辦事項
    "日報",            // 施工日報
    "施工照片",        // 現場照片
    "天氣記錄",        // 天氣日誌
    "任務進度"         // 進度追蹤
  ]
}
```

**用途**：
- 多視角任務管理（看板、日曆、列表、樹狀圖）
- 工地管理專用功能（日報、照片、天氣）
- 完整的任務生命週期管理

**適合角色**：專案經理、任務負責人

#### 5. 組織品質 (Organization Quality)
```typescript
{
  "text": "Organization Quality",
  "children": [
    "品質檢查",        // 品質檢查列表
    "品質檢查詳情",    // 檢查詳情
    "提交驗收",        // 提交驗收申請
    "驗收管理",        // 驗收列表
    "驗收詳情",        // 驗收詳情
    "驗收照片",        // 驗收照片
    "驗收結果"         // 驗收結果
  ]
}
```

**用途**：
- 品質檢查流程
- 驗收管理
- 品質追蹤

**適合角色**：品質經理、驗收人員

#### 6. 組織問題 (Organization Issues)
```typescript
{
  "text": "Organization Issues",
  "children": [
    "問題列表",        // 問題追蹤列表
    "創建問題",        // 創建新問題
    "問題詳情",        // 問題詳細資訊
    "問題指派",        // 問題分配
    "問題處理",        // 處理界面
    "處理照片",        // 處理照片
    "關閉問題",        // 關閉問題
    "問題同步日誌"     // 同步記錄
  ]
}
```

**用途**：
- 問題追蹤系統
- 問題同步至主分支（即時同步）
- 問題處理流程

#### 7. 組織溝通 (Organization Communication)
```typescript
{
  "text": "Organization Communication",
  "children": [
    "討論區",          // 討論區
    "評論管理",        // 評論列表
    "發表評論",        // 新增評論
    "通知中心",        // 通知列表
    "通知詳情",        // 通知詳情
    "通知規則",        // 通知規則設定
    "即時通知",        // 即時通知
    "待辦中心",        // 待辦事項
    "團隊通知"         // 團隊通知
  ]
}
```

**用途**：
- 組織內部溝通
- 通知管理
- 協作討論

#### 8. 組織分析 (Organization Analytics)
```typescript
{
  "text": "Organization Analytics",
  "children": [
    "統計數據",        // 數據統計
    "進度追蹤",        // 進度監控
    "進度更新",        // 更新進度
    "主分支報表",      // 主分支數據報表
    "分支報表",        // 分支數據報表
    "跨分支總覽",      // 跨分支數據對比
    "活動日誌",        // 活動記錄
    "活動日誌詳情",    // 活動詳情
    "數據報表",        // 數據報表
    "匯出報表",        // 報表匯出
    "圖表生成"         // 圖表工具
  ]
}
```

**用途**：
- 數據分析和報表
- 進度監控
- 決策支持

**適合角色**：管理層、數據分析師

#### 9. 組織文檔 (Organization Documents)
```typescript
{
  "text": "Organization Documents",
  "children": [
    "文檔列表",        // 文檔管理
    "上傳文檔",        // 上傳文件
    "文檔瀏覽器",      // 文件瀏覽
    "文檔預覽",        // 預覽功能
    "圖紙查看器",      // CAD 圖紙查看
    "文檔元數據",      // 元數據管理
    "版本管理",        // 版本控制
    "權限設置"         // 權限管理
  ]
}
```

**用途**：
- 完整的文檔管理系統
- 版本控制
- 權限管理

### 🎨 使用場景

**場景 1：專案經理管理藍圖**
```
用戶：專案經理（組織管理員）
需求：創建藍圖、管理分支、審查 PR
使用：組織上下文 → 組織藍圖 → 創建藍圖 → 管理分支 → 審查 PR
```

**場景 2：查看組織進度**
```
用戶：管理層
需求：查看組織整體進度和數據分析
使用：組織上下文 → 組織分析 → 統計數據 → 進度追蹤
```

**場景 3：管理組織成員和團隊**
```
用戶：HR / 組織管理員
需求：添加成員、創建團隊、分配權限
使用：組織上下文 → 組織管理 → 組織成員 / 組織團隊
```

- --

## 👥 團隊上下文 (team-data.json)

### 🎯 用途與定位

**核心理念**：團隊協作與任務執行中心

- **適用場景**：團隊日常協作、任務執行
- **權限範圍**：團隊級別數據
- **特點**：聚焦於執行、功能集是組織的子集

### 📋 菜單結構

```json
{
  "menu": [
    {
      "text": "Team",
      "children": [
        "團隊管理",       // 團隊成員
        "團隊任務",       // 任務管理（簡化版）
        "團隊問題",       // 問題追蹤（簡化版）
        "團隊溝通",       // 溝通協作（簡化版）
        "團隊文檔"        // 文檔管理（簡化版）
      ]
    }
  ]
}
```

### ✨ 核心功能

#### 1. 團隊管理 (Team Management)
```typescript
{
  "text": "Team Management",
  "children": [
    "團隊成員"         // 團隊成員列表
  ]
}
```

**用途**：
- 查看團隊成員
- 團隊基本資訊

**與組織上下文的差異**：
- 沒有成員管理功能（需在組織上下文操作）
- 只能查看，不能添加或刪除成員

#### 2. 團隊任務 (Team Tasks)
```typescript
{
  "text": "Team Tasks",
  "children": [
    "任務看板",        // Kanban 視圖
    "任務日曆",        // 日曆視圖
    "任務列表",        // 列表視圖
    "任務樹狀圖",      // 樹狀結構視圖
    "待辦清單",        // 待辦事項
    "日報",            // 施工日報
    "施工照片",        // 現場照片
    "任務進度"         // 進度追蹤
  ]
}
```

**用途**：
- 團隊任務管理（聚焦於執行）
- 多視角任務查看
- 工地現場管理

**與組織上下文的差異**：
- 沒有「創建任務」、「任務詳情」、「任務表單」（需在組織上下文創建）
- 沒有「任務指派」（由組織或專案經理指派）
- 沒有「天氣記錄」（簡化功能）
- 聚焦於查看和執行

#### 3. 團隊問題 (Team Issues)
```typescript
{
  "text": "Team Issues",
  "children": [
    "問題列表",        // 問題列表（過濾團隊相關）
    "問題指派"         // 團隊問題分配
  ]
}
```

**用途**：
- 查看團隊相關問題
- 團隊內部問題分配

**與組織上下文的差異**：
- 沒有「創建問題」、「問題詳情」等管理功能
- 只能查看和指派

#### 4. 團隊溝通 (Team Communication)
```typescript
{
  "text": "Team Communication",
  "children": [
    "討論區",          // 團隊討論區
    "評論管理",        // 評論列表
    "團隊通知"         // 團隊通知
  ]
}
```

**用途**：
- 團隊內部溝通
- 團隊討論和協作

**與組織上下文的差異**：
- 沒有「發表評論」（簡化功能）
- 沒有「通知中心」、「通知規則」等複雜功能
- 聚焦於團隊內部溝通

#### 5. 團隊文檔 (Team Documents)
```typescript
{
  "text": "Team Documents",
  "children": [
    "文檔列表",        // 團隊文檔（過濾團隊可訪問）
    "上傳文檔"         // 上傳文件
  ]
}
```

**用途**：
- 團隊文檔快速訪問
- 上傳團隊相關文件

**與組織上下文的差異**：
- 沒有文檔瀏覽器、版本管理、權限設置等進階功能
- 簡化的文檔管理

### 🎨 使用場景

**場景 1：團隊每日任務檢視**
```
用戶：團隊成員（執行人員）
需求：查看今日任務、更新進度
使用：團隊上下文 → 團隊任務 → 任務看板 → 更新任務狀態
```

**場景 2：團隊內部討論**
```
用戶：團隊成員
需求：團隊內部討論問題、分享資訊
使用：團隊上下文 → 團隊溝通 → 討論區
```

**場景 3：團隊文檔訪問**
```
用戶：團隊成員
需求：快速訪問團隊相關文檔
使用：團隊上下文 → 團隊文檔 → 文檔列表
```

- --

## 📋 功能可用性矩陣

下表展示各功能在不同上下文中的可用性：

| 功能模組 | 個人上下文 | 組織上下文 | 團隊上下文 | 說明 |
|---------|-----------|-----------|-----------|------|
| **帳戶管理** | ✅ | ✅ | ❌ | 個人：自己的帳戶；組織：組織成員管理 |
| **組織/團隊管理** | ❌ | ✅ | ⚠️ | 組織：完整管理；團隊：僅查看成員 |
| **協作管理** | ❌ | ✅ | ❌ | 僅組織級別 |
| **藍圖系統** | ✅ | ✅ | ❌ | 個人：個人藍圖；組織：完整功能；團隊：使用組織藍圖 |
| **任務管理 - 創建** | ❌ | ✅ | ❌ | 僅組織可創建任務 |
| **任務管理 - 查看** | ✅ | ✅ | ✅ | 個人：聚合視圖；組織/團隊：多視角視圖 |
| **任務管理 - 執行** | ✅ | ✅ | ✅ | 所有上下文都可執行任務 |
| **品質管理** | ❌ | ✅ | ❌ | 僅組織級別 |
| **問題追蹤 - 創建** | ❌ | ✅ | ❌ | 僅組織可創建問題 |
| **問題追蹤 - 查看** | ❌ | ✅ | ✅ | 組織：完整功能；團隊：簡化視圖 |
| **溝通討論** | ✅ | ✅ | ✅ | 個人：通知中心；組織：完整功能；團隊：簡化功能 |
| **數據分析** | ❌ | ✅ | ❌ | 僅組織級別 |
| **文檔管理 - 進階** | ❌ | ✅ | ❌ | 版本控制、權限管理僅組織有 |
| **文檔管理 - 基本** | ✅ | ✅ | ✅ | 所有上下文都可上傳和查看文檔 |

### 圖例說明
- ✅ **完整功能**：該上下文提供完整的功能集
- ⚠️ **部分功能**：該上下文提供部分功能（通常是只讀或簡化版）
- ❌ **不可用**：該上下文不提供此功能

### 功能分級原則

| 級別 | 功能類型 | 適用上下文 |
|------|---------|-----------|
| **管理級** | 創建、刪除、配置、權限管理 | 組織 |
| **執行級** | 查看、更新、執行、協作 | 組織、團隊 |
| **個人級** | 個人數據、聚合視圖、偏好設置 | 個人 |

- --

## 🔄 上下文切換體驗

### UI/UX 最佳實踐

#### 1. **清晰的上下文指示器**

```typescript
// 推薦做法：在 Header 中顯示當前上下文
<div class="context-indicator">
  <nz-avatar [nzIcon]="contextIcon()" [nzSrc]="contextAvatar()" />
  <span class="context-label">{{ contextLabel() }}</span>
  <span class="context-type">{{ contextType() }}</span>
</div>
```

**關鍵點**：
- 使用圖標和文字雙重指示
- 顯示上下文類型（個人/組織/團隊）
- 顯示上下文名稱

#### 2. **平滑的切換動畫**

```typescript
// 使用 loading 狀態避免閃爍
@if (switching()) {
  <nz-spin nzSimple />
} @else {
  <!-- 內容 -->
}
```

**關鍵點**：
- 切換過程顯示 loading 指示器
- 避免突兀的內容切換
- 保持 UI 穩定性

#### 3. **上下文切換器 (Context Switcher)**

```html
<nz-dropdown [nzDropdownMenu]="contextMenu" nzPlacement="bottomRight">
  <button nz-button>
    <i nz-icon [nzType]="contextIcon()"></i>
    {{ contextLabel() }}
    <i nz-icon nzType="down"></i>
  </button>
</nz-dropdown>

<nz-dropdown-menu #contextMenu="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item (click)="switchToUser(userId)">
      <i nz-icon nzType="user"></i> 個人視角
    </li>
    <li nz-menu-divider></li>
    <li nz-submenu nzTitle="組織視角">
      @for (org of allOrganizations(); track org.id) {
        <ul>
          <li nz-menu-item (click)="switchToOrganization(org.id)">
            {{ org.name }}
          </li>
        </ul>
      }
    </li>
    <li nz-menu-divider></li>
    <li nz-submenu nzTitle="團隊視角">
      @for (team of userTeams(); track team.id) {
        <ul>
          <li nz-menu-item (click)="switchToTeam(team.id)">
            {{ team.name }}
          </li>
        </ul>
      }
    </li>
  </ul>
</nz-dropdown-menu>
```

**關鍵點**：
- 下拉選單方式，節省空間
- 分組顯示（個人/組織/團隊）
- 顯示所有可用上下文

#### 4. **狀態持久化**

```typescript
// 自動保存用戶的上下文選擇
persistenceService.saveContext(type, id);

// 下次登入自動恢復
restoreContext();
```

**關鍵點**：
- 記住用戶最後的上下文選擇
- 下次訪問自動恢復
- 使用 localStorage 或後端保存

### 導航模式

#### 模式 1：頂部導航 + 上下文切換器
```
┌─────────────────────────────────────┐
│ Logo  [上下文切換器]  通知  用戶     │
├─────────────────────────────────────┤
│                                     │
│            主要內容區                │
│                                     │
└─────────────────────────────────────┘
```

#### 模式 2：側邊欄 + 上下文區塊
```
┌────┬────────────────────────────────┐
│    │ 組織名稱                        │
│ L  ├────────────────────────────────┤
│ o  │                                │
│ g  │  - 組織管理                     │
│ o  │  - 組織藍圖                     │
│    │  - 組織任務                     │
│    │  - ...                         │
│    │                                │
│    │  [切換上下文]                   │
└────┴────────────────────────────────┘
```

### 關鍵體驗指標

| 指標 | 目標 | 說明 |
|------|------|------|
| **切換時間** | < 500ms | 上下文切換到顯示新菜單的時間 |
| **數據加載** | < 1s | 切換後數據加載完成時間 |
| **狀態恢復** | 100% | 用戶上次位置恢復成功率 |
| **錯誤率** | < 0.1% | 切換失敗率 |

- --

## 📐 功能規劃指南

### 決策樹：功能應該放在哪個上下文？

```
開始：我要添加一個新功能
  │
  ├─ 這是管理功能嗎？(創建、刪除、配置、權限)
  │   └─ 是 → 📍 放在【組織上下文】
  │
  ├─ 這是數據分析功能嗎？
  │   └─ 是 → 📍 放在【組織上下文】
  │
  ├─ 這是個人數據或偏好嗎？
  │   └─ 是 → 📍 放在【個人上下文】
  │
  ├─ 這是團隊協作執行功能嗎？
  │   └─ 是 → 📍 放在【團隊上下文】和【組織上下文】
  │
  └─ 這是查看或執行功能嗎？
      └─ 是 → 📍 放在【所有上下文】（根據權限過濾數據）
```

### 功能分類原則

#### 原則 1：管理權限 → 組織上下文
```
例如：
✅ 創建藍圖 → 組織上下文
✅ 管理團隊 → 組織上下文
✅ 品質檢查配置 → 組織上下文
✅ 權限設置 → 組織上下文
```

#### 原則 2：個人數據 → 個人上下文
```
例如：
✅ 我的待辦清單 → 個人上下文
✅ 我的偏好設置 → 個人上下文
✅ 我的通知 → 個人上下文
```

#### 原則 3：團隊協作 → 團隊 + 組織
```
例如：
✅ 任務執行 → 團隊上下文 + 組織上下文
✅ 團隊討論 → 團隊上下文 + 組織上下文
✅ 文檔訪問 → 團隊上下文 + 組織上下文
```

#### 原則 4：數據分析 → 組織上下文
```
例如：
✅ 進度報表 → 組織上下文
✅ 統計分析 → 組織上下文
✅ 數據匯出 → 組織上下文
```

### 功能添加檢查清單

添加新功能前，請檢查：

- [ ] **確定功能類型**：管理/執行/分析/個人？
- [ ] **確定適用上下文**：個人/組織/團隊？
- [ ] **檢查權限需求**：需要什麼權限？
- [ ] **考慮數據範圍**：數據如何過濾？
- [ ] **評估用戶體驗**：功能放在這裡合理嗎？
- [ ] **檢查一致性**：與其他功能的放置是否一致？
- [ ] **更新菜單數據**：修改對應的 .json 文件
- [ ] **更新文檔**：更新本指南的功能矩陣表

### 反模式 (Anti-patterns)

❌ **不要做的事情**：

1. **在團隊上下文添加管理功能**
   ```
   ❌ 錯誤：團隊上下文中添加「創建組織」功能
   ✅ 正確：管理功能應在組織上下文
   ```

2. **在個人上下文添加組織管理**
   ```
   ❌ 錯誤：個人上下文中添加「管理組織成員」
   ✅ 正確：組織管理應在組織上下文
   ```

3. **功能重複定義**
   ```
   ❌ 錯誤：同一功能在多個上下文中實現不一致
   ✅ 正確：共享功能應使用相同的組件和服務
   ```

4. **上下文混淆**
   ```
   ❌ 錯誤：在團隊上下文顯示所有組織數據
   ✅ 正確：數據應根據上下文正確過濾
   ```

- --

## 💡 最佳實踐

### DO's ✅

1. **清晰的上下文指示**
   - 始終顯示當前上下文
   - 使用圖標和顏色區分不同上下文
   - 提供快速切換方式

2. **一致的功能放置**
   - 遵循功能分類原則
   - 相似功能在相似位置
   - 參考現有功能的放置

3. **數據範圍控制**
   - 根據上下文過濾數據
   - 尊重權限限制
   - 提供清晰的數據範圍提示

4. **狀態持久化**
   - 保存用戶的上下文選擇
   - 記住用戶在各上下文的位置
   - 提供「回到上次位置」功能

5. **性能優化**
   - 延遲加載非關鍵數據
   - 緩存經常訪問的數據
   - 使用虛擬滾動處理大列表

### DON'Ts ❌

1. **不要混淆上下文**
   - 不要在團隊上下文顯示不相關的組織數據
   - 不要在個人上下文顯示組織管理功能

2. **不要忽視權限**
   - 不要顯示用戶無權訪問的功能
   - 不要在前端顯示敏感數據（依賴後端過濾）

3. **不要過度簡化團隊上下文**
   - 團隊成員需要足夠的功能來完成工作
   - 不要因為「簡化」而移除必要功能

4. **不要忽視切換成本**
   - 上下文切換應該快速流暢
   - 不要讓用戶頻繁切換上下文才能完成任務

5. **不要忘記更新文檔**
   - 添加新功能後更新本指南
   - 更新功能矩陣表
   - 更新菜單數據文件註釋

### 常見陷阱

#### 陷阱 1：功能放置不當
```
問題：把「創建任務」放在團隊上下文
影響：權限混亂、數據範圍不清
解決：管理功能應在組織上下文
```

#### 陷阱 2：數據過濾錯誤
```
問題：團隊上下文顯示整個組織的任務
影響：數據量大、用戶困惑
解決：根據上下文正確過濾數據
```

#### 陷阱 3：上下文指示不清
```
問題：用戶不知道自己在哪個上下文
影響：操作錯誤、數據混亂
解決：始終顯示清晰的上下文指示器
```

#### 陷阱 4：切換後狀態丟失
```
問題：切換上下文後，之前的位置丟失
影響：用戶體驗差
解決：實現狀態持久化
```

- --

## 🎨 使用場景範例

### 場景 1：新員工入職

**用戶角色**：新員工
**初始狀態**：首次登入系統

**操作流程**：
1. **登入後** → 自動進入【個人上下文】
2. **查看個人資料** → 個人上下文 → 帳戶系統 → 我的個人資料
3. **查看加入的組織** → 個人上下文 → 帳戶系統 → 我的組織
4. **切換到組織** → 上下文切換器 → 選擇組織
5. **查看組織架構** → 組織上下文 → 組織管理 → 組織團隊
6. **查看指派任務** → 切換回個人上下文 → 我的任務 → 我的指派任務

### 場景 2：專案經理日常工作

**用戶角色**：專案經理
**工作內容**：管理藍圖、審查 PR、監控進度

**典型一天**：

**上午：檢查進度**
1. 登入 → 【組織上下文】（已保存的上下文）
2. 組織分析 → 進度追蹤 → 查看昨日進度
3. 組織分析 → 主分支報表 → 查看主分支狀態
4. 組織分析 → 跨分支總覽 → 對比各分支進度

**中午：處理 PR**
1. 組織藍圖 → Pull Request → 查看待審查 PR 列表
2. PR 詳情 → 查看提交內容
3. PR 審查 → 審查並批准/拒絕

**下午：任務管理**
1. 組織任務 → 任務看板 → 檢查任務狀態
2. 組織任務 → 創建任務 → 創建新任務
3. 組織任務 → 任務指派 → 分配任務給團隊

**傍晚：問題追蹤**
1. 組織問題 → 問題列表 → 查看今日問題
2. 問題詳情 → 查看問題詳情
3. 問題指派 → 分配問題給相關人員

### 場景 3：團隊成員執行任務

**用戶角色**：團隊成員（施工人員）
**工作內容**：執行任務、上傳照片、更新進度

**典型流程**：

**早晨：查看今日任務**
1. 登入 → 【團隊上下文】（已保存的上下文）
2. 團隊任務 → 任務看板 → 查看「待處理」欄位的任務
3. 團隊任務 → 任務日曆 → 查看今日計劃

**工作中：更新進度**
1. 團隊任務 → 任務看板 → 拖動任務到「進行中」
2. 團隊任務 → 施工照片 → 上傳現場照片
3. 團隊任務 → 日報 → 填寫施工日報

**下午：回報問題**
1. 發現問題 → 團隊溝通 → 討論區 → 發布問題討論
2. 等待專案經理在組織上下文創建正式問題

**傍晚：完成任務**
1. 團隊任務 → 任務看板 → 拖動任務到「已完成」
2. 團隊任務 → 任務進度 → 更新任務進度百分比

### 場景 4：跨上下文工作流

**用戶角色**：資深開發者
**工作內容**：跨多個組織和團隊工作

**複雜工作流**：

**查看所有任務（個人上下文）**
```
個人上下文 → 我的任務 → 我的指派任務
（顯示來自所有組織和團隊的任務聚合視圖）
```

**在組織 A 創建藍圖（組織上下文）**
```
切換到組織 A → 組織藍圖 → 創建藍圖
```

**在團隊 B 執行任務（團隊上下文）**
```
切換到團隊 B → 團隊任務 → 任務看板 → 更新任務
```

**在組織 C 查看分析（組織上下文）**
```
切換到組織 C → 組織分析 → 統計數據
```

**回到個人上下文查看通知（個人上下文）**
```
切換到個人 → 我的溝通 → 我的通知
（查看來自所有上下文的通知）
```

### 場景 5：組織管理員管理多個團隊

**用戶角色**：組織管理員
**工作內容**：管理組織、創建團隊、分配權限

**管理流程**：

**創建新團隊**
```
組織上下文 → 組織管理 → 組織團隊 → 創建團隊
```

**添加團隊成員**
```
組織上下文 → 組織管理 → 組織團隊 → 選擇團隊 → 添加成員
```

**為團隊創建藍圖分支**
```
組織上下文 → 組織藍圖 → 選擇藍圖 → 分支管理 → 創建分支 → 分配給團隊
```

**監控團隊進度**
```
切換到團隊上下文 → 團隊任務 → 任務看板
（以團隊成員視角查看）
```

**回到組織上下文查看整體進度**
```
切換回組織上下文 → 組織分析 → 跨分支總覽
（查看所有團隊的進度對比）
```

- --

## 📊 總結與建議

### 核心設計理念

1. **分層設計**：個人 → 組織 → 團隊
   - 個人：個人生產力
   - 組織：管理中心
   - 團隊：執行中心

2. **功能分級**：管理 → 執行 → 個人
   - 管理功能在組織上下文
   - 執行功能在組織和團隊上下文
   - 個人功能在個人上下文

3. **權限控制**：基於上下文的權限管理
   - 不同上下文有不同的權限範圍
   - 前端顯示 + 後端驗證雙重保障

### 用戶體驗原則

1. **清晰性**：用戶始終知道自己在哪個上下文
2. **一致性**：相似功能在相似位置
3. **效率性**：減少不必要的上下文切換
4. **容錯性**：切換失敗時提供友好提示
5. **持久性**：記住用戶的選擇和位置

### 開發建議

1. **遵循分類原則**：參考決策樹決定功能放置
2. **保持一致性**：新功能應與現有功能保持一致
3. **更新文檔**：添加新功能後及時更新文檔
4. **測試切換流程**：確保上下文切換流暢
5. **監控性能**：關注切換時間和數據加載時間

### 未來擴展方向

1. **更多上下文類型**
   - 可能添加「專案上下文」
   - 可能添加「客戶上下文」

2. **更智能的切換**
   - 根據用戶行為推薦上下文
   - 自動切換到相關上下文

3. **更豐富的功能**
   - 在保持原則的前提下添加新功能
   - 持續優化用戶體驗

- --

## 📚 相關資源

- [工作區上下文系統架構審查](./工作區上下文系統架構審查.md) - 技術實現詳解
- [工作區系統快速參考指南](./工作區系統-快速參考指南.md) - 開發者快速參考
- [工作區上下文切換流程圖](./工作區上下文切換流程圖.mermaid.md) - 視覺化流程圖
- [完整架構流程圖](./architecture/20-complete-architecture-flowchart.mermaid.md) - 系統完整架構
- [資料表清單總覽](./30-資料表清單總覽.md) - 資料庫結構
- [開發作業指引](./specs/00-development-guidelines.md) - 開發規範

- --

**文檔維護者**：開發團隊
**反饋與建議**：請通過 Issue 或 PR 提出改進建議
