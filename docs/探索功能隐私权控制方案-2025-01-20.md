# æ¢ç´¢åŠŸèƒ½éšç§æƒæ§åˆ¶æ–¹æ¡ˆ

> **æ—¥æœŸ**ï¼š2025-01-20  
> **ç›®çš„**ï¼šè®¾è®¡ç°ä»£åŒ–çš„éšç§æƒæ§åˆ¶æ–¹æ¡ˆï¼Œæ”¯æŒç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾çš„æœç´¢å’Œéšç§ä¿æŠ¤  
> **çŠ¶æ€**ï¼šğŸ“‹ è®¾è®¡æ–¹æ¡ˆ

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **å¯æœç´¢æ€§**ï¼šç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾éƒ½åº”è¯¥èƒ½è¢«æœç´¢åˆ°
2. **éšç§ä¿æŠ¤**ï¼šä¸åŒå®ä½“å¯ä»¥è®¾ç½®ä¸åŒçš„éšç§çº§åˆ«
3. **ç»†ç²’åº¦æ§åˆ¶**ï¼šæ”¯æŒå­—æ®µçº§åˆ«çš„éšç§æ§åˆ¶
4. **å…³ç³»æ„ŸçŸ¥**ï¼šåŸºäºç”¨æˆ·å…³ç³»ï¼ˆå¥½å‹ã€ç»„ç»‡æˆå‘˜ã€åä½œå…³ç³»ï¼‰çš„æƒé™æ§åˆ¶
5. **ç°ä»£åŒ–è®¾è®¡**ï¼šç¬¦åˆä¸šç•Œæœ€ä½³å®è·µï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ–¹æ¡ˆé€‰æ‹©ï¼šåŸºäºå¯è§æ€§çº§åˆ«çš„éšç§æ§åˆ¶

å‚è€ƒä¸šç•Œæœ€ä½³å®è·µï¼ˆGitHubã€LinkedInã€Twitter ç­‰ï¼‰ï¼Œé‡‡ç”¨**å¯è§æ€§çº§åˆ« + å…³ç³»æ„ŸçŸ¥**çš„æ··åˆæ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯è§æ€§çº§åˆ« (Visibility Level)          â”‚
â”‚  - Public: æ‰€æœ‰äººå¯è§                   â”‚
â”‚  - Organization: ç»„ç»‡æˆå‘˜å¯è§           â”‚
â”‚  - Friends: å¥½å‹å¯è§                    â”‚
â”‚  - Private: ä»…è‡ªå·±å¯è§                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…³ç³»æ„ŸçŸ¥æƒé™ (Relationship-based)      â”‚
â”‚  - å¥½å‹å…³ç³»                             â”‚
â”‚  - ç»„ç»‡æˆå‘˜å…³ç³»                         â”‚
â”‚  - åä½œå…³ç³»                             â”‚
â”‚  - æ‹¥æœ‰è€…å…³ç³»                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­—æ®µçº§åˆ«æ§åˆ¶ (Field-level)             â”‚
â”‚  - åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€å¤´åƒï¼‰               â”‚
â”‚  - è”ç³»ä¿¡æ¯ï¼ˆé‚®ç®±ã€ç”µè¯ï¼‰               â”‚
â”‚  - è¯¦ç»†ä¿¡æ¯ï¼ˆæè¿°ã€å…ƒæ•°æ®ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### 1. å¯è§æ€§çº§åˆ«æšä¸¾

```typescript
/**
 * å¯è§æ€§çº§åˆ«æšä¸¾
 * ç”¨äºæ§åˆ¶å®ä½“åœ¨æ¢ç´¢åŠŸèƒ½ä¸­çš„å¯è§æ€§
 */
export enum VisibilityLevel {
  /** å…¬å¼€ï¼šæ‰€æœ‰äººå¯è§ï¼ˆåŒ…æ‹¬æœªç™»å½•ç”¨æˆ·ï¼‰ */
  PUBLIC = 'public',
  
  /** å·²è®¤è¯ç”¨æˆ·ï¼šæ‰€æœ‰å·²ç™»å½•ç”¨æˆ·å¯è§ */
  AUTHENTICATED = 'authenticated',
  
  /** ç»„ç»‡æˆå‘˜ï¼šåŒä¸€ç»„ç»‡çš„æˆå‘˜å¯è§ */
  ORGANIZATION = 'organization',
  
  /** å¥½å‹ï¼šå·²å»ºç«‹å¥½å‹å…³ç³»çš„ç”¨æˆ·å¯è§ */
  FRIENDS = 'friends',
  
  /** ç§æœ‰ï¼šä»…è‡ªå·±å¯è§ */
  PRIVATE = 'private'
}
```

### 2. æ•°æ®åº“å­—æ®µè®¾è®¡

#### accounts è¡¨æ·»åŠ å­—æ®µ

```sql
-- æ·»åŠ éšç§æ§åˆ¶å­—æ®µ
ALTER TABLE accounts ADD COLUMN IF NOT EXISTS 
  -- æœç´¢å¯è§æ€§ï¼ˆæ§åˆ¶æ˜¯å¦èƒ½åœ¨æ¢ç´¢åŠŸèƒ½ä¸­è¢«æœç´¢åˆ°ï¼‰
  search_visibility VARCHAR(20) DEFAULT 'authenticated' 
    CHECK (search_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private')),
  
  -- åŸºæœ¬ä¿¡æ¯å¯è§æ€§ï¼ˆåç§°ã€å¤´åƒç­‰ï¼‰
  profile_visibility VARCHAR(20) DEFAULT 'authenticated'
    CHECK (profile_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private')),
  
  -- è”ç³»ä¿¡æ¯å¯è§æ€§ï¼ˆé‚®ç®±ã€ç”µè¯ç­‰ï¼‰
  contact_visibility VARCHAR(20) DEFAULT 'friends'
    CHECK (contact_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private')),
  
  -- è¯¦ç»†ä¿¡æ¯å¯è§æ€§ï¼ˆæè¿°ã€å…ƒæ•°æ®ç­‰ï¼‰
  detail_visibility VARCHAR(20) DEFAULT 'friends'
    CHECK (detail_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private'));

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_accounts_search_visibility 
  ON accounts(search_visibility) 
  WHERE search_visibility != 'private';
```

#### blueprints è¡¨æ·»åŠ å­—æ®µ

```sql
-- æ·»åŠ éšç§æ§åˆ¶å­—æ®µ
ALTER TABLE blueprints ADD COLUMN IF NOT EXISTS 
  -- æœç´¢å¯è§æ€§ï¼ˆæ§åˆ¶æ˜¯å¦èƒ½åœ¨æ¢ç´¢åŠŸèƒ½ä¸­è¢«æœç´¢åˆ°ï¼‰
  search_visibility VARCHAR(20) DEFAULT 'authenticated'
    CHECK (search_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private')),
  
  -- åŸºæœ¬ä¿¡æ¯å¯è§æ€§ï¼ˆåç§°ã€æè¿°ç­‰ï¼‰
  profile_visibility VARCHAR(20) DEFAULT 'authenticated'
    CHECK (profile_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private')),
  
  -- è¯¦ç»†ä¿¡æ¯å¯è§æ€§ï¼ˆé¡¹ç›®ä»£ç ã€å…ƒæ•°æ®ç­‰ï¼‰
  detail_visibility VARCHAR(20) DEFAULT 'organization'
    CHECK (detail_visibility IN ('public', 'authenticated', 'organization', 'friends', 'private'));

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_blueprints_search_visibility 
  ON blueprints(search_visibility) 
  WHERE search_visibility != 'private';
```

### 3. å¥½å‹å…³ç³»è¡¨ï¼ˆå¦‚æœéœ€è¦ï¼‰

```sql
-- å¥½å‹å…³ç³»è¡¨ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦å¥½å‹åŠŸèƒ½ï¼‰
CREATE TABLE IF NOT EXISTS friendships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  requester_id UUID NOT NULL REFERENCES accounts(id) ON DELETE CASCADE,
  addressee_id UUID NOT NULL REFERENCES accounts(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending' 
    CHECK (status IN ('pending', 'accepted', 'rejected', 'blocked')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(requester_id, addressee_id),
  CHECK (requester_id != addressee_id)
);

CREATE INDEX idx_friendships_requester ON friendships(requester_id, status);
CREATE INDEX idx_friendships_addressee ON friendships(addressee_id, status);
```

---

## ğŸ”’ æƒé™åˆ¤æ–­é€»è¾‘

### 1. å¯è§æ€§åˆ¤æ–­å‡½æ•°

```sql
-- åˆ›å»ºå¯è§æ€§åˆ¤æ–­å‡½æ•°
CREATE OR REPLACE FUNCTION private.can_view_account(
  target_account_id UUID,
  viewer_auth_user_id UUID,
  visibility_level VARCHAR(20)
)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = ''
AS $$
DECLARE
  target_account RECORD;
  viewer_account_id UUID;
  is_owner BOOLEAN;
  is_friend BOOLEAN;
  is_org_member BOOLEAN;
BEGIN
  -- è·å–ç›®æ ‡è´¦æˆ·ä¿¡æ¯
  SELECT * INTO target_account
  FROM public.accounts
  WHERE id = target_account_id;
  
  IF NOT FOUND THEN
    RETURN FALSE;
  END IF;
  
  -- è·å–æŸ¥çœ‹è€…è´¦æˆ· ID
  SELECT id INTO viewer_account_id
  FROM public.accounts
  WHERE auth_user_id = viewer_auth_user_id;
  
  -- å¦‚æœæ˜¯è‡ªå·±ï¼Œæ€»æ˜¯å¯è§
  IF viewer_account_id = target_account_id THEN
    RETURN TRUE;
  END IF;
  
  -- æ ¹æ®å¯è§æ€§çº§åˆ«åˆ¤æ–­
  CASE visibility_level
    WHEN 'public' THEN
      RETURN TRUE;
      
    WHEN 'authenticated' THEN
      RETURN viewer_auth_user_id IS NOT NULL;
      
    WHEN 'organization' THEN
      -- æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ç»„ç»‡çš„æˆå‘˜
      IF target_account.type = 'Organization' THEN
        -- æ£€æŸ¥æŸ¥çœ‹è€…æ˜¯å¦æ˜¯ç»„ç»‡æˆå‘˜
        RETURN EXISTS (
          SELECT 1
          FROM public.team_members tm
          JOIN public.teams t ON tm.team_id = t.id
          WHERE t.organization_id = target_account_id
            AND tm.account_id = viewer_account_id
        );
      ELSE
        -- ç”¨æˆ·è´¦æˆ·ï¼šæ£€æŸ¥æ˜¯å¦åœ¨åŒä¸€ç»„ç»‡ä¸­
        RETURN EXISTS (
          SELECT 1
          FROM public.team_members tm1
          JOIN public.team_members tm2 ON tm1.team_id = tm2.team_id
          JOIN public.teams t ON tm1.team_id = t.id
          WHERE tm1.account_id = target_account_id
            AND tm2.account_id = viewer_account_id
        );
      END IF;
      
    WHEN 'friends' THEN
      -- æ£€æŸ¥æ˜¯å¦æ˜¯å¥½å‹ï¼ˆå¦‚æœå®ç°äº†å¥½å‹åŠŸèƒ½ï¼‰
      RETURN EXISTS (
        SELECT 1
        FROM public.friendships
        WHERE status = 'accepted'
          AND (
            (requester_id = target_account_id AND addressee_id = viewer_account_id)
            OR (requester_id = viewer_account_id AND addressee_id = target_account_id)
          )
      );
      
    WHEN 'private' THEN
      RETURN FALSE;
      
    ELSE
      RETURN FALSE;
  END CASE;
END;
$$;
```

### 2. è“å›¾å¯è§æ€§åˆ¤æ–­å‡½æ•°

```sql
-- åˆ›å»ºè“å›¾å¯è§æ€§åˆ¤æ–­å‡½æ•°
CREATE OR REPLACE FUNCTION private.can_view_blueprint(
  target_blueprint_id UUID,
  viewer_auth_user_id UUID,
  visibility_level VARCHAR(20)
)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = ''
AS $$
DECLARE
  target_blueprint RECORD;
  viewer_account_id UUID;
  is_owner BOOLEAN;
  is_collaborator BOOLEAN;
BEGIN
  -- è·å–ç›®æ ‡è“å›¾ä¿¡æ¯
  SELECT * INTO target_blueprint
  FROM public.blueprints
  WHERE id = target_blueprint_id;
  
  IF NOT FOUND THEN
    RETURN FALSE;
  END IF;
  
  -- è·å–æŸ¥çœ‹è€…è´¦æˆ· ID
  SELECT id INTO viewer_account_id
  FROM public.accounts
  WHERE auth_user_id = viewer_auth_user_id;
  
  -- æ£€æŸ¥æ˜¯å¦æ˜¯æ‹¥æœ‰è€…
  is_owner := (target_blueprint.owner_id = viewer_account_id);
  IF is_owner THEN
    RETURN TRUE;
  END IF;
  
  -- æ£€æŸ¥æ˜¯å¦æ˜¯åä½œè€…
  is_collaborator := EXISTS (
    SELECT 1
    FROM public.organization_collaborations oc
    JOIN public.collaboration_members cm ON oc.id = cm.collaboration_id
    WHERE oc.blueprint_id = target_blueprint_id
      AND cm.account_id = viewer_account_id
      AND oc.status = 'active'
  );
  
  -- æ ¹æ®å¯è§æ€§çº§åˆ«åˆ¤æ–­
  CASE visibility_level
    WHEN 'public' THEN
      RETURN TRUE;
      
    WHEN 'authenticated' THEN
      RETURN viewer_auth_user_id IS NOT NULL;
      
    WHEN 'organization' THEN
      -- æ£€æŸ¥æ˜¯å¦æ˜¯åä½œç»„ç»‡çš„æˆå‘˜
      RETURN is_collaborator OR EXISTS (
        SELECT 1
        FROM public.team_members tm
        JOIN public.teams t ON tm.team_id = t.id
        WHERE t.organization_id = target_blueprint.owner_id
          AND tm.account_id = viewer_account_id
      );
      
    WHEN 'friends' THEN
      -- æ£€æŸ¥æ˜¯å¦æ˜¯å¥½å‹ï¼ˆå¦‚æœå®ç°äº†å¥½å‹åŠŸèƒ½ï¼‰
      RETURN EXISTS (
        SELECT 1
        FROM public.friendships
        WHERE status = 'accepted'
          AND (
            (requester_id = target_blueprint.owner_id AND addressee_id = viewer_account_id)
            OR (requester_id = viewer_account_id AND addressee_id = target_blueprint.owner_id)
          )
      );
      
    WHEN 'private' THEN
      RETURN is_owner OR is_collaborator;
      
    ELSE
      RETURN FALSE;
  END CASE;
END;
$$;
```

---

## ğŸ” æœç´¢å‡½æ•°æ›´æ–°

### æ›´æ–°æœç´¢è´¦æˆ·å‡½æ•°

```sql
-- æ›´æ–°æœç´¢è´¦æˆ·å‡½æ•°ï¼Œæ·»åŠ éšç§æ§åˆ¶
CREATE OR REPLACE FUNCTION public.search_accounts_for_explore(
  p_query TEXT,
  p_type TEXT DEFAULT NULL,
  p_page INTEGER DEFAULT 1,
  p_page_size INTEGER DEFAULT 20,
  p_order_by TEXT DEFAULT 'name',
  p_order_direction TEXT DEFAULT 'asc',
  p_viewer_auth_user_id UUID DEFAULT NULL  -- æ–°å¢ï¼šæŸ¥çœ‹è€… ID
)
RETURNS TABLE (...)
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = ''
AS $$
DECLARE
  v_offset INTEGER;
  v_limit INTEGER;
BEGIN
  v_offset := (p_page - 1) * p_page_size;
  v_limit := p_page_size;

  RETURN QUERY
  SELECT 
    a.id,
    a.name,
    -- æ ¹æ® contact_visibility å†³å®šæ˜¯å¦è¿”å›é‚®ç®±
    CASE 
      WHEN private.can_view_account(a.id, p_viewer_auth_user_id, a.contact_visibility)
      THEN a.email
      ELSE NULL
    END as email,
    a.type,
    a.status,
    a.auth_user_id,
    a.auth_organization_id,
    a.auth_bot_id,
    -- æ ¹æ® profile_visibility å†³å®šæ˜¯å¦è¿”å›å¤´åƒ
    CASE 
      WHEN private.can_view_account(a.id, p_viewer_auth_user_id, a.profile_visibility)
      THEN a.avatar_url::TEXT
      ELSE NULL
    END as avatar_url,
    -- æ ¹æ® detail_visibility å†³å®šæ˜¯å¦è¿”å›å…ƒæ•°æ®
    CASE 
      WHEN private.can_view_account(a.id, p_viewer_auth_user_id, a.detail_visibility)
      THEN a.metadata
      ELSE '{}'::JSONB
    END as metadata,
    a.created_at,
    a.updated_at
  FROM public.accounts a
  WHERE 
    a.status = 'active'
    AND (p_type IS NULL OR a.type = p_type)
    -- æœç´¢ç”¨æˆ·æ—¶ï¼Œé™åˆ¶ auth_user_id IS NOT NULL
    AND (
      p_type IS NULL 
      OR p_type != 'User' 
      OR a.auth_user_id IS NOT NULL
    )
    -- éšç§æ§åˆ¶ï¼šåªè¿”å›å¯è§çš„è´¦æˆ·
    AND (
      a.search_visibility = 'public'
      OR (
        a.search_visibility = 'authenticated' 
        AND p_viewer_auth_user_id IS NOT NULL
      )
      OR private.can_view_account(a.id, p_viewer_auth_user_id, a.search_visibility)
    )
    -- æœç´¢æ¡ä»¶
    AND (
      p_query IS NULL 
      OR p_query = ''
      OR a.name ILIKE '%' || p_query || '%'
      OR (
        private.can_view_account(a.id, p_viewer_auth_user_id, a.contact_visibility)
        AND a.email ILIKE '%' || p_query || '%'
      )
    )
  ORDER BY 
    CASE 
      WHEN p_order_by = 'name' AND p_order_direction = 'asc' THEN a.name
      WHEN p_order_by = 'name' AND p_order_direction = 'desc' THEN a.name
      WHEN p_order_by = 'created_at' AND p_order_direction = 'asc' THEN a.created_at::TEXT
      WHEN p_order_by = 'created_at' AND p_order_direction = 'desc' THEN a.created_at::TEXT
      ELSE a.name
    END
  LIMIT v_limit
  OFFSET v_offset;
END;
$$;
```

---

## ğŸ¨ å‰ç«¯å®ç°

### 1. éšç§è®¾ç½®ç»„ä»¶

```typescript
// éšç§è®¾ç½®ç»„ä»¶
@Component({
  selector: 'app-privacy-settings',
  template: `
    <nz-card nzTitle="éšç§è®¾ç½®">
      <nz-form [formGroup]="privacyForm">
        <!-- æœç´¢å¯è§æ€§ -->
        <nz-form-item>
          <nz-form-label>æœç´¢å¯è§æ€§</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="searchVisibility">
              <nz-option [nzValue]="VisibilityLevel.PUBLIC" 
                         nzLabel="å…¬å¼€ - æ‰€æœ‰äººå¯ä»¥æœç´¢åˆ°æˆ‘"></nz-option>
              <nz-option [nzValue]="VisibilityLevel.AUTHENTICATED" 
                         nzLabel="å·²è®¤è¯ç”¨æˆ· - å·²ç™»å½•ç”¨æˆ·å¯ä»¥æœç´¢åˆ°æˆ‘"></nz-option>
              <nz-option [nzValue]="VisibilityLevel.ORGANIZATION" 
                         nzLabel="ç»„ç»‡æˆå‘˜ - åŒä¸€ç»„ç»‡çš„æˆå‘˜å¯ä»¥æœç´¢åˆ°æˆ‘"></nz-option>
              <nz-option [nzValue]="VisibilityLevel.FRIENDS" 
                         nzLabel="å¥½å‹ - åªæœ‰å¥½å‹å¯ä»¥æœç´¢åˆ°æˆ‘"></nz-option>
              <nz-option [nzValue]="VisibilityLevel.PRIVATE" 
                         nzLabel="ç§æœ‰ - æ— æ³•è¢«æœç´¢åˆ°"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        
        <!-- å…¶ä»–å¯è§æ€§è®¾ç½®... -->
      </nz-form>
    </nz-card>
  `
})
export class PrivacySettingsComponent {
  readonly VisibilityLevel = VisibilityLevel;
  privacyForm = this.fb.group({
    searchVisibility: [VisibilityLevel.AUTHENTICATED],
    profileVisibility: [VisibilityLevel.AUTHENTICATED],
    contactVisibility: [VisibilityLevel.FRIENDS],
    detailVisibility: [VisibilityLevel.FRIENDS]
  });
}
```

### 2. æœç´¢ç»“æœå±•ç¤º

```typescript
// æœç´¢ç»“æœç»„ä»¶ä¸­ï¼Œæ ¹æ®å¯è§æ€§æ˜¾ç¤º/éšè—å­—æ®µ
@if (canViewContact(account)) {
  <div class="email">{{ account.email }}</div>
} @else {
  <div class="email-placeholder">è”ç³»ä¿¡æ¯ä¸å¯è§</div>
}
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šåŸºç¡€å­—æ®µæ·»åŠ ï¼ˆ1-2 å¤©ï¼‰

1. âœ… æ·»åŠ  `search_visibility` å­—æ®µåˆ° `accounts` è¡¨
2. âœ… æ·»åŠ  `search_visibility` å­—æ®µåˆ° `blueprints` è¡¨
3. âœ… åˆ›å»ºå¯è§æ€§çº§åˆ«æšä¸¾ç±»å‹
4. âœ… è®¾ç½®é»˜è®¤å€¼ï¼ˆ`authenticated`ï¼‰

### é˜¶æ®µ 2ï¼šæƒé™åˆ¤æ–­å‡½æ•°ï¼ˆ2-3 å¤©ï¼‰

1. âœ… åˆ›å»º `can_view_account` å‡½æ•°
2. âœ… åˆ›å»º `can_view_blueprint` å‡½æ•°
3. âœ… æµ‹è¯•æƒé™åˆ¤æ–­é€»è¾‘

### é˜¶æ®µ 3ï¼šæœç´¢å‡½æ•°æ›´æ–°ï¼ˆ1-2 å¤©ï¼‰

1. âœ… æ›´æ–° `search_accounts_for_explore` å‡½æ•°
2. âœ… æ›´æ–° `search_blueprints_for_explore` å‡½æ•°ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. âœ… æ›´æ–° Repository è°ƒç”¨ï¼Œä¼ é€’ `viewer_auth_user_id`

### é˜¶æ®µ 4ï¼šå‰ç«¯å®ç°ï¼ˆ2-3 å¤©ï¼‰

1. âœ… åˆ›å»ºéšç§è®¾ç½®ç»„ä»¶
2. âœ… æ›´æ–°æœç´¢ç»“æœå±•ç¤ºç»„ä»¶
3. âœ… æ·»åŠ éšç§è®¾ç½®é¡µé¢

### é˜¶æ®µ 5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1-2 å¤©ï¼‰

1. âœ… å•å…ƒæµ‹è¯•
2. âœ… é›†æˆæµ‹è¯•
3. âœ… æ€§èƒ½ä¼˜åŒ–

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. é»˜è®¤éšç§çº§åˆ«

- **ç”¨æˆ·è´¦æˆ·**ï¼š`search_visibility = 'authenticated'`ï¼ˆé»˜è®¤å·²ç™»å½•ç”¨æˆ·å¯è§ï¼‰
- **ç»„ç»‡è´¦æˆ·**ï¼š`search_visibility = 'authenticated'`ï¼ˆé»˜è®¤å·²ç™»å½•ç”¨æˆ·å¯è§ï¼‰
- **è“å›¾**ï¼š`search_visibility = 'organization'`ï¼ˆé»˜è®¤ç»„ç»‡æˆå‘˜å¯è§ï¼‰

### 2. éšç§å‡çº§è·¯å¾„

- æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œé»˜è®¤ä½¿ç”¨è¾ƒä¸¥æ ¼çš„éšç§è®¾ç½®
- ç”¨æˆ·å¯ä»¥åœ¨è®¾ç½®ä¸­è°ƒæ•´éšç§çº§åˆ«
- æä¾›éšç§è®¾ç½®å‘å¯¼ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å„é€‰é¡¹

### 3. æ•°æ®è„±æ•

- ä¸å¯è§çš„å­—æ®µè¿”å› `NULL` æˆ–ç©ºå€¼
- å‰ç«¯ä¸æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯
- æ—¥å¿—ä¸­ä¸è®°å½•æ•æ„Ÿæ•°æ®

---

## ğŸ¯ ç°ä»£åŒ–ç‰¹æ€§

### 1. ç»†ç²’åº¦æ§åˆ¶

- âœ… å­—æ®µçº§åˆ«çš„éšç§æ§åˆ¶
- âœ… ä¸åŒå­—æ®µå¯ä»¥è®¾ç½®ä¸åŒçš„å¯è§æ€§çº§åˆ«

### 2. å…³ç³»æ„ŸçŸ¥

- âœ… åŸºäºç”¨æˆ·å…³ç³»çš„æƒé™åˆ¤æ–­
- âœ… æ”¯æŒå¥½å‹ã€ç»„ç»‡æˆå‘˜ã€åä½œå…³ç³»

### 3. å¯æ‰©å±•æ€§

- âœ… æ˜“äºæ·»åŠ æ–°çš„å¯è§æ€§çº§åˆ«
- âœ… æ˜“äºæ·»åŠ æ–°çš„å…³ç³»ç±»å‹

### 4. æ€§èƒ½ä¼˜åŒ–

- âœ… ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- âœ… ç¼“å­˜æƒé™åˆ¤æ–­ç»“æœï¼ˆå¯é€‰ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æº

- [GitHub Privacy Settings](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/customizing-your-profile/about-your-profile)
- [LinkedIn Privacy Controls](https://www.linkedin.com/help/linkedin/answer/a1339360)
- [Twitter Privacy Settings](https://help.twitter.com/en/safety-and-security/how-to-make-twitter-private-and-public)
- [RLS ç­–ç•¥å¼€å‘æŒ‡å—](./50-RLSç­–ç•¥é–‹ç™¼æŒ‡å—.md)

---

## â“ å¾…è®¨è®ºé—®é¢˜

1. **å¥½å‹åŠŸèƒ½**ï¼šæ˜¯å¦éœ€è¦å®ç°å¥½å‹åŠŸèƒ½ï¼Ÿå¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥ç§»é™¤ `friends` å¯è§æ€§çº§åˆ«
2. **é»˜è®¤éšç§çº§åˆ«**ï¼šå„å®ä½“çš„é»˜è®¤éšç§çº§åˆ«æ˜¯å¦åˆé€‚ï¼Ÿ
3. **å­—æ®µå¯è§æ€§**ï¼šæ˜¯å¦éœ€è¦å­—æ®µçº§åˆ«çš„å¯è§æ€§æ§åˆ¶ï¼Œè¿˜æ˜¯å®ä½“çº§åˆ«çš„å°±å¤Ÿäº†ï¼Ÿ
4. **ç»„ç»‡å¯è§æ€§**ï¼šç»„ç»‡è´¦æˆ·çš„ `organization` å¯è§æ€§æ˜¯æŒ‡"åŒä¸€ç»„ç»‡çš„æˆå‘˜"è¿˜æ˜¯"æ‰€æœ‰ç»„ç»‡æˆå‘˜"ï¼Ÿ

---

**æœ€åæ›´æ–°**ï¼š2025-01-20  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ


