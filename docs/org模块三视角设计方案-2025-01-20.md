# org æ¨¡å—ä¸‰è§†è§’è®¾è®¡æ–¹æ¡ˆ

> **è®¾è®¡æ—¥æœŸ**ï¼š2025-01-20  
> **è®¾è®¡ç›®æ ‡**ï¼šè®© `@org` æ¨¡å—èƒ½å¤Ÿåº”å¯¹ä¸‰ç§è§†è§’ï¼ˆUserã€Organizationã€Teamï¼‰  
> **è®¾è®¡åŸåˆ™**ï¼šåŸºäº WorkspaceContextFacade çš„ä¸Šä¸‹æ–‡ç®¡ç†

---

## ğŸ“‹ éœ€æ±‚åˆ†æ

### ä¸‰ç§è§†è§’å®šä¹‰

æ ¹æ®èœå•æ•°æ®æ–‡ä»¶åˆ†æï¼š

1. **User è§†è§’**ï¼ˆ`user-data.json`ï¼‰
   - è·¯å¾„ï¼š`/accounts/org`
   - æ˜¾ç¤ºï¼šæˆ‘çš„ç»„ç»‡ã€æˆ‘åŠ å…¥çš„ç»„ç»‡
   - åŠŸèƒ½ï¼šåˆ›å»ºç»„ç»‡ã€æŸ¥çœ‹ç»„ç»‡ã€ç®¡ç†ç»„ç»‡

2. **Organization è§†è§’**ï¼ˆ`organization-data.json`ï¼‰
   - è·¯å¾„ï¼š`/accounts/org`ï¼ˆåœ¨ç»„ç»‡ä¸Šä¸‹æ–‡ä¸­ï¼‰
   - æ˜¾ç¤ºï¼šå½“å‰ç»„ç»‡çš„è¯¦ç»†ä¿¡æ¯
   - åŠŸèƒ½ï¼šæˆå‘˜ç®¡ç†ã€å›¢é˜Ÿç®¡ç†ã€è§’è‰²ç®¡ç†ã€åä½œç®¡ç†ç­‰

3. **Team è§†è§’**ï¼ˆ`team-data.json`ï¼‰
   - è·¯å¾„ï¼š`/accounts/org`ï¼ˆåœ¨å›¢é˜Ÿä¸Šä¸‹æ–‡ä¸­ï¼‰
   - æ˜¾ç¤ºï¼šå½“å‰å›¢é˜Ÿæ‰€å±çš„ç»„ç»‡ä¿¡æ¯
   - åŠŸèƒ½ï¼šæŸ¥çœ‹ç»„ç»‡ä¿¡æ¯ã€åˆ‡æ¢åˆ°ç»„ç»‡è§†è§’

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **åŸºäº WorkspaceContextFacade**ï¼šä½¿ç”¨ç°æœ‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿ
2. **å•ä¸€ç»„ä»¶å¤šè§†è§’**ï¼šåŒä¸€ä¸ªç»„ä»¶æ ¹æ®ä¸Šä¸‹æ–‡æ˜¾ç¤ºä¸åŒå†…å®¹
3. **èŒè´£åˆ†ç¦»**ï¼šComponent åªå¤„ç† UIï¼Œä¸šåŠ¡é€»è¾‘åœ¨ Facade/Service
4. **çŠ¶æ€ç®¡ç†**ï¼šä» Facade è·å–çŠ¶æ€ï¼Œä¸è‡ªå·±ç®¡ç†

### ç»„ä»¶ç»“æ„

```
org.component.ts
â”œâ”€â”€ æ ¹æ® contextType æ˜¾ç¤ºä¸åŒè§†å›¾
â”‚   â”œâ”€â”€ contextType === 'user' â†’ ç”¨æˆ·è§†è§’è§†å›¾
â”‚   â”œâ”€â”€ contextType === 'organization' â†’ ç»„ç»‡è§†è§’è§†å›¾
â”‚   â””â”€â”€ contextType === 'team' â†’ å›¢é˜Ÿè§†è§’è§†å›¾
â””â”€â”€ ç»Ÿä¸€çš„å¯¼èˆªå’Œæ“ä½œå¤„ç†
```

---

## ğŸ“ è¯¦ç»†è®¾è®¡

### 1. ç”¨æˆ·è§†è§’ï¼ˆUser Contextï¼‰

**æ˜¾ç¤ºå†…å®¹**ï¼š
- æˆ‘çš„ç»„ç»‡ï¼ˆæˆ‘åˆ›å»º/æ‹¥æœ‰çš„ç»„ç»‡ï¼‰
- æˆ‘åŠ å…¥çš„ç»„ç»‡ï¼ˆæˆ‘ä½œä¸ºæˆå‘˜åŠ å…¥çš„ç»„ç»‡ï¼‰

**åŠŸèƒ½**ï¼š
- åˆ›å»ºç»„ç»‡
- æŸ¥çœ‹ç»„ç»‡è¯¦æƒ…
- ç®¡ç†ç»„ç»‡æˆå‘˜
- ç®¡ç†ç»„ç»‡è§’è‰²
- ç®¡ç†ç»„ç»‡å›¢é˜Ÿ

**æ•°æ®æ¥æº**ï¼š
- `WorkspaceContextFacade.createdOrganizations`
- `WorkspaceContextFacade.joinedOrganizations`

---

### 2. ç»„ç»‡è§†è§’ï¼ˆOrganization Contextï¼‰

**æ˜¾ç¤ºå†…å®¹**ï¼š
- å½“å‰ç»„ç»‡çš„è¯¦ç»†ä¿¡æ¯
- ç»„ç»‡æˆå‘˜åˆ—è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼Œå®Œæ•´åŠŸèƒ½åœ¨ `/accounts/org/:id/members`ï¼‰
- ç»„ç»‡å›¢é˜Ÿåˆ—è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼Œå®Œæ•´åŠŸèƒ½åœ¨ `/accounts/org/:id/teams`ï¼‰
- å¿«é€Ÿæ“ä½œå…¥å£

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹ç»„ç»‡ä¿¡æ¯
- å¿«é€Ÿè®¿é—®æˆå‘˜ç®¡ç†
- å¿«é€Ÿè®¿é—®å›¢é˜Ÿç®¡ç†
- å¿«é€Ÿè®¿é—®è§’è‰²ç®¡ç†
- åˆ‡æ¢åˆ°å…¶ä»–ç»„ç»‡

**æ•°æ®æ¥æº**ï¼š
- `WorkspaceContextFacade.contextId`ï¼ˆå½“å‰ç»„ç»‡ IDï¼‰
- `AccountFacade` è·å–ç»„ç»‡è¯¦æƒ…
- `OrganizationMemberService` è·å–æˆå‘˜åˆ—è¡¨
- `TeamService` è·å–å›¢é˜Ÿåˆ—è¡¨

---

### 3. å›¢é˜Ÿè§†è§’ï¼ˆTeam Contextï¼‰

**æ˜¾ç¤ºå†…å®¹**ï¼š
- å½“å‰å›¢é˜Ÿæ‰€å±çš„ç»„ç»‡ä¿¡æ¯
- ç»„ç»‡åŸºæœ¬ä¿¡æ¯
- åˆ‡æ¢åˆ°ç»„ç»‡è§†è§’çš„å…¥å£

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹ç»„ç»‡ä¿¡æ¯
- åˆ‡æ¢åˆ°ç»„ç»‡è§†è§’

**æ•°æ®æ¥æº**ï¼š
- `WorkspaceContextFacade.contextId`ï¼ˆå½“å‰å›¢é˜Ÿ IDï¼‰
- `TeamService` è·å–å›¢é˜Ÿä¿¡æ¯
- `AccountFacade` è·å–ç»„ç»‡ä¿¡æ¯

---

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šå•ä¸€ç»„ä»¶å¤šè§†å›¾ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- ä»£ç é›†ä¸­ï¼Œæ˜“äºç»´æŠ¤
- å…±äº«çŠ¶æ€å’Œé€»è¾‘
- ç¬¦åˆ Angular ç»„ä»¶è®¾è®¡åŸåˆ™

**å®ç°æ–¹å¼**ï¼š
```typescript
@Component({
  selector: 'app-org',
  template: `
    @switch (contextType()) {
      @case ('user') {
        <!-- ç”¨æˆ·è§†è§’è§†å›¾ -->
        <app-org-user-view />
      }
      @case ('organization') {
        <!-- ç»„ç»‡è§†è§’è§†å›¾ -->
        <app-org-organization-view />
      }
      @case ('team') {
        <!-- å›¢é˜Ÿè§†è§’è§†å›¾ -->
        <app-org-team-view />
      }
      @default {
        <!-- é»˜è®¤è§†å›¾ï¼ˆç”¨æˆ·è§†è§’ï¼‰ -->
        <app-org-user-view />
      }
    }
  `
})
export class OrgComponent {
  private readonly contextFacade = inject(WorkspaceContextFacade);
  readonly contextType = this.contextFacade.contextType;
  readonly contextId = this.contextFacade.contextId;
}
```

---

### æ–¹æ¡ˆ 2ï¼šå­ç»„ä»¶åˆ†ç¦»ï¼ˆå¤‡é€‰ï¼‰

**ä¼˜ç‚¹**ï¼š
- æ¯ä¸ªè§†è§’ç‹¬ç«‹ï¼ŒèŒè´£æ¸…æ™°
- æ˜“äºå•ç‹¬æµ‹è¯•å’Œç»´æŠ¤

**ç¼ºç‚¹**ï¼š
- ä»£ç åˆ†æ•£ï¼Œå¯èƒ½é‡å¤
- éœ€è¦å…±äº«çŠ¶æ€ç®¡ç†

**å®ç°æ–¹å¼**ï¼š
```typescript
// org-user-view.component.ts
@Component({
  selector: 'app-org-user-view',
  template: `<!-- ç”¨æˆ·è§†è§’å†…å®¹ -->`
})
export class OrgUserViewComponent {}

// org-organization-view.component.ts
@Component({
  selector: 'app-org-organization-view',
  template: `<!-- ç»„ç»‡è§†è§’å†…å®¹ -->`
})
export class OrgOrganizationViewComponent {}

// org-team-view.component.ts
@Component({
  selector: 'app-org-team-view',
  template: `<!-- å›¢é˜Ÿè§†è§’å†…å®¹ -->`
})
export class OrgTeamViewComponent {}
```

---

## ğŸ“ ä»£ç å®ç°

### æ­¥éª¤ 1ï¼šä¿®æ”¹ org.component.ts æ”¯æŒå¤šè§†è§’

```typescript
import { ChangeDetectionStrategy, Component, OnInit, inject, computed } from '@angular/core';
import { Router } from '@angular/router';
import { AccountFacade } from '@core';
import { WorkspaceContextFacade } from '@core';
import { Account, SHARED_IMPORTS } from '@shared';
import { NzMessageService } from 'ng-zorro-antd/message';

@Component({
  selector: 'app-org',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <page-header [title]="pageTitle()" />
    
    @switch (contextType()) {
      @case ('user') {
        <!-- ç”¨æˆ·è§†è§’ï¼šæˆ‘çš„ç»„ç»‡ã€æˆ‘åŠ å…¥çš„ç»„ç»‡ -->
        <app-org-user-view />
      }
      @case ('organization') {
        <!-- ç»„ç»‡è§†è§’ï¼šå½“å‰ç»„ç»‡è¯¦æƒ… -->
        <app-org-organization-view [organizationId]="contextId()" />
      }
      @case ('team') {
        <!-- å›¢é˜Ÿè§†è§’ï¼šå›¢é˜Ÿæ‰€å±ç»„ç»‡ä¿¡æ¯ -->
        <app-org-team-view [teamId]="contextId()" />
      }
      @default {
        <!-- é»˜è®¤ï¼šç”¨æˆ·è§†è§’ -->
        <app-org-user-view />
      }
    }
  `,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class OrgComponent implements OnInit {
  private readonly contextFacade = inject(WorkspaceContextFacade);
  private readonly router = inject(Router);
  private readonly message = inject(NzMessageService);

  readonly contextType = this.contextFacade.contextType;
  readonly contextId = this.contextFacade.contextId;

  readonly pageTitle = computed(() => {
    const type = this.contextType();
    switch (type) {
      case 'user':
        return 'çµ„ç¹”ç®¡ç†';
      case 'organization':
        return 'çµ„ç¹”è©³æƒ…';
      case 'team':
        return 'çµ„ç¹”ä¿¡æ¯';
      default:
        return 'çµ„ç¹”ç®¡ç†';
    }
  });

  ngOnInit(): void {
    // ç»„ä»¶åˆå§‹åŒ–é€»è¾‘
  }
}
```

---

### æ­¥éª¤ 2ï¼šåˆ›å»ºç”¨æˆ·è§†è§’å­ç»„ä»¶

```typescript
// org-user-view.component.ts
@Component({
  selector: 'app-org-user-view',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <div style="display: flex; gap: 16px; flex-direction: column;">
      <!-- æˆ‘çš„ç»„ç»‡ -->
      <nz-card [nzBordered]="false">
        <div class="flex justify-between mb-md">
          <div>
            <h2>æˆ‘çš„çµ„ç¹”</h2>
            <p class="text-muted">æˆ‘å‰µå»ºæˆ–æ“æœ‰çš„çµ„ç¹”</p>
          </div>
          <button nz-button nzType="primary" (click)="createOrganization()">
            <span nz-icon nzType="plus"></span>
            å»ºç«‹çµ„ç¹”
          </button>
        </div>
        <!-- ç»„ç»‡åˆ—è¡¨ -->
      </nz-card>

      <!-- æˆ‘åŠ å…¥çš„ç»„ç»‡ -->
      <nz-card [nzBordered]="false">
        <!-- åŠ å…¥çš„ç»„ç»‡åˆ—è¡¨ -->
      </nz-card>
    </div>
  `
})
export class OrgUserViewComponent {
  private readonly accountFacade = inject(AccountFacade);
  private readonly contextFacade = inject(WorkspaceContextFacade);
  private readonly router = inject(Router);

  readonly createdOrganizations = this.contextFacade.createdOrganizations;
  readonly joinedOrganizations = this.contextFacade.joinedOrganizations;
  readonly loading = this.contextFacade.loadingOrganizations;

  createOrganization(): void {
    this.router.navigate(['/accounts/create/organization']);
  }
}
```

---

### æ­¥éª¤ 3ï¼šåˆ›å»ºç»„ç»‡è§†è§’å­ç»„ä»¶

```typescript
// org-organization-view.component.ts
@Component({
  selector: 'app-org-organization-view',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <div style="display: flex; gap: 16px; flex-direction: column;">
      <!-- ç»„ç»‡åŸºæœ¬ä¿¡æ¯ -->
      <nz-card [nzBordered]="false">
        <h2>{{ organization()?.name }}</h2>
        <p>{{ organization()?.email }}</p>
        <!-- æ›´å¤šç»„ç»‡ä¿¡æ¯ -->
      </nz-card>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <nz-card [nzBordered]="false">
        <h3>å¿«é€Ÿæ“ä½œ</h3>
        <div class="flex gap-md">
          <button nz-button (click)="manageMembers()">æˆå“¡ç®¡ç†</button>
          <button nz-button (click)="manageTeams()">åœ˜éšŠç®¡ç†</button>
          <button nz-button (click)="manageRoles()">è§’è‰²ç®¡ç†</button>
        </div>
      </nz-card>

      <!-- ç»„ç»‡æˆå‘˜ï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
      <nz-card [nzBordered]="false">
        <h3>çµ„ç¹”æˆå“¡</h3>
        <!-- æˆå‘˜åˆ—è¡¨ï¼ˆæœ€å¤šæ˜¾ç¤º 5 ä¸ªï¼‰ -->
      </nz-card>

      <!-- ç»„ç»‡å›¢é˜Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
      <nz-card [nzBordered]="false">
        <h3>çµ„ç¹”åœ˜éšŠ</h3>
        <!-- å›¢é˜Ÿåˆ—è¡¨ï¼ˆæœ€å¤šæ˜¾ç¤º 5 ä¸ªï¼‰ -->
      </nz-card>
    </div>
  `
})
export class OrgOrganizationViewComponent {
  @Input({ required: true }) organizationId!: string;
  
  private readonly accountFacade = inject(AccountFacade);
  private readonly router = inject(Router);

  readonly organization = signal<Account | null>(null);

  ngOnInit(): void {
    this.loadOrganization();
  }

  async loadOrganization(): Promise<void> {
    // ä» AccountFacade åŠ è½½ç»„ç»‡ä¿¡æ¯
  }

  manageMembers(): void {
    this.router.navigate(['/accounts/org', this.organizationId, 'members']);
  }

  manageTeams(): void {
    this.router.navigate(['/accounts/org', this.organizationId, 'teams']);
  }

  manageRoles(): void {
    this.router.navigate(['/accounts/org', this.organizationId, 'roles']);
  }
}
```

---

### æ­¥éª¤ 4ï¼šåˆ›å»ºå›¢é˜Ÿè§†è§’å­ç»„ä»¶

```typescript
// org-team-view.component.ts
@Component({
  selector: 'app-org-team-view',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <div style="display: flex; gap: 16px; flex-direction: column;">
      <!-- å›¢é˜Ÿæ‰€å±ç»„ç»‡ä¿¡æ¯ -->
      <nz-card [nzBordered]="false">
        <h2>{{ organization()?.name }}</h2>
        <p>{{ organization()?.email }}</p>
        <button nz-button nzType="primary" (click)="switchToOrganization()">
          åˆ‡æ›åˆ°çµ„ç¹”è¦–è§’
        </button>
      </nz-card>
    </div>
  `
})
export class OrgTeamViewComponent {
  @Input({ required: true }) teamId!: string;
  
  private readonly contextFacade = inject(WorkspaceContextFacade);
  private readonly teamService = inject(TeamService);
  private readonly accountFacade = inject(AccountFacade);

  readonly organization = signal<Account | null>(null);

  ngOnInit(): void {
    this.loadTeamOrganization();
  }

  async loadTeamOrganization(): Promise<void> {
    // 1. åŠ è½½å›¢é˜Ÿä¿¡æ¯
    // 2. è·å–å›¢é˜Ÿæ‰€å±çš„ç»„ç»‡ ID
    // 3. åŠ è½½ç»„ç»‡ä¿¡æ¯
  }

  switchToOrganization(): void {
    const orgId = this.organization()?.id;
    if (orgId) {
      this.contextFacade.switchToOrganization(orgId);
    }
  }
}
```

---

## ğŸ”„ çŠ¶æ€ç®¡ç†

### ä½¿ç”¨ WorkspaceContextFacade

**ç”¨æˆ·è§†è§’çŠ¶æ€**ï¼š
```typescript
readonly createdOrganizations = this.contextFacade.createdOrganizations;
readonly joinedOrganizations = this.contextFacade.joinedOrganizations;
readonly loadingOrganizations = this.contextFacade.loadingOrganizations;
```

**ç»„ç»‡è§†è§’çŠ¶æ€**ï¼š
```typescript
readonly contextId = this.contextFacade.contextId; // å½“å‰ç»„ç»‡ ID
// é€šè¿‡ AccountFacade è·å–ç»„ç»‡è¯¦æƒ…
```

**å›¢é˜Ÿè§†è§’çŠ¶æ€**ï¼š
```typescript
readonly contextId = this.contextFacade.contextId; // å½“å‰å›¢é˜Ÿ ID
// é€šè¿‡ TeamService è·å–å›¢é˜Ÿä¿¡æ¯
// é€šè¿‡ AccountFacade è·å–ç»„ç»‡ä¿¡æ¯
```

---

## âœ… å®æ–½æ£€æŸ¥æ¸…å•

### è®¾è®¡é˜¶æ®µ

- [x] åˆ†æä¸‰ç§è§†è§’çš„éœ€æ±‚
- [x] è®¾è®¡æ¶æ„æ–¹æ¡ˆ
- [x] ç¡®å®šå®ç°æ–¹å¼

### å®æ–½é˜¶æ®µ

- [ ] ä¿®æ”¹ `org.component.ts` æ”¯æŒå¤šè§†è§’
- [ ] åˆ›å»º `org-user-view.component.ts`
- [ ] åˆ›å»º `org-organization-view.component.ts`
- [ ] åˆ›å»º `org-team-view.component.ts`
- [ ] æ›´æ–°è·¯ç”±é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æµ‹è¯•ä¸‰ç§è§†è§’çš„åˆ‡æ¢

### éªŒè¯é˜¶æ®µ

- [ ] **ç±»å‹æ£€æŸ¥**ï¼š`yarn type-check` é€šè¿‡
- [ ] **ä»£ç æ£€æŸ¥**ï¼š`yarn lint` é€šè¿‡
- [ ] **æ ·å¼æ£€æŸ¥**ï¼š`yarn lint:style` é€šè¿‡
- [ ] **æ„å»ºæ£€æŸ¥**ï¼š`yarn build` é€šè¿‡
- [ ] **è¿è¡Œæ—¶æ£€æŸ¥**ï¼šä¸‰ç§è§†è§’åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ
- [ ] **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šåœ¨ä¸åŒè§†è§’é—´åˆ‡æ¢æ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [org æ¨¡å—ä»£ç åˆ†ææŠ¥å‘Š](./orgæ¨¡å—ä»£ç åˆ†ææŠ¥å‘Š-2025-01-20.md) - å½“å‰ä»£ç é—®é¢˜åˆ†æ
- [WorkspaceContextFacade](../../src/app/core/facades/workspace-context.facade.ts) - ä¸Šä¸‹æ–‡ç®¡ç† Facade
- [æ¶æ„æ ‡å‡†](../../.cursor/rules/architecture.mdc) - åˆ†å±¤æ¶æ§‹å’Œä¾è³´é—œä¿‚

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-01-20  
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ

