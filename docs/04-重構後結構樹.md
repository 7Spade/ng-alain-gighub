# 重構後專案結構樹 v2.0

> 📋 **目的**：展示重構後的完整專案結構，包含業務領域劃分和分層架構設計

基於架構設計：Git-like 分支模型、51 張資料表、11 個業務模組  
技術棧：Angular 20.3.x + NG-ZORRO 20.3.x + NG-ALAIN 20.0.x + Supabase  
設計原則：Standalone Components、分層架構（routes → shared → core）、業務領域驅動

**最後更新**：2025-11-15  
**維護者**：開發團隊

---

## 📋 目录结构总览

```
src/
├─ app/
│  ├─ core/                    # 核心模块（i18n、net、permissions、supabase、infra）
│  ├─ shared/                  # 共享层（shared-imports、widgets、models、services）
│  ├─ routes/                  # 业务层（accounts、blueprints、bots、tasks、system 等）
│  └─ layout/                  # 布局模块（basic、blank、passport）
├─ assets/                     # 静态资源
├─ environments/               # 环境配置
└─ styles/                     # 全局样式
```

> ✅ 此树结构反映 2025-11-14 的实际仓库状态。下方章节按照同一基准更新，方便与代码库比对。

---

## 📁 详细文件夹结构

### 1. Core 模块（核心基础设施层）

```
src/app/core/
├─ AGENTS.md                  # Core 模块规范摘要
├─ README.md                  # 模块说明
├─ index.ts                   # 统一导出（i18n、net、startup、supabase、permissions、infra）
├─ start-page.guard.ts        # Start Page 路由守卫
│
├─ i18n/                      # 🌍 国际化
│  └─ i18n.service.ts
│
├─ infra/                     # 🧱 Repository / 类型 / 错误转换
│  ├─ README.md
│  ├─ QUICK_START.md
│  ├─ errors/
│  │  ├─ error.types.ts
│  │  ├─ supabase-error.transformer.ts
│  │  └─ index.ts
│  ├─ repositories/
│  │  ├─ base.repository.ts
│  │  ├─ account.repository.ts
│  │  ├─ blueprint.repository.ts
│  │  ├─ blueprint-branch.repository.ts
│  │  ├─ blueprint-config.repository.ts
│  │  ├─ branch-fork.repository.ts
│  │  ├─ collaboration-invitation.repository.ts
│  │  ├─ collaboration-member.repository.ts
│  │  ├─ organization-collaboration.repository.ts
│  │  ├─ organization-schedule.repository.ts
│  │  ├─ pull-request.repository.ts
│  │  ├─ team-member.repository.ts
│  │  └─ team.repository.ts
│  ├─ types/
│  │  ├─ database.types.ts
│  │  ├─ account.types.ts
│  │  ├─ blueprint.types.ts
│  │  ├─ collaboration.types.ts
│  │  └─ index.ts
│  └─ utils/
│     ├─ transformers.ts
│     └─ index.ts
│
├─ net/                       # 🌐 HTTP 拦截/刷新/辅助
│  ├─ default.interceptor.ts
│  ├─ helper.ts
│  └─ refresh-token.ts
│
├─ permissions/               # 🔒 权限服务
│  ├─ permission.service.ts
│  ├─ role.service.ts
│  └─ types.ts
│
├─ startup/                   # 🚀 启动流程
│  └─ startup.service.ts
│
└─ supabase/                  # 💾 Supabase Service
   ├─ supabase.service.ts
   ├─ supabase-auth-adapter.service.ts
   └─ index.ts
```

> 📌 说明：原文件中提到的 `auth/`、`guards/`、`interceptors/` 等目录已整合到 `start-page.guard.ts`、`net/` 与 `permissions/` 等现有文件中，不再单独维护。

### 2. Shared 模块（共享层）

```
src/app/shared/
├─ AGENTS.md                  # Shared 模块规范摘要
├─ README.md                  # 模块说明
├─ index.ts                   # 统一导出（utils、models、services、shared-imports 等）
├─ shared-imports.ts          # ⭐ SHARED_IMPORTS
├─ shared-delon.module.ts     # Delon 封装
├─ shared-zorro.module.ts     # NG-ZORRO 封装
├─ shared-tinymce.module.ts   # Tinymce 集成
│
├─ cell-widget/               # Cell 组件封装
│  └─ index.ts
│
├─ st-widget/                 # ST 表格定制
│  └─ index.ts
│
├─ json-schema/               # SF JSON Schema 扩展
│  ├─ README.md
│  ├─ index.ts
│  └─ test/
│     └─ test.widget.ts
│
├─ utils/
│  └─ yuan.ts                 # 金额格式化工具
│
├─ models/                    # 📊 目前已实现的业务模型
│  ├─ index.ts
│  ├─ account/
│  │  ├─ index.ts
│  │  └─ types.ts
│  ├─ collaboration/
│  │  ├─ index.ts
│  │  └─ types.ts
│  └─ blueprint/
│     ├─ index.ts
│     └─ types.ts
│
└─ services/
   ├─ index.ts
   ├─ account/
   │  ├─ account.service.ts
   │  ├─ account.service.spec.ts
   │  ├─ organization-schedule.service.ts
   │  ├─ team.service.ts
   │  └─ team.service.spec.ts
   ├─ collaboration/
   │  ├─ collaboration.service.ts
   │  ├─ collaboration.service.spec.ts
   │  ├─ invitation.service.ts
   │  └─ invitation.service.spec.ts
   └─ blueprint/
      ├─ blueprint.service.ts
      ├─ branch.service.ts
      └─ pull-request.service.ts
```

> ⚠️ 提醒：文档原先列出的 permission/task/quality… 等模型目录尚未在当前代码库中创建，如需扩展请依据 `models/account` 的结构新增。

### 3. Routes 模块（业务层）

```
src/app/routes/
├─ routes.ts                  # 根路由（含守卫、layout 切换）
├─ AGENTS.md                  # 业务层规范摘要
│
├─ accounts/                  # 🔐 账号、团队、排班、bots 子页面
├─ analytics/                 # 📊 进度追踪、报表、统计
├─ blueprints/                # 🎯 蓝图 / Git-like 分支、PR、Fork、Review
├─ bots/                      # 🤖 Bot 列表、执行记录、配置
├─ collaboration/             # 🤝 协作信息（list/detail/form/invitations）
├─ communication/             # 💬 评论、通知、实时通道、团队提醒、待办
├─ dashboard/                 # 📈 传统 v1 / monitor / workplace / analysis
├─ data-v/                    # 📺 数据可视化（Relation Demo）
├─ delon/                     # 🧩 Delon 组件示例（acl/cache/downfile...）
├─ documents/                 # 📁 文档列表、上传、预览、权限
├─ exception/                 # ⚠️ 403/404/500 等异常页
├─ extras/                    # 🧭 Extra 示例（help center、poi、settings）
├─ issues/                    # ⚠️ 问题列表、详情、分派、照片、处理流程
├─ passport/                  # 🔑 登录/注册/锁屏/注册结果
├─ pro/                       # 🧱 ng-alain Pro 示例（account、list、form…）
├─ quality/                   # ✅ 检查、验收、照片、提交結果
├─ style/                     # 🎨 主题、色彩、栅格指南
├─ system/                    # ⚙️ 系统设置、角色、权限矩阵、Feature Flags
├─ tasks/                     # 📋 任务列表、详情、日历、阶段、照片、天气
└─ widgets/                   # 🧰 Widget 集锦
```

> 💡 每个子目录都采用 Standalone Component 结构，自身 `routes.ts` 负责 lazy loading，内部文件涵盖 `.ts/.html/.less`（部分较新的组件已改为 inline template）。

### 4. Layout 模块（布局层）

```
src/app/layout/
├─ AGENTS.md                  # Layout 模块规范摘要
├─ index.ts                   # 导出 basic / blank / passport
│
├─ basic/                     # 基础布局（inline template）
│  ├─ basic.component.ts
│  ├─ README.md
│  └─ widgets/
│     ├─ clear-storage.component.ts
│     ├─ fullscreen.component.ts
│     ├─ i18n.component.ts
│     ├─ icon.component.ts
│     ├─ notify.component.ts
│     ├─ rtl.component.ts
│     ├─ search.component.ts
│     ├─ task.component.ts
│     └─ user.component.ts
│
├─ blank/                     # 空白布局
│  ├─ blank.component.ts
│  └─ README.md
│
└─ passport/                  # 认证布局（inline template + less）
   ├─ passport.component.ts
   └─ passport.component.less
```

> 📝 现阶段 Layout 组件均内嵌模板（无 `.html` 文件），若需分离模板请同步调整 `index.ts` 与相关导入。

---

## 🎯 设计原则

### 1. 分层架构
- **Core 层**：基础设施服务（认证、数据库、网络、权限）
- **Shared 层**：共享资源（模型、组件、工具、服务）
- **Routes 层**：业务功能页面（按业务领域划分）
- **Layout 层**：布局组件（基础、空白、认证）

### 2. 业务领域驱动
- 按 **11 个业务模块** 组织 `routes/` 和 `shared/models/`
- 每个业务模块对应相应的资料表集合
- 保持业务逻辑的内聚性

### 3. Angular 20 最佳实践
- 使用 **Standalone Components**
- 使用 **SHARED_IMPORTS** 统一导入
- 使用 **Signals** 进行状态管理
- 使用 **inject()** 进行依赖注入

### 4. 命名规范
- 文件夹使用 **kebab-case**（如 `daily-reports/`）
- 组件文件使用 **kebab-case.component.ts**
- 服务文件使用 **kebab-case.service.ts**
- 模型文件使用 **kebab-case.model.ts**

---

## 📊 模块映射关系

| 业务模块 | 资料表数量 | Shared Models 状态（2025-11） | Routes 路径 |
|---------|-----------|------------------------------|-------------|
| 🔐 账户与身份系统 | 4 张 | ✅ `shared/models/account/` | ✅ `routes/accounts/` |
| 🤝 组织协作系统 | 3 张 | ✅ `shared/models/collaboration/` | ✅ `routes/collaboration/` |
| 🔒 权限系统 | 5 张 | 🚧 尚未创建 | ✅ `routes/system/roles/` |
| 🎯 蓝图/专案系统 | 5 张 | ✅ `shared/models/blueprint/` | ✅ `routes/blueprints/` |
| 📋 任务执行系统 | 9 张 | 🚧 尚未创建 | ✅ `routes/tasks/` |
| ✅ 品质验收系统 | 4 张 | 🚧 尚未创建 | ✅ `routes/quality/` |
| ⚠️ 问题追踪系统 | 4 张 | 🚧 尚未创建 | ✅ `routes/issues/` |
| 💬 协作沟通系统 | 6 张 | 🚧 尚未创建 | ✅ `routes/communication/` |
| 📊 资料分析系统 | 6 张 | 🚧 尚未创建 | ✅ `routes/documents/`, `routes/analytics/` |
| 🤖 机器人系统 | 3 张 | 🚧 尚未创建 | ✅ `routes/bots/` |
| ⚙️ 系统管理 | 2 张 | 🚧 尚未创建 | ✅ `routes/system/` |

> Status Legend：✅ 已在代码库实现；🚧 尚未落地（保留在架构设计中，扩展时请遵循本文件结构）。

---

## 📚 相关文档

- **完整 SQL 表结构**：`30-0-完整SQL表结构定义.md`
- **资料表清单总览**：`30-资料表清单总览.md`
- **业务流程图**：`14-业务流程图.mermaid.md`
- **账户层流程图**：`13-帐户层流程图.mermaid.md`
- **实体关系图**：`12-实体关系图.mermaid.md`
- **架构流程图**：`27-完整架构流程图.mermaid.md`
- **SHARED_IMPORTS 使用指南**：`45-SHARED_IMPORTS-使用指南.md`

---

**文件版本**: v2.1  
**最后更新**: 2025-11-14  
**维护者**: 系统架构团队

