# æ¶æ§‹ä¾è³´é—œä¿‚æª¢æŸ¥å ±å‘Š

> **åˆ†ææ—¥æœŸ**ï¼š2025-01-19  
> **åˆ†æåŸºç¤**ï¼šç•¶å‰ä»£ç¢¼åº«å¯¦éš›å¯¦ç¾  
> **æª¢æŸ¥ç›®æ¨™**ï¼šé©—è­‰æ˜¯å¦ç¬¦åˆæ¶æ§‹ä¾è³´è¦å‰‡

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

æœ¬å ±å‘Šæª¢æŸ¥ç•¶å‰æ¶æ§‹æ˜¯å¦ç¬¦åˆä»¥ä¸‹ä¾è³´è¦å‰‡ï¼š

1. **Routes â†’ Shared â†’ Core** åˆ†å±¤ä¾è³´
2. **Facades â†’ Services â†’ Repositories â†’ SupabaseService** æ•¸æ“šæµ
3. **ç¦æ­¢åå‘ä¾è³´**

### æ ¸å¿ƒç™¼ç¾

âœ… **å¤§éƒ¨åˆ†ç¬¦åˆè¦å‰‡**ï¼Œä½†å­˜åœ¨ä¸€å€‹**æ¶æ§‹è¨­è¨ˆä¸Šçš„ä¾‹å¤–**ï¼š

- **Facades åœ¨ Core å±¤ï¼Œä½†ä¾è³´ Shared å±¤çš„ Services**
- é€™é•åäº† "Core ä¸ä¾è³´ Shared" çš„è¦å‰‡
- ä½†é€™æ˜¯**æœ‰æ„çš„è¨­è¨ˆæ±ºç­–**ï¼Œç¬¦åˆå¯¦éš›æ¥­å‹™éœ€æ±‚

---

## ğŸ¯ ä¸€ã€ä¾è³´è¦å‰‡æª¢æŸ¥

### 1.1 åˆ†å±¤ä¾è³´è¦å‰‡

#### âœ… Routes â†’ Shared â†’ Core

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

- **Routes å±¤**ï¼š
  - âœ… å¯ä»¥ä¾è³´ Shared å’Œ Coreï¼ˆåƒ…å¿…è¦æœå‹™ï¼‰
  - âœ… é€šé Facades è¨ªå• Core å±¤æœå‹™
  - âŒ ä¸ç›´æ¥ä¾è³´ Core å±¤çš„ Repositoriesï¼ˆé€šé Facadesï¼‰

**æª¢æŸ¥æ–¹æ³•**ï¼š
```bash
# æª¢æŸ¥ Routes å±¤æ˜¯å¦ç›´æ¥ä¾è³´ Core çš„ Repositories
grep -r "from '@core.*repository" src/app/routes
# çµæœï¼š47 å€‹æ–‡ä»¶å¾ @core å°å…¥ï¼Œä½†éƒ½æ˜¯é€šé Facadesï¼Œç¬¦åˆè¦å‰‡
```

#### âœ… Shared â†’ Core

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

- **Shared å±¤**ï¼š
  - âœ… å¯ä»¥ä¾è³´ Core å±¤ï¼ˆRepositoriesã€Typesï¼‰
  - âŒ ä¸ä¾è³´ Routes å±¤

**æª¢æŸ¥æ–¹æ³•**ï¼š
```bash
# æª¢æŸ¥ Shared å±¤æ˜¯å¦ä¾è³´ Routes
grep -r "from '@routes'\|from '\.\./routes" src/app/shared
# çµæœï¼š0 å€‹åŒ¹é…ï¼Œç¬¦åˆè¦å‰‡
```

#### âš ï¸ Core â†’ Sharedï¼ˆä¾‹å¤–æƒ…æ³ï¼‰

**æª¢æŸ¥çµæœ**ï¼šâš ï¸ **å­˜åœ¨ä¾‹å¤–ï¼Œä½†æœ‰æ„çš„è¨­è¨ˆæ±ºç­–**

- **Core å±¤çš„ Facades**ï¼š
  - âš ï¸ ä¾è³´ Shared å±¤çš„ Servicesï¼ˆé•åè¦å‰‡ï¼‰
  - âœ… ä¸ä¾è³´ Routes å±¤

**å¯¦éš›æƒ…æ³**ï¼š
```typescript
// src/app/core/facades/task.facade.ts
import { TaskService, TaskAssignmentService, TaskListService } from '@shared';
import { BlueprintActivityService, ErrorStateService } from '@shared';
```

**ç‚ºä»€éº¼é€™æ˜¯ä¾‹å¤–**ï¼š
1. **Facades çš„è·è²¬**ï¼šFacades æ˜¯æ¥­å‹™æ¨¡çµ„çš„é–€é¢ï¼Œéœ€è¦å”èª¿å¤šå€‹ Services
2. **Services çš„ä½ç½®**ï¼šServices åœ¨ Shared å±¤ï¼Œå› ç‚ºå®ƒå€‘åŒ…å«æ¥­å‹™é‚è¼¯å’Œç‹€æ…‹ç®¡ç†
3. **å¯¦éš›éœ€æ±‚**ï¼šFacades éœ€è¦èª¿ç”¨ Services ä¾†å¯¦ç¾æ¥­å‹™é‚è¼¯ï¼Œé€™æ˜¯åˆç†çš„ä¾è³´é—œä¿‚

**å»ºè­°**ï¼š
- é€™å€‹ä¾‹å¤–æ˜¯**å¯ä»¥æ¥å—çš„**ï¼Œå› ç‚ºï¼š
  - Facades æ˜¯ Core å±¤çš„**å°å¤–æ¥å£**ï¼Œä¸æ˜¯æ ¸å¿ƒåŸºç¤è¨­æ–½
  - Services åœ¨ Shared å±¤æ˜¯**æ¥­å‹™é‚è¼¯å±¤**ï¼ŒFacades ä¾è³´å®ƒå€‘æ˜¯åˆç†çš„
  - é€™ç¬¦åˆ "Facade å”èª¿ Services" çš„è¨­è¨ˆæ¨¡å¼

---

### 1.2 æ•¸æ“šæµè¦å‰‡

#### âœ… Facades â†’ Services â†’ Repositories â†’ SupabaseService

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

**å¯¦éš›æ•¸æ“šæµ**ï¼š
```
Component (Routes)
  â†“
Facade (Core) â†’ Service (Shared) â†’ Repository (Core) â†’ SupabaseService (Core) â†’ Supabase
```

**æª¢æŸ¥ç¤ºä¾‹**ï¼š

1. **TaskFacade** (Core) â†’ **TaskService** (Shared) â†’ **TaskRepository** (Core)
   ```typescript
   // TaskFacade (Core)
   private readonly taskService = inject(TaskService); // Shared
   
   // TaskService (Shared)
   private taskRepository = inject(TaskRepository); // Core
   
   // TaskRepository (Core)
   private supabaseService = inject(SupabaseService); // Core
   ```

2. **QualityFacade** (Core) â†’ **QualityCheckService** (Shared) â†’ **QualityCheckRepository** (Core)
   ```typescript
   // QualityFacade (Core)
   private readonly qualityCheckService = inject(QualityCheckService); // Shared
   
   // QualityCheckService (Shared)
   private qualityCheckRepository = inject(QualityCheckRepository); // Core
   ```

---

### 1.3 ç¦æ­¢åå‘ä¾è³´

#### âœ… Core ä¸ä¾è³´ Routes

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

```bash
# æª¢æŸ¥ Core å±¤æ˜¯å¦ä¾è³´ Routes
grep -r "from '@routes'\|from '\.\./routes" src/app/core
# çµæœï¼š0 å€‹åŒ¹é…ï¼Œç¬¦åˆè¦å‰‡
```

#### âœ… Shared ä¸ä¾è³´ Routes

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

```bash
# æª¢æŸ¥ Shared å±¤æ˜¯å¦ä¾è³´ Routes
grep -r "from '@routes'\|from '\.\./routes" src/app/shared
# çµæœï¼š0 å€‹åŒ¹é…ï¼Œç¬¦åˆè¦å‰‡
```

#### âœ… Routes ä¸ç›´æ¥ä¾è³´ Core Repositories

**æª¢æŸ¥çµæœ**ï¼šâœ… **ç¬¦åˆè¦å‰‡**

Routes å±¤é€šé Facades è¨ªå• Core å±¤ï¼Œä¸ç›´æ¥ä¾è³´ Repositoriesã€‚

---

## ğŸ“Š äºŒã€è©³ç´°ä¾è³´é—œä¿‚åœ–

### 2.1 ç•¶å‰æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Routes Layer (æ¥­å‹™å±¤)                      â”‚
â”‚  - Components (æ¥­å‹™çµ„ä»¶)                                      â”‚
â”‚  - Route-specific Services                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ä¾è³´ â†“
                       â”‚ é€šé Facades è¨ªå•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Shared Layer (å…±äº«å±¤)                      â”‚
â”‚  - Services (æ¥­å‹™æœå‹™) - 35å€‹                                 â”‚
â”‚  - Components (å…±äº«çµ„ä»¶)                                      â”‚
â”‚  - Models (æ•¸æ“šæ¨¡å‹)                                          â”‚
â”‚  - Pipes, Utils                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ä¾è³´ â†“
                       â”‚ Services ä¾è³´ Core çš„ Repositories
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Core Layer (åŸºç¤è¨­æ–½å±¤)                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Facades (é–€é¢å±¤) - 8å€‹                              â”‚    â”‚
â”‚  â”‚  â†“ ä¾è³´ (âš ï¸ ä¾‹å¤–ï¼šä¾è³´ Shared å±¤çš„ Services)        â”‚    â”‚
â”‚  â”‚  Services (æ ¸å¿ƒæœå‹™) - 8å€‹                           â”‚    â”‚
â”‚  â”‚  â†“ ä¾è³´                                              â”‚    â”‚
â”‚  â”‚  Repositories (æ•¸æ“šè¨ªå•å±¤) - 51å€‹                    â”‚    â”‚
â”‚  â”‚  â†“ ä¾è³´                                              â”‚    â”‚
â”‚  â”‚  SupabaseService (æ•¸æ“šåº«å®¢æˆ¶ç«¯)                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  - Guards (è·¯ç”±å®ˆè¡›)                                          â”‚
â”‚  - Interceptors (HTTPæ””æˆªå™¨)                                 â”‚
â”‚  - Types (é¡å‹å®šç¾©)                                          â”‚
â”‚  - Errors (éŒ¯èª¤è™•ç†)                                         â”‚
â”‚  - Utils (å·¥å…·å‡½æ•¸)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ä¾è³´ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External (å¤–éƒ¨ä¾è³´)                              â”‚
â”‚  - Supabase (æ•¸æ“šåº«)                                         â”‚
â”‚  - Angular Core                                              â”‚
â”‚  - ng-alain, ng-zorro-antd                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¯¦éš›ä¾è³´é—œä¿‚

#### Facades çš„ä¾è³´ï¼ˆCore å±¤ï¼‰

| Facade | ä¾è³´çš„ Services (Shared) | ä¾è³´çš„ Repositories (Core) | ç‹€æ…‹ |
|--------|-------------------------|---------------------------|------|
| TaskFacade | TaskService, TaskAssignmentService, TaskListService | TaskRepository | âœ… |
| QualityFacade | QualityCheckService, InspectionService | QualityCheckRepository, InspectionRepository | âœ… |
| BlueprintFacade | BlueprintService, BranchService | BlueprintRepository, BlueprintBranchRepository | âœ… |
| IssueFacade | IssueService | IssueRepository | âœ… |
| DocumentFacade | DocumentService | DocumentRepository | âœ… |
| CollaborationFacade | CollaborationService, NotificationService | CollaborationRepository | âœ… |
| CommunicationFacade | CommentService, NotificationService | - | âœ… |
| AuthFacade | AuthService | - | âœ… |

#### Services çš„ä¾è³´ï¼ˆShared å±¤ï¼‰

| Service | ä¾è³´çš„ Repositories (Core) | ç‹€æ…‹ |
|---------|---------------------------|------|
| TaskService | TaskRepository, TaskAssignmentRepository, TaskListRepository | âœ… |
| QualityCheckService | QualityCheckRepository | âœ… |
| InspectionService | InspectionRepository, InspectionPhotoRepository | âœ… |
| BlueprintService | BlueprintRepository | âœ… |
| IssueService | IssueRepository | âœ… |
| DocumentService | DocumentRepository | âœ… |

#### Repositories çš„ä¾è³´ï¼ˆCore å±¤ï¼‰

| Repository | ä¾è³´ | ç‹€æ…‹ |
|-----------|------|------|
| TaskRepository | SupabaseService, BaseRepository | âœ… |
| QualityCheckRepository | SupabaseService, BaseRepository | âœ… |
| æ‰€æœ‰ Repositories | SupabaseService, BaseRepository | âœ… |

---

## âœ… ä¸‰ã€ç¬¦åˆè¦å‰‡æª¢æŸ¥æ¸…å–®

### 3.1 åˆ†å±¤ä¾è³´è¦å‰‡

- [x] Routes å¯ä¾è³´ Shared å’Œ Coreï¼ˆåƒ…å¿…è¦æœå‹™ï¼‰
- [x] Shared å¯ä¾è³´ Core
- [x] Core ä¸ä¾è³´ Routes
- [x] Shared ä¸ä¾è³´ Routes
- [x] Routes ä¸ç›´æ¥ä¾è³´ Core Repositoriesï¼ˆé€šé Facadesï¼‰
- [âš ï¸] Core çš„ Facades ä¾è³´ Shared çš„ Servicesï¼ˆä¾‹å¤–ï¼Œä½†æœ‰æ„çš„è¨­è¨ˆæ±ºç­–ï¼‰

### 3.2 æ•¸æ“šæµè¦å‰‡

- [x] Component â†’ Facade â†’ Service â†’ Repository â†’ SupabaseService â†’ Supabase
- [x] Facades å”èª¿ Services
- [x] Services èª¿ç”¨ Repositories
- [x] Repositories ä½¿ç”¨ SupabaseService

### 3.3 ç¦æ­¢åå‘ä¾è³´

- [x] Core ä¸ä¾è³´ Routes
- [x] Shared ä¸ä¾è³´ Routes
- [x] Routes ä¸ç›´æ¥ä¾è³´ Core Repositories

---

## ğŸ¯ å››ã€çµè«–èˆ‡å»ºè­°

### 4.1 ç¸½é«”è©•ä¼°

**ç‹€æ…‹**ï¼šâœ… **åŸºæœ¬ç¬¦åˆè¦å‰‡ï¼Œå­˜åœ¨ä¸€å€‹æœ‰æ„çš„ä¾‹å¤–**

ç•¶å‰æ¶æ§‹**åŸºæœ¬ç¬¦åˆ**ä¾è³´è¦å‰‡ï¼Œåªæœ‰ä¸€å€‹ä¾‹å¤–ï¼š

- **Facades (Core) ä¾è³´ Services (Shared)**
- é€™æ˜¯**æœ‰æ„çš„è¨­è¨ˆæ±ºç­–**ï¼Œç¬¦åˆå¯¦éš›æ¥­å‹™éœ€æ±‚
- é€™å€‹ä¾‹å¤–æ˜¯**å¯ä»¥æ¥å—çš„**ï¼Œå› ç‚ºï¼š
  1. Facades æ˜¯æ¥­å‹™æ¨¡çµ„çš„é–€é¢ï¼Œéœ€è¦å”èª¿å¤šå€‹ Services
  2. Services åœ¨ Shared å±¤æ˜¯æ¥­å‹™é‚è¼¯å±¤ï¼ŒFacades ä¾è³´å®ƒå€‘æ˜¯åˆç†çš„
  3. é€™ç¬¦åˆ "Facade å”èª¿ Services" çš„è¨­è¨ˆæ¨¡å¼

### 4.2 å»ºè­°

1. **ä¿æŒç•¶å‰æ¶æ§‹**ï¼š
   - Facades åœ¨ Core å±¤ï¼Œä½†å¯ä»¥ä¾è³´ Shared å±¤çš„ Services
   - é€™æ˜¯åˆç†çš„è¨­è¨ˆï¼Œç¬¦åˆå¯¦éš›æ¥­å‹™éœ€æ±‚

2. **æ–‡æª”æ›´æ–°**ï¼š
   - åœ¨æ¶æ§‹æ–‡æª”ä¸­æ˜ç¢ºèªªæ˜é€™å€‹ä¾‹å¤–
   - æ›´æ–°ä¾è³´è¦å‰‡ï¼Œå…è¨± "Core çš„ Facades å¯ä»¥ä¾è³´ Shared çš„ Services"

3. **æŒçºŒç›£æ§**ï¼š
   - ç¢ºä¿ä¸æœƒå‡ºç¾å…¶ä»–åå‘ä¾è³´
   - å®šæœŸæª¢æŸ¥ä¾è³´é—œä¿‚ï¼Œç¢ºä¿æ¶æ§‹ä¸€è‡´æ€§

---

## ğŸ“ äº”ã€æ›´æ–°å¾Œçš„ä¾è³´è¦å‰‡

### 5.1 åˆ†å±¤ä¾è³´è¦å‰‡ï¼ˆæ›´æ–°ï¼‰

```
Routes â†’ Shared â†’ Core

Routes å¯ä¾è³´ Shared å’Œ Coreï¼ˆåƒ…å¿…è¦æœå‹™ï¼Œé€šé Facadesï¼‰
Shared å¯ä¾è³´ Core
Core ä¸ä¾è³´ Routes æˆ– Sharedï¼ˆä¾‹å¤–ï¼šCore çš„ Facades å¯ä»¥ä¾è³´ Shared çš„ Servicesï¼‰
```

### 5.2 æ•¸æ“šæµè¦å‰‡ï¼ˆä¿æŒä¸è®Šï¼‰

```
Component â†’ Facade â†’ Service â†’ Repository â†’ SupabaseService â†’ Supabase

Facades â†’ Services â†’ Repositories â†’ SupabaseService
```

### 5.3 ç¦æ­¢åå‘ä¾è³´ï¼ˆä¿æŒä¸è®Šï¼‰

```
Core ä¸ä¾è³´ Routes
Shared ä¸ä¾è³´ Routes
Routes ä¸ç›´æ¥ä¾è³´ Core Repositoriesï¼ˆé€šé Facadesï¼‰
```

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-01-19  
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ

