# è´¦æˆ·ç³»ç»Ÿå¼€å‘ - ç»“æ„è¯„ä¼°æ€»ç»“

> **æ—¥æœŸ**ï¼š2025-01-15  
> **ä»»åŠ¡**ï¼šè¯„ä¼°ä»£ç ç»“æ„ï¼Œä¸ºè´¦æˆ·ç³»ç»Ÿå¼€å‘åšå‡†å¤‡

---

## ğŸ“‹ å·¥ä½œæ¦‚è¿°

æœ¬æ¬¡å·¥ä½œä¸»è¦å®Œæˆäº†è´¦æˆ·ç³»ç»Ÿå¼€å‘å‰çš„ä»£ç ç»“æ„è¯„ä¼°å’ŒåŸºç¡€ç›®å½•åˆ›å»ºï¼Œå¹¶é‡æ–°è¯„ä¼°äº† Repository å’Œ Service çš„æ­£ç¡®ä½ç½®ï¼Œç¡®ä¿åç»­å¼€å‘ç¬¦åˆé¡¹ç›®æ¶æ„è§„èŒƒã€‚

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. ä»£ç ç»“æ„è¯„ä¼°

#### 1.1 ç°æœ‰åŸºç¡€è®¾æ–½åˆ†æ
- âœ… **BaseRepository**ï¼šå·²å®ç°é€šç”¨ CRUD æ“ä½œï¼Œè‡ªåŠ¨å¤„ç† snake_case â†” camelCase è½¬æ¢
- âœ… **æ•°æ®è½¬æ¢å·¥å…·**ï¼š`toCamelCaseData()`, `toSnakeCaseData()` å·²å®ç°
- âœ… **é”™è¯¯å¤„ç†**ï¼š`handleSupabaseResponse()`, `transformSupabaseError()` å·²å®ç°
- âœ… **æ•°æ®åº“ç±»å‹**ï¼š`database.types.ts` å·²åŒ…å«æ‰€æœ‰ 51 å¼ è¡¨çš„ç±»å‹å®šä¹‰ï¼ˆsnake_caseï¼‰

#### 1.2 ç°æœ‰æœåŠ¡æ¨¡å¼åˆ†æ
- **Repository æ¨¡å¼**ï¼š`BlueprintRepository` ç»§æ‰¿ `BaseRepository`ï¼ˆä½äº `core/infra/repositories/`ï¼‰
- **Service æ¨¡å¼**ï¼š`PermissionService`, `RoleService` ç›´æ¥ä½¿ç”¨ `SupabaseService`ï¼ˆä½äº `core/permissions/`ï¼‰

#### 1.3 åˆ†å±‚æ¶æ„ç¡®è®¤
```
routes (ä¸šåŠ¡å±‚)
  â†“ ä¾èµ–
shared (å…±äº«å±‚)
  â†“ ä¾èµ–
core (åŸºç¡€è®¾æ–½å±‚)
```

### 2. åŸºç¡€ç›®å½•ç»“æ„åˆ›å»º

#### 2.1 å·²åˆ›å»ºçš„æ–‡ä»¶
```
src/app/shared/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ account/
â”‚   â”‚   â””â”€â”€ index.ts          âœ… å·²åˆ›å»º
â”‚   â””â”€â”€ index.ts              âœ… å·²åˆ›å»º
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ account/
â”‚   â”‚   â””â”€â”€ index.ts          âœ… å·²åˆ›å»º
â”‚   â””â”€â”€ index.ts              âœ… å·²åˆ›å»º
â”‚
â””â”€â”€ index.ts                  âœ… å·²æ›´æ–°ï¼ˆæ·»åŠ  models å’Œ services å¯¼å‡ºï¼‰
```

#### 2.2 ç»“æ„ç‰¹ç‚¹
- âœ… éµå¾ª `core/permissions/` çš„æ¨¡å¼
- âœ… æ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹çš„ç›®å½•
- âœ… ä½¿ç”¨ `index.ts` ç»Ÿä¸€å¯¼å‡º
- âœ… æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†

### 3. æ¶æ„å†³ç­–é‡æ–°è¯„ä¼°

#### 3.1 å‘ç°çš„é—®é¢˜
- **æ–‡æ¡£è§„åˆ’**ï¼š`docs/04-é‡æ§‹å¾Œçµæ§‹æ¨¹.md` æåˆ° Repository åœ¨ `shared/services/repository/`
- **å®é™…ä»£ç **ï¼šRepository å®é™…åœ¨ `core/infra/repositories/`
- **ç»“è®º**ï¼šåº”éµå¾ªå®é™…ä»£ç ç»“æ„ï¼ŒRepository å±äºåŸºç¡€è®¾æ–½å±‚

#### 3.2 æœ€ç»ˆç¡®å®šçš„æ¶æ„

**Repository ä½ç½®**ï¼š
- âœ… `core/infra/repositories/account.repository.ts`ï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼Œæ•°æ®è®¿é—®ï¼‰
- âœ… ç»§æ‰¿ `BaseRepository`ï¼Œè‡ªåŠ¨å¤„ç†æ•°æ®è½¬æ¢å’Œé”™è¯¯å¤„ç†

**Models ä½ç½®**ï¼š
- âœ… `shared/models/account/types.ts`ï¼ˆå…±äº«å±‚ï¼Œç±»å‹å®šä¹‰ï¼‰
- âœ… å®šä¹‰ Account, Team, TeamMember æ¥å£ï¼ˆcamelCaseï¼‰

**Service ä½ç½®**ï¼š
- âœ… `shared/services/account/account.service.ts`ï¼ˆå…±äº«å±‚ï¼Œä¸šåŠ¡é€»è¾‘ï¼‰
- âœ… ä½¿ç”¨ `AccountRepository`ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†

#### 3.3 å®æ–½é¡ºåºè°ƒæ•´

**åŸè®¡åˆ’**ï¼š
1. Models â†’ Serviceï¼ˆç›´æ¥ä½¿ç”¨ SupabaseServiceï¼‰

**æ–°è®¡åˆ’**ï¼š
1. Modelsï¼ˆç±»å‹å®šä¹‰ï¼‰
2. Repositoryï¼ˆæ•°æ®è®¿é—®å±‚ï¼Œä½¿ç”¨ BaseRepositoryï¼‰
3. Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼Œä½¿ç”¨ Repositoryï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… å¤ç”¨ BaseRepository çš„é€šç”¨åŠŸèƒ½
- âœ… è‡ªåŠ¨æ•°æ®è½¬æ¢ï¼ˆsnake_case â†” camelCaseï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… ç¬¦åˆåˆ†å±‚æ¶æ„ï¼ˆshared â†’ coreï¼‰

---

## ğŸ”„ å†³ç­–åå¤è¿‡ç¨‹

### ç¬¬ä¸€æ¬¡è¯„ä¼°ï¼ˆåˆå§‹è®¡åˆ’ï¼‰
- **å‡è®¾**ï¼šService ç›´æ¥ä½¿ç”¨ SupabaseServiceï¼ˆå‚è€ƒ PermissionService æ¨¡å¼ï¼‰
- **é—®é¢˜**ï¼šæœªå……åˆ†åˆ©ç”¨å·²æœ‰çš„ BaseRepository åŸºç¡€è®¾æ–½

### ç¬¬äºŒæ¬¡è¯„ä¼°ï¼ˆå‘ç° Repositoryï¼‰
- **å‘ç°**ï¼šé¡¹ç›®å·²æœ‰å®Œæ•´çš„ Repository æ¨¡å¼å®ç°
- **è€ƒè™‘**ï¼šæ˜¯å¦åº”è¯¥ä½¿ç”¨ Repository æ¨¡å¼ï¼Ÿ

### ç¬¬ä¸‰æ¬¡è¯„ä¼°ï¼ˆæ¶æ„å¯¹é½ï¼‰
- **åˆ†æ**ï¼šRepository å±äºåŸºç¡€è®¾æ–½å±‚ï¼ˆcoreï¼‰ï¼ŒService å±äºå…±äº«å±‚ï¼ˆsharedï¼‰
- **ç¡®è®¤**ï¼šService â†’ Repository â†’ SupabaseService ç¬¦åˆåˆ†å±‚æ¶æ„
- **å†³ç­–**ï¼šé‡‡ç”¨ Repository æ¨¡å¼ï¼Œå……åˆ†åˆ©ç”¨ç°æœ‰åŸºç¡€è®¾æ–½

### æœ€ç»ˆå†³ç­–
- âœ… **Repository**ï¼š`core/infra/repositories/`ï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
- âœ… **Models**ï¼š`shared/models/account/`ï¼ˆå…±äº«å±‚ï¼‰
- âœ… **Service**ï¼š`shared/services/account/`ï¼ˆå…±äº«å±‚ï¼Œä½¿ç”¨ Repositoryï¼‰

---

## ğŸ“Š æ¶æ„å¯¹æ¯”

| ç»„ä»¶ | åŸè®¡åˆ’ä½ç½® | æœ€ç»ˆä½ç½® | ç†ç”± |
|------|-----------|---------|------|
| Repository | `shared/services/repository/` | `core/infra/repositories/` | å±äºåŸºç¡€è®¾æ–½å±‚ï¼Œå·²æœ‰å®ç° |
| Models | `shared/models/account/` | `shared/models/account/` | ä¿æŒä¸å˜ï¼Œç¬¦åˆè§„åˆ’ |
| Service | `shared/services/account/` | `shared/services/account/` | ä¿æŒä¸å˜ï¼Œä½¿ç”¨ Repository |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å®æ–½é¡ºåº
1. **åˆ›å»º Models**ï¼ˆ`shared/models/account/types.ts`ï¼‰
   - å®šä¹‰ Account, Team, TeamMember æ¥å£
   - å®šä¹‰æšä¸¾ç±»å‹ï¼ˆAccountType, AccountStatus, TeamMemberRoleï¼‰

2. **åˆ›å»º Repository**ï¼ˆ`core/infra/repositories/account.repository.ts`ï¼‰
   - ç»§æ‰¿ BaseRepository
   - å®ç°ç‰¹å®šæŸ¥è¯¢æ–¹æ³•ï¼ˆfindByType, findByStatus ç­‰ï¼‰

3. **åˆ›å»º Service**ï¼ˆ`shared/services/account/account.service.ts`ï¼‰
   - ä½¿ç”¨ AccountRepository
   - ä½¿ç”¨ Signals ç®¡ç†çŠ¶æ€
   - å¤„ç†ä¸šåŠ¡é€»è¾‘

### æŠ€æœ¯è¦ç‚¹
- âœ… Angular 20 Standalone Components
- âœ… Signals çŠ¶æ€ç®¡ç†
- âœ… Repository æ¨¡å¼ï¼ˆå¤ç”¨ BaseRepositoryï¼‰
- âœ… è‡ªåŠ¨æ•°æ®è½¬æ¢ï¼ˆsnake_case â†” camelCaseï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… åˆ†å±¤æ¶æ§‹ï¼ˆroutes â†’ shared â†’ coreï¼‰

---

## ğŸ“ ç»éªŒæ•™è®­

### 1. å…ˆè¯„ä¼°ç°æœ‰ä»£ç 
- âœ… åœ¨åˆ¶å®šè®¡åˆ’å‰ï¼Œå…ˆå…¨é¢äº†è§£ç°æœ‰ä»£ç ç»“æ„
- âœ… å……åˆ†åˆ©ç”¨å·²æœ‰çš„åŸºç¡€è®¾æ–½ï¼ˆBaseRepositoryï¼‰

### 2. æ–‡æ¡£ä¸ä»£ç å¯¹é½
- âš ï¸ æ–‡æ¡£è§„åˆ’å¯èƒ½ä¸å®é™…ä»£ç ä¸ä¸€è‡´
- âœ… åº”ä»¥å®é™…ä»£ç ä¸ºå‡†ï¼Œå¿…è¦æ—¶æ›´æ–°æ–‡æ¡£

### 3. åˆ†å±‚æ¶æ„çš„é‡è¦æ€§
- âœ… æ˜ç¡®å„å±‚çš„èŒè´£å’Œä¾èµ–å…³ç³»
- âœ… Repositoryï¼ˆåŸºç¡€è®¾æ–½ï¼‰â†’ Serviceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ç¬¦åˆæ¶æ„åŸåˆ™

### 4. å†³ç­–åå¤çš„ä»·å€¼
- âœ… é€šè¿‡å¤šæ¬¡è¯„ä¼°ï¼Œæ‰¾åˆ°æœ€ä½³æ–¹æ¡ˆ
- âœ… è®°å½•å†³ç­–è¿‡ç¨‹ï¼Œä¾¿äºåç»­å‚è€ƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘è„‰ç»œè®°å½•](./fyi-development.md) - è¯¦ç»†çš„å¼€å‘å†³ç­–è®°å½•
- [æ¶æ„è¯´æ˜](./fyi-architecture.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡
- [é¡¹ç›®ç»“æ„è¯´æ˜](./01-å°ˆæ¡ˆçµæ§‹èªªæ˜.md) - é¡¹ç›®ç»“æ„æ¦‚è§ˆ
- [é‡æ„åç»“æ„æ ‘](./04-é‡æ§‹å¾Œçµæ§‹æ¨¹.md) - å®Œæ•´çš„é¡¹ç›®æ–‡ä»¶å¤¹ç»“æ„æ ‘
- [Core åŸºç¡€è®¾æ–½ README](../src/app/core/infra/README.md) - Repository æ¨¡å¼ä½¿ç”¨æŒ‡å—

---

**æœ€åæ›´æ–°**ï¼š2025-01-15  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ




