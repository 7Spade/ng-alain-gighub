# 实施检查清单 - 组织团队管理

> **目的**：确保实现符合企业级标准和 SRP 原则

## 📋 实施前检查

### 架构设计 ✅

- [x] 已明确职责划分（Component、Service、Repository）
- [x] 已确定文件结构
- [x] 已确定复用策略
- [x] 已确定路由设计

### 依赖关系 ✅

- [x] TeamService 已存在，无需修改
- [x] TeamRepository 已存在，无需修改
- [x] TeamCreateComponent 支持 Modal 模式
- [x] TeamDeleteComponent 支持 Modal 模式
- [ ] TeamEditComponent 需要扩展支持 Modal 模式（或使用跳转方案）

---

## 🚀 实施步骤

### 步骤 1：扩展 TeamEditComponent 支持 Modal 模式（可选但推荐）

**文件：** `routes/accounts/teams/team-edit/team-edit.component.ts`

**需要修改：**
1. 添加 `NZ_MODAL_DATA` 和 `NzModalRef` 注入（可选）
2. 添加 `isModalMode()` 方法
3. 修改 `ngOnInit()` 支持两种模式：
   - Modal 模式：从 `NZ_MODAL_DATA` 获取 team
   - 路由模式：从 `ActivatedRoute` 获取 teamId
4. 修改 `onSubmit()` 支持两种模式：
   - Modal 模式：关闭 Modal 并返回结果
   - 路由模式：导航到团队详情页

**参考：** `TeamCreateComponent` 的实现方式

### 步骤 2：创建 OrgTeamsComponent

**文件：** `routes/org/teams/teams.component.ts`

**需要实现：**
1. 从路由参数获取组织 ID
2. 调用 `TeamService.loadTeamsByOrganizationId()` 加载团队列表
3. 显示团队列表（使用 ST 表格）
4. 创建团队按钮（打开 TeamCreateComponent Modal）
5. 编辑团队操作（打开 TeamEditComponent Modal 或跳转）
6. 删除团队操作（打开 TeamDeleteComponent Modal）
7. 成员管理操作（跳转到 `/org/teams/:id/members`）

### 步骤 3：更新路由配置

**文件：** `routes/org/routes.ts`

**需要添加：**
```typescript
{
  path: ':id/teams',
  component: OrgTeamsComponent,
  data: { title: '團隊管理', titleI18n: 'menu.org.teams' }
}
```

**注意：** 路由顺序很重要，`:id/teams` 必须在 `teams/:id/members` 之前。

### 步骤 4：更新菜单配置

**文件：** `assets/tmp/organization-data.json`

**需要添加：**
```json
{
  "text": "Team Management",
  "link": "/org/:id/teams",
  "i18n": "menu.development.account.organizationTeams"
}
```

### 步骤 5：验证

**代码质量检查：**
- [ ] 类型检查：`yarn type-check`
- [ ] 代码检查：`yarn lint`
- [ ] 样式检查：`yarn lint:style`

**功能测试：**
- [ ] 显示团队列表
- [ ] 创建团队功能
- [ ] 编辑团队功能
- [ ] 删除团队功能
- [ ] 成员管理跳转
- [ ] 菜单导航

---

## ✅ SRP 原则检查

### Component 层 ✅

- [ ] 只处理 UI 展示和用户交互
- [ ] 不包含业务逻辑
- [ ] 不直接访问 Repository
- [ ] 使用 Service 获取数据

### Service 层 ✅

- [ ] 处理业务逻辑
- [ ] 使用 Signals 管理状态
- [ ] 调用 Repository 获取数据
- [ ] 不处理 UI 逻辑

### Repository 层 ✅

- [ ] 只处理数据访问
- [ ] 不包含业务逻辑
- [ ] 不处理 UI

---

## ✅ 企业级标准检查

### 分层架构 ✅

- [ ] routes → shared → core（依赖方向正确）
- [ ] 无反向依赖
- [ ] 无循环依赖

### 可复用性 ✅

- [ ] 复用 TeamService
- [ ] 复用 TeamRepository
- [ ] 复用 TeamCreateComponent
- [ ] 复用 TeamDeleteComponent
- [ ] 复用或扩展 TeamEditComponent

### 一致性 ✅

- [ ] 与 OrgMembersComponent 设计风格一致
- [ ] 使用相同的 UI 组件（SHARED_IMPORTS）
- [ ] 使用相同的错误处理方式
- [ ] 使用相同的状态管理方式（Signals）

### 低耦合高内聚 ✅

- [ ] Component 只依赖 Service
- [ ] Service 只依赖 Repository
- [ ] 组件之间通过 Service 通信

---

## 📝 实施注意事项

### 1. TeamEditComponent Modal 模式

**如果选择扩展 TeamEditComponent：**
- 参考 `TeamCreateComponent` 的实现
- 使用 `inject(NzModalRef, { optional: true })` 和 `inject(NZ_MODAL_DATA, { optional: true })`
- 添加 `isModalMode()` 方法判断模式
- 两种模式都要支持

**如果选择跳转方案：**
- 在 `OrgTeamsComponent` 中直接跳转到 `/accounts/teams/:id/edit`
- 编辑完成后，用户需要手动返回

### 2. 路由顺序

**重要：** 路由顺序必须正确：
```typescript
// ✅ 正确顺序
{ path: ':id/teams', ... },        // 具体路径在前
{ path: 'teams/:id/members', ... } // 动态路径在后

// ❌ 错误顺序（会导致路由冲突）
{ path: 'teams/:id/members', ... }, // 动态路径在前
{ path: ':id/teams', ... }          // 具体路径在后
```

### 3. 菜单动态 ID 替换

**已实现：** `MenuContextService.processMenuLinks()` 会自动替换 `:id` 占位符

**验证：** 切换到组织上下文后，菜单中的链接应该正确替换为组织 ID

---

## 🎯 完成标准

### 功能完整性 ✅

- [ ] 所有功能正常工作
- [ ] 错误处理完善
- [ ] 用户体验良好

### 代码质量 ✅

- [ ] 通过所有检查（类型、代码、样式）
- [ ] 符合 SRP 原则
- [ ] 符合企业级标准

### 文档完整性 ✅

- [ ] 代码注释清晰
- [ ] 设计文档完整
- [ ] 实施检查清单完成

---

**最后更新**：2025-01-20  
**维护者**：开发团队

