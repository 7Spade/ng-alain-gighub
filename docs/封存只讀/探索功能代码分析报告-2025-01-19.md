# æ¢ç´¢åŠŸèƒ½ä»£ç åˆ†ææŠ¥å‘Š

> **æ—¥æœŸ**ï¼š2025-01-19  
> **ç›®çš„**ï¼šåˆ†æ"æ¢ç´¢"åŠŸèƒ½çš„æ‰€æœ‰ç›¸å…³ä»£ç ï¼Œæ‰¾å‡ºæ²¡æœ‰æœç´¢æ ä½ã€åŠŸèƒ½ä¸å…¨çš„é—®é¢˜

---

## ğŸ“‹ ç›®å½•

1. [ç›¸å…³ä»£ç æ–‡ä»¶æ¸…å•](#ç›¸å…³ä»£ç æ–‡ä»¶æ¸…å•)
2. [ä»£ç ç»“æ„åˆ†æ](#ä»£ç ç»“æ„åˆ†æ)
3. [é—®é¢˜åˆ†æ](#é—®é¢˜åˆ†æ)
4. [ä¿®å¤å»ºè®®](#ä¿®å¤å»ºè®®)
5. [éªŒè¯æ¸…å•](#éªŒè¯æ¸…å•)

---

## ğŸ“ ç›¸å…³ä»£ç æ–‡ä»¶æ¸…å•

### 1. ç»„ä»¶å±‚ï¼ˆRoutesï¼‰

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `src/app/routes/explore/explore.component.ts` | æ¢ç´¢åŠŸèƒ½ä¸»ç»„ä»¶ | âœ… å­˜åœ¨ |
| `src/app/routes/explore/routes.ts` | è·¯ç”±é…ç½® | âœ… å­˜åœ¨ |
| `src/app/routes/explore/explore.component.html` | âŒ **ç¼ºå¤±** | æ¨¡æ¿å†…è”åœ¨ TS æ–‡ä»¶ä¸­ |
| `src/app/routes/explore/explore.component.less` | âŒ **ç¼ºå¤±** | æ ·å¼å†…è”åœ¨æ¨¡æ¿ä¸­ |

### 2. æœåŠ¡å±‚ï¼ˆSharedï¼‰

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `src/app/shared/services/explore/explore.service.ts` | æ¢ç´¢æœåŠ¡ | âœ… å­˜åœ¨ |
| `src/app/shared/services/explore/index.ts` | æœåŠ¡å¯¼å‡º | âœ… å­˜åœ¨ |
| `src/app/shared/services/index.ts` | æœåŠ¡æ€»å¯¼å‡º | âœ… å­˜åœ¨ |

### 3. æ¨¡å‹å±‚ï¼ˆSharedï¼‰

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `src/app/shared/models/explore.models.ts` | æ¢ç´¢æ¨¡å‹å®šä¹‰ | âœ… å­˜åœ¨ |
| `src/app/shared/models/index.ts` | æ¨¡å‹æ€»å¯¼å‡º | âœ… å­˜åœ¨ |

### 4. ç±»å‹å±‚ï¼ˆCoreï¼‰

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `src/app/core/infra/types/explore/explore.types.ts` | æ¢ç´¢ç±»å‹å®šä¹‰ | âœ… å­˜åœ¨ |
| `src/app/core/infra/types/explore/index.ts` | ç±»å‹å¯¼å‡º | âœ… å­˜åœ¨ |
| `src/app/core/infra/types/index.ts` | ç±»å‹æ€»å¯¼å‡º | âœ… å­˜åœ¨ |

### 5. æ•°æ®è®¿é—®å±‚ï¼ˆCoreï¼‰

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `src/app/core/infra/repositories/account.repository.ts` | è´¦æˆ·ä»“åº“ï¼ˆåŒ…å« search æ–¹æ³•ï¼‰ | âœ… å­˜åœ¨ |
| `src/app/core/infra/repositories/blueprint.repository.ts` | è“å›¾ä»“åº“ï¼ˆåŒ…å« search æ–¹æ³•ï¼‰ | âœ… å­˜åœ¨ |

### 6. æ–‡æ¡£

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|---------|------|------|
| `docs/æ¢ç´¢åŠŸèƒ½è®¾è®¡æ–‡æ¡£.md` | è®¾è®¡æ–‡æ¡£ | âœ… å­˜åœ¨ |

---

## ğŸ—ï¸ ä»£ç ç»“æ„åˆ†æ

### æ¶æ„å±‚çº§

```
Routes Layer (ç»„ä»¶å±‚)
  â””â”€â”€ ExploreComponent
       â†“ ä¾èµ–
Shared Layer (æœåŠ¡å±‚)
  â””â”€â”€ ExploreService
       â†“ ä¾èµ–
Core Layer (æ•°æ®è®¿é—®å±‚)
  â”œâ”€â”€ AccountRepository.search()
  â””â”€â”€ BlueprintRepository.search()
       â†“ ä¾èµ–
Supabase Database
```

### æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ â†’ ExploreComponent
  â†“
ExploreService.search()
  â†“
å¹¶è¡ŒæŸ¥è¯¢ï¼š
  â”œâ”€â”€ AccountRepository.search() â†’ ç”¨æˆ·/ç»„ç»‡
  â””â”€â”€ BlueprintRepository.search() â†’ è“å›¾
  â†“
åˆå¹¶ç»“æœ â†’ SearchResult
  â†“
æ˜¾ç¤ºåœ¨ç»„ä»¶ä¸­
```

---

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜ 1ï¼šæœç´¢æ ä½å¯èƒ½æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º âš ï¸

**ä½ç½®**ï¼š`src/app/routes/explore/explore.component.ts` ç¬¬ 12-32 è¡Œ

**ä»£ç **ï¼š
```typescript
<page-header [title]="'æ¢ç´¢'">
  <ng-template #extra>
    <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="searchButtonTpl" style="width: 500px;">
      <!-- æœç´¢è¾“å…¥æ¡† -->
    </nz-input-group>
  </ng-template>
</page-header>
```

**é—®é¢˜åˆ†æ**ï¼š

1. **æ¨¡æ¿å¼•ç”¨é—®é¢˜**ï¼š
   - ä½¿ç”¨äº† `<ng-template #extra>`ï¼Œä½† `page-header` ç»„ä»¶å¯èƒ½ä¸æ”¯æŒè¿™ç§ç”¨æ³•
   - æ ¹æ®å…¶ä»–ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼ï¼ˆå¦‚ `workplace.component.html`ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ `[extra]="extra"` æ¥ç»‘å®šæ¨¡æ¿å¼•ç”¨

2. **å¯¹æ¯”å…¶ä»–ç»„ä»¶çš„ç”¨æ³•**ï¼š
   ```html
   <!-- workplace.component.html -->
   <page-header [breadcrumb]="breadcrumb" [content]="content" [extra]="extra">
     <ng-template #extra>
       <!-- extra å†…å®¹ -->
     </ng-template>
   </page-header>
   ```

3. **å¯èƒ½çš„åŸå› **ï¼š
   - `page-header` ç»„ä»¶å¯èƒ½æ²¡æœ‰æ­£ç¡®è¯†åˆ« `#extra` æ¨¡æ¿å¼•ç”¨
   - æœç´¢æ ä½å¯èƒ½è¢« CSS éšè—
   - æœç´¢æ ä½å¯èƒ½è¢«å…¶ä»–å…ƒç´ é®æŒ¡

### é—®é¢˜ 2ï¼šåŠŸèƒ½å®ç°å®Œæ•´ä½†å¯èƒ½æœ‰è¿è¡Œæ—¶é—®é¢˜ âš ï¸

**Repository å±‚**ï¼š
- âœ… `AccountRepository.search()` å·²å®ç°ï¼ˆç¬¬ 179-222 è¡Œï¼‰
- âœ… `BlueprintRepository.search()` å·²å®ç°ï¼ˆç¬¬ 111-149 è¡Œï¼‰

**Service å±‚**ï¼š
- âœ… `ExploreService.search()` å·²å®ç°ï¼ˆç¬¬ 64-144 è¡Œï¼‰
- âœ… çŠ¶æ€ç®¡ç†ä½¿ç”¨ Signals
- âœ… é”™è¯¯å¤„ç†å·²å®ç°

**Component å±‚**ï¼š
- âœ… æœç´¢è¾“å…¥æ¡†å·²å®ç°
- âœ… æœç´¢æŒ‰é’®å·²å®ç°
- âœ… é˜²æŠ–æœç´¢å·²å®ç°
- âœ… ç»“æœå±•ç¤ºå·²å®ç°
- âœ… åˆ†é¡µå·²å®ç°

**å¯èƒ½çš„é—®é¢˜**ï¼š
- æœç´¢åŠŸèƒ½å¯èƒ½æ²¡æœ‰æ­£ç¡®è§¦å‘
- æœç´¢ç»“æœå¯èƒ½æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º
- åˆ†é¡µå¯èƒ½æ²¡æœ‰æ­£ç¡®å·¥ä½œ

### é—®é¢˜ 3ï¼šä»£ç è´¨é‡é—®é¢˜ âš ï¸

1. **æ¨¡æ¿å†…è”åœ¨ TS æ–‡ä»¶ä¸­**ï¼š
   - æ¨¡æ¿ä»£ç ç›´æ¥å†™åœ¨ `template` å±æ€§ä¸­ï¼Œä¸åˆ©äºç»´æŠ¤
   - å»ºè®®ï¼šå°†æ¨¡æ¿æå–åˆ°ç‹¬ç«‹çš„ `.html` æ–‡ä»¶

2. **æ ·å¼å†…è”åœ¨æ¨¡æ¿ä¸­**ï¼š
   - æ ·å¼ç›´æ¥å†™åœ¨æ¨¡æ¿çš„ `style` å±æ€§ä¸­ï¼Œä¸åˆ©äºç»´æŠ¤
   - å»ºè®®ï¼šå°†æ ·å¼æå–åˆ°ç‹¬ç«‹çš„ `.less` æ–‡ä»¶

3. **ç±»å‹å®‰å…¨é—®é¢˜**ï¼š
   - `getAvatarUrl()` å’Œ `getBlueprintDescription()` æ–¹æ³•ä½¿ç”¨äº† `any` ç±»å‹ï¼ˆç¬¬ 211ã€217 è¡Œï¼‰
   - å»ºè®®ï¼šä½¿ç”¨æ˜ç¡®çš„ç±»å‹å®šä¹‰

---

## ğŸ”§ ä¿®å¤å»ºè®®

### ä¿®å¤ 1ï¼šä¿®å¤æœç´¢æ ä½æ˜¾ç¤ºé—®é¢˜

**æ–¹æ¡ˆ Aï¼šä½¿ç”¨æ­£ç¡®çš„æ¨¡æ¿ç»‘å®šæ–¹å¼**

```typescript
// explore.component.ts
@Component({
  selector: 'app-explore',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <page-header [title]="'æ¢ç´¢'" [extra]="headerExtra">
      <ng-template #headerExtra>
        <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="searchButtonTpl" style="width: 500px;">
          <ng-template #searchButtonTpl>
            <button nz-button nzType="primary" nzSize="large" nzSearch [nzLoading]="exploreService.loading()" (click)="onSearch()">
              <span nz-icon nzType="search"></span>
              æœç´¢
            </button>
          </ng-template>
          <input
            type="text"
            nz-input
            nzSize="large"
            [(ngModel)]="searchInputValue"
            (ngModelChange)="onSearchInputChange($event)"
            (keyup.enter)="onSearch()"
            placeholder="æœç´¢ç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾..."
          />
        </nz-input-group>
      </ng-template>
    </page-header>
    <!-- å…¶ä»–å†…å®¹ -->
  `
})
```

**æ–¹æ¡ˆ Bï¼šå°†æœç´¢æ ä½ç§»åˆ°å¡ç‰‡å†…éƒ¨ï¼ˆæ›´æ˜æ˜¾çš„ä½ç½®ï¼‰**

```typescript
@Component({
  // ...
  template: `
    <page-header [title]="'æ¢ç´¢'"></page-header>
    
    <nz-card style="margin-top: 16px;">
      <!-- æœç´¢æ ä½æ”¾åœ¨å¡ç‰‡é¡¶éƒ¨ -->
      <div style="margin-bottom: 16px;">
        <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="searchButtonTpl" style="width: 100%; max-width: 600px;">
          <!-- æœç´¢è¾“å…¥æ¡† -->
        </nz-input-group>
      </div>
      
      <!-- å…¶ä»–å†…å®¹ -->
    </nz-card>
  `
})
```

### ä¿®å¤ 2ï¼šæå–æ¨¡æ¿å’Œæ ·å¼æ–‡ä»¶

**æ­¥éª¤ 1ï¼šåˆ›å»º `explore.component.html`**

```html
<page-header [title]="'æ¢ç´¢'" [extra]="headerExtra">
  <ng-template #headerExtra>
    <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="searchButtonTpl" class="search-input-group">
      <ng-template #searchButtonTpl>
        <button nz-button nzType="primary" nzSize="large" nzSearch [nzLoading]="exploreService.loading()" (click)="onSearch()">
          <span nz-icon nzType="search"></span>
          æœç´¢
        </button>
      </ng-template>
      <input
        type="text"
        nz-input
        nzSize="large"
        [(ngModel)]="searchInputValue"
        (ngModelChange)="onSearchInputChange($event)"
        (keyup.enter)="onSearch()"
        placeholder="æœç´¢ç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾..."
      />
    </nz-input-group>
  </ng-template>
</page-header>

<nz-card class="explore-card">
  <!-- å…¶ä»–å†…å®¹ -->
</nz-card>
```

**æ­¥éª¤ 2ï¼šåˆ›å»º `explore.component.less`**

```less
.search-input-group {
  width: 500px;
}

.explore-card {
  margin-top: 16px;
}
```

**æ­¥éª¤ 3ï¼šæ›´æ–° `explore.component.ts`**

```typescript
@Component({
  selector: 'app-explore',
  standalone: true,
  imports: [SHARED_IMPORTS],
  templateUrl: './explore.component.html',
  styleUrl: './explore.component.less'
})
```

### ä¿®å¤ 3ï¼šä¿®å¤ç±»å‹å®‰å…¨é—®é¢˜

```typescript
// åœ¨ explore.models.ts ä¸­æ·»åŠ ç±»å‹å®šä¹‰
export interface AccountWithAvatar extends Account {
  avatarUrl?: string;
  avatar_url?: string;
}

export interface BlueprintWithDescription extends Blueprint {
  description?: string;
  projectCode?: string;
  project_code?: string;
}

// åœ¨ explore.component.ts ä¸­ä½¿ç”¨
getAvatarUrl(account: AccountWithAvatar): string | undefined {
  return account.avatarUrl || account.avatar_url || undefined;
}

getBlueprintDescription(blueprint: BlueprintWithDescription): string {
  return blueprint.description || blueprint.projectCode || blueprint.project_code || 'æ— æè¿°';
}
```

### ä¿®å¤ 4ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
// åœ¨ explore.component.ts ä¸­æ·»åŠ 
onSearch(): void {
  const query = this.searchInputValue.trim();
  console.log('æœç´¢å…³é”®è¯:', query); // è°ƒè¯•æ—¥å¿—
  if (query) {
    this.currentPage.set(1);
    this.performSearch(query);
  }
}

private async performSearch(query: string): Promise<void> {
  console.log('æ‰§è¡Œæœç´¢:', { query, type: this.selectedType(), page: this.currentPage() }); // è°ƒè¯•æ—¥å¿—
  try {
    await this.exploreService.search({
      query,
      type: this.selectedType(),
      page: this.currentPage(),
      pageSize: this.pageSize,
      orderBy: 'name',
      orderDirection: 'asc'
    });
    console.log('æœç´¢ç»“æœ:', this.exploreService.searchResults()); // è°ƒè¯•æ—¥å¿—
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error); // è°ƒè¯•æ—¥å¿—
  }
}
```

---

## âœ… éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ] æœç´¢æ ä½æ­£ç¡®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
- [ ] è¾“å…¥æœç´¢å…³é”®è¯åï¼Œæœç´¢åŠŸèƒ½æ­£å¸¸è§¦å‘
- [ ] æœç´¢ç»“æœæ­£ç¡®æ˜¾ç¤ºï¼ˆç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾ï¼‰
- [ ] åˆ†ç±»ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç‚¹å‡»æœç´¢ç»“æœå¯ä»¥æ­£ç¡®è·³è½¬åˆ°è¯¦æƒ…é¡µ
- [ ] é”™è¯¯æç¤ºæ­£ç¡®æ˜¾ç¤º
- [ ] åŠ è½½çŠ¶æ€æ­£ç¡®æ˜¾ç¤º

### ä»£ç è´¨é‡éªŒè¯

- [ ] æ¨¡æ¿å·²æå–åˆ°ç‹¬ç«‹çš„ `.html` æ–‡ä»¶
- [ ] æ ·å¼å·²æå–åˆ°ç‹¬ç«‹çš„ `.less` æ–‡ä»¶
- [ ] ç±»å‹å®‰å…¨é—®é¢˜å·²ä¿®å¤ï¼ˆç§»é™¤ `any` ç±»å‹ï¼‰
- [ ] ä»£ç é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥ï¼ˆ`yarn type-check`ï¼‰
- [ ] ä»£ç é€šè¿‡ ESLint æ£€æŸ¥ï¼ˆ`yarn lint`ï¼‰
- [ ] ä»£ç é€šè¿‡ Stylelint æ£€æŸ¥ï¼ˆ`yarn lint:style`ï¼‰
- [ ] é¡¹ç›®æ„å»ºæˆåŠŸï¼ˆ`yarn build`ï¼‰

### æµè§ˆå™¨éªŒè¯

- [ ] åœ¨ Chrome ä¸­æµ‹è¯•æœç´¢åŠŸèƒ½
- [ ] åœ¨ Firefox ä¸­æµ‹è¯•æœç´¢åŠŸèƒ½
- [ ] åœ¨ Safari ä¸­æµ‹è¯•æœç´¢åŠŸèƒ½ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] å“åº”å¼è®¾è®¡åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ­£å¸¸å·¥ä½œ
- [ ] é”®ç›˜å¯¼èˆªæ­£å¸¸å·¥ä½œï¼ˆTabã€Enterã€Escï¼‰

---

## ğŸ“ æ€»ç»“

### å‘ç°çš„é—®é¢˜

1. **æœç´¢æ ä½å¯èƒ½æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º**ï¼š`page-header` çš„ `extra` æ¨¡æ¿å¯èƒ½æ²¡æœ‰æ­£ç¡®ç»‘å®š
2. **ä»£ç è´¨é‡é—®é¢˜**ï¼šæ¨¡æ¿å’Œæ ·å¼å†…è”åœ¨ TS æ–‡ä»¶ä¸­ï¼Œä¸åˆ©äºç»´æŠ¤
3. **ç±»å‹å®‰å…¨é—®é¢˜**ï¼šä½¿ç”¨äº† `any` ç±»å‹

### åŠŸèƒ½å®Œæ•´æ€§

- âœ… Repository å±‚ï¼š`search` æ–¹æ³•å·²å®ç°
- âœ… Service å±‚ï¼šæœç´¢é€»è¾‘å®Œæ•´
- âœ… Component å±‚ï¼šUI å’Œäº¤äº’é€»è¾‘å®Œæ•´

### å»ºè®®çš„ä¿®å¤ä¼˜å…ˆçº§

1. **P0ï¼ˆå¿…é¡»ä¿®å¤ï¼‰**ï¼šä¿®å¤æœç´¢æ ä½æ˜¾ç¤ºé—®é¢˜
2. **P1ï¼ˆå»ºè®®ä¿®å¤ï¼‰**ï¼šæå–æ¨¡æ¿å’Œæ ·å¼æ–‡ä»¶
3. **P2ï¼ˆå¯é€‰ä¿®å¤ï¼‰**ï¼šä¿®å¤ç±»å‹å®‰å…¨é—®é¢˜

---

**æœ€åæ›´æ–°**ï¼š2025-01-19  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

