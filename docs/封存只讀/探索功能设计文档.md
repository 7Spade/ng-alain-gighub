# æ¢ç´¢åŠŸèƒ½è®¾è®¡æ–‡æ¡£

> ğŸ“‹ **ç›®çš„**ï¼šè®¾è®¡ä¸€ä¸ª"æ¢ç´¢"åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·æœç´¢ç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾  
> **æœ€åæ›´æ–°**ï¼š2025-01-19  
> **ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [éœ€æ±‚åˆ†æ](#éœ€æ±‚åˆ†æ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [å¼€å‘é¡ºåº](#å¼€å‘é¡ºåº)
6. [è¯¦ç»†å®ç°æ–¹æ¡ˆ](#è¯¦ç»†å®ç°æ–¹æ¡ˆ)
7. [UI/UX è®¾è®¡](#uiux-è®¾è®¡)
8. [æƒé™æ§åˆ¶](#æƒé™æ§åˆ¶)
9. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
10. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### åŠŸèƒ½ç›®æ ‡

æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æœç´¢ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·ï¼š
- æœç´¢ç”¨æˆ·ï¼ˆUser ç±»å‹çš„è´¦æˆ·ï¼‰
- æœç´¢ç»„ç»‡ï¼ˆOrganization ç±»å‹çš„è´¦æˆ·ï¼‰
- æœç´¢è“å›¾ï¼ˆBlueprintsï¼‰

### æ ¸å¿ƒç‰¹æ€§

1. **ç»Ÿä¸€æœç´¢ç•Œé¢**ï¼šä¸€ä¸ªæœç´¢æ¡†ï¼Œæ”¯æŒæœç´¢å¤šç§å®ä½“ç±»å‹
2. **åˆ†ç±»ç­›é€‰**ï¼šæ”¯æŒæŒ‰ç±»å‹ç­›é€‰ï¼ˆç”¨æˆ·/ç»„ç»‡/è“å›¾ï¼‰
3. **æ¨¡ç³Šæœç´¢**ï¼šæ”¯æŒåç§°ã€æè¿°ç­‰å­—æ®µçš„æ¨¡ç³ŠåŒ¹é…
4. **åˆ†é¡µåŠ è½½**ï¼šæ”¯æŒåˆ†é¡µåŠ è½½æ›´å¤šç»“æœ
5. **ç»“æœå±•ç¤º**ï¼šä½¿ç”¨å¡ç‰‡æˆ–åˆ—è¡¨å±•ç¤ºæœç´¢ç»“æœ
6. **å¿«é€Ÿè·³è½¬**ï¼šç‚¹å‡»ç»“æœå¯è·³è½¬åˆ°è¯¦æƒ…é¡µ

---

## ğŸ“Š éœ€æ±‚åˆ†æ

### ç”¨æˆ·æ•…äº‹

1. **ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæœç´¢å…¶ä»–ç”¨æˆ·**ï¼Œä»¥ä¾¿æ‰¾åˆ°å¹¶å…³æ³¨ä»–ä»¬
2. **ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæœç´¢ç»„ç»‡**ï¼Œä»¥ä¾¿åŠ å…¥æˆ–æŸ¥çœ‹ç»„ç»‡ä¿¡æ¯
3. **ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæœç´¢è“å›¾**ï¼Œä»¥ä¾¿æŸ¥çœ‹å…¬å¼€çš„è“å›¾é¡¹ç›®
4. **ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤ŸæŒ‰ç±»å‹ç­›é€‰æœç´¢ç»“æœ**ï¼Œä»¥ä¾¿å¿«é€Ÿæ‰¾åˆ°æˆ‘éœ€è¦çš„å†…å®¹

### æœç´¢èŒƒå›´

#### ç”¨æˆ·æœç´¢
- **æœç´¢å­—æ®µ**ï¼š`name`ï¼ˆè´¦æˆ·åç§°ï¼‰ã€`email`ï¼ˆå¦‚æœå…¬å¼€ï¼‰
- **ç­›é€‰æ¡ä»¶**ï¼š`type = 'User'`ã€`status = 'active'`
- **æ’åº**ï¼šæŒ‰åç§°å­—æ¯é¡ºåºæˆ–åˆ›å»ºæ—¶é—´

#### ç»„ç»‡æœç´¢
- **æœç´¢å­—æ®µ**ï¼š`name`ï¼ˆç»„ç»‡åç§°ï¼‰ã€`email`ï¼ˆå¦‚æœå…¬å¼€ï¼‰
- **ç­›é€‰æ¡ä»¶**ï¼š`type = 'Organization'`ã€`status = 'active'`
- **æ’åº**ï¼šæŒ‰åç§°å­—æ¯é¡ºåºæˆ–åˆ›å»ºæ—¶é—´

#### è“å›¾æœç´¢
- **æœç´¢å­—æ®µ**ï¼š`name`ï¼ˆè“å›¾åç§°ï¼‰ã€`description`ï¼ˆæè¿°ï¼‰ã€`project_code`ï¼ˆé¡¹ç›®ä»£ç ï¼‰
- **ç­›é€‰æ¡ä»¶**ï¼š`status IN ('planning', 'active')`ï¼ˆåªæ˜¾ç¤ºè§„åˆ’ä¸­æˆ–è¿›è¡Œä¸­çš„è“å›¾ï¼‰
- **æ’åº**ï¼šæŒ‰åç§°å­—æ¯é¡ºåºã€åˆ›å»ºæ—¶é—´æˆ–æ›´æ–°æ—¶é—´

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

éµå¾ªé¡¹ç›®çš„äº”å±‚æ¶æ„æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Routes/Components å±‚               â”‚  â† ExploreComponent
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Facades å±‚ï¼ˆå¯é€‰ï¼‰                 â”‚  â† ExploreFacade
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Services å±‚                        â”‚  â† ExploreService
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Repositories å±‚                    â”‚  â† AccountRepository, BlueprintRepository
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Types å±‚                           â”‚  â† SearchResult, SearchOptions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–å…³ç³»

```
ExploreComponent
  â†“ ä¾èµ–
ExploreFacadeï¼ˆå¯é€‰ï¼‰æˆ– ExploreService
  â†“ ä¾èµ–
AccountRepository + BlueprintRepository
  â†“ ä¾èµ–
SupabaseService
```

---

## ğŸ“¦ æ•°æ®æ¨¡å‹

### Types å±‚

#### SearchTypeï¼ˆæœç´¢ç±»å‹æšä¸¾ï¼‰

```typescript
export enum SearchType {
  ALL = 'all',
  USERS = 'users',
  ORGANIZATIONS = 'organizations',
  BLUEPRINTS = 'blueprints'
}
```

#### SearchOptionsï¼ˆæœç´¢é€‰é¡¹ï¼‰

```typescript
export interface SearchOptions {
  query: string;                    // æœç´¢å…³é”®è¯
  type: SearchType;                 // æœç´¢ç±»å‹
  page?: number;                    // é¡µç ï¼ˆä» 1 å¼€å§‹ï¼‰
  pageSize?: number;                // æ¯é¡µæ•°é‡
  orderBy?: 'name' | 'createdAt';   // æ’åºå­—æ®µ
  orderDirection?: 'asc' | 'desc';  // æ’åºæ–¹å‘
}
```

#### SearchResultï¼ˆæœç´¢ç»“æœï¼‰

```typescript
export interface SearchResult {
  users: Account[];                 // ç”¨æˆ·ç»“æœ
  organizations: Account[];         // ç»„ç»‡ç»“æœ
  blueprints: Blueprint[];          // è“å›¾ç»“æœ
  total: {
    users: number;
    organizations: number;
    blueprints: number;
    all: number;
  };
  page: number;
  pageSize: number;
  totalPages: number;
}
```

---

## ğŸ”„ å¼€å‘é¡ºåº

éµå¾ª `docs/00-é †åº.md` çš„å¼€å‘é¡ºåºï¼š

### ç¬¬ 1 æ­¥ï¼šTypes å±‚

**ä½ç½®**ï¼š`src/app/core/infra/types/explore.types.ts`

**èŒè´£**ï¼š
- å®šä¹‰æœç´¢ç›¸å…³çš„ç±»å‹ï¼ˆSearchTypeã€SearchOptionsã€SearchResultï¼‰
- ä» `database.types.ts` æå–ç›¸å…³ç±»å‹

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç±»å‹å®šä¹‰å®Œæ•´
- [ ] ç±»å‹å·²æ­£ç¡®å¯¼å‡º
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 2 æ­¥ï¼šRepositories å±‚

**ä½ç½®**ï¼š
- `src/app/core/infra/repositories/account.repository.ts`ï¼ˆæ·»åŠ æœç´¢æ–¹æ³•ï¼‰
- `src/app/core/infra/repositories/blueprint.repository.ts`ï¼ˆæ·»åŠ æœç´¢æ–¹æ³•ï¼‰

**èŒè´£**ï¼š
- åœ¨ `AccountRepository` ä¸­æ·»åŠ  `search()` æ–¹æ³•ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰
- åœ¨ `BlueprintRepository` ä¸­æ·»åŠ  `search()` æ–¹æ³•ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰

**å®ç°è¦ç‚¹**ï¼š
- ä½¿ç”¨ Supabase çš„ `ilike` æ“ä½œç¬¦è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢
- æ”¯æŒå¤šå­—æ®µæœç´¢ï¼ˆnameã€emailã€description ç­‰ï¼‰
- æ”¯æŒåˆ†é¡µå’Œæ’åº

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æœç´¢æ–¹æ³•å·²å®ç°
- [ ] æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢
- [ ] æ”¯æŒåˆ†é¡µå’Œæ’åº
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 3 æ­¥ï¼šModels å±‚

**ä½ç½®**ï¼š`src/app/shared/models/explore.models.ts`

**èŒè´£**ï¼š
- å®šä¹‰ä¸šåŠ¡æ¨¡å‹ï¼ˆSearchResultã€SearchOptions ç­‰ï¼‰
- ä» Types å±‚æå–ç±»å‹

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] Models æ–‡ä»¶å·²åˆ›å»º
- [ ] ä» Types å±‚æ­£ç¡®æå–ç±»å‹
- [ ] Models å·²æ­£ç¡®å¯¼å‡º
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 4 æ­¥ï¼šServices å±‚

**ä½ç½®**ï¼š`src/app/shared/services/explore/explore.service.ts`

**èŒè´£**ï¼š
- åè°ƒ `AccountRepository` å’Œ `BlueprintRepository`
- ä½¿ç”¨ Signals ç®¡ç†æœç´¢çŠ¶æ€
- å®ç°æœç´¢é€»è¾‘ï¼ˆsearchUsersã€searchOrganizationsã€searchBlueprintsã€searchAllï¼‰

**çŠ¶æ€ç®¡ç†**ï¼š
- `searchResults`ï¼šæœç´¢ç»“æœ
- `loading`ï¼šåŠ è½½çŠ¶æ€
- `error`ï¼šé”™è¯¯çŠ¶æ€
- `searchQuery`ï¼šå½“å‰æœç´¢å…³é”®è¯
- `searchType`ï¼šå½“å‰æœç´¢ç±»å‹

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] Service ä½¿ç”¨ `@Injectable({ providedIn: 'root' })`
- [ ] ä½¿ç”¨ `inject()` è¿›è¡Œä¾èµ–æ³¨å…¥
- [ ] ä½¿ç”¨ Signals ç®¡ç†çŠ¶æ€
- [ ] æš´éœ² `ReadonlySignal` ç»™ç»„ä»¶
- [ ] ä¸šåŠ¡é€»è¾‘æ–¹æ³•å·²å®ç°
- [ ] é”™è¯¯å¤„ç†å·²å®ç°
- [ ] Loading çŠ¶æ€ç®¡ç†å·²å®ç°
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 5 æ­¥ï¼šFacades å±‚ï¼ˆå¯é€‰ï¼‰

**ä½ç½®**ï¼š`src/app/core/facades/explore.facade.ts`

**èŒè´£**ï¼š
- ç»Ÿä¸€å¯¹å¤–çš„æœç´¢æ¥å£
- åè°ƒ ExploreService
- æ•´åˆé”™è¯¯å¤„ç†

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] Facade ä½¿ç”¨ `@Injectable({ providedIn: 'root' })`
- [ ] æš´éœ²ç»Ÿä¸€çš„ Signal çŠ¶æ€æ¥å£
- [ ] æ•´åˆé”™è¯¯å¤„ç†
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 6 æ­¥ï¼šRoutes/Components å±‚

**ä½ç½®**ï¼š`src/app/routes/explore/`

**æ–‡ä»¶ç»“æ„**ï¼š
```
explore/
â”œâ”€â”€ explore.component.ts
â”œâ”€â”€ explore.component.html
â”œâ”€â”€ explore.component.less
â””â”€â”€ routes.ts
```

**èŒè´£**ï¼š
- å®ç°æœç´¢ UIï¼ˆæœç´¢æ¡†ã€ç­›é€‰å™¨ã€ç»“æœå±•ç¤ºï¼‰
- å¤„ç†ç”¨æˆ·äº¤äº’
- è·¯ç”±é…ç½®

**UI ç»„ä»¶**ï¼š
- æœç´¢æ¡†ï¼šä½¿ç”¨ `nz-input-search`
- ç­›é€‰å™¨ï¼šä½¿ç”¨ `nz-radio-group` æˆ– `nz-tabs`
- ç»“æœå±•ç¤ºï¼šä½¿ç”¨ `nz-card` æˆ– `nz-list`
- åˆ†é¡µï¼šä½¿ç”¨ `nz-pagination`

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç»„ä»¶ä½¿ç”¨ Standalone Component
- [ ] ä½¿ç”¨ `SHARED_IMPORTS` å¯¼å…¥æ¨¡å—
- [ ] ä½¿ç”¨ `inject()` æ³¨å…¥ Service/Facade
- [ ] ä» Service/Facade è·å–çŠ¶æ€
- [ ] è·¯ç”±å·²é…ç½®
- [ ] UI/UX ç¬¦åˆè®¾è®¡è§„èŒƒ
- [ ] å“åº”å¼è®¾è®¡å·²å®ç°
- [ ] å¯è®¿é—®æ€§è¦æ±‚å·²æ»¡è¶³
- [ ] é€šè¿‡ TypeScript ç¼–è¯‘æ£€æŸ¥

---

### ç¬¬ 7 æ­¥ï¼šæµ‹è¯•ä¸æ–‡æ¡£

**èŒè´£**ï¼š
- ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆServiceã€Facadeï¼‰
- æ›´æ–°æ–‡æ¡£

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] å•å…ƒæµ‹è¯•å·²ç¼–å†™ï¼ˆâ‰¥80% è¦†ç›–ç‡ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°

---

## ğŸ’» è¯¦ç»†å®ç°æ–¹æ¡ˆ

### Repository å±‚å®ç°

#### AccountRepository.search()

```typescript
/**
 * æœç´¢è´¦æˆ·ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰
 *
 * @param query æœç´¢å…³é”®è¯
 * @param type è´¦æˆ·ç±»å‹ï¼ˆå¯é€‰ï¼‰
 * @param options æŸ¥è¯¢é€‰é¡¹
 * @returns Observable<Account[]>
 */
search(query: string, type?: AccountType, options?: QueryOptions): Observable<Account[]> {
  let searchQuery = this.supabase
    .from(this.tableName)
    .select(options?.select || '*')
    .or(`name.ilike.%${query}%,email.ilike.%${query}%`);

  // åº”ç”¨ç±»å‹ç­›é€‰
  if (type) {
    searchQuery = searchQuery.eq('type', type);
  }

  // åªæœç´¢æ´»è·ƒè´¦æˆ·
  searchQuery = searchQuery.eq('status', AccountStatus.ACTIVE);

  // åº”ç”¨æ’åº
  if (options?.orderBy) {
    const snakeOrderBy = options.orderBy.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);
    searchQuery = searchQuery.order(snakeOrderBy, { 
      ascending: options.orderDirection !== 'desc' 
    });
  }

  // åº”ç”¨åˆ†é¡µ
  if (options?.page && options?.pageSize) {
    const fromIndex = (options.page - 1) * options.pageSize;
    const toIndex = fromIndex + options.pageSize - 1;
    searchQuery = searchQuery.range(fromIndex, toIndex);
  }

  return from(searchQuery).pipe(
    map((response: PostgrestResponse<any>) => {
      const data = handleSupabaseResponse(response, `${this.constructor.name}.search`);
      return Array.isArray(data) 
        ? data.map(item => toCamelCaseData<Account>(item)) 
        : [];
    })
  );
}
```

#### BlueprintRepository.search()

```typescript
/**
 * æœç´¢è“å›¾ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰
 *
 * @param query æœç´¢å…³é”®è¯
 * @param options æŸ¥è¯¢é€‰é¡¹
 * @returns Observable<Blueprint[]>
 */
search(query: string, options?: QueryOptions): Observable<Blueprint[]> {
  let searchQuery = this.supabase
    .from(this.tableName)
    .select(options?.select || '*')
    .or(`name.ilike.%${query}%,description.ilike.%${query}%,project_code.ilike.%${query}%`);

  // åªæœç´¢è§„åˆ’ä¸­æˆ–è¿›è¡Œä¸­çš„è“å›¾
  searchQuery = searchQuery.in('status', [BlueprintStatus.PLANNING, BlueprintStatus.ACTIVE]);

  // åº”ç”¨æ’åº
  if (options?.orderBy) {
    const snakeOrderBy = options.orderBy.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);
    searchQuery = searchQuery.order(snakeOrderBy, { 
      ascending: options.orderDirection !== 'desc' 
    });
  }

  // åº”ç”¨åˆ†é¡µ
  if (options?.page && options?.pageSize) {
    const fromIndex = (options.page - 1) * options.pageSize;
    const toIndex = fromIndex + options.pageSize - 1;
    searchQuery = searchQuery.range(fromIndex, toIndex);
  }

  return from(searchQuery).pipe(
    map((response: PostgrestResponse<any>) => {
      const data = handleSupabaseResponse(response, `${this.constructor.name}.search`);
      return Array.isArray(data) 
        ? data.map(item => toCamelCaseData<Blueprint>(item)) 
        : [];
    })
  );
}
```

### Service å±‚å®ç°

#### ExploreService

```typescript
@Injectable({ providedIn: 'root' })
export class ExploreService {
  private readonly accountRepo = inject(AccountRepository);
  private readonly blueprintRepo = inject(BlueprintRepository);

  // çŠ¶æ€ç®¡ç†
  private searchResultsState = signal<SearchResult | null>(null);
  private loadingState = signal<boolean>(false);
  private errorState = signal<string | null>(null);
  private searchQueryState = signal<string>('');
  private searchTypeState = signal<SearchType>(SearchType.ALL);

  // æš´éœ² ReadonlySignal
  readonly searchResults = this.searchResultsState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  readonly error = this.errorState.asReadonly();
  readonly searchQuery = this.searchQueryState.asReadonly();
  readonly searchType = this.searchTypeState.asReadonly();

  /**
   * æ‰§è¡Œæœç´¢
   */
  async search(options: SearchOptions): Promise<void> {
    this.loadingState.set(true);
    this.errorState.set(null);
    this.searchQueryState.set(options.query);
    this.searchTypeState.set(options.type);

    try {
      const page = options.page || 1;
      const pageSize = options.pageSize || 20;
      const orderBy = options.orderBy || 'name';
      const orderDirection = options.orderDirection || 'asc';

      const queryOptions: QueryOptions = {
        page,
        pageSize,
        orderBy,
        orderDirection
      };

      // æ ¹æ®æœç´¢ç±»å‹æ‰§è¡Œä¸åŒçš„æœç´¢
      const results: SearchResult = {
        users: [],
        organizations: [],
        blueprints: [],
        total: {
          users: 0,
          organizations: 0,
          blueprints: 0,
          all: 0
        },
        page,
        pageSize,
        totalPages: 0
      };

      if (options.type === SearchType.ALL || options.type === SearchType.USERS) {
        results.users = await firstValueFrom(
          this.accountRepo.search(options.query, AccountType.USER, queryOptions)
        );
        results.total.users = results.users.length;
      }

      if (options.type === SearchType.ALL || options.type === SearchType.ORGANIZATIONS) {
        results.organizations = await firstValueFrom(
          this.accountRepo.search(options.query, AccountType.ORGANIZATION, queryOptions)
        );
        results.total.organizations = results.organizations.length;
      }

      if (options.type === SearchType.ALL || options.type === SearchType.BLUEPRINTS) {
        results.blueprints = await firstValueFrom(
          this.blueprintRepo.search(options.query, queryOptions)
        );
        results.total.blueprints = results.blueprints.length;
      }

      results.total.all = results.total.users + results.total.organizations + results.total.blueprints;
      results.totalPages = Math.ceil(results.total.all / pageSize);

      this.searchResultsState.set(results);
    } catch (error) {
      this.errorState.set(error instanceof Error ? error.message : 'æœç´¢å¤±è´¥');
      throw error;
    } finally {
      this.loadingState.set(false);
    }
  }
}
```

### Component å±‚å®ç°

#### ExploreComponent

```typescript
@Component({
  selector: 'app-explore',
  standalone: true,
  imports: [SHARED_IMPORTS],
  templateUrl: './explore.component.html',
  styleUrl: './explore.component.less'
})
export class ExploreComponent implements OnInit, OnDestroy {
  private readonly exploreService = inject(ExploreService);
  private readonly router = inject(Router);
  private readonly destroy$ = new Subject<void>();

  // ä» Service è·å–çŠ¶æ€
  readonly searchResults = this.exploreService.searchResults;
  readonly loading = this.exploreService.loading;
  readonly error = this.exploreService.error;
  readonly searchQuery = this.exploreService.searchQuery;
  readonly searchType = this.exploreService.searchType;

  // æœ¬åœ°çŠ¶æ€
  searchInput = signal('');
  selectedType = signal<SearchType>(SearchType.ALL);
  currentPage = signal(1);
  pageSize = 20;

  // æœç´¢æµï¼ˆé˜²æŠ–ï¼‰
  private searchSubject = new Subject<string>();

  ngOnInit(): void {
    // è®¾ç½®é˜²æŠ–æœç´¢
    this.searchSubject
      .pipe(
        debounceTime(500),
        distinctUntilChanged(),
        takeUntil(this.destroy$)
      )
      .subscribe(query => {
        if (query.trim()) {
          this.performSearch(query);
        } else {
          this.exploreService.searchResultsState.set(null);
        }
      });
  }

  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }

  onSearch(query: string): void {
    this.searchInput.set(query);
    this.searchSubject.next(query);
  }

  onTypeChange(type: SearchType): void {
    this.selectedType.set(type);
    const query = this.searchInput();
    if (query.trim()) {
      this.performSearch(query);
    }
  }

  onPageChange(page: number): void {
    this.currentPage.set(page);
    const query = this.searchInput();
    if (query.trim()) {
      this.performSearch(query);
    }
  }

  private async performSearch(query: string): Promise<void> {
    try {
      await this.exploreService.search({
        query,
        type: this.selectedType(),
        page: this.currentPage(),
        pageSize: this.pageSize,
        orderBy: 'name',
        orderDirection: 'asc'
      });
    } catch (error) {
      // é”™è¯¯å·²åœ¨ Service ä¸­å¤„ç†
      console.error('æœç´¢å¤±è´¥:', error);
    }
  }

  navigateToAccount(accountId: string): void {
    this.router.navigate(['/accounts', accountId]);
  }

  navigateToBlueprint(blueprintId: string): void {
    this.router.navigate(['/blueprints', blueprintId]);
  }
}
```

---

## ğŸ¨ UI/UX è®¾è®¡

### å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¢ç´¢                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æœç´¢æ¡†]                                â”‚
â”‚  [å…¨éƒ¨] [ç”¨æˆ·] [ç»„ç»‡] [è“å›¾]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢ç»“æœ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å¡ç‰‡ 1  â”‚  â”‚ å¡ç‰‡ 2  â”‚  â”‚ å¡ç‰‡ 3  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [åˆ†é¡µæ§ä»¶]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœç´¢æ¡†

- ä½¿ç”¨ `nz-input-search` ç»„ä»¶
- æ”¯æŒå›è½¦æœç´¢
- æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- æ”¯æŒé˜²æŠ–ï¼ˆ500msï¼‰

### ç­›é€‰å™¨

- ä½¿ç”¨ `nz-radio-group` æˆ– `nz-tabs`
- é€‰é¡¹ï¼šå…¨éƒ¨ã€ç”¨æˆ·ã€ç»„ç»‡ã€è“å›¾
- åˆ‡æ¢æ—¶è‡ªåŠ¨é‡æ–°æœç´¢

### ç»“æœå±•ç¤º

- ä½¿ç”¨ `nz-card` å±•ç¤ºæ¯ä¸ªç»“æœ
- æ˜¾ç¤ºå¤´åƒã€åç§°ã€æè¿°ç­‰ä¿¡æ¯
- ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°è¯¦æƒ…é¡µ
- æ”¯æŒç©ºçŠ¶æ€æç¤º

### åˆ†é¡µ

- ä½¿ç”¨ `nz-pagination` ç»„ä»¶
- æ¯é¡µæ˜¾ç¤º 20 æ¡ç»“æœ
- æ”¯æŒè·³è½¬åˆ°æŒ‡å®šé¡µç 

---

## ğŸ”’ æƒé™æ§åˆ¶

### RLS ç­–ç•¥

æœç´¢åŠŸèƒ½ä¾èµ– Supabase çš„ RLSï¼ˆRow Level Securityï¼‰ç­–ç•¥ï¼š

1. **è´¦æˆ·æœç´¢**ï¼š
   - ç”¨æˆ·åªèƒ½çœ‹åˆ° `status = 'active'` çš„è´¦æˆ·
   - æ ¹æ® RLS ç­–ç•¥è¿‡æ»¤ç»“æœ

2. **è“å›¾æœç´¢**ï¼š
   - ç”¨æˆ·åªèƒ½çœ‹åˆ°æœ‰æƒé™è®¿é—®çš„è“å›¾
   - æ ¹æ® RLS ç­–ç•¥è¿‡æ»¤ç»“æœ

### åº”ç”¨å±‚æƒé™

- æœç´¢åŠŸèƒ½å¯¹æ‰€æœ‰å·²ç™»å½•ç”¨æˆ·å¼€æ”¾
- æœç´¢ç»“æœæ ¹æ®ç”¨æˆ·æƒé™è‡ªåŠ¨è¿‡æ»¤
- æ— éœ€é¢å¤–çš„æƒé™æ£€æŸ¥

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### é˜²æŠ–ä¼˜åŒ–

- æœç´¢è¾“å…¥ä½¿ç”¨ 500ms é˜²æŠ–
- é¿å…é¢‘ç¹çš„ API è°ƒç”¨

### åˆ†é¡µåŠ è½½

- é»˜è®¤æ¯é¡µ 20 æ¡ç»“æœ
- æ”¯æŒåˆ†é¡µåŠ è½½æ›´å¤šç»“æœ
- é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®

### ç¼“å­˜ç­–ç•¥

- å¯ä»¥è€ƒè™‘ç¼“å­˜æœç´¢ç»“æœï¼ˆå¯é€‰ï¼‰
- ä½¿ç”¨ Signals ç®¡ç†çŠ¶æ€ï¼Œè‡ªåŠ¨æ›´æ–° UI

### ç´¢å¼•ä¼˜åŒ–

ç¡®ä¿æ•°æ®åº“ç´¢å¼•ï¼š
- `accounts.name` ç´¢å¼•
- `accounts.type` ç´¢å¼•
- `accounts.status` ç´¢å¼•
- `blueprints.name` ç´¢å¼•
- `blueprints.status` ç´¢å¼•

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

1. **ExploreService æµ‹è¯•**ï¼š
   - æµ‹è¯•æœç´¢æ–¹æ³•
   - æµ‹è¯•çŠ¶æ€ç®¡ç†
   - æµ‹è¯•é”™è¯¯å¤„ç†

2. **Repository æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰ï¼š
   - æµ‹è¯•æœç´¢æ–¹æ³•
   - æµ‹è¯•æ¨¡ç³ŠæŸ¥è¯¢

### é›†æˆæµ‹è¯•

- æµ‹è¯•æœç´¢æµç¨‹
- æµ‹è¯•åˆ†é¡µåŠŸèƒ½
- æµ‹è¯•ç­›é€‰åŠŸèƒ½

### E2E æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

- æµ‹è¯•å®Œæ•´çš„æœç´¢æµç¨‹
- æµ‹è¯•ç»“æœè·³è½¬

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘é¡ºåºæŒ‡å—](./00-é †åº.md)
- [ç³»ç»Ÿæ¶æ„æ€ç»´å¯¼å›¾](./01-ç³»çµ±æ¶æ§‹æ€ç¶­å°åœ–.mermaid.md)
- [å®Œæ•´ SQL è¡¨ç»“æ„å®šä¹‰](./22-å®Œæ•´SQLè¡¨çµæ§‹å®šç¾©.md)
- [èµ„æ–™æ¨¡å‹å¯¹ç…§è¡¨](./27-è³‡æ–™æ¨¡å‹å°ç…§è¡¨.md)

---

**æœ€åæ›´æ–°**ï¼š2025-01-19  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

