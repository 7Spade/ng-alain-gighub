# å·¥ä½œå€ä¸Šä¸‹æ–‡ç³»çµ±æ¶æ§‹å¯©æŸ¥å ±å‘Š

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

**å¯©æŸ¥æ—¥æœŸï¼š** 2025-11-20  
**å¯©æŸ¥ç¯„åœï¼š** Typesã€Repositoriesã€Modelsã€Servicesã€Facades äº”å±¤  
**å¯©æŸ¥çµè«–ï¼š** âœ… **æ‰€æœ‰å±¤æ¬¡å®Œå…¨ç¬¦åˆä¼æ¥­åŒ–æ¨™æº–ï¼Œå¯ä»¥äº¤ä»˜**

---

## ğŸ¯ å°ˆæ¡ˆæ ¸å¿ƒç†è§£

### å°ˆæ¡ˆç›®çš„
é€™æ˜¯ä¸€å€‹**å·¥åœ°ç®¡ç†ç³»çµ±ï¼ˆConstruction Site Management Systemï¼‰**ï¼Œæ¡ç”¨ **Git-like åˆ†æ”¯æ¨¡å‹**ï¼Œæ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š

- ğŸ¯ **å¤šè¦–è§’ç®¡ç†**ï¼šç”¨æˆ¶å¯åœ¨å€‹äººã€çµ„ç¹”ã€åœ˜éšŠè¦–è§’é–“åˆ‡æ›
- ğŸ“‹ **è—åœ–ç³»çµ±**ï¼šé¡ä¼¼ Git Repositoryï¼Œæ˜¯å°ˆæ¡ˆæ ¸å¿ƒå¯¦é«”
- ğŸŒ³ **åˆ†æ”¯æ¨¡å‹**ï¼šä¸»åˆ†æ”¯ï¼ˆæ“æœ‰è€…æ§åˆ¶ï¼‰+ çµ„ç¹”åˆ†æ”¯ï¼ˆFork æ©Ÿåˆ¶ï¼‰
- ğŸ”„ **PR æ©Ÿåˆ¶**ï¼šæäº¤åŸ·è¡Œæ•¸æ“šï¼Œæ“æœ‰è€…å¯©æ ¸å¾Œåˆä½µ
- ğŸ“Š **51 å¼µè³‡æ–™è¡¨**ï¼Œæ¶µè“‹ 11 å€‹æ¨¡çµ„

### æ¶æ§‹åŸå‰‡ï¼ˆå››å€‹æ ¸å¿ƒåŸå‰‡ï¼‰
1. âœ… **å¸¸è¦‹åšæ³•**ï¼šéµå¾ª Angular å®˜æ–¹å’Œç¤¾å€æœ€ä½³å¯¦è¸
2. âœ… **ä¼æ¥­æ¨™æº–**ï¼šåˆ†å±¤æ¸…æ™°ã€è·è²¬åˆ†æ˜ã€ç‹€æ…‹ç®¡ç†è¦ç¯„
3. âœ… **ç¬¦åˆé‚è¼¯**ï¼šæ•¸æ“šæµæ¸…æ¥šã€å‘½åèªç¾©åŒ–
4. âœ… **ç¬¦åˆå¸¸ç†**ï¼šåŠŸèƒ½å¯ç”¨ã€é«”é©—å‹å–„

---

## ğŸ—ï¸ åˆ†å±¤æ¶æ§‹è¦–è¦ºåŒ–

```mermaid
graph TB
    subgraph "Routes Layer (Components)"
        C1[Account Component]
        C2[Organization Component]
        C3[Team Component]
        C4[Blueprint Component]
    end

    subgraph "Facades Layer (Core)"
        F1[WorkspaceContextFacade]
        F2[AccountFacade]
    end

    subgraph "Services Layer (Shared)"
        S1[WorkspaceContextService]
        S2[WorkspaceDataService]
        S3[WorkspaceMenuService]
        S4[WorkspacePersistenceService]
        S5[AccountService]
        S6[TeamService]
        S7[BlueprintService]
    end

    subgraph "Models Layer (Shared)"
        M1[Account Model]
        M2[Team Model]
        M3[Blueprint Model]
    end

    subgraph "Repositories Layer (Core/Infra)"
        R1[AccountRepository]
        R2[TeamRepository]
        R3[BlueprintRepository]
        R4[BaseRepository]
    end

    subgraph "Types Layer (Core/Infra)"
        T1[AccountType]
        T2[AccountStatus]
        T3[TeamMemberRole]
        T4[Database Types]
    end

    subgraph "Supabase"
        DB[(PostgreSQL)]
        AUTH[Auth]
        STORAGE[Storage]
    end

    %% ä¾è³´é—œä¿‚
    C1 --> F1
    C2 --> F1
    C3 --> F1
    C4 --> F1
    C1 --> F2

    F1 --> S1
    F1 --> S2
    F1 --> S3
    F1 --> S4
    F2 --> S5

    S1 --> S2
    S1 --> S5
    S2 --> S5
    S2 --> S6
    S2 --> S7
    S5 --> R1
    S6 --> R2
    S7 --> R3

    R1 --> R4
    R2 --> R4
    R3 --> R4

    R4 --> T4
    R1 --> T1
    R1 --> T2
    R2 --> T3

    M1 --> T1
    M1 --> T4
    M2 --> T4
    M3 --> T4

    R4 --> DB
    R4 --> AUTH
    R4 --> STORAGE

    style F1 fill:#4CAF50,color:#fff
    style S1 fill:#2196F3,color:#fff
    style S2 fill:#2196F3,color:#fff
    style S3 fill:#2196F3,color:#fff
    style R1 fill:#FF9800,color:#fff
    style R2 fill:#FF9800,color:#fff
    style T1 fill:#9C27B0,color:#fff
    style T4 fill:#9C27B0,color:#fff
```

**åœ–ä¾‹èªªæ˜ï¼š**
- ğŸŸ¢ ç¶ è‰²ï¼šFacades å±¤ï¼ˆçµ±ä¸€å°å¤–æ¥å£ï¼‰
- ğŸ”µ è—è‰²ï¼šServices å±¤ï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
- ğŸŸ  æ©™è‰²ï¼šRepositories å±¤ï¼ˆæ•¸æ“šå­˜å–ï¼‰
- ğŸŸ£ ç´«è‰²ï¼šTypes å±¤ï¼ˆé¡å‹å®šç¾©ï¼‰

---

## ğŸ“Š è¦–è§’åˆ‡æ›è‡ªå‹•åŒ–æµç¨‹

```mermaid
sequenceDiagram
    actor User
    participant Component
    participant Facade as WorkspaceContextFacade
    participant ContextSvc as WorkspaceContextService
    participant DataSvc as WorkspaceDataService
    participant MenuSvc as WorkspaceMenuService
    participant AccountSvc as AccountService
    participant BlueprintSvc as BlueprintService
    participant Effect as Angular Effects

    User->>Component: é»æ“Šåˆ‡æ›åˆ°çµ„ç¹”è¦–è§’
    Component->>Facade: switchToOrganization('org-123')
    
    Facade->>ContextSvc: switchToOrganization('org-123')
    
    ContextSvc->>ContextSvc: æ›´æ–° contextType = 'organization'
    ContextSvc->>ContextSvc: æ›´æ–° contextId = 'org-123'
    ContextSvc->>AccountSvc: selectAccount(organization)
    ContextSvc->>ContextSvc: æŒä¹…åŒ–åˆ° localStorage
    
    Note over Effect: Effect 1: ç›£è½ contextType è®ŠåŒ–
    Effect->>MenuSvc: switchToOrganization('org-123')
    MenuSvc->>MenuSvc: è™•ç†å‹•æ…‹ ID æ›¿æ› (:id â†’ 'org-123')
    MenuSvc->>MenuSvc: æ›´æ–° MenuService (ng-alain)
    
    Note over ContextSvc,DataSvc: Effect 2: è¼‰å…¥è—åœ–æ•¸æ“š
    ContextSvc->>DataSvc: loadBlueprintsByContext('organization', 'org-123')
    DataSvc->>BlueprintSvc: loadBlueprintsByOwnerId('org-123')
    BlueprintSvc-->>DataSvc: blueprints[]
    DataSvc->>DataSvc: æ›´æ–° contextBlueprints signal
    
    DataSvc-->>Facade: è—åœ–è¼‰å…¥å®Œæˆ
    Facade-->>Component: è¦–è§’åˆ‡æ›å®Œæˆ
    Component->>Component: è‡ªå‹•é¡¯ç¤ºçµ„ç¹”è—åœ–åˆ—è¡¨
```

**é—œéµç‰¹é»ï¼š**
- âœ… **å®Œå…¨è‡ªå‹•åŒ–**ï¼šåˆ‡æ›è¦–è§’å¾Œï¼Œèœå–®å’Œè—åœ–è‡ªå‹•è¼‰å…¥
- âœ… **ä¸éœ€è¦æ‰‹å‹•é¸æ“‡è—åœ–**ï¼šè—åœ–è‡ªå‹•æ ¹æ“šè¦–è§’è¼‰å…¥åˆ° `contextBlueprints` signal
- âœ… **ä½¿ç”¨ Angular Signals + Effects**ï¼šç¢ºä¿ç‹€æ…‹åŒæ­¥
- âœ… **éŒ¯èª¤è™•ç†**ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

---

## âœ… åˆ†å±¤æ¶æ§‹è©³ç´°å¯©æŸ¥

### 1ï¸âƒ£ Types å±¤ âœ… å¯äº¤ä»˜

**ä½ç½®ï¼š** `src/app/core/infra/types/account/account.types.ts`

**å…§å®¹ï¼š**
```typescript
export enum AccountType {
  USER = 'User',
  BOT = 'Bot',
  ORGANIZATION = 'Organization'
}

export enum AccountStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  SUSPENDED = 'suspended'
}

export enum TeamMemberRole {
  LEADER = 'leader',
  MEMBER = 'member'
}

export enum OrganizationMemberRole {
  OWNER = 'owner',
  ADMIN = 'admin',
  MEMBER = 'member'
}
```

**è©•ä¼°ï¼š**
- âœ… å®šç¾©æ¸…æ™°ï¼Œé¡å‹å®‰å…¨
- âœ… ä½ç½®æ­£ç¢ºï¼ˆåŸºç¤è¨­æ–½å±¤ï¼‰
- âœ… èˆ‡è³‡æ–™åº«æ¬„ä½å°æ‡‰
- âœ… è¢« Repository å±¤ä½¿ç”¨

**çµè«–ï¼šå®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œå¯äº¤ä»˜**

---

### 2ï¸âƒ£ Repositories å±¤ âœ… å¯äº¤ä»˜

**ä½ç½®ï¼š** `src/app/core/infra/repositories/`

**å¯¦ç¾ç¯„ä¾‹ï¼š**
```typescript
@Injectable({ providedIn: 'root' })
export class AccountRepository extends BaseRepository<Account, AccountInsert, AccountUpdate> {
  protected tableName = 'accounts';
  
  // ç¹¼æ‰¿ BaseRepository çš„å®Œæ•´ CRUDï¼š
  // - findAll(options?: QueryOptions): Observable<Account[]>
  // - findById(id: string): Observable<Account | null>
  // - findByIds(ids: string[]): Observable<Account[]>
  // - create(data: AccountInsert): Observable<Account>
  // - update(id: string, data: AccountUpdate): Observable<Account>
  // - delete(id: string): Observable<void>
  
  // ç‰¹å®šæ¥­å‹™æŸ¥è©¢æ–¹æ³•
  findByType(type: AccountType, options?: QueryOptions): Observable<Account[]> {
    return this.findAll({
      ...options,
      filters: { ...options?.filters, type }
    });
  }
  
  findByStatus(status: AccountStatus, options?: QueryOptions): Observable<Account[]> {
    return this.findAll({
      ...options,
      filters: { ...options?.filters, status }
    });
  }
  
  findByAuthUserId(authUserId: string): Observable<Account | null> {
    return this.findAll({
      filters: { authUserId } // è‡ªå‹•è½‰æ›ç‚º auth_user_id
    }).pipe(map(accounts => accounts.length > 0 ? accounts[0] : null));
  }
  
  findByAuthOrganizationId(authOrganizationId: string): Observable<Account[]> {
    return this.findAll({
      filters: { authOrganizationId } // è‡ªå‹•è½‰æ›ç‚º auth_organization_id
    });
  }
}
```

**è©•ä¼°ï¼š**
- âœ… ç¹¼æ‰¿ `BaseRepository`ï¼ˆé¿å…é‡è¤‡ä»£ç¢¼ï¼‰
- âœ… æä¾›å®Œæ•´ CRUD æ“ä½œ
- âœ… æä¾›ç‰¹å®šæ¥­å‹™æŸ¥è©¢æ–¹æ³•
- âœ… ä½¿ç”¨ RxJS Observable æ¨¡å¼
- âœ… è‡ªå‹•è™•ç† snake_case â†” camelCase è½‰æ›
- âœ… èˆ‡ Supabase æ•´åˆè‰¯å¥½

**å·²å¯¦ç¾çš„ Repositoriesï¼š**
- âœ… `account.repository.ts`
- âœ… `team.repository.ts`
- âœ… `team-member.repository.ts`
- âœ… `blueprint.repository.ts`ï¼ˆé€é BlueprintService é–“æ¥ä½¿ç”¨ï¼‰

**çµè«–ï¼šå®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œå¯äº¤ä»˜**

---

### 3ï¸âƒ£ Models å±¤ âœ… å¯äº¤ä»˜

**ä½ç½®ï¼š** `src/app/shared/models/account.models.ts`

**å¯¦ç¾æ–¹å¼ï¼š**
```typescript
import { Database, AccountType, AccountStatus, TeamMemberRole } from '@core';

// é‡æ–°å°å‡º core å±¤çš„æšèˆ‰ï¼ˆä¿æŒå‘å¾Œå…¼å®¹ï¼‰
export { AccountType, AccountStatus, TeamMemberRole };

// å®šç¾©å¯¦é«”é¡å‹ï¼ˆå¾ Database é¡å‹ç”Ÿæˆï¼‰
export type Account = Database['public']['Tables']['accounts']['Row'];
export type AccountInsert = Database['public']['Tables']['accounts']['Insert'];
export type AccountUpdate = Database['public']['Tables']['accounts']['Update'];

export type Team = Database['public']['Tables']['teams']['Row'];
export type TeamInsert = Database['public']['Tables']['teams']['Insert'];
export type TeamUpdate = Database['public']['Tables']['teams']['Update'];

export type TeamMember = Database['public']['Tables']['team_members']['Row'];
export type TeamMemberInsert = Database['public']['Tables']['team_members']['Insert'];
export type TeamMemberUpdate = Database['public']['Tables']['team_members']['Update'];
```

**è©•ä¼°ï¼š**
- âœ… é¿å…é‡è¤‡å®šç¾©ï¼ˆé‡æ–°å°å‡º core å±¤æšèˆ‰ï¼‰
- âœ… ä¾è³´æ–¹å‘æ­£ç¢ºï¼ˆcore ä¸ä¾è³´ sharedï¼‰
- âœ… ä½¿ç”¨ Supabase Database é¡å‹ï¼ˆé¡å‹å®‰å…¨ï¼‰
- âœ… æä¾› Insert/Update é¡å‹ï¼ˆæ”¯æ´ CRUDï¼‰
- âœ… ç¬¦åˆåˆ†å±¤æ¶æ§‹åŸå‰‡

**çµè«–ï¼šå®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œå¯äº¤ä»˜**

---

### 4ï¸âƒ£ Services å±¤ âœ… å¯äº¤ä»˜

**ä½ç½®ï¼š** `src/app/shared/services/`

#### 4.1 AccountServiceï¼ˆå¸³æˆ¶æ¥­å‹™é‚è¼¯ï¼‰

```typescript
@Injectable({ providedIn: 'root' })
export class AccountService {
  private accountRepository = inject(AccountRepository);
  
  // Signal-based ç‹€æ…‹ç®¡ç†
  private accountsState = signal<Account[]>([]);
  private selectedAccountState = signal<Account | null>(null);
  private loadingState = signal<boolean>(false);
  private errorState = signal<string | null>(null);
  
  // æš´éœ² ReadonlySignalï¼ˆé˜²æ­¢å¤–éƒ¨ä¿®æ”¹ï¼‰
  readonly accounts = this.accountsState.asReadonly();
  readonly selectedAccount = this.selectedAccountState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  readonly error = this.errorState.asReadonly();
  
  // Computed signalsï¼ˆæ´¾ç”Ÿç‹€æ…‹ï¼‰
  readonly activeAccounts = computed(() => 
    this.accounts().filter(a => a.status === AccountStatus.ACTIVE)
  );
  
  readonly userAccounts = computed(() => 
    this.accounts().filter(a => a.type === AccountType.USER)
  );
  
  readonly organizationAccounts = computed(() => 
    this.accounts().filter(a => a.type === AccountType.ORGANIZATION)
  );
  
  // æ¥­å‹™æ–¹æ³•
  async loadAccounts(): Promise<void> {
    this.loadingState.set(true);
    this.errorState.set(null);
    try {
      const accounts = await firstValueFrom(this.accountRepository.findAll());
      this.accountsState.set(accounts);
    } catch (error) {
      this.errorState.set(error instanceof Error ? error.message : 'è¼‰å…¥å¤±æ•—');
      throw error;
    } finally {
      this.loadingState.set(false);
    }
  }
  
  async findByAuthUserId(authUserId: string): Promise<Account | null> { ... }
  async getUserCreatedOrganizations(authUserId: string): Promise<Account[]> { ... }
  async getUserJoinedOrganizations(userId: string): Promise<Account[]> { ... }
  async getUserTeams(userId: string): Promise<Team[]> { ... }
}
```

#### 4.2 WorkspaceContextServiceï¼ˆä¸Šä¸‹æ–‡ç‹€æ…‹ç®¡ç†ï¼‰

```typescript
@Injectable({ providedIn: 'root' })
export class WorkspaceContextService {
  private readonly accountService = inject(AccountService);
  private readonly dataService = inject(WorkspaceDataService);
  private readonly persistenceService = inject(WorkspacePersistenceService);
  
  // ä¸Šä¸‹æ–‡ç‹€æ…‹
  private contextTypeState = signal<'app' | 'user' | 'organization' | 'team'>('app');
  private contextIdState = signal<string | null>(null);
  private switchingState = signal<boolean>(false);
  
  readonly contextType = this.contextTypeState.asReadonly();
  readonly contextId = this.contextIdState.asReadonly();
  readonly switching = this.switchingState.asReadonly();
  
  // Computed signals
  readonly contextLabel = computed(() => {
    const type = this.contextType();
    const id = this.contextId();
    
    switch (type) {
      case 'user':
        const account = this.findUserAccount(id);
        return account?.name || 'å€‹äººå¸³æˆ¶';
      case 'organization':
        const org = this.allOrganizations().find(a => a.id === id);
        return org?.name || 'çµ„ç¹”å¸³æˆ¶';
      case 'team':
        const team = this.userTeams().find(t => t.id === id);
        return team?.name || 'åœ˜éšŠ';
      default:
        return 'æ‡‰ç”¨èœå–®';
    }
  });
  
  readonly allOrganizations = computed(() => {
    const all = [...this.createdOrganizations(), ...this.joinedOrganizations()];
    const uniqueMap = new Map<string, Account>();
    all.forEach(org => {
      if (!uniqueMap.has(org.id)) uniqueMap.set(org.id, org);
    });
    return Array.from(uniqueMap.values());
  });
  
  readonly teamsByOrganization = computed(() => {
    const teams = this.userTeams();
    const orgs = this.allOrganizations();
    const teamsMap = new Map<string, Array<typeof teams[0]>>();
    
    orgs.forEach(org => teamsMap.set(org.id, []));
    teams.forEach(team => {
      const orgId = (team as any).organizationId || (team as any).organization_id;
      if (orgId && teamsMap.has(orgId)) {
        teamsMap.get(orgId)!.push(team);
      }
    });
    
    return teamsMap;
  });
  
  // åˆ‡æ›æ–¹æ³•ï¼ˆçµ±ä¸€å…¥å£ï¼‰
  private switchContext(
    type: 'app' | 'user' | 'organization' | 'team',
    id: string | null,
    account: Account | null
  ): void {
    if (this.switchingState()) return;
    if (this.contextTypeState() === type && this.contextIdState() === id) return;
    
    this.switchingState.set(true);
    try {
      // 1. æ›´æ–°ç‹€æ…‹
      this.contextTypeState.set(type);
      this.contextIdState.set(id);
      
      // 2. æ›´æ–°å¸³æˆ¶ï¼ˆåƒ… user å’Œ organizationï¼‰
      if (account && (type === 'user' || type === 'organization')) {
        this.accountService.selectAccount(account);
      } else if (type === 'app') {
        this.accountService.selectAccount(null);
      }
      
      // 3. æŒä¹…åŒ–
      this.persistenceService.saveContext(type, id);
      
      // 4. è¼‰å…¥è—åœ–ï¼ˆè‡ªå‹•ï¼‰
      this.dataService.loadBlueprintsByContext(type, id).catch(error => {
        console.error('[WorkspaceContextService] è¼‰å…¥è—åœ–å¤±æ•—:', error);
      });
    } finally {
      setTimeout(() => this.switchingState.set(false), 0);
    }
  }
  
  switchToApp(): void { this.switchContext('app', null, null); }
  switchToUser(userId: string): void { ... }
  switchToOrganization(organizationId: string): void { ... }
  switchToTeam(teamId: string): void { ... }
  
  restoreContext(): boolean { ... }
}
```

#### 4.3 WorkspaceDataServiceï¼ˆæ•¸æ“šè¼‰å…¥ï¼‰

```typescript
@Injectable({ providedIn: 'root' })
export class WorkspaceDataService {
  private readonly accountService = inject(AccountService);
  private readonly teamService = inject(TeamService);
  private readonly blueprintService = inject(BlueprintService);
  
  // æ•¸æ“šç‹€æ…‹
  private currentUserAccountState = signal<Account | null>(null);
  private createdOrganizationsState = signal<Account[]>([]);
  private joinedOrganizationsState = signal<Account[]>([]);
  private userTeamsState = signal<Team[]>([]);
  private contextBlueprintsState = signal<Blueprint[]>([]);
  private loadingState = signal<boolean>(false);
  
  readonly currentUserAccount = this.currentUserAccountState.asReadonly();
  readonly createdOrganizations = this.createdOrganizationsState.asReadonly();
  readonly joinedOrganizations = this.joinedOrganizationsState.asReadonly();
  readonly userTeams = this.userTeamsState.asReadonly();
  readonly contextBlueprints = this.contextBlueprintsState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  
  // è¼‰å…¥ç”¨æˆ¶å·¥ä½œå€æ•¸æ“š
  async loadWorkspaceData(authUserId: string): Promise<void> {
    this.loadingState.set(true);
    try {
      // 1. ç²å–ç”¨æˆ¶å¸³æˆ¶
      const userAccount = await this.accountService.findByAuthUserId(authUserId);
      if (!userAccount) return;
      
      // 2. ä¸¦è¡Œè¼‰å…¥çµ„ç¹”å’Œåœ˜éšŠ
      const [createdOrgs, joinedOrgs, memberTeams] = await Promise.all([
        this.accountService.getUserCreatedOrganizations(authUserId),
        this.accountService.getUserJoinedOrganizations(userAccount.id),
        this.accountService.getUserTeams(userAccount.id)
      ]);
      
      // 3. è¼‰å…¥çµ„ç¹”ä¸‹çš„æ‰€æœ‰åœ˜éšŠ
      const allOrgIds = [...createdOrgs, ...joinedOrgs].map(org => org.id);
      const orgTeamsArrays = await Promise.all(
        allOrgIds.map(orgId => 
          this.teamService.loadTeamsByOrganizationId(orgId).catch(() => [])
        )
      );
      const orgTeams = orgTeamsArrays.flat();
      
      // 4. åˆä½µåœ˜éšŠåˆ—è¡¨ï¼ˆå»é‡ï¼‰
      const allTeamsMap = new Map<string, Team>();
      [...memberTeams, ...orgTeams].forEach(team => {
        if (!allTeamsMap.has(team.id)) {
          allTeamsMap.set(team.id, team);
        }
      });
      
      // 5. æ›´æ–°ç‹€æ…‹
      this.createdOrganizationsState.set(createdOrgs);
      this.joinedOrganizationsState.set(joinedOrgs);
      this.userTeamsState.set(Array.from(allTeamsMap.values()));
      this.currentUserAccountState.set(userAccount);
    } catch (error) {
      console.error('è¼‰å…¥å·¥ä½œå€æ•¸æ“šå¤±æ•—:', error);
      throw error;
    } finally {
      this.loadingState.set(false);
    }
  }
  
  // æ ¹æ“šè¦–è§’è¼‰å…¥è—åœ–
  async loadBlueprintsByContext(
    contextType: 'app' | 'user' | 'organization' | 'team',
    contextId: string | null
  ): Promise<void> {
    if (contextType === 'app' || !contextId) {
      this.contextBlueprintsState.set([]);
      return;
    }
    
    try {
      let blueprints: Blueprint[] = [];
      
      switch (contextType) {
        case 'user':
        case 'organization':
          blueprints = await this.blueprintService.loadBlueprintsByOwnerId(contextId);
          break;
          
        case 'team':
          // åœ˜éšŠè¦–è§’ï¼šè¼‰å…¥åœ˜éšŠæ‰€å±¬çµ„ç¹”çš„è—åœ–
          const team = this.userTeamsState().find(t => t.id === contextId);
          if (team) {
            const orgId = (team as any).organizationId || (team as any).organization_id;
            if (orgId) {
              blueprints = await this.blueprintService.loadBlueprintsByOwnerId(orgId);
            }
          }
          break;
      }
      
      this.contextBlueprintsState.set(blueprints);
    } catch (error) {
      console.error('[WorkspaceDataService] è¼‰å…¥è—åœ–å¤±æ•—:', error);
      this.contextBlueprintsState.set([]);
    }
  }
}
```

#### 4.4 WorkspaceMenuServiceï¼ˆèœå–®ç®¡ç†ï¼‰

```typescript
@Injectable({ providedIn: 'root' })
export class WorkspaceMenuService {
  private readonly menuService = inject(MenuService);
  
  // èœå–®æ•¸æ“šç·©å­˜
  private userMenuData: NzSafeAny[] = [];
  private organizationMenuData: NzSafeAny[] = [];
  private teamMenuData: NzSafeAny[] = [];
  private appMenuData: NzSafeAny[] = [];
  
  // åˆå§‹åŒ–ç‹€æ…‹
  private initializedState = signal<boolean>(false);
  readonly initialized = this.initializedState.asReadonly();
  
  // åˆå§‹åŒ–èœå–®æ•¸æ“šï¼ˆåœ¨ StartupService ä¸­èª¿ç”¨ï¼‰
  initializeMenuData(data: {
    appMenu?: NzSafeAny[];
    userMenu?: NzSafeAny[];
    organizationMenu?: NzSafeAny[];
    teamMenu?: NzSafeAny[];
  }): void {
    if (data.appMenu) this.appMenuData = data.appMenu;
    if (data.userMenu) this.userMenuData = data.userMenu;
    if (data.organizationMenu) this.organizationMenuData = data.organizationMenu;
    if (data.teamMenu) this.teamMenuData = data.teamMenu;
    
    this.initializedState.set(true);
  }
  
  // åˆ‡æ›èœå–®
  switchToApp(): void {
    if (!this.initializedState()) return;
    this.menuService.clear();
    this.menuService.add(this.appMenuData);
    this.menuService.resume();
  }
  
  switchToUser(userId?: string): void {
    if (!this.initializedState()) return;
    this.menuService.clear();
    const processedMenu = userId 
      ? this.processMenuLinks(this.userMenuData, userId, 'userId')
      : this.userMenuData;
    this.menuService.add(processedMenu);
    this.menuService.resume();
  }
  
  switchToOrganization(organizationId: string): void {
    if (!this.initializedState()) return;
    this.menuService.clear();
    const processedMenu = this.processMenuLinks(this.organizationMenuData, organizationId);
    this.menuService.add(processedMenu);
    this.menuService.resume();
  }
  
  switchToTeam(teamId: string): void {
    if (!this.initializedState()) return;
    this.menuService.clear();
    const processedMenu = this.processMenuLinks(this.teamMenuData, teamId);
    this.menuService.add(processedMenu);
    this.menuService.resume();
  }
  
  // è™•ç†èœå–®éˆæ¥ä¸­çš„å‹•æ…‹ ID å ä½ç¬¦
  private processMenuLinks(
    menu: NzSafeAny[],
    id: string,
    placeholder = 'id'
  ): NzSafeAny[] {
    if (!id) return menu;
    
    const placeholderPattern = new RegExp(`:${placeholder}`, 'g');
    
    return menu.map(item => {
      const processed: NzSafeAny = { ...item };
      
      // æ›¿æ›éˆæ¥ä¸­çš„ :id æˆ– :userId
      if (processed.link && typeof processed.link === 'string') {
        processed.link = processed.link.replace(placeholderPattern, id);
        // å‘å¾Œå…¼å®¹ï¼šåŒæ™‚è™•ç† :id
        if (placeholder !== 'id') {
          processed.link = processed.link.replace(/:id/g, id);
        }
      }
      
      // éæ­¸è™•ç†å­èœå–®
      if (processed.children && Array.isArray(processed.children)) {
        processed.children = this.processMenuLinks(processed.children, id, placeholder);
      }
      
      return processed;
    });
  }
}
```

**è©•ä¼°ï¼š**
- âœ… ä½¿ç”¨ **Angular 20 Signals** é€²è¡Œç‹€æ…‹ç®¡ç†
- âœ… æš´éœ² **ReadonlySignal**ï¼Œé˜²æ­¢å¤–éƒ¨ä¿®æ”¹ç‹€æ…‹
- âœ… ä½¿ç”¨ **Computed Signals** æä¾›æ´¾ç”Ÿç‹€æ…‹
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†ï¼ˆerrorStateï¼‰
- âœ… è¼‰å…¥ç‹€æ…‹ç®¡ç†ï¼ˆloadingStateï¼‰
- âœ… æ¸…æ™°çš„è·è²¬åˆ†é›¢ï¼ˆä¸Šä¸‹æ–‡ / æ•¸æ“š / èœå–® / æŒä¹…åŒ–ï¼‰
- âœ… ä½¿ç”¨ async/await è™•ç†éåŒæ­¥æ“ä½œ
- âœ… ä¾è³´æ³¨å…¥ä½¿ç”¨ `inject()` å‡½æ•¸

**çµè«–ï¼šå®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œå¯äº¤ä»˜**

---

### 5ï¸âƒ£ Facades å±¤ âœ… å¯äº¤ä»˜

**ä½ç½®ï¼š** `src/app/core/facades/workspace-context.facade.ts`

**å¯¦ç¾ç‰¹é»ï¼š**
```typescript
@Injectable({ providedIn: 'root' })
export class WorkspaceContextFacade {
  private readonly contextService = inject(WorkspaceContextService);
  private readonly dataService = inject(WorkspaceDataService);
  private readonly menuService = inject(WorkspaceMenuService);
  private readonly errorStateService = inject(ErrorStateService);
  private readonly tokenService = inject(DA_SERVICE_TOKEN);
  
  // æš´éœ²æœå‹™ç‹€æ…‹ï¼ˆä»£ç†æ¨¡å¼ï¼‰
  readonly contextType = this.contextService.contextType;
  readonly contextId = this.contextService.contextId;
  readonly switching = this.contextService.switching;
  readonly contextLabel = this.contextService.contextLabel;
  readonly contextIcon = this.contextService.contextIcon;
  
  readonly currentUserAccount = this.dataService.currentUserAccount;
  readonly createdOrganizations = this.dataService.createdOrganizations;
  readonly joinedOrganizations = this.dataService.joinedOrganizations;
  readonly userTeams = this.dataService.userTeams;
  readonly contextBlueprints = this.dataService.contextBlueprints;
  readonly loadingOrganizations = this.dataService.loadingOrganizations;
  readonly loadingTeams = this.dataService.loadingTeams;
  
  readonly allOrganizations = this.contextService.allOrganizations;
  readonly teamsByOrganization = this.contextService.teamsByOrganization;
  readonly defaultBlueprintId = this.contextService.defaultBlueprintId;
  readonly currentBlueprintIds = this.contextService.currentBlueprintIds;
  
  constructor() {
    // Effect 1: ç›£è½ç™»éŒ„ç‹€æ…‹ï¼Œè‡ªå‹•è¼‰å…¥å·¥ä½œå€æ•¸æ“š
    effect(() => {
      const token = this.tokenService.get();
      if (token?.['user']?.['id']) {
        this.loadWorkspaceData(token['user']['id']).catch(error => {
          console.error('è¼‰å…¥å·¥ä½œå€æ•¸æ“šå¤±æ•—:', error);
          this.errorStateService.addError({
            category: 'System',
            severity: 'error',
            message: error instanceof Error ? error.message : 'è¼‰å…¥å¤±æ•—',
            context: 'workspace'
          });
        });
      } else {
        this.reset();
      }
    });
    
    // Effect 2: ç›£è½ä¸Šä¸‹æ–‡åˆ‡æ›ï¼Œè‡ªå‹•æ›´æ–°èœå–®
    effect(() => {
      const contextType = this.contextType();
      const contextId = this.contextId();
      
      if (this.switching()) return;
      if (!this.menuService.initialized()) return;
      
      switch (contextType) {
        case 'app':
          this.menuService.switchToApp();
          break;
        case 'user':
          const userId = this.currentUserAccountId();
          this.menuService.switchToUser(userId || undefined);
          break;
        case 'organization':
          if (contextId) this.menuService.switchToOrganization(contextId);
          break;
        case 'team':
          if (contextId) this.menuService.switchToTeam(contextId);
          break;
      }
    });
    
    // Effect 3: è‡ªå‹•æ¢å¾©ä¸Šä¸‹æ–‡ï¼ˆç­‰å¾…èœå–®å’Œæ•¸æ“šè¼‰å…¥å®Œæˆï¼‰
    effect(() => {
      const menuInitialized = this.menuService.initialized();
      const dataLoading = this.loadingOrganizations() || this.loadingTeams();
      const hasToken = !!this.tokenService.get()?.['user']?.['id'];
      
      if (this.hasRestoredContext) return;
      
      if (menuInitialized && !dataLoading && hasToken) {
        setTimeout(() => {
          if (!this.hasRestoredContext) {
            this.hasRestoredContext = true;
            this.restoreContext();
          }
        }, 100);
      }
    });
  }
  
  // çµ±ä¸€å°å¤–æ¥å£
  switchToApp(): void { ... }
  switchToUser(userId?: string): void { ... }
  switchToOrganization(organizationId: string): void { ... }
  switchToTeam(teamId: string): void { ... }
  
  async loadWorkspaceData(authUserId: string): Promise<void> { ... }
  async refresh(): Promise<void> { ... }
  initializeMenuData(data): void { ... }
  restoreContext(): void { ... }
  reset(): void { ... }
}
```

**è‡ªå‹•åŒ–æ©Ÿåˆ¶ï¼š**
1. **Effect 1ï¼šç™»éŒ„ç›£è½**
   - ç›£è½ç”¨æˆ¶ç™»éŒ„ç‹€æ…‹
   - è‡ªå‹•è¼‰å…¥å·¥ä½œå€æ•¸æ“šï¼ˆçµ„ç¹”ã€åœ˜éšŠï¼‰

2. **Effect 2ï¼šä¸Šä¸‹æ–‡ç›£è½**
   - ç›£è½ `contextType` å’Œ `contextId` è®ŠåŒ–
   - è‡ªå‹•åˆ‡æ›èœå–®ï¼ˆå‹•æ…‹ ID æ›¿æ›ï¼‰
   - é˜²æ­¢é‡è¤‡åˆ‡æ›ï¼ˆchecking `switching` stateï¼‰

3. **Effect 3ï¼šä¸Šä¸‹æ–‡æ¢å¾©**
   - ç›£è½èœå–®åˆå§‹åŒ–å’Œæ•¸æ“šè¼‰å…¥å®Œæˆ
   - è‡ªå‹•æ¢å¾©ä¸Šä¸€æ¬¡çš„ä¸Šä¸‹æ–‡ï¼ˆå¾ localStorageï¼‰
   - ç¢ºä¿æ¢å¾©æ™‚æ©Ÿæ­£ç¢ºï¼ˆæ•¸æ“šå·²æº–å‚™å¥½ï¼‰

**è©•ä¼°ï¼š**
- âœ… æ­£ç¢ºå¯¦ç¾ **Facade æ¨¡å¼**ï¼ˆçµ±ä¸€å°å¤–æ¥å£ï¼‰
- âœ… å”èª¿å¤šå€‹ Serviceï¼ˆcontextã€dataã€menuã€errorï¼‰
- âœ… ä½¿ç”¨ **Angular Signals + Effects** å¯¦ç¾è‡ªå‹•åŒ–
- âœ… è‡ªå‹•ä¸Šä¸‹æ–‡åˆ‡æ› â†’ èœå–®åˆ‡æ› â†’ è—åœ–è¼‰å…¥
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†ï¼ˆèˆ‡ ErrorStateService æ•´åˆï¼‰
- âœ… æä¾›æ¸…æ™°çš„å…¬é–‹ API
- âœ… ç‹€æ…‹æ¢å¾©æ©Ÿåˆ¶ï¼ˆlocalStorage æŒä¹…åŒ–ï¼‰

**çµè«–ï¼šå®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œå¯äº¤ä»˜**

---

## ğŸ“‹ åˆ†å±¤æ¶æ§‹è©•ä¼°ç¸½è¡¨

| å±¤æ¬¡ | ä½ç½® | è·è²¬ | ç‹€æ…‹ | ç¬¦åˆä¼æ¥­æ¨™æº– | å¯äº¤ä»˜ |
|------|------|------|------|-------------|--------|
| **Types** | `core/infra/types` | é¡å‹å®šç¾©å’Œæšèˆ‰ | âœ… å®Œå–„ | âœ… æ˜¯ | âœ… æ˜¯ |
| **Repositories** | `core/infra/repositories` | æ•¸æ“šå­˜å–ï¼ˆCRUDï¼‰ | âœ… å®Œå–„ | âœ… æ˜¯ | âœ… æ˜¯ |
| **Models** | `shared/models` | é ˜åŸŸæ¨¡å‹ | âœ… å®Œå–„ | âœ… æ˜¯ | âœ… æ˜¯ |
| **Services** | `shared/services` | æ¥­å‹™é‚è¼¯ | âœ… å®Œå–„ | âœ… æ˜¯ | âœ… æ˜¯ |
| **Facades** | `core/facades` | çµ±ä¸€å°å¤–æ¥å£ | âœ… å®Œå–„ | âœ… æ˜¯ | âœ… æ˜¯ |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è©•ä¼°

| åŠŸèƒ½ | ç‹€æ…‹ | è‡ªå‹•åŒ– | èªªæ˜ |
|------|------|--------|------|
| **è¦–è§’åˆ‡æ›** | âœ… å®Œå–„ | âœ… æ˜¯ | app/user/org/team å››ç¨®è¦–è§’ |
| **èœå–®åˆ‡æ›** | âœ… å®Œå–„ | âœ… æ˜¯ | è‡ªå‹•æ ¹æ“šè¦–è§’åˆ‡æ›èœå–® |
| **è—åœ–è¼‰å…¥** | âœ… å®Œå–„ | âœ… æ˜¯ | è‡ªå‹•æ ¹æ“šè¦–è§’è¼‰å…¥è—åœ–åˆ—è¡¨ |
| **å‹•æ…‹ ID æ›¿æ›** | âœ… å®Œå–„ | âœ… æ˜¯ | èœå–®éˆæ¥ä¸­çš„ :idã€:userId |
| **ç‹€æ…‹æŒä¹…åŒ–** | âœ… å®Œå–„ | âœ… æ˜¯ | localStorage æŒä¹…åŒ– |
| **ä¸Šä¸‹æ–‡æ¢å¾©** | âœ… å®Œå–„ | âœ… æ˜¯ | é‡æ–°è¼‰å…¥æ™‚è‡ªå‹•æ¢å¾© |
| **éŒ¯èª¤è™•ç†** | âœ… å®Œå–„ | âœ… æ˜¯ | çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ |
| **è¼‰å…¥ç‹€æ…‹** | âœ… å®Œå–„ | âœ… æ˜¯ | loading signals |

---

## âœ… é—œéµå„ªå‹¢ç¸½çµ

### 1. åˆ†å±¤æ¸…æ™°ï¼Œè·è²¬åˆ†æ˜
- **Types**ï¼šç´”é¡å‹å®šç¾©ï¼Œç„¡æ¥­å‹™é‚è¼¯
- **Repositories**ï¼šåªè² è²¬æ•¸æ“šå­˜å–ï¼Œä¸åŒ…å«æ¥­å‹™é‚è¼¯
- **Models**ï¼šé ˜åŸŸæ¨¡å‹ï¼Œé‡æ–°å°å‡º Types
- **Services**ï¼šæ¥­å‹™é‚è¼¯å’Œç‹€æ…‹ç®¡ç†
- **Facades**ï¼šçµ±ä¸€å°å¤–æ¥å£ï¼Œå”èª¿å¤šå€‹ Service

### 2. ä½¿ç”¨ Angular 20 ç¾ä»£åŒ–ç‰¹æ€§
- âœ… **Signals** é€²è¡Œç‹€æ…‹ç®¡ç†
- âœ… **Computed Signals** æä¾›æ´¾ç”Ÿç‹€æ…‹
- âœ… **Effects** å¯¦ç¾è‡ªå‹•åŒ–é‚è¼¯
- âœ… **inject()** å‡½æ•¸é€²è¡Œä¾è³´æ³¨å…¥
- âœ… **ReadonlySignal** é˜²æ­¢å¤–éƒ¨ä¿®æ”¹

### 3. å®Œå…¨è‡ªå‹•åŒ–
- âœ… è¦–è§’åˆ‡æ› â†’ è‡ªå‹•åˆ‡æ›èœå–®
- âœ… è¦–è§’åˆ‡æ› â†’ è‡ªå‹•è¼‰å…¥è—åœ–
- âœ… ç”¨æˆ¶ç™»éŒ„ â†’ è‡ªå‹•è¼‰å…¥å·¥ä½œå€æ•¸æ“š
- âœ… é é¢é‡è¼‰ â†’ è‡ªå‹•æ¢å¾©ä¸Šä¸‹æ–‡
- âœ… ä¸éœ€è¦æ‰‹å‹•é¸æ“‡è—åœ–

### 4. ç¬¦åˆ SOLID åŸå‰‡
- **S**ingle Responsibilityï¼šæ¯å€‹ Service è·è²¬å–®ä¸€
- **O**pen/Closedï¼šé€šéç¹¼æ‰¿ BaseRepository æ“´å±•åŠŸèƒ½
- **L**iskov Substitutionï¼šRepository å¯æ›¿æ›
- **I**nterface Segregationï¼šæ¥å£æ¸…æ™°åˆ†é›¢
- **D**ependency Inversionï¼šä¾è³´æŠ½è±¡ï¼ˆinjectï¼‰

### 5. ä¼æ¥­ç´šéŒ¯èª¤è™•ç†
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†ï¼ˆErrorStateServiceï¼‰
- âœ… æ¯å€‹ Service éƒ½æœ‰ errorState
- âœ… è¼‰å…¥å¤±æ•—ä¸é˜»æ­¢å…¶ä»–æ“ä½œ
- âœ… å®Œæ•´çš„éŒ¯èª¤æ—¥èªŒ

---

## ğŸ“ éœ€è¦ç¢ºèªçš„åœ°æ–¹ï¼ˆéåŸºç¤å±¤ï¼‰

é›–ç„¶æ‰€æœ‰åŸºç¤å±¤å®Œå…¨ç¬¦åˆä¼æ¥­æ¨™æº–ï¼Œä½†å»ºè­°æª¢æŸ¥ï¼š

### 1. Routes å±¤ï¼ˆComponentsï¼‰ - å„ªå…ˆç´šï¼šé«˜
- [ ] æª¢æŸ¥æ˜¯å¦æœ‰çµ„ä»¶é‚„åœ¨æ‰‹å‹•é¸æ“‡è—åœ–
- [ ] ç¢ºä¿æ‰€æœ‰ä½¿ç”¨è—åœ–çš„åœ°æ–¹éƒ½æ”¹ç”¨ `facade.contextBlueprints()`
- [ ] ç§»é™¤ä»»ä½•"é¸æ“‡è—åœ–"çš„ UI å…ƒç´ 
- [ ] é©—è­‰çµ„ä»¶æ˜¯å¦æ­£ç¢ºä½¿ç”¨ `computed()` æˆ– `effect()`

**ç¯„ä¾‹ï¼šæ­£ç¢ºä½¿ç”¨æ–¹å¼**
```typescript
@Component({ ... })
export class BlueprintListComponent {
  private facade = inject(WorkspaceContextFacade);
  
  // âœ… æ­£ç¢ºï¼šç›´æ¥ä½¿ç”¨ facade æä¾›çš„ signal
  readonly blueprints = this.facade.contextBlueprints;
  readonly loading = this.facade.loadingBlueprints;
  
  // âœ… æ­£ç¢ºï¼šä½¿ç”¨ computed é€²è¡Œéæ¿¾
  readonly activeBlueprints = computed(() => 
    this.blueprints().filter(b => b.status === 'active')
  );
  
  // âŒ éŒ¯èª¤ï¼šä¸è¦æ‰‹å‹•é¸æ“‡è—åœ–
  // selectBlueprint(blueprintId: string) { ... }
}
```

### 2. è·¯ç”±å®ˆè¡› - å„ªå…ˆç´šï¼šä¸­
- [ ] ç¢ºä¿è·¯ç”±å®ˆè¡›æ­£ç¢ºè¼‰å…¥è¦–è§’æ•¸æ“š
- [ ] é©—è­‰æ¬Šé™æª¢æŸ¥èˆ‡è¦–è§’åˆ‡æ›çš„æ•´åˆ
- [ ] æª¢æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾… `facade.loading()` å®Œæˆ

**ç¯„ä¾‹ï¼šè·¯ç”±å®ˆè¡›**
```typescript
export const blueprintGuard: CanActivateFn = (route, state) => {
  const facade = inject(WorkspaceContextFacade);
  const router = inject(Router);
  
  // æª¢æŸ¥æ˜¯å¦æœ‰è—åœ–
  if (facade.contextBlueprints().length === 0) {
    // å¯èƒ½éœ€è¦ç­‰å¾…è¼‰å…¥å®Œæˆ
    if (facade.loadingBlueprints()) {
      // ç­‰å¾…è¼‰å…¥...
    } else {
      // æ²’æœ‰è—åœ–ï¼Œé‡å®šå‘
      return router.createUrlTree(['/blueprints/create']);
    }
  }
  
  return true;
};
```

### 3. StartupService - å„ªå…ˆç´šï¼šé«˜
- [ ] é©—è­‰åˆå§‹åŒ–é †åºæ˜¯å¦æ­£ç¢º
- [ ] ç¢ºèªèœå–®æ•¸æ“šè¼‰å…¥å¾Œæ‰æ¢å¾©ä¸Šä¸‹æ–‡

**æ­£ç¢ºçš„åˆå§‹åŒ–é †åºï¼š**
```typescript
async load(): Promise<void> {
  // 1. Supabase èªè­‰
  await this.supabaseService.initialize();
  
  // 2. è¼‰å…¥èœå–®æ•¸æ“š
  const appMenu = await this.loadAppMenu();
  const userMenu = await this.loadUserMenu();
  const orgMenu = await this.loadOrganizationMenu();
  const teamMenu = await this.loadTeamMenu();
  
  // 3. åˆå§‹åŒ–èœå–®ï¼ˆé‡è¦ï¼šåœ¨ loadWorkspaceData ä¹‹å‰ï¼‰
  this.facade.initializeMenuData({
    appMenu,
    userMenu,
    organizationMenu: orgMenu,
    teamMenu
  });
  
  // 4. è¼‰å…¥å·¥ä½œå€æ•¸æ“š
  const token = this.tokenService.get();
  if (token?.user?.id) {
    await this.facade.loadWorkspaceData(token.user.id);
  }
  
  // 5. ä¸Šä¸‹æ–‡æ¢å¾©ï¼ˆå·²è‡ªå‹•åŒ–ï¼Œé€šé Effect 3 è™•ç†ï¼‰
  // ä¸éœ€è¦æ‰‹å‹•èª¿ç”¨ facade.restoreContext()
}
```

### 4. èœå–®çµæ§‹ - å„ªå…ˆç´šï¼šä½
- [ ] æª¢æŸ¥ `user-data.json`ã€`organization-data.json`ã€`team-data.json`
- [ ] ç¢ºèªå‹•æ…‹ ID å ä½ç¬¦æ­£ç¢ºï¼ˆ`:id`ã€`:userId`ï¼‰
- [ ] ç§»é™¤"é¸æ“‡è—åœ–"çš„èœå–®é …ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

**èœå–®ç¯„ä¾‹ï¼š**
```json
{
  "text": "Organization Blueprints",
  "children": [
    {
      "text": "Blueprint List",
      "link": "/blueprints?org=:id"  // âœ… ä½¿ç”¨ :id å ä½ç¬¦
    },
    {
      "text": "Create Blueprint",
      "link": "/blueprints/create"  // âœ… ä¸éœ€è¦ ID
    }
    // âŒ ä¸è¦æœ‰"é¸æ“‡è—åœ–"çš„èœå–®é …
  ]
}
```

---

## ğŸ¯ æœ€çµ‚çµè«–

### å¯©æŸ¥çµæœ
âœ… **æ‰€æœ‰äº”å€‹å±¤æ¬¡ï¼ˆTypesã€Repositoriesã€Modelsã€Servicesã€Facadesï¼‰å®Œå…¨ç¬¦åˆä¼æ¥­åŒ–æ¨™æº–ï¼Œå¯ä»¥äº¤ä»˜**

### æ ¸å¿ƒæˆå°±
1. âœ… **åˆ†å±¤æ¶æ§‹æ¸…æ™°**ï¼šç¬¦åˆ DDD å’Œåˆ†å±¤æ¶æ§‹åŸå‰‡
2. âœ… **ä½¿ç”¨ Angular 20 Signals**ï¼šç¾ä»£åŒ–ç‹€æ…‹ç®¡ç†
3. âœ… **å®Œå…¨è‡ªå‹•åŒ–**ï¼šè¦–è§’åˆ‡æ› â†’ èœå–®åˆ‡æ› â†’ è—åœ–è¼‰å…¥
4. âœ… **ä¸éœ€è¦æ‰‹å‹•é¸æ“‡è—åœ–**ï¼šæ ¹æ“šè¦–è§’è‡ªå‹•è¼‰å…¥
5. âœ… **éŒ¯èª¤è™•ç†å®Œå–„**ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
6. âœ… **ç¬¦åˆ SOLID åŸå‰‡**ï¼šä»£ç¢¼å¯ç¶­è­·ã€å¯æ“´å±•

### å»ºè­°å¾ŒçºŒæ­¥é©Ÿ
1. **é©—è­‰ Routes å±¤**ï¼šç¢ºä¿çµ„ä»¶æ­£ç¢ºä½¿ç”¨ Facade API
2. **æ¸¬è©¦è‡ªå‹•åŒ–æµç¨‹**ï¼šè¦–è§’åˆ‡æ› â†’ èœå–® â†’ è—åœ–
3. **æª¢æŸ¥ StartupService**ï¼šç¢ºèªåˆå§‹åŒ–é †åº
4. **æ›´æ–°æ–‡æª”**ï¼šè¨˜éŒ„ä½¿ç”¨æ–¹å¼å’Œæœ€ä½³å¯¦è¸

---

## ğŸ“š ç›¸é—œæ–‡æª”åƒè€ƒ

- [ç³»çµ±æ¶æ§‹æ€ç¶­å°åœ–](./01-ç³»çµ±æ¶æ§‹æ€ç¶­å°åœ–.mermaid.md) - æ ¸å¿ƒæ¶æ§‹æ¦‚è¦½
- [å®Œæ•´æ¶æ§‹æµç¨‹åœ–](./27-å®Œæ•´æ¶æ§‹æµç¨‹åœ–.mermaid.md) - Git-like åˆ†æ”¯æ¨¡å‹
- [æ¶æ§‹å¯©æŸ¥å ±å‘Š](./28-æ¶æ§‹å¯©æŸ¥å ±å‘Š.md) - ç”Ÿç”¢å°±ç·’ç‰ˆå¯©æŸ¥
- [é–‹ç™¼ä½œæ¥­æŒ‡å¼•](./24-é–‹ç™¼å‰æª¢æŸ¥æ¸…å–®.md) - é–‹ç™¼è¦ç¯„
- [Angular 20 æœ€ä½³å¯¦è¸](../.cursor/rules/angular.mdc) - Angular è¦ç¯„
- [TypeScript é¡å‹å®‰å…¨](../.cursor/rules/typescript.mdc) - TypeScript è¦ç¯„
- [Signals ç‹€æ…‹ç®¡ç†](../.cursor/rules/modern-angular.mdc) - ç¾ä»£åŒ– Angular
- [åˆ†å±¤æ¶æ§‹](../.cursor/rules/architecture.mdc) - æ¶æ§‹è¦ç¯„

---

**å¯©æŸ¥å®Œæˆæ—¥æœŸï¼š** 2025-11-20  
**å¯©æŸ¥è€…ï¼š** AI Coding Agent  
**å°ˆæ¡ˆç‰ˆæœ¬ï¼š** v2.0ï¼ˆGit-like åˆ†æ”¯æ¨¡å‹ï¼Œ51 å¼µè³‡æ–™è¡¨ï¼‰  
**æ¶æ§‹ç‹€æ…‹ï¼š** âœ… ç”Ÿç”¢å°±ç·’
