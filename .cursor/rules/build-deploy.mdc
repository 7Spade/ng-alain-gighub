---
description: 構建和部署規範
globs: ["angular.json", "**/build/**", "dist/**"]
alwaysApply: false
---

# 構建和部署規範

> **相關規則**：參考 [性能優化](./performance.mdc)、[依賴管理](./dependency-management.mdc)、[測試規範](./testing.mdc)

## 構建命令

```bash
# 開發環境啟動
yarn start

# 熱模塊替換（HMR）
yarn hmr

# 生產構建
yarn build

# 構建並生成 source map（用於分析）
yarn analyze

# 查看構建分析報告
yarn analyze:view
```

## 構建配置

- 使用 `ng-high-memory` 腳本處理大型項目構建
- 設置 `--max_old_space_size=8000` 避免內存不足
- 生產構建啟用優化和壓縮
- 生成 source map 用於錯誤追蹤和性能分析

## 性能分析

- 使用 `source-map-explorer` 分析構建產物
- 定期檢查 bundle 大小
- 識別大型依賴並優化
- 使用 `yarn analyze:view` 可視化分析結果
- 詳細策略參考 [性能優化規範](./performance.mdc)

## 構建優化

- 啟用 Tree Shaking 移除未使用代碼
- 使用代碼分割（Code Splitting）
- 啟用壓縮和混淆
- 優化圖片和資源加載

## 部署前檢查

部署前必須確保：
1. 構建成功無錯誤
2. 構建產物大小在合理範圍內（參考 [性能優化規範](./performance.mdc)）
3. 所有測試通過（參考 [測試規範](./testing.mdc)）
4. 性能指標達標
5. 文檔已更新

## 環境配置

- 使用環境變數管理不同環境配置
- 區分開發、測試、生產環境
- 敏感信息使用環境變數，不提交到版本控制

## 構建產物

- 構建產物輸出到 `dist/` 目錄
- 不提交構建產物到版本控制
- 使用 CI/CD 自動構建和部署

## 參考文檔

- [Angular 構建文檔](https://angular.dev/tools/cli/build)
- [source-map-explorer 文檔](https://github.com/danvk/source-map-explorer)
