---
description: Angular 20 現代化特性與遷移指南
globs: ["**/*.ts", "**/*.html"]
alwaysApply: false
---

# Angular 20 現代化特性

> **相關規則**：參考 [Angular 20 最佳實踐](./angular.mdc)、[類型安全](./typescript.mdc)

## Signal Inputs 和 Outputs

- 使用 `input()` 替代 `@Input()` 裝飾器
- 使用 `output()` 替代 `@Output()` 裝飾器
- 使用 `input.required()` 標記必需的輸入
- Signal Inputs 自動提供類型安全，無需額外類型標註（參考 [類型安全](./typescript.mdc)）

## Signal Queries

- 使用 `viewChild()` 替代 `@ViewChild()` 裝飾器
- 使用 `contentChild()` 替代 `@ContentChild()` 裝飾器
- 使用 `viewChildren()` 替代 `@ViewChildren()` 裝飾器
- 使用 `contentChildren()` 替代 `@ContentChildren()` 裝飾器
- Signal Queries 返回 Signal，在模板中調用時必須使用括號

## Standalone 遷移

- 使用 `ng generate @angular/core:standalone` 進行自動遷移
- 使用 `bootstrapApplication()` 替代 `bootstrapModule()`
- 移除不必要的 NgModules
- 確保所有組件、指令、管道都是 standalone

## 模板最佳實踐

- 在模板中調用 Signal 時必須使用括號：`{{ mySignal() }}`
- 使用 `@empty` 塊處理 `@for` 循環的空列表情況
- 使用 `track` 函數優化 `@for` 循環性能
- 避免在模板中使用複雜表達式，優先使用 `computed()` Signal

## Deferrable Views（@defer）

- 使用 `@defer { ... }` 延後非關鍵組件載入，預設 `on idle` 觸發可降低首屏 bundle（參考 [Deferrable Views](https://angular.dev/guide/templates/defer)）
- 依情境選擇觸發條件：`on viewport`（滾到才載）、`on hover`（互動才載）、`hydrate on viewport`（SSR Hydration）等
- *務必* 搭配 `@placeholder`、`@loading`、`@error` 提供視覺回饋，並運用 `minimum`、`after` 參數避免閃爍
- 將 `@defer` 套用於大型 lazy component（如 `article-comments`、`large-cmp`），並保留語義化 placeholder 內容

## View Transitions API

- Router 層級啟用 View Transitions：`provideRouter(routes, withViewTransitions())` 或 `RouterModule.forRoot(routes, { enableViewTransitions: true })`
- 透過 `onViewTransitionCreated` 可檢查 `Router` 導航結果，對僅 fragment/query 變更的情況呼叫 `transition.skipTransition()`，避免多餘動畫
- 以全域 CSS 客製 `::view-transition-old()`／`::view-transition-new()`，製作進出場動畫，並確保對 `prefers-reduced-motion` 友善

## Resource API 與資料串流

- 使用 `resource({ params, loader })` 管理 async 資料，`params` 讀取 Signals，自動重跑 `loader`
- 需要 RxJS 時改用 `rxResource({ stream })`，或利用 `resource({ stream })` 逐步產出（支援 `ReadableStream` chunk）
- `resourceRef.value()` 會回傳 Signal，可透過 `computed()`/模板 `userResource.value()?.name` 直接綁定
- 透過 `resourceRef.reload()` 觸發重新載入，錯誤狀態須在 UI 中顯示

## Signal Forms 與 Typed Forms

- Reactive Forms 預設啟用 Typed Forms：`new FormControl('', { nonNullable: true })`、`FormRecord<FormControl<string | null>>`
- 利用 `updateOn: 'blur'` 或 `updateOn: 'submit'` 延後昂貴驗證請求
- 將表單值映射到 Signals（`const firstName = signalControl(this.form.controls.firstName)`）以便在模板使用 `firstName()`，並保持 `strictNullChecks`
- 動態欄位使用 `FormArray`/`FormRecord`，新增控制項後需同步更新 UI 輔助文字與驗證訊息

## 診斷和錯誤處理

- 啟用 `strictTemplates` 以獲得更好的類型檢查（參考 [類型安全](./typescript.mdc)）
- Angular 會自動檢測未使用的 standalone imports
- 使用 Angular 的擴展診斷功能（如 NG8113）檢測問題

## 參考文檔

- [Angular Signal Inputs](https://angular.dev/api/core/input)
- [Angular Signal Queries](https://angular.dev/api/core/viewChild)
- [Angular Standalone Migration](https://angular.dev/reference/migrations/standalone)
- [Angular 20 最佳實踐](./angular.mdc)
- [Angular Deferrable Views](https://angular.dev/guide/templates/defer)
- [Angular View Transitions](https://angular.dev/guide/animations/route-animations)
- [Angular Signals Resource API](https://angular.dev/guide/signals/resource)
- [Typed Forms 指南](https://angular.dev/guide/forms/typed-forms)
