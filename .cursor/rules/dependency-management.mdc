---
description: Yarn 依賴管理規範
globs: ["package.json", "yarn.lock", ".yarnrc.yml"]
alwaysApply: true
---

# Yarn 依賴管理規範

> **相關規則**：參考 [安全規範](./security.mdc)、[構建部署](./build-deploy.mdc)

## 基本原則

- 使用 Yarn 4.9.2 作為包管理器
- 提交 `yarn.lock` 到版本控制
- 使用語意化版本範圍（^、~）
- 定期更新依賴以獲取安全修復

## 包管理器

- 項目使用 Yarn 4.9.2（通過 `packageManager` 字段指定）
- 使用 Yarn 的 PnP（Plug'n'Play）模式（如配置）
- 遵循 Yarn 的依賴解析規則

## 依賴安裝

```bash
# 安裝所有依賴
yarn install

# 添加生產依賴
yarn add <package>

# 添加開發依賴
yarn add -D <package>

# 更新依賴
yarn upgrade

# 移除依賴
yarn remove <package>
```

## 版本管理

- 使用 `^` 允許小版本和補丁版本更新
- 使用 `~` 僅允許補丁版本更新
- 固定版本僅在必要時使用
- 定期檢查和更新過時的依賴

## 依賴分類

- **dependencies**: 運行時必需的依賴
- **devDependencies**: 開發和構建時需要的依賴
- 正確分類依賴以減少生產構建大小

## 安全檢查

- 定期運行 `yarn audit` 檢查安全漏洞
- 及時修復高危和中危漏洞
- 使用 `yarn audit --fix` 自動修復（謹慎使用）
- 詳細規範參考 [安全規範](./security.mdc)

## 鎖定文件

- 必須提交 `yarn.lock` 到版本控制
- 不要手動編輯 `yarn.lock`
- 團隊成員使用相同的鎖定文件確保一致性

## 依賴更新策略

- 定期更新依賴（建議每月一次）
- 更新前檢查 CHANGELOG 和 Breaking Changes
- 在獨立分支中測試依賴更新
- 更新後運行完整測試套件

## 禁止事項

- 禁止使用 `npm install`（使用 Yarn）
- 禁止刪除 `yarn.lock`
- 禁止手動修改 `yarn.lock`
- 禁止提交 `node_modules` 目錄

## 參考文檔

- [Yarn 官方文檔](https://yarnpkg.com/)
- [語意化版本](https://semver.org/)
