---
description: 分層架構與依賴關係規範
globs: ["src/app/**/*.ts"]
alwaysApply: true
---

# 分層架構規範

> **相關規則**：參考 [Git-like 分支模型](./git-model.mdc)、[模組特定規範](./shared-specific.mdc)、[Routes 模組規範](./routes-specific.mdc)、[Core 模組規範](./core-specific.mdc)

## 依賴方向

- 嚴格遵守分層依賴方向：`routes` → `shared` → `core`
- 禁止 `routes` 直接依賴 `core`（除必要服務外）
- 禁止 `shared` 直接依賴 `routes`
- 使用 `inject()` 進行依賴注入

## 架構理解

### Git-like 分支模型

- 系統採用 Git-like 分支模型，包含主分支、組織分支、PR 機制
- 參考 `docs/13-1.md` 和 `docs/13-2.md` 了解完整架構
- 詳細規範參考 [Git-like 分支模型規範](./git-model.mdc)

### 51 張資料表架構

- 系統共包含 51 張資料表，分為 11 個模組
- 參考 `docs/30-1.md` 了解完整資料表結構
- TypeScript 模型定義需與資料庫結構保持一致（參考 [類型安全](./typescript.mdc)）

### 核心設計原則

- **暫存區機制**：48h 可撤回
- **待辦中心**：五種狀態
- **問題同步**：即時同步至主分支
- **活動記錄**：集中記錄
- **文件管理**：版本控制、縮圖、軟刪除

## 設計與實現同步

- 設計文檔應該反映實際實現，或明確標註差異
- 架構變更需同步更新 `docs/13-1.md`, `docs/13-2.md`, `docs/30-1.md` 等架構文檔
- 文檔化要求參考 [代碼質量規範](./code-quality.mdc)

## 參考文檔

- [完整架構流程圖](../../docs/13-1.md) ⭐⭐⭐⭐⭐
- [架構審查報告](../../docs/13-2.md) ⭐⭐⭐⭐⭐
- [資料表結構定義](../../docs/30-1.md) ⭐⭐⭐⭐⭐
