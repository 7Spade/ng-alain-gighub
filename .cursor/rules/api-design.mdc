---
description: API 設計與 Repository 模式規範
globs: ["src/app/core/**/*.ts", "src/app/shared/**/*.ts", "src/app/routes/**/*.ts"]
alwaysApply: false
---

# API 設計規範

> **相關規則**：參考 [錯誤處理](./error-handling.mdc)、[安全規範](./security.mdc)、[類型安全](./typescript.mdc)、[MCP 工具](./mcp-tools.mdc)

## Repository 模式

- 使用 Repository 模式封裝資料存取邏輯
- 統一回應格式與錯誤處理（參考 [錯誤處理規範](./error-handling.mdc)）
- 使用 TypeScript 類型定義 API 介面（參考 [類型安全](./typescript.mdc)）

## API 功能要求

- 支援分頁、排序、篩選查詢參數
- 實作請求快取與重試機制
- 提供統一的錯誤處理機制

## 權限驗證

- 分支相關 API 需驗證權限（擁有者/協作組織/查看者）
- PR 相關 API 需實作審核與合併邏輯
- 權限驗證必須在資料庫層（RLS）與應用層雙重驗證（參考 [安全規範](./security.mdc)）

## 資料庫操作

- 所有資料庫操作必須通過 Supabase MCP 工具（參考 [MCP 工具](./mcp-tools.mdc)）
- 啟用 Supabase RLS (Row Level Security) 檢查
- 使用 Repository 模式封裝資料存取邏輯

## 參考文檔

- [Routes 模組規範](./routes-specific.mdc)
- [Core 模組規範](./core-specific.mdc)
