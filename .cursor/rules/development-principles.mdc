---
description: Core development principles that must be followed in all development work
globs: ["**/*.ts", "**/*.tsx", "**/*.html", "**/*.less"]
alwaysApply: true
---

# Core Development Principles

> **Related Rules**: See [Code Quality](./code-quality.mdc), [Architecture Standards](./architecture.mdc)

**所有開發工作必須遵循以下四個核心原則，這是避免問題和確保代碼質量的基礎。**

---

## 1. 常見做法 (Common Practices)

### 遵循業界標準做法
- 參考 Angular、TypeScript、ng-alain 官方文檔和最佳實踐
- 遵循 Angular 20 現代語法（Standalone Components、Signals、Typed Forms）
- 使用 SHARED_IMPORTS 模式，避免碎片化導入
- 參考項目中已有的類似實現，保持一致性

### UI/UX 符合常規
- **列表頁**：只負責顯示和查看，不包含編輯和刪除功能
- **詳情頁**：負責編輯和刪除功能
- **組件職責**：每個組件有單一職責，避免功能重複
- **操作流程**：符合用戶使用習慣，避免反直覺的設計

### 避免標新立異
- 不要為了創新而創新，優先使用成熟穩定的方案
- 參考團隊管理功能的實現方式（列表頁只查看，詳情頁編輯刪除）
- 保持代碼風格和結構的一致性

---

## 2. 企業標準 (Enterprise Standards)

### 代碼結構清晰
- 嚴格遵循分層架構（routes → shared → core）
- 禁止反向依賴，確保依賴方向正確
- 使用路徑別名（@core、@shared），不使用深層路徑

### 職責分離明確
- 每個組件、服務、模組都有單一職責
- Repository 層：數據訪問
- Service 層：業務邏輯和狀態管理
- Component 層：UI 展示和用戶交互

### 錯誤處理完善
- 所有異步操作都有錯誤處理
- 使用 try-catch 捕獲錯誤
- 提供用戶友好的錯誤提示（使用 NzMessageService）
- 關鍵錯誤記錄到日誌

### 狀態管理規範
- 使用 Signals 管理狀態（signal、computed、effect）
- 避免全局狀態污染（單例服務的狀態是全局的）
- 子組件不應該影響父組件依賴的狀態
- 優先加載主要功能，輔助功能非阻塞加載

### 測試覆蓋完整
- 關鍵業務邏輯必須有單元測試
- 使用 Karma/Jasmine 進行測試
- 測試覆蓋率目標：≥80% 服務層，100% 關鍵業務邏輯

---

## 3. 符合邏輯 (Logical Consistency)

### 數據流清晰
- 數據流向明確：Component → Service → Repository → Database
- 避免循環依賴
- 狀態更新時機正確

### 命名語義化
- 變量、函數、類名能清楚表達意圖
- 使用描述性名稱（如 `isUserLoggedIn`、`userPermissions`）
- 遵循項目命名規範（kebab-case 文件名，PascalCase 類名）

### 條件判斷合理
- 避免複雜的嵌套條件
- 使用早期返回（early return）
- 條件表達式清晰易懂

### 組件初始化順序
- 優先加載主要功能（用戶最需要的內容）
- 輔助功能非阻塞加載（使用 `.catch()` 而不是 `await`）
- 避免不必要的等待

### 狀態更新時機
- 確保 loading 狀態的設置和清除是配對的
- 避免在子組件中修改父組件依賴的狀態
- 檢查單例服務的使用，確保多個組件使用同一個服務時不會互相干擾

---

## 4. 符合常理 (Common Sense)

### 功能完整性
- **聲稱完成的功能必須真正可用**，不能只是"看起來完成"
- 必須通過完整的驗證流程（類型檢查、代碼檢查、構建檢查、運行時檢查）
- 不能有阻塞用戶使用的問題（如無限加載、空轉等）

### 用戶體驗優先
- 從用戶角度思考，確保功能符合使用習慣
- 提供清晰的錯誤提示和加載狀態
- 避免讓用戶困惑的操作流程

### 避免過度設計
- 不要為了技術而技術，簡單有效的方案更好
- 避免不必要的抽象層
- 優先使用現有工具和模式

### 及時驗證
- 實現後立即驗證，不要等到最後才發現問題
- 每個階段完成後驗證構建
- 及早發現和修復問題

### 文檔與代碼一致
- 文檔描述必須與實際實現一致
- 架構變更需要同步更新文檔
- 代碼註釋清晰，說明複雜邏輯

---

## 實施檢查清單

**在完成任何功能開發後，必須檢查以下四項原則：**

### ✅ 常見做法檢查
- [ ] 是否符合 Angular/TypeScript/ng-alain 最佳實踐？
- [ ] 是否參考了項目中已有的類似實現？
- [ ] UI/UX 是否符合常規（列表頁只查看，詳情頁編輯刪除）？
- [ ] 是否避免了不必要的創新？

### ✅ 企業標準檢查
- [ ] 代碼結構是否清晰（分層架構、依賴方向）？
- [ ] 職責分離是否明確（單一職責原則）？
- [ ] 錯誤處理是否完善（所有異步操作都有錯誤處理）？
- [ ] 狀態管理是否規範（使用 Signals，避免全局狀態污染）？

### ✅ 邏輯一致性檢查
- [ ] 數據流是否清晰（Component → Service → Repository）？
- [ ] 命名是否語義化（能清楚表達意圖）？
- [ ] 條件判斷是否合理（避免複雜嵌套）？
- [ ] 組件初始化順序是否正確（優先加載主要功能）？

### ✅ 常理檢查
- [ ] 功能是否真正可用（不是"看起來完成"）？
- [ ] 用戶體驗是否良好（符合使用習慣）？
- [ ] 是否避免了過度設計（簡單有效的方案）？
- [ ] 是否及時驗證（構建檢查、運行時檢查）？

**如果任何一項檢查不通過，必須修復後才能標記為完成。**

---

## 參考案例

### 正面案例
- **團隊管理功能**：列表頁只顯示和查看，詳情頁負責編輯和刪除，職責清晰
- **組織成員管理**：使用 Service 層管理狀態，組件只負責 UI 展示

### 反面案例（已修復）
- **組織管理頁面無限加載問題**：子組件修改了父組件依賴的全局狀態，導致頁面一直顯示加載狀態
  - **問題**：`OrganizationRoleManageComponent` 調用 `loadAccounts()` 設置了全局 `loading` 狀態
  - **修復**：調整加載順序，優先加載主要功能，輔助功能非阻塞加載
  - **教訓**：避免在子組件中修改父組件依賴的狀態

---

## 相關文檔

- [代碼質量規範](./code-quality.mdc) - 詳細的驗證流程和檢查清單
- [架構標準](./architecture.mdc) - 分層架構和依賴關係
- [工作總結-組織管理頁面無限加載問題修復](../../docs/工作總結-組織管理頁面無限加載問題修復-2025-01-15.md) - 問題修復案例

---

**最後更新**：2025-01-15  
**維護者**：開發團隊
