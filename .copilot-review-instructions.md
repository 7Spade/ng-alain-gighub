# GitHub Copilot 程式碼審查指示

> **目的**：為 VS Code 的 Copilot Chat 審查功能提供統一的檢查清單。  
> 本檔案萃取自 `.github/agents/domain/` 各領域代理，提供審查時的必看項目。

## 📋 審查原則

### 回應語言
- **一律使用正體中文**進行審查回饋
- 技術術語保持英文原文

### 審查層次
1. **關鍵問題**：必須修正才能合併（❌）
2. **建議改進**：可選但強烈建議（⚠️）
3. **資訊提示**：可選的優化建議（ℹ️）

### 審查格式
```markdown
## 審查結果摘要
- 關鍵問題：X 項
- 建議改進：Y 項
- 資訊提示：Z 項

## ❌ 關鍵問題
1. [檔案路徑:行號] 問題描述
   - 原因：...
   - 建議：...
   - 參考：@file ...

## ⚠️ 建議改進
...

## ℹ️ 資訊提示
...
```

## 🔍 Angular 開發規範檢查

### 1. Standalone Components（❌ 必須）
- [ ] 所有元件必須為 Standalone
- [ ] 使用 `imports: [SHARED_IMPORTS]` 而非個別匯入
- [ ] 不得出現任何 `@NgModule` 定義

**參考**：`.cursor/rules/angular.mdc`、`docs/45-SHARED_IMPORTS-使用指南.md`

### 2. Signals API（❌ 必須）
- [ ] 狀態管理使用 `signal()` / `computed()` / `effect()`
- [ ] Input 使用 `input()` 而非 `@Input()`
- [ ] Output 使用 `output()` 而非 `@Output()`
- [ ] Query 使用 `viewChild()` / `contentChild()` 等新 API
- [ ] 禁止使用舊式裝飾器

**參考**：`.cursor/rules/modern-angular.mdc`

### 3. Modern Control Flow（❌ 必須）
- [ ] 模板使用 `@if` / `@else` 而非 `*ngIf`
- [ ] 模板使用 `@for` 搭配 `track` 而非 `*ngFor`
- [ ] 模板使用 `@switch` / `@case` 而非 `*ngSwitch`
- [ ] 使用 `@defer` 處理延遲載入區塊

**參考**：`.cursor/rules/angular.mdc`

### 4. OnPush 與效能（⚠️ 強烈建議）
- [ ] 預設使用 `ChangeDetectionStrategy.OnPush`
- [ ] 避免在模板直接呼叫函數（改用 computed signal）
- [ ] 列表使用 `track` 追蹤項目 ID
- [ ] 重型區塊使用 `@defer` 延遲載入

**參考**：`.cursor/rules/performance.mdc`

### 5. NG-ZORRO / @delon 優先（⚠️ 強烈建議）
- [ ] 表單使用 NG-ZORRO 元件（`nz-form`、`nz-input` 等）
- [ ] 表格使用 `@delon/abc/st` 或 `nz-table`
- [ ] 佈局使用 `nz-layout` 系列元件
- [ ] 確認沒有重複實作已有的元件

**參考**：`docs/38-ng-zorro-antd-組件清單與CLI指令.md`

## 🔒 安全與權限檢查

### 6. 身份驗證（❌ 必須）
- [ ] Token 僅透過 `@delon/auth TokenService` 存取
- [ ] 不得在程式碼中硬編碼 API 金鑰或密碼
- [ ] 敏感資訊使用環境變數
- [ ] 不得在日誌或回應中洩漏 PII

**參考**：`.cursor/rules/security.mdc`、`docs/34-安全檢查清單.md`

### 7. RLS 策略（❌ 必須）
- [ ] 所有資料表操作需有對應的 RLS Policy
- [ ] 前端權限使用 `@delon/acl` 控制 UI 顯示
- [ ] 不得硬編碼角色或權限
- [ ] 檔案上傳需驗證 MIME 類型與大小

**參考**：`docs/50-RLS策略開發指南.md`、`docs/09-安全與-RLS-權限矩陣.md`

### 8. 依賴安全（⚠️ 建議定期檢查）
- [ ] 執行 `yarn audit --groups dependencies --level moderate`
- [ ] CVSS ≥ 7.0 的漏洞需立即處理
- [ ] 新增依賴需檢查授權與安全性

**參考**：`.cursor/rules/security.mdc`

## 📝 TypeScript 類型安全檢查

### 9. Strict Mode（❌ 必須）
- [ ] 不得使用 `any` 類型（必要時使用 `unknown` + 類型守衛）
- [ ] 所有函數參數與回傳值有明確類型
- [ ] 表單使用 typed API（`FormGroup<T>`、`FormControl<T>`）
- [ ] 非空斷言 `!` 需有充分理由與註解

**參考**：`.cursor/rules/typescript.mdc`

### 10. 錯誤處理（❌ 必須）
- [ ] 所有 async 操作有完整的 try-catch 或 error handling
- [ ] 錯誤訊息提供有意義的上下文
- [ ] 使用 `NzMessageService` 或統一錯誤處理呈現錯誤
- [ ] Repository 層捕捉並轉換 Supabase 錯誤

**參考**：`.cursor/rules/error-handling.mdc`

## 🏗️ 架構與依賴檢查

### 11. 分層架構（❌ 必須）
- [ ] 依賴方向正確：`routes` → `shared` → `core`
- [ ] 不得反向依賴或跨層直接引用
- [ ] 路徑別名僅使用 `@core`、`@shared`、`@env`
- [ ] 禁止深層 alias（如 `@core/services/xxx`）

**參考**：`.cursor/rules/architecture.mdc`、`docs/03-專案結構說明.md`

### 12. SHARED_IMPORTS 使用（❌ 必須）
- [ ] 新元件統一使用 `imports: [SHARED_IMPORTS]`
- [ ] 不得繞過 SHARED_IMPORTS 個別匯入
- [ ] 確認所需的模組已在 SHARED_IMPORTS 中

**參考**：`docs/45-SHARED_IMPORTS-使用指南.md`

### 13. 程式碼重用（⚠️ 強烈建議）
- [ ] 避免重複實作已有的工具函數或服務
- [ ] 共用邏輯放在 `@shared` 或 `@core`
- [ ] 提交前搜尋現有實作

**參考**：`.cursor/rules/code-quality.mdc`

## 🧪 測試與品質檢查

### 14. 單元測試（⚠️ 建議）
- [ ] 新功能有對應的單元測試
- [ ] 測試覆蓋主要邏輯分支
- [ ] 測試使用 AAA 模式（Arrange / Act / Assert）
- [ ] Mock 外部依賴（Supabase、HTTP 等）

**參考**：`.cursor/rules/testing.mdc`、`docs/31-測試指南.md`

### 15. 程式碼複雜度（⚠️ 建議）
- [ ] 函數短小精幹（建議 < 50 行）
- [ ] 採用 early return 降低巢狀
- [ ] 圈複雜度合理（建議 < 10）
- [ ] 避免過深的巢狀結構

**參考**：`.cursor/rules/code-quality.mdc`

### 16. 命名與文件（ℹ️ 資訊）
- [ ] 變數與函數使用 camelCase
- [ ] 類別與介面使用 PascalCase
- [ ] 檔案使用 kebab-case
- [ ] 匯出的 API 有 JSDoc 註解
- [ ] 複雜邏輯有適當說明

**參考**：`.cursor/rules/code-quality.mdc`

## 🎨 樣式與格式檢查

### 17. Stylelint 規範（⚠️ 建議）
- [ ] LESS 樣式符合 Stylelint 規則
- [ ] 使用 ng-alain 主題變數而非硬編碼顏色
- [ ] 避免使用 `!important`
- [ ] RWD 斷點使用專案定義的變數

**參考**：`.cursor/rules/styling.mdc`、`stylelint.config.mjs`

### 18. 格式化（ℹ️ 自動修正）
- [ ] 執行 `yarn lint` 自動修正格式問題
- [ ] 執行 `yarn lint:style` 修正樣式格式
- [ ] 確保 Prettier 設定生效

**參考**：`.cursor/rules/formatting.mdc`

## ♿ 無障礙檢查

### 19. WCAG 2.1 AA（⚠️ 建議）
- [ ] 互動元素有適當的 `aria-label` 或 `aria-labelledby`
- [ ] 表單欄位有對應的 `<label>`
- [ ] 色彩對比符合 WCAG AA 標準（4.5:1）
- [ ] 鍵盤可完整操作所有功能

**參考**：`.cursor/rules/accessibility.mdc`

## 📦 建構與部署檢查

### 20. 建構驗證（❌ 必須）
- [ ] 執行 `yarn lint` 無錯誤
- [ ] 執行 `yarn lint:style` 無錯誤
- [ ] 執行 `yarn test --watch=false` 全數通過
- [ ] 執行 `yarn build` 建構成功
- [ ] 若有 type-check 指令，需執行並通過

**參考**：`docs/00-開發作業指引.md`

## 📄 文件同步檢查

### 21. 文件更新（⚠️ 建議）
- [ ] 資料表變更需更新 `docs/22-完整SQL表結構定義.md`
- [ ] API 變更需更新 `docs/26-API-接口詳細文檔.md`
- [ ] RLS 變更需更新 `docs/50-RLS策略開發指南.md`
- [ ] 新功能需更新對應的 README 或指南

**參考**：`docs-index.md`、`.github/agents/docs-index.md`

## 🔄 審查工作流程

1. **自動化檢查**
   ```bash
   yarn lint
   yarn lint:style
   yarn test --watch=false
   yarn build
   yarn audit --groups dependencies --level moderate
   ```

2. **人工審查**
   - 逐一檢查上述清單
   - 標註關鍵問題、建議改進、資訊提示
   - 提供具體的改進建議與參考文件

3. **回饋格式**
   - 使用標準審查格式
   - 提供檔案路徑與行號
   - 引用相關規範文件

4. **追蹤與驗證**
   - 開發者修正後重新審查
   - 確認所有關鍵問題已解決
   - 驗證建議改進是否採納

---

**版本**：v2.0（2025-11-18）  
**維護者**：開發團隊  
**最後更新**：2025-01-15

---

## 🔗 延伸閱讀

### 完整規範文件
- `.github/agents/copilot-instructions.md`：Copilot 總體指示
- `.github/agents/ng-project-agent.md`：專案架構與工作流程
- `.github/agents/docs-index.md`：完整文件索引

### 領域專門代理
- `.github/agents/domain/angular-agent.md`：Angular 規範
- `.github/agents/domain/typescript-agent.md`：TypeScript 規範
- `.github/agents/domain/security-agent.md`：安全規範
- `.github/agents/domain/code-quality-agent.md`：程式碼品質
- `.github/agents/domain/testing-agent.md`：測試規範
- `.github/agents/domain/performance-agent.md`：效能優化
- `.github/agents/domain/accessibility-agent.md`：無障礙規範

### Cursor 規則檔案
- `.cursor/rules/`：完整的開發規範定義
