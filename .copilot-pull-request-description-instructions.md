# GitHub Copilot Pull Request 描述指示

> **目的**：為 VS Code 的 Copilot Chat 提供統一的 PR 描述產生規範。  
> 確保 PR 描述清楚、完整且符合專案標準。

## 📋 基本原則

### 語言要求
- **PR 標題與描述一律使用正體中文**
- 程式碼區塊與技術術語保持原文

### PR 標題格式
遵循 Conventional Commits 格式：
```
<type>(<scope>): <description>
```

範例：
```
feat(auth): 新增 Google OAuth 登入功能
fix(user-list): 修正分頁顯示錯誤
refactor(task-service): 重構任務服務使用 Signals API
```

## 📝 PR 描述結構

### 完整模板
```markdown
## 📋 變更摘要
[用 1-2 段話說明此 PR 的目的與主要變更]

## 🎯 相關 Issue
Closes #123
Refs #456

## 🔧 變更類型
- [ ] ✨ 新功能（feat）
- [ ] 🐛 錯誤修正（fix）
- [ ] 📝 文件更新（docs）
- [ ] 💄 格式調整（style）
- [ ] ♻️ 程式碼重構（refactor）
- [ ] ⚡ 效能優化（perf）
- [ ] ✅ 測試相關（test）
- [ ] 🔧 建構/工具（build/chore）
- [ ] 🚨 重大變更（BREAKING CHANGE）

## 📦 變更內容

### 新增
- 新增 XXX 功能
- 新增 XXX 元件/服務

### 修改
- 修改 XXX 邏輯
- 更新 XXX 設定

### 移除
- 移除未使用的 XXX
- 刪除過時的 XXX

### 重構
- 重構 XXX 結構
- 優化 XXX 實作

## 🧪 測試

### 測試範圍
- [ ] 單元測試已新增/更新
- [ ] E2E 測試已新增/更新
- [ ] 手動測試已完成

### 測試結果
\`\`\`bash
✓ yarn lint
✓ yarn lint:style
✓ yarn test --watch=false
✓ yarn build
\`\`\`

### 測試情境
1. **情境一**：描述測試情境與預期結果
2. **情境二**：描述測試情境與預期結果

## 📸 截圖/錄影
[如有 UI 變更，請附上截圖或錄影]

## 📚 文件更新
- [ ] README 已更新
- [ ] API 文件已更新
- [ ] 使用指南已更新
- [ ] 無需文件更新

### 受影響的文件
- `docs/XX-XXX.md`
- `README.md`

## ⚠️ 重大變更
[如有 BREAKING CHANGE，請詳細說明]

### 變更說明
[說明哪些 API/行為改變了]

### 遷移指南
[提供升級/遷移步驟]

## 🔍 審查重點
請審查者特別注意：
1. XXX 的實作是否符合規範
2. XXX 的效能是否符合預期
3. XXX 的安全性是否足夠

## 📋 檢查清單

### 程式碼品質
- [ ] 遵循 Angular 20 + Signals 規範
- [ ] 使用 Standalone Components + SHARED_IMPORTS
- [ ] 使用 Modern Control Flow (@if/@for/@switch)
- [ ] 使用 OnPush 變更檢測策略
- [ ] TypeScript strict mode 通過
- [ ] 無 ESLint / Stylelint 警告

### 安全性
- [ ] 無硬編碼的 API 金鑰或密碼
- [ ] RLS 策略已正確設定
- [ ] 使用 @delon/auth TokenService 管理 token
- [ ] 檔案上傳有適當驗證
- [ ] `yarn audit` 無高風險漏洞

### 測試
- [ ] 單元測試覆蓋率 ≥ 70%
- [ ] 所有測試通過
- [ ] 新功能有對應測試
- [ ] 錯誤處理有測試

### 文件
- [ ] 程式碼有適當註解
- [ ] 公開 API 有 JSDoc
- [ ] 相關文件已更新
- [ ] README 需要時已更新

### 效能
- [ ] 無不必要的重新渲染
- [ ] 大型列表使用 track
- [ ] 重型區塊使用 @defer
- [ ] 無記憶體洩漏

## 🔗 相關連結
- 相關 PR：#XXX
- 設計稿：[連結]
- 討論串：[連結]

## 💬 額外說明
[其他需要說明的內容]

---

**審查者**：@reviewer1 @reviewer2  
**標籤**：`feat`, `needs-review`
```

## 🎯 各類型 PR 範例

### 範例 1：新功能（feat）

```markdown
## 📋 變更摘要
新增使用者個人資料編輯功能，包含頭像上傳、基本資料編輯與密碼變更。使用 NG-ZORRO 表單元件與 Supabase Storage 整合。

## 🎯 相關 Issue
Closes #123

## 🔧 變更類型
- [x] ✨ 新功能（feat）

## 📦 變更內容

### 新增
- 新增 `ProfileEditComponent` 元件（使用 Standalone + SHARED_IMPORTS）
- 新增 `ProfileService` 服務（使用 Signals 管理狀態）
- 新增頭像上傳功能（整合 Supabase Storage）
- 新增密碼變更功能（使用 Supabase Auth API）

### 修改
- 更新 `UserMenuComponent` 加入個人資料編輯入口
- 更新 `docs/26-API-接口詳細文檔.md` 新增相關 API 說明

### 檔案結構
\`\`\`
src/app/routes/profile/
├── edit/
│   ├── edit.component.ts
│   ├── edit.component.html
│   ├── edit.component.less
│   └── edit.component.spec.ts
└── profile.service.ts
    └── profile.service.spec.ts
\`\`\`

## 🧪 測試

### 測試範圍
- [x] 單元測試已新增
- [x] 手動測試已完成

### 測試結果
\`\`\`bash
✓ yarn lint (0 warnings)
✓ yarn lint:style (0 warnings)
✓ yarn test --watch=false (23/23 passed)
✓ yarn build (success)
\`\`\`

### 測試情境
1. **個人資料更新**：修改姓名、郵件等基本資料，驗證更新成功
2. **頭像上傳**：上傳新頭像（測試 JPG/PNG，< 2MB），驗證預覽與上傳
3. **密碼變更**：修改密碼，驗證驗證規則與更新流程
4. **表單驗證**：測試各欄位驗證規則（必填、格式、長度）
5. **錯誤處理**：測試網路錯誤、權限錯誤等異常情況

## 📸 截圖
![個人資料編輯頁面](./docs/images/profile-edit.png)
![頭像上傳](./docs/images/avatar-upload.png)

## 📚 文件更新
- [x] API 文件已更新

### 受影響的文件
- `docs/26-API-接口詳細文檔.md` - 新增個人資料 API 說明
- `docs/22-完整SQL表結構定義.md` - 補充 profiles 表欄位說明

## 🔍 審查重點
請審查者特別注意：
1. 頭像上傳的檔案驗證是否足夠（MIME、大小、尺寸）
2. Supabase Storage Policy 是否正確設定
3. 密碼變更的安全性（舊密碼驗證、強度檢查）
4. 表單 UX 是否友善（驗證提示、載入狀態）

## 📋 檢查清單

### 程式碼品質
- [x] 遵循 Angular 20 + Signals 規範
- [x] 使用 Standalone Components + SHARED_IMPORTS
- [x] 使用 Modern Control Flow (@if/@for)
- [x] 使用 OnPush 變更檢測策略
- [x] TypeScript strict mode 通過
- [x] 無 ESLint / Stylelint 警告

### 安全性
- [x] 無硬編碼的 API 金鑰或密碼
- [x] RLS 策略已正確設定（profiles 表與 storage）
- [x] 使用 @delon/auth TokenService 管理 token
- [x] 檔案上傳有 MIME 與大小驗證
- [x] `yarn audit` 無高風險漏洞

### 測試
- [x] 單元測試覆蓋率 78%（高於 70% 要求）
- [x] 所有測試通過
- [x] 新功能有對應測試（元件與服務）
- [x] 錯誤處理有測試

### 文件
- [x] 程式碼有適當註解
- [x] 公開 API 有 JSDoc
- [x] API 文件已更新
- [x] 表結構文件已補充

### 效能
- [x] 頭像預覽使用 URL.createObjectURL 避免 Base64
- [x] 表單使用 OnPush 策略
- [x] 上傳進度使用 Signal 管理

## 🔗 相關連結
- 設計稿：[Figma Link]

---

**審查者**：@tech-lead @security-reviewer  
**標籤**：`feat`, `needs-review`, `user-management`
```

### 範例 2：錯誤修正（fix）

```markdown
## 📋 變更摘要
修正任務列表在切換篩選條件後，分頁計算錯誤導致顯示錯誤頁碼的問題。

## 🎯 相關 Issue
Fixes #234

## 🔧 變更類型
- [x] 🐛 錯誤修正（fix）

## 📦 變更內容

### 修改
- 修正 `TaskListComponent` 分頁邏輯
- 在篩選變更時重置分頁為第一頁
- 更新分頁總數計算方式

### 程式碼變更
\`\`\`typescript
// 修正前
filterTasks(filter: TaskFilter): void {
  this.filter.set(filter);
  this.loadTasks();
}

// 修正後
filterTasks(filter: TaskFilter): void {
  this.filter.set(filter);
  this.currentPage.set(1); // 重置分頁
  this.loadTasks();
}
\`\`\`

## 🧪 測試

### 測試範圍
- [x] 單元測試已更新
- [x] 手動測試已完成

### 測試結果
\`\`\`bash
✓ yarn lint
✓ yarn test --watch=false
\`\`\`

### 測試情境
1. **初始載入**：載入第一頁，驗證分頁正確
2. **切換篩選**：切換篩選條件，驗證自動回到第一頁
3. **分頁導航**：切換到第二頁後再篩選，驗證回到第一頁
4. **清空篩選**：清空篩選條件，驗證分頁重置

## 📚 文件更新
- [ ] 無需文件更新

## 🔍 審查重點
請審查者確認：
1. 分頁重置邏輯是否完整
2. 其他篩選場景是否也需要重置

## 📋 檢查清單

### 程式碼品質
- [x] 遵循專案規範
- [x] TypeScript strict mode 通過
- [x] 無 ESLint 警告

### 測試
- [x] 單元測試已更新
- [x] 所有測試通過
- [x] 新增邊界測試

---

**審查者**：@task-team  
**標籤**：`bug`, `task-management`
```

### 範例 3：重構（refactor）

```markdown
## 📋 變更摘要
重構使用者服務（UserService）改用 Signals API，移除 RxJS BehaviorSubject，提升效能與程式碼可維護性。

## 🎯 相關 Issue
Refs #345

## 🔧 變更類型
- [x] ♻️ 程式碼重構（refactor）

## 📦 變更內容

### 修改
- 將 `UserService` 狀態管理從 RxJS 改為 Signals
- 使用 `signal()` / `computed()` 取代 `BehaviorSubject`
- 更新所有依賴此服務的元件
- 移除不必要的 RxJS operators

### 受影響檔案
- `src/app/core/services/user.service.ts`
- `src/app/routes/user/list/list.component.ts`
- `src/app/routes/user/detail/detail.component.ts`
- `src/app/layout/header/user-menu/user-menu.component.ts`

## 🧪 測試

### 測試範圍
- [x] 單元測試已更新
- [x] 整合測試已完成
- [x] 手動測試已完成

### 測試結果
\`\`\`bash
✓ yarn lint
✓ yarn test --watch=false (56/56 passed)
✓ yarn build
\`\`\`

### 效能比較
- 初始載入時間：從 420ms 降至 280ms（提升 33%）
- 記憶體使用：從 8.2MB 降至 6.5MB（減少 21%）
- Bundle Size：無明顯變化

## 📚 文件更新
- [x] API 文件已更新

### 受影響的文件
- `docs/00-開發作業指引.md` - 補充 Signals 使用範例

## ⚠️ 重大變更
無重大變更。所有 API 保持向下相容。

## 🔍 審查重點
請審查者特別注意：
1. Signal 替換是否完整（無遺漏的 RxJS 狀態）
2. 元件變更檢測是否正常（OnPush 策略）
3. 錯誤處理是否完整

## 📋 檢查清單

### 程式碼品質
- [x] 遵循 Angular 20 + Signals 規範
- [x] 所有依賴元件已更新
- [x] TypeScript strict mode 通過
- [x] 無 ESLint 警告

### 測試
- [x] 單元測試覆蓋率維持 78%
- [x] 所有測試通過
- [x] 無功能退化

### 效能
- [x] 效能測試完成
- [x] 無效能退化
- [x] 記憶體使用降低

---

**審查者**：@tech-lead  
**標籤**：`refactor`, `performance`, `signals`
```

## 📋 PR 描述檢查清單

提交 PR 前確認：
- [ ] 標題符合 Conventional Commits 格式
- [ ] 標題與描述使用正體中文
- [ ] 關聯相關 Issue（Closes/Fixes/Refs）
- [ ] 變更類型已勾選
- [ ] 變更內容清楚列出
- [ ] 測試結果已附上
- [ ] UI 變更有截圖/錄影
- [ ] 文件更新狀態已標註
- [ ] 重大變更有詳細說明
- [ ] 審查重點已列出
- [ ] 檢查清單已完成
- [ ] 指定審查者與標籤

## 🔗 相關資源

- `.copilot-commit-message-instructions.md`：Commit Message 規範
- `.github/agents/copilot-instructions.md`：完整開發指示
- `docs/00-開發作業指引.md`：開發流程規範

---

**版本**：v2.0（2025-11-18）  
**維護者**：開發團隊  
**最後更新**：2025-01-15
