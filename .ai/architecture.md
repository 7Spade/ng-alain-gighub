# 系統架構概述

> **目的**：為 AI 提供系統架構的快速參考，幫助理解項目的整體設計和核心原則。

## 🏗️ 系統架構總覽

本系統採用 **Git-like 分支模型**，是一個基於 Angular 20 + Supabase 的企業級協作平台。

### 核心技術棧

- **前端**：Angular 20.3.x + NG-ZORRO 20.3.x + NG-ALAIN 20.0.x
- **後端**：Supabase (PostgreSQL + Auth + Storage + Realtime + Edge Functions)
- **包管理**：Yarn 4.9.2
- **開發工具**：TypeScript、ESLint、Prettier、Stylelint

## 📐 分層架構

系統採用嚴格的分層架構，依賴方向為：`routes` → `shared` → `core`

```
routes (UI Layer)
  ↓ 依賴
shared (Shared Layer)
  ↓ 依賴
core (Core Layer)
  ↓ 依賴
supabase (Infrastructure)
```

### 各層職責

- **routes**：路由層，包含所有功能頁面（Dashboard、Pro、Passport 等）
- **shared**：共享層，提供可重用的組件、服務和工具
- **core**：核心層，提供基礎設施服務（HTTP 攔截、錯誤處理、國際化、路由守衛）

## 🌳 Git-like 分支模型

系統採用 Git-like 分支模型，核心概念：

- **主分支（Main Branch）**：藍圖主分支，擁有者組織控制任務結構
- **組織分支（Organization Branch）**：協作組織的工作分支
- **PR 機制**：Pull Request 審核與合併流程
- **暫存區機制**：48 小時可撤回的暫存區

### 核心設計原則

1. **暫存區機制**：48h 可撤回
2. **待辦中心**：五種狀態（待處理、進行中、已完成、已取消、已暫停）
3. **問題同步**：即時同步至主分支
4. **活動記錄**：集中記錄所有操作
5. **文件管理**：版本控制、縮圖、軟刪除

## 🗄️ 數據庫架構

系統共包含 **51 張資料表**，分為 11 個模組：

1. **帳戶與身份系統** (4 張)
2. **組織協作系統** (3 張)
3. **權限系統** (5 張)
4. **藍圖/專案系統** (5 張) - Git-like 分支模型
5. **任務執行系統** (9 張)
6. **品質驗收系統** (4 張)
7. **問題追蹤系統** (4 張)
8. **協作溝通系統** (6 張)
9. **資料分析系統** (6 張)
10. **機器人系統** (3 張)
11. **系統管理** (2 張)

## 🔐 安全架構

- **資料庫層**：Supabase RLS (Row Level Security) 行級安全
- **應用層**：權限驗證和錯誤處理
- **API 層**：Repository 模式封裝資料存取

## 📚 參考文檔

- [完整架構流程圖](../../docs/27-完整架構流程圖.mermaid.md) ⭐⭐⭐⭐⭐
- [架構審查報告](../../docs/28-架構審查報告.md) ⭐⭐⭐⭐⭐
- [資料表結構定義](../../docs/30-0-完整SQL表結構定義.md) ⭐⭐⭐⭐⭐
- [系統架構思維導圖](../../docs/10-系統架構思維導圖.mermaid.md) ⭐⭐⭐⭐⭐

---

**最後更新**：2025-01-15  
**架構版本**：v2.0

