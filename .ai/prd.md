# 產品需求摘要（AI Context）

> 對應完整文件：`docs/PRD.md`（建築工程管理系統 PRD v2.1，最後更新 2025-01-15）

## 1. 產品定位與價值主張
- **定位**：面向建築/營造產業的 B2B SaaS 平台，採 Git-like 分支模型處理跨組織承攬協作。
- **核心價值**：
  1. 主/協作分支權限分離，確保任務結構與資料品質。
  2. 1:1 承攬關係與 PR 審核機制，明確責任切割與審計軌跡。
  3. 待辦中心、進度儀表板與活動記錄提供全域可視性。
  4. 品質驗收、暫存區與問題同步貫穿施工全流程。

## 2. 主要使用者角色
| 角色 | 核心需求 |
|------|---------|
| **擁有者/業主** | 建立藍圖、鎖定任務結構、審核協作分支 PR、取得跨專案報表。 |
| **承攬商/協作組織** | 在被授權的分支中填寫任務、日誌、品質紀錄並提交 PR。 |
| **品管與驗收人員** | 建立 QC/驗收單、追蹤缺失與責任轉移、附加多媒體證據。 |
| **專案經理** | 監控待辦中心、指派任務、管理通知與活動記錄。 |
| **資料/內稽人員** | 查詢歷史紀錄、分析 KPI、下載審計報告。 |

## 3. 核心功能模組
1. **藍圖與分支管理**：藍圖主表 `blueprints`、分支 `blueprint_branches`、PR `pull_requests` 與 Fork/權限邏輯（見 `docs/27-完整架構流程圖.mermaid.md`）。
2. **任務執行**：`tasks`、`task_assignments`、`task_lists`、`task_staging` 支援 Phase→Milestone→Task→Subtask，含 48h 暫存機制與施工日誌同步 `daily_reports`。
3. **品質與驗收**：`quality_checks`、`inspections`、照片附件表，配合責任切割標記與轉移日期。
4. **問題與待辦中心**：`issues` 即時同步主分支，待辦中心整合 task / staging / QC / inspection / issue 五態。
5. **協作溝通與通知**：`comments`、`notifications`、`notification_rules`、`notification_subscriptions`；支援 @mention、附件、靜音規則。
6. **文件與分析**：`documents`、`document_versions/thumbnails` 管理圖紙/證書/報表；`progress_tracking`、`analytics_cache`、`activity_logs` 提供儀表板與審計。

## 4. 關鍵流程摘要
- **藍圖 → 分支 → PR**：擁有者建立藍圖 → 協作組織 Fork → 在分支執行任務 → 送 PR → 審核合併後僅回寫承攬欄位。
- **任務執行**：任務指派 → 接受 → 施工日誌 + 附件 → 暫存區提交 → 品管檢查 → 驗收（責任切割）。
- **品質與驗收**：QC → 驗收 → 標記事件責任轉移 → 活動記錄同步主分支。
- **問題處理**：任一分支開立 issue → 同步主分支 → 擁有者追蹤狀態與嚴重度，紀錄解法形成知識庫。
- **待辦中心**：聚合五種來源並依優先度、到期日排序，支援批次操作與通知。

## 5. 版本路線圖（摘自 `docs/44-專案路線圖.md`）
- **MVP**：Git-like 結構、任務樹、暫存區、日誌、QC/驗收最小流程、PR 審核、待辦中心。
- **Beta**：通知/訂閱、問題同步、進度儀表板、文件版本管理、組織權限矩陣。
- **GA**：多藍圖儀表板、即時聊天、機器人自動化（Bot 任務）、客製報表與 SOP 模板。

## 6. 成功量測指標
- PR 審核平均耗時 < 48h，逾期 PR 率 < 5%。
- 暫存區撤回比例 < 15%，顯示提交品質提升。
- 品質缺失閉環率（Close/Opened）≥ 90%。
- 問題同步延遲 < 5 秒，主分支問題可視率 100%。
- 施工日誌附圖覆蓋率 ≥ 95%，保證現場證據完整。

## 7. 依賴與風險（摘要）
- 需嚴格 RLS 與分支權限，資料庫/應用層雙重驗證（參考 `docs/21-安全與-RLS-權限矩陣.md`）。
- 施工日誌與天氣 API 整合需快取和重試機制。
- 品質/驗收附件使用 Supabase Storage Bucket，需搭配縮圖與權限 URL。
- 高併發 PR 或 issue 同步須觀察 PostgREST 限流與 Edge Functions 觸發行為。

## 8. 關聯文檔
- `docs/PRD.md`
- `docs/27-完整架構流程圖.mermaid.md`
- `docs/30-資料表清單總覽.md`
- `docs/44-專案路線圖.md`
- `docs/33-API-接口詳細文檔.md`
