# Definition of Done (DoD) - 企業標準

> **版本**: 1.0.0  
> **最後更新**: 2025-11-22  
> **適用範圍**: ng-alain-gighub 專案所有開發項目

## 📋 概述

本文件定義了 ng-alain-gighub 專案的企業級「完成定義」(Definition of Done, DoD)標準。所有工作項目（features, bugs, tasks）在被標記為「完成」之前，必須滿足以下所有條件。

---

## 🎯 通用 DoD 檢查清單（所有項目必須通過）

### 1. 代碼質量 ✅

#### 代碼風格
- [ ] 代碼遵循 Angular/TypeScript 官方風格指南
- [ ] 代碼遵循專案 ESLint 配置規則
- [ ] 代碼遵循專案 Prettier 格式化規則
- [ ] 代碼遵循專案 Stylelint 規則（針對樣式文件）
- [ ] 無 `console.log()` 或調試代碼殘留
- [ ] 無 `any` 類型濫用（除非有充分理由並註釋說明）
- [ ] 無未使用的導入或變量

#### 代碼檢查
- [ ] `yarn lint` 通過，無錯誤和警告
- [ ] `yarn lint:style` 通過（如有樣式更改）
- [ ] TypeScript 編譯通過，無類型錯誤
- [ ] `yarn build` 構建成功，無警告

#### 代碼審查
- [ ] 代碼已通過至少一位指定審查者的審核
- [ ] 所有代碼審查評論已被解決或回覆
- [ ] 無未解決的 TODO/FIXME 標記（或已記錄在 backlog）

### 2. 測試覆蓋 ✅

#### 單元測試
- [ ] 新增代碼有對應的單元測試
- [ ] 單元測試覆蓋率 ≥ 80%（服務層）
- [ ] 關鍵業務邏輯測試覆蓋率 = 100%
- [ ] 所有單元測試通過（`yarn test`）
- [ ] 無測試被標記為 `.skip()` 或 `.only()`

#### 集成測試
- [ ] 涉及多個模組交互的功能有集成測試
- [ ] API 調用有對應的集成測試或 mock
- [ ] 關鍵用戶流程有集成測試覆蓋

#### E2E 測試（如適用）
- [ ] 關鍵用戶流程有 E2E 測試
- [ ] E2E 測試在 CI 環境中通過

### 3. CI/CD 狀態 ✅

#### CI 檢查
- [ ] 所有 GitHub Actions CI 檢查通過（全綠）
- [ ] Build job 成功
- [ ] Lint job 成功
- [ ] Test job 成功（包含覆蓋率報告）
- [ ] 無構建警告或已評估並記錄

#### 部署準備
- [ ] 代碼可以成功部署到測試環境
- [ ] 在測試環境中驗證功能正常

### 4. 文檔更新 ✅

#### 代碼文檔
- [ ] 公開 API 有 JSDoc/TSDoc 註釋
- [ ] 複雜邏輯有清晰的代碼註釋
- [ ] 接口和類型有文檔說明

#### 用戶文檔
- [ ] README.md 已更新（如有新功能或重大變更）
- [ ] CHANGELOG.md 已更新（遵循 Keep a Changelog 格式）
- [ ] 相關技術文檔已更新（docs/ 目錄）
- [ ] API 文檔已更新（如有 API 變更）

#### 遷移指南
- [ ] 有破壞性變更時提供遷移指南
- [ ] 資料庫 schema 變更有遷移腳本
- [ ] 配置變更有升級說明

### 5. 安全與合規 ✅

#### 安全檢查
- [ ] `npm audit` 無高危或嚴重漏洞
- [ ] 無硬編碼的敏感信息（密碼、API keys 等）
- [ ] 用戶輸入有適當的驗證和清理
- [ ] 權限檢查已正確實施
- [ ] XSS/CSRF 防護已考慮並實施

#### 依賴檢查
- [ ] 新增依賴已通過團隊審核
- [ ] 依賴版本固定或使用安全範圍
- [ ] 無已知的安全漏洞依賴

### 6. 向後兼容性 ✅

- [ ] API 變更遵循語義化版本規範
- [ ] 破壞性變更已明確標記並記錄
- [ ] 現有功能無意外破壞
- [ ] 資料庫遷移可以安全執行和回滾

### 7. 性能與優化 ✅

- [ ] 無明顯性能退化（與主分支對比）
- [ ] 大型列表有分頁或虛擬滾動
- [ ] 圖片和資源已優化
- [ ] 使用 OnPush 變更檢測策略（Angular 組件）
- [ ] 避免不必要的 HTTP 請求

### 8. 用戶體驗 ✅

- [ ] UI 符合設計規範（ng-zorro-antd 風格）
- [ ] 響應式設計在主要設備上正常顯示
- [ ] 加載狀態有適當的反饋（loading spinner）
- [ ] 錯誤信息清晰友好
- [ ] 成功操作有視覺反饋（通知、消息）

### 9. 部署與回滾 ✅

#### 部署文檔
- [ ] 部署步驟已記錄或更新
- [ ] 環境變量變更已記錄
- [ ] 配置文件變更已記錄

#### 回滾準備
- [ ] 回滾步驟已記錄
- [ ] 資料庫遷移可以回滾
- [ ] 無不可逆的數據變更（或已備份）

### 10. 審查與批准 ✅

- [ ] Pull Request 描述完整清晰
- [ ] PR 包含變更摘要、測試結果、風險評估
- [ ] 指定審查者已批准 PR
- [ ] 產品負責人已簽核（重大功能）
- [ ] 所有 PR 檢查項通過

---

## 🔧 特定類型 DoD 補充標準

### Feature (新功能)

除通用 DoD 外，還需要：

- [ ] 功能需求已完整實現
- [ ] 功能規格說明已更新
- [ ] 用戶手冊或幫助文檔已更新
- [ ] 功能已在至少兩個瀏覽器中測試
- [ ] 功能已在移動設備上測試（如適用）
- [ ] 性能基準測試已完成
- [ ] A/B 測試計劃已制定（如需要）

### Bug Fix (錯誤修復)

除通用 DoD 外，還需要：

- [ ] Bug 根本原因已識別並記錄
- [ ] 修復已在複現環境中驗證
- [ ] 添加回歸測試防止問題再次發生
- [ ] 相關 bug 報告已更新或關閉
- [ ] 無新增的副作用或破壞

### Refactoring (代碼重構)

除通用 DoD 外，還需要：

- [ ] 功能行為無變化（通過測試驗證）
- [ ] 代碼複雜度降低（可量化）
- [ ] 代碼可讀性提升
- [ ] 技術債務項目已從 backlog 移除
- [ ] 重構原因和收益已記錄

### Technical Debt (技術債務清理)

除通用 DoD 外，還需要：

- [ ] 技術債務項目已完全解決
- [ ] 無新增技術債務
- [ ] 長期維護成本降低
- [ ] 團隊知識分享已完成

### Documentation (文檔更新)

- [ ] 文檔內容準確無誤
- [ ] 文檔格式一致（Markdown 格式）
- [ ] 代碼示例已測試可運行
- [ ] 鏈接全部有效
- [ ] 拼寫和語法檢查通過
- [ ] 至少一位同行審查通過

---

## 📝 PR 描述必須包含

每個 Pull Request 的描述必須包含以下內容：

```markdown
## 變更摘要
簡要描述本次變更的內容和目的。

## 變更類型
- [ ] Feature (新功能)
- [ ] Bug Fix (錯誤修復)
- [ ] Refactoring (代碼重構)
- [ ] Documentation (文檔更新)
- [ ] Performance (性能優化)
- [ ] Test (測試補充)
- [ ] CI/CD (流程改進)
- [ ] Other (其他)

## 關聯 Issue
Closes #123
Related to #456

## 測試結果
- [ ] 單元測試通過
- [ ] 集成測試通過
- [ ] E2E 測試通過（如適用）
- [ ] 手動測試通過

### 測試覆蓋率
- Before: 75%
- After: 82%

## 風險評估

### 影響範圍
描述本次變更影響的模組和功能。

### 潛在風險
列出可能的風險和緩解措施。

### 性能影響
描述對性能的影響（正面/負面/無影響）。

## 回滾步驟
1. 回滾 PR merge
2. 回滾資料庫遷移（如有）
3. 恢復配置文件（如有）
4. 重新部署上一個穩定版本

## 部署注意事項
列出部署時需要注意的事項（環境變量、配置變更、資料遷移等）。

## 截圖或錄屏
（如有 UI 變更，請附上截圖或錄屏）

## 檢查清單
- [ ] 所有 DoD 檢查項已通過
- [ ] 代碼已自我審查
- [ ] 文檔已更新
- [ ] 測試已補充
- [ ] CI 全綠
```

---

## 🔍 DoD 驗證流程

### 開發者自檢
1. 在提交 PR 前，開發者應自行檢查所有 DoD 項目
2. 在 PR 描述中勾選已完成的檢查項
3. 對於未完成的項目，提供說明或理由

### 代碼審查者檢查
1. 審查者應驗證 DoD 檢查清單的完整性
2. 對於不符合 DoD 的 PR，應要求修改後再批准
3. 審查者可以要求補充額外的檢查項（特殊情況）

### 自動化檢查
以下項目由 CI/CD 自動檢查：
- 代碼風格（ESLint, Prettier, Stylelint）
- 單元測試執行和覆蓋率
- 構建成功
- 類型檢查
- 安全漏洞掃描

---

## 🚫 DoD 豁免機制

在特殊情況下，可以申請 DoD 豁免，但必須：

1. **記錄豁免原因**：在 PR 中明確說明為何無法滿足某些 DoD
2. **獲得批准**：需要技術負責人或產品負責人批准
3. **創建技術債務項目**：將未完成的 DoD 作為技術債務記錄
4. **設定完成期限**：明確何時補齊未完成的 DoD

### 常見豁免場景
- **緊急熱修復**：可豁免文檔更新和部分測試（需後補）
- **實驗性功能**：可豁免部分測試和文檔（需標記為 experimental）
- **依賴外部資源**：某些檢查項需要外部系統支持（需記錄）

---

## 📊 DoD 合規檢查報告

每個 Sprint 結束時，團隊應生成 DoD 合規報告：

### 統計指標
- DoD 完全合規率
- 最常被豁免的檢查項
- 平均 PR 審查輪數
- CI 失敗率

### 持續改進
- 識別流程瓶頸
- 優化檢查清單
- 更新自動化工具
- 團隊培訓和分享

---

## 🔗 相關資源

- [開發最佳實踐指南](./docs/42-開發最佳實踐指南.md)
- [SHARED_IMPORTS 使用指南](./docs/37-SHARED_IMPORTS-使用指南.md)
- [五層架構開發順序](./docs/archive/00-順序.md)
- [Angular 官方風格指南](https://angular.dev/style-guide)
- [TypeScript 最佳實踐](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)

---

## 📞 聯絡與支持

如對 DoD 有疑問或建議，請：
- 在團隊會議中提出討論
- 在專案 GitHub 提出 Issue
- 聯絡技術負責人

---

**最後更新**: 2025-11-22  
**維護者**: 開發團隊  
**版本**: 1.0.0
